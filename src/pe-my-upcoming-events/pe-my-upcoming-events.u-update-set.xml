<?xml version="1.0" encoding="UTF-8"?>
<unload unload_date="2019-05-03 20:59:11">
<sp_widget action="INSERT_OR_UPDATE">
<category>custom</category>
<client_script><![CDATA[function($rootScope, $http,$timeout) {
	var c = this;

} ]]></client_script>
<controller_as>c</controller_as>
<css>.event-date{
	display: inline-block;
	margin-right: 7px;
	height:50px;
	width: 30px;

	p{
		margin-bottom: 2px;
	}
	.event-month{
		height: 16px;	
		margin-bottom: 0px;
        width: 40.04px;	
        color: $text-color;	
        font-size: 14px;	
        font-weight: 500;	
        line-height: 16px;	
        text-align: center;
      	
	}

	.event-day{
		height: 28px;	
        width: 40px;	
        color: $text-muted;	
        font-size: 24px;	
        line-height: 28px;	
        text-align: center;
	}
}

.event-info{
	display: inline-block;
	width:85%;
	vertical-align: top;
	p{
      margin-bottom: 0px;
    }
    .event-title{	
        color: $text-color;	
        font-size: 14px;	
        font-weight: 500;	
				margin-top: 0px;
      	font-size: 14px;
      
    }
    .event-attendance{
        color: $text-muted;	
        font-size: 14px;	
        line-height: 15px;
        padding-top: 6px;
    }
}

.wrap-para {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.color-black {
  color: $text-color;
}
.block-display{
  display: block;
}
</css>
<data_table>sp_instance</data_table>
<demo_data/>
<description/>
<docs display_value=""/>
<field_list/>
<has_preview>true</has_preview>
<id>my_events_test</id>
<internal>false</internal>
<link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
<name>My Upcoming Events</name>
<option_schema/>
<public>true</public>
<roles/>
<script><![CDATA[(function() {

	data.user = gs.getUserID();
	var myRsvp = new GlideRecord('sn_communities_event_rsvp');
	
	myRsvp.query();
	data.listItems =[];

var test = "start_date>=javascript:gs.beginningOfToday()";
	while (myRsvp.next()) {
		if (data.user == myRsvp.attendee.document)
		{
			var eventSysId = myRsvp.event;
			var event = new GlideRecord('sn_communities_event');
		  event.addQuery('sys_id', eventSysId);
			event.addEncodedQuery(test);
			event.query();
			while (event.next()) {
				var gd = new GlideDate();
				gd.setValue(event.start_date.getDisplayValue());
				var month = gd.getByFormat("MMMMM");
				var day = gd.getByFormat("dd");
				data.listItems.push({
					title: event.title.getDisplayValue(),
					month: month,
					day: day,
					location: event.location.getDisplayValue(),
					rsvp_status: myRsvp.rsvp_status.getDisplayValue(),
					sys_id: eventSysId.sys_id.getDisplayValue()
				})
			}
		}
	}
})();

]]></script>
<servicenow>false</servicenow>
<sys_class_name>sp_widget</sys_class_name>
<sys_created_by>allisa.liberto</sys_created_by>
<sys_created_on>2019-05-02 01:59:38</sys_created_on>
<sys_id>65491f9fdb41fb408c63dd18f4961990</sys_id>
<sys_mod_count>107</sys_mod_count>
<sys_name>My Upcoming Events</sys_name>
<sys_package display_value="Global" source="global">global</sys_package>
<sys_policy/>
<sys_scope display_value="Global">global</sys_scope>
<sys_update_name>sp_widget_65491f9fdb41fb408c63dd18f4961990</sys_update_name>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-05-03 20:58:43</sys_updated_on>
<template><![CDATA[   <div class="panel panel-default csm-widget">
      <div class="panel-heading">
         <h4 class="panel-title">${My Upcoming Events}</h4>
      </div>
      <div class="panel-body" ng-repeat="item in c.data.listItems" >
         <ul class="list-unstyled">
           <div class="col-md-2 col-xs-2 col-sm-2">
             <div class="event-date">
               <p class="event-month">{{item.month}}</p>
              <p class="event-day">{{item.day}}</p>
             </div>
           </div>
           <div class="col-md-10 col-xs-10 col-sm-10">
             <div class="event-info module">
               <p class="event-title">
                 <a class="color-black wrap-para block-display"
                 data-ng-href="/csm?id=community_event&sys_id={{::item.sys_id}}">{{item.title}}</a>
               </p>
             </div>
           </div>
         </ul>
      </div>
   </div>]]></template>
</sp_widget>
</unload>
