<?xml version="1.0" encoding="UTF-8"?><unload unload_date="2019-09-25 18:36:46">
<sys_remote_update_set action="INSERT_OR_UPDATE">
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<application_name>SP Asset Map</application_name>
<application_scope>x_snc_sp_asset_map</application_scope>
<application_version>1.0.0</application_version>
<collisions/>
<commit_date/>
<deleted/>
<description/>
<inserted/>
<name>Location Map</name>
<origin_sys_id/>
<parent display_value=""/>
<release_date/>
<remote_base_update_set display_value=""/>
<remote_parent_id/>
<remote_sys_id>eb857aeedb48c410993fdc965e961952</remote_sys_id>
<state>loaded</state>
<summary/>
<sys_class_name>sys_remote_update_set</sys_class_name>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>a7957aeedb48c410993fdc965e9619fb</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<update_set display_value=""/>
<update_source display_value=""/>
<updated/>
</sys_remote_update_set>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>DELETE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_css_include_d406560cdba93b409eb1d311ce961982</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_css_include"><m2m_sp_dependency_css_include action="DELETE"><order>100</order><sp_css_include display_value="Awesome Marker CSS">f4f5560cdba93b409eb1d311ce96197b</sp_css_include><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sys_class_name>m2m_sp_dependency_css_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 15:16:52</sys_created_on><sys_id>d406560cdba93b409eb1d311ce961982</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Awesome Marker CSS.Leaflet NG</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_css_include_d406560cdba93b409eb1d311ce961982</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-16 15:16:52</sys_updated_on></m2m_sp_dependency_css_include></record_update>]]></payload>
<payload_hash>-1600205016</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>23957aeedb48c410993fdc965e9619fe</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d914b0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Awesome Marker CSS.Leaflet NG</target_name>
<type>Dependency CSS Includes</type>
<update_domain>global</update_domain>
<update_guid>8f361e0c42a93b40c31a0f364570c26f</update_guid>
<update_guid_history>8f361e0c42a93b40c31a0f364570c26f:-1600205016,8f361e0c42a93b40c31a0f364570c26f:-1600205016,1c06560c54a93b4031f384e0b9415983:1933488180</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_css_include_71ef4b971b93b70074f3db9cdc4bcb4f</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_css_include"><sp_css_include action="INSERT_OR_UPDATE"><name>leaflet search</name><source>local</source><sp_css display_value="leaflet search css">19ff8b971b93b70074f3db9cdc4bcbfd</sp_css><sys_class_name>sp_css_include</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 21:40:02</sys_created_on><sys_id>71ef4b971b93b70074f3db9cdc4bcb4f</sys_id><sys_mod_count>1</sys_mod_count><sys_name>leaflet search</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_css_include_71ef4b971b93b70074f3db9cdc4bcb4f</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 21:40:29</sys_updated_on><url/></sp_css_include></record_update>]]></payload>
<payload_hash>310812994</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2395faeedb48c410993fdc965e961913</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91c20000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>leaflet search</target_name>
<type>CSS Include</type>
<update_domain>global</update_domain>
<update_guid>6900db973693b7008478f54e905151e7</update_guid>
<update_guid_history>6900db973693b7008478f54e905151e7:310812994,c3ef4b97f293b700b9eb3fc86d5c9162:-664079022</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_widget_ac248111dbe7b300e246e6430596198b</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sp_widget"&gt;&lt;sp_widget action="INSERT_OR_UPDATE"&gt;&lt;category&gt;custom&lt;/category&gt;&lt;client_script&gt;&lt;![CDATA[function() {
  /* widget controller */
  var c = this;
}]]&gt;&lt;/client_script&gt;&lt;controller_as&gt;c&lt;/controller_as&gt;&lt;css&gt;.category{
  font-weight: bold;
}
.row{
	padding-bottom:30px;
  vertical-align:top;
}
.information{
	border-collapse:separate;
  border-spacing: 10px 10px;
}
.drive{
  color: #0645AD;
  margin-left: 40px;
}&lt;/css&gt;&lt;data_table&gt;sp_instance&lt;/data_table&gt;&lt;demo_data/&gt;&lt;description/&gt;&lt;docs/&gt;&lt;field_list/&gt;&lt;has_preview&gt;false&lt;/has_preview&gt;&lt;id&gt;site_information&lt;/id&gt;&lt;internal&gt;false&lt;/internal&gt;&lt;link&gt;&lt;![CDATA[function link(scope, element, attrs, controller) {  }]]&gt;&lt;/link&gt;&lt;name&gt;Site Information&lt;/name&gt;&lt;option_schema/&gt;&lt;public&gt;true&lt;/public&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[(function() {
	data.instanceURL = gs.getProperty('glide.servlet.uri');
	var gr = new GlideRecord('cmn_location');
	data.attachmentSysId = input.attachmentSysId;
	gr.get(input.sysId);
	data.gr = gr;
	data.phone = gr.phone.getDisplayValue();


	data.site = {};
	data.site.name = gr.name.getDisplayValue();
	data.site.street = gr.street.getDisplayValue();
	data.site.city = gr.city.getDisplayValue();
	data.site.state = gr.state.getDisplayValue();
	data.site.zip = gr.zip.getDisplayValue();
	data.site.country = gr.country.getDisplayValue();
	data.site.phone = gr.phone.getDisplayValue();
	data.site.parent_location = gr.parent.getDisplayValue();
	data.site.lat = parseFloat(gr.latitude.getDisplayValue());
	data.site.lng = parseFloat(gr.longitude.getDisplayValue());
	data.site.contact = gr.contact.getDisplayValue();
	data.site.contact_phone = gr.contact.mobile_phone.getDisplayValue();
	data.site.contact_email = gr.contact.email.getDisplayValue();



})();]]&gt;&lt;/script&gt;&lt;servicenow&gt;false&lt;/servicenow&gt;&lt;sys_class_name&gt;sp_widget&lt;/sys_class_name&gt;&lt;sys_created_by&gt;brian.nguyen&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-08-27 16:37:09&lt;/sys_created_on&gt;&lt;sys_id&gt;ac248111dbe7b300e246e6430596198b&lt;/sys_id&gt;&lt;sys_mod_count&gt;52&lt;/sys_mod_count&gt;&lt;sys_name&gt;Site Information&lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sp_widget_ac248111dbe7b300e246e6430596198b&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-09-25 17:54:17&lt;/sys_updated_on&gt;&lt;template&gt;&lt;![CDATA[&lt;h2&gt;&lt;font color='#22A94B'&gt;{{c.data.site.name}} &lt;/font&gt;&lt;/h2&gt;
&lt;div&gt;
 &lt;table class="information"&gt; 
   &lt;tr class="row"&gt; 
   	&lt;td class="category"&gt;Address:&lt;/td&gt;
     &lt;td&gt;{{c.data.site.street}}&lt;br&gt;{{c.data.site.city}}, {{c.data.site.state}} {{c.data.site.zip}}&lt;br&gt;{{c.data.site.country}}&lt;/td&gt;
   &lt;/tr&gt;
   &lt;tr class="row"&gt; 
   	&lt;td class="category"&gt;Phone #:&lt;/td&gt;
     &lt;td&gt;{{c.data.site.phone}}&lt;/td&gt;
   &lt;/tr&gt;
   &lt;tr class="row"&gt; 
   	&lt;td class="category"&gt;Parent Location:&lt;/td&gt;
     &lt;td&gt;{{c.data.site.parent_location}}&lt;/td&gt;
   &lt;/tr&gt;
   &lt;tr class="row"&gt;
   	&lt;td class="category"&gt;Latitude:&lt;/td&gt;
     &lt;td&gt;{{c.data.site.lat}}&lt;/td&gt;
   &lt;/tr&gt;

   &lt;tr class="row"&gt;
   	&lt;td class="category"&gt;Longitude:&lt;/td&gt;
     &lt;td&gt;{{c.data.site.lng}}&lt;/td&gt;
   &lt;/tr&gt;   
   &lt;tr class="row"&gt;
   	&lt;td class="category"&gt;Contact:&lt;/td&gt;
     &lt;td&gt;{{c.data.site.contact}}&lt;/td&gt;
   &lt;/tr&gt;
    &lt;tr class="row"&gt;
   	&lt;td class="category"&gt;Contact Phone #:&lt;/td&gt;
     &lt;td&gt;{{c.data.site.contact_phone}}&lt;/td&gt;
   &lt;/tr&gt;   
   &lt;tr class="row"&gt;
   	&lt;td class="category"&gt;Contact Email:&lt;/td&gt;
     &lt;td&gt;{{c.data.site.contact_email}}&lt;/td&gt;
   &lt;/tr&gt;   
  &lt;/table&gt;
  &lt;a class="drive" target="_blank" href="https://www.google.com/maps/dir/?api=1&amp;destination={{c.data.site.lat}},{{c.data.site.lng}}"&gt;Google Maps Directions&lt;/a&gt;
   &lt;a class="drive" target="_blank" href="{{c.data.instanceURL}}sys_attachment.do?sys_id={{c.data.attachmentSysId}}"&gt;Download Information&lt;/a&gt;
&lt;!-- your widget template --&gt;
&lt;/div&gt;
]]&gt;&lt;/template&gt;&lt;/sp_widget&gt;&lt;/record_update&gt;</payload>
<payload_hash>-904375135</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2395faeedb48c410993fdc965e961916</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d698f39bb0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Site Information</target_name>
<type>Widget</type>
<update_domain>global</update_domain>
<update_guid>91eb62268048c4100ac282442a2e6d24</update_guid>
<update_guid_history>91eb62268048c4100ac282442a2e6d24:-904375135,268b6ea21f48c410ab3426bde64d02aa:570816714,0f3b6622c748c41046c674a26f4669dc:1436883108,5c0b62226448c410e26998597fefc689:-172120088,2eba2eee3108c410de7068938411b6fa:1622077105,71baa2ee3c08c41097986821d6065022:1489459010,6a38ee2ef808c41009142d705accbe98:857297794,38e7e62e0208c410d50d1cc10579d7a9:-1103872514,bb17e2eaeb08c41079515a6a475b2456:-1715034694,fee6e2ea4b08c410b56cc29749979589:161844801,b876aeaae308c410ff790b57f5d17903:-340111912,2f25e26a9508c410bae86c6efffee0b5:1281446154,60942e2a4008c41081ec7b7944ffed1e:1652051210,9454a62a3908c41088a69dda01c94bc4:-1478383218,3444662a3808c41025a3529bb158fc82:1008026926,1204eae66008c410726c65349a824acd:1372591232,e8f58355f9efb30066634bebf71bf5d9:703695405,f6754b15faefb30055a93ef1fe6aae06:1038690963,66140fd1adefb3001d04f0a5c3a4fd6c:1846590007,f480c711a4efb300a03f2f80c3b32f94:-2084595317,362f72dd21afb30070ed2ba9a58f34ec:-607817548,650f3e9dcbafb3003aa4f877598ef6c6:-1199448386,5b9ef29d49afb30015b215019e62c992:-287588313,240e329d1cafb300c77a2417ab2d817e:892666595,cbdd7e5d31afb300c0a688f6ba7db9b3:317854686,ddbdfa5de5afb300abb9db1f4ab601fa:-540395330,198d365d12afb3004ed72f46cd7ffdd0:-128085518,cf3d1e9964ebb300b2690c5127ba3f07:-1622695260,77cb5a598febb3007e27ae176008d2ca:187524630,f9538e159fabb30028fc728cb2eac6fa:1485699587,6dbaddd1b72bb30081cd083b3de0a8d1:1927439245,71aad115aa2bb3000f959608040c7ba4:1485892770,d48a9d910d2bb3000a1a3cc03aadb3ac:-431567722,237a5115ea2bb300b36a15b80a79b942:1253976605,1e5addd18d2bb30046a3e713585e0580:-1721501035,0c971551a72bb300fb3655d521e7bc3d:319081287,8a67d151ae2bb3005aa43a44e497aa28:1896258364,1d57dd11072bb300e840122d77d0c09e:1811560232,e317dd114e2bb3005b269446f1b41b42:1420530940,b0d615115d2bb300d2544d3cb80a20fa:-1902105117,8446d111b62bb3002b754c162a87d231:1817818011,0f26d111612bb300d3376e6426b3f606:-1657793570,0df59ddd17e7b3003b4702efe6d3fe60:1283981589,93c555ddc7e7b3000cc776e184a462e9:-1963516915,243555ddaae7b300d4171d0fe5014f46:415149884,1ff451ddafe7b300b8ddfa2325244e90:782915503,6de4559d2be7b3001517cf63a5e164d5:1461881349,e4d45d9d2ae7b3000361e0350e52d98f:-723957127,a7c45d9deae7b3005a262b93b958cc9b:1024460461,59a4959d47e7b300e0f7a356762a5b19:-1803831901,7224919d77e7b3006bb8c926dc5dd203:-35265485,2211959912e7b300b8271f58eb7e58e0:452815137,602481111de7b300b6ef52cd01bef88d:1215711061</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_ui_script_a292939b1b93b70074f3db9cdc4bcb6a</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_ui_script"&gt;&lt;sys_ui_script action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;description/&gt;&lt;global&gt;false&lt;/global&gt;&lt;name&gt;x_snc_sp_asset_map.leaflet search js&lt;/name&gt;&lt;script&gt;&lt;![CDATA[/*
	Name					Data passed			   Description
	Managed Events:
	 search:locationfound	{latlng, title, layer} fired after moved and show markerLocation
	 search:expanded		{}					   fired after control was expanded
	 search:collapsed		{}					   fired after control was collapsed
 	 search:cancel			{}					   fired after cancel button clicked
	Public methods:
	 setLayer()				L.LayerGroup()         set layer search at runtime
	 showAlert()            'Text message'         show alert message
	 searchText()			'Text searched'        search text by external code
*/

//TODO implement can do research on multiple sources layers and remote		
//TODO history: false,		//show latest searches in tooltip		
//FIXME option condition problem {autoCollapse: true, markerLocation: true} not show location
//FIXME option condition problem {autoCollapse: false }
//
//TODO here insert function  search inputText FIRST in _recordsCache keys and if not find results.. 
//  run one of callbacks search(sourceData,jsonpUrl or options.layer) and run this.showTooltip
//
//TODO change structure of _recordsCache
//	like this: _recordsCache = {"text-key1": {loc:[lat,lng], ..other attributes.. }, {"text-key2": {loc:[lat,lng]}...}, ...}
//	in this mode every record can have a free structure of attributes, only 'loc' is required
//TODO important optimization!!! always append data in this._recordsCache
//  now _recordsCache content is emptied and replaced with new data founded
//  always appending data on _recordsCache give the possibility of caching ajax, jsonp and layersearch!
//
//TODO here insert function  search inputText FIRST in _recordsCache keys and if not find results.. 
//  run one of callbacks search(sourceData,jsonpUrl or options.layer) and run this.showTooltip
//
//TODO change structure of _recordsCache
//	like this: _recordsCache = {"text-key1": {loc:[lat,lng], ..other attributes.. }, {"text-key2": {loc:[lat,lng]}...}, ...}
//	in this way every record can have a free structure of attributes, only 'loc' is required

(function (factory) {
    if(typeof define === 'function' &amp;&amp; define.amd) {
    //AMD
        define(['leaflet'], factory);
    } else if(typeof module !== 'undefined') {
    // Node/CommonJS
        module.exports = factory(require('leaflet'));
    } else {
    // Browser globals
        if(typeof window.L === 'undefined')
            throw 'Leaflet must be loaded first';
        factory(window.L);
    }
})(function (L) {


L.Control.Search = L.Control.extend({
	
	includes: L.version[0]==='1' ? L.Evented.prototype : L.Mixin.Events,

	options: {
		url: '',						//url for search by ajax request, ex: "search.php?q={s}". Can be function to returns string for dynamic parameter setting
		layer: null,					//layer where search markers(is a L.LayerGroup)				
		sourceData: null,				//function to fill _recordsCache, passed searching text by first param and callback in second				
		//TODO implements uniq option 'sourceData' to recognizes source type: url,array,callback or layer				
		jsonpParam: null,				//jsonp param name for search by jsonp service, ex: "callback"
		propertyLoc: 'loc',				//field for remapping location, using array: ['latname','lonname'] for select double fields(ex. ['lat','lon'] ) support dotted format: 'prop.subprop.title'
		propertyName: 'title',			//property in marker.options(or feature.properties for vector layer) trough filter elements in layer,
		formatData: null,				//callback for reformat all data from source to indexed data object
		filterData: null,				//callback for filtering data from text searched, params: textSearch, allRecords
		moveToLocation: null,			//callback run on location found, params: latlng, title, map
		buildTip: null,					//function to return row tip html node(or html string), receive text tooltip in first param
		container: '',					//container id to insert Search Control		
		zoom: null,						//default zoom level for move to location
		minLength: 1,					//minimal text length for autocomplete
		initial: true,					//search elements only by initial text
		casesensitive: false,			//search elements in case sensitive text
		autoType: true,					//complete input with first suggested result and select this filled-in text.
		delayType: 400,					//delay while typing for show tooltip
		tooltipLimit: -1,				//limit max results to show in tooltip. -1 for no limit, 0 for no results
		tipAutoSubmit: true,			//auto map panTo when click on tooltip
		firstTipSubmit: false,			//auto select first result con enter click
		autoResize: true,				//autoresize on input change
		collapsed: true,				//collapse search control at startup
		autoCollapse: false,			//collapse search control after submit(on button or on tips if enabled tipAutoSubmit)
		autoCollapseTime: 1200,			//delay for autoclosing alert and collapse after blur
		textErr: 'Location not found',	//error message
		textCancel: 'Cancel',		    //title in cancel button		
		textPlaceholder: 'Search...',   //placeholder value			
		hideMarkerOnCollapse: false,    //remove circle and marker on search control collapsed		
		position: 'topleft',		
		marker: {						//custom L.Marker or false for hide
			icon: false,				//custom L.Icon for maker location or false for hide
			animate: true,				//animate a circle over location found
			circle: {					//draw a circle in location found
				radius: 10,
				weight: 3,
				color: '#e03',
				stroke: true,
				fill: false
			}
		}
	},

	_getPath: function(obj, prop) {
		var parts = prop.split('.'),
			last = parts.pop(),
			len = parts.length,
			cur = parts[0],
			i = 1;

		if(len &gt; 0)
			while((obj = obj[cur]) &amp;&amp; i &lt; len)
				cur = parts[i++];

		if(obj)
			return obj[last];
	},

	_isObject: function(obj) {
		return Object.prototype.toString.call(obj) === "[object Object]";
	},

	initialize: function(options) {
		L.Util.setOptions(this, options || {});
		this._inputMinSize = this.options.textPlaceholder ? this.options.textPlaceholder.length : 10;
		this._layer = this.options.layer || new L.LayerGroup();
		this._filterData = this.options.filterData || this._defaultFilterData;
		this._formatData = this.options.formatData || this._defaultFormatData;
		this._moveToLocation = this.options.moveToLocation || this._defaultMoveToLocation;
		this._autoTypeTmp = this.options.autoType;	//useful for disable autoType temporarily in delete/backspace keydown
		this._countertips = 0;		//number of tips items
		this._recordsCache = {};	//key,value table! to store locations! format: key,latlng
		this._curReq = null;
	},

	onAdd: function (map) {
		this._map = map;
		this._container = L.DomUtil.create('div', 'leaflet-control-search');
		this._input = this._createInput(this.options.textPlaceholder, 'search-input');
		this._tooltip = this._createTooltip('search-tooltip');
		this._cancel = this._createCancel(this.options.textCancel, 'search-cancel');
		this._button = this._createButton(this.options.textPlaceholder, 'search-button');
		this._alert = this._createAlert('search-alert');

		if(this.options.collapsed===false)
			this.expand(this.options.collapsed);

		if(this.options.marker) {
			
			if(this.options.marker instanceof L.Marker || this.options.marker instanceof L.CircleMarker)
				this._markerSearch = this.options.marker;

			else if(this._isObject(this.options.marker))
				this._markerSearch = new L.Control.Search.Marker([0,0], this.options.marker);

			this._markerSearch._isMarkerSearch = true;
		}

		this.setLayer( this._layer );

		map.on({
			// 		'layeradd': this._onLayerAddRemove,
			// 		'layerremove': this._onLayerAddRemove
			'resize': this._handleAutoresize
			}, this);
		return this._container;
	},
	addTo: function (map) {

		if(this.options.container) {
			this._container = this.onAdd(map);
			this._wrapper = L.DomUtil.get(this.options.container);
			this._wrapper.style.position = 'relative';
			this._wrapper.appendChild(this._container);
		}
		else
			L.Control.prototype.addTo.call(this, map);

		return this;
	},

	onRemove: function(map) {
		this._recordsCache = {};
		// map.off({
		// 		'layeradd': this._onLayerAddRemove,
		// 		'layerremove': this._onLayerAddRemove
		// 	}, this);
		map.off({
			// 		'layeradd': this._onLayerAddRemove,
			// 		'layerremove': this._onLayerAddRemove
			'resize': this._handleAutoresize
			}, this);
	},

	// _onLayerAddRemove: function(e) {
	// 	//without this, run setLayer also for each Markers!! to optimize!
	// 	if(e.layer instanceof L.LayerGroup)
	// 		if( L.stamp(e.layer) != L.stamp(this._layer) )
	// 			this.setLayer(e.layer);
	// },

	setLayer: function(layer) {	//set search layer at runtime
		//this.options.layer = layer; //setting this, run only this._recordsFromLayer()
		this._layer = layer;
		this._layer.addTo(this._map);
		return this;
	},
	
	showAlert: function(text) {
		var self = this;
		text = text || this.options.textErr;
		this._alert.style.display = 'block';
		this._alert.innerHTML = text;
		clearTimeout(this.timerAlert);
		
		this.timerAlert = setTimeout(function() {
			self.hideAlert();
		},this.options.autoCollapseTime);
		return this;
	},
	
	hideAlert: function() {
		this._alert.style.display = 'none';
		return this;
	},
		
	cancel: function() {
		this._input.value = '';
		this._handleKeypress({ keyCode: 8 });//simulate backspace keypress
		this._input.size = this._inputMinSize;
		this._input.focus();
		this._cancel.style.display = 'none';
		this._hideTooltip();
		this.fire('search:cancel');
		return this;
	},
	
	expand: function(toggle) {
		toggle = typeof toggle === 'boolean' ? toggle : true;
		this._input.style.display = 'block';
		L.DomUtil.addClass(this._container, 'search-exp');
		if ( toggle !== false ) {
			this._input.focus();
			this._map.on('dragstart click', this.collapse, this);
		}
		this.fire('search:expanded');
		return this;	
	},

	collapse: function() {
		this._hideTooltip();
		this.cancel();
		this._alert.style.display = 'none';
		this._input.blur();
		if(this.options.collapsed)
		{
			this._input.style.display = 'none';
			this._cancel.style.display = 'none';			
			L.DomUtil.removeClass(this._container, 'search-exp');		
			if (this.options.hideMarkerOnCollapse) {
				this._map.removeLayer(this._markerSearch);
			}
			this._map.off('dragstart click', this.collapse, this);
		}
		this.fire('search:collapsed');
		return this;
	},
	
	collapseDelayed: function() {	//collapse after delay, used on_input blur
		var self = this;
		if (!this.options.autoCollapse) return this;
		clearTimeout(this.timerCollapse);
		this.timerCollapse = setTimeout(function() {
			self.collapse();
		}, this.options.autoCollapseTime);
		return this;		
	},

	collapseDelayedStop: function() {
		clearTimeout(this.timerCollapse);
		return this;		
	},

	////start DOM creations
	_createAlert: function(className) {
		var alert = L.DomUtil.create('div', className, this._container);
		alert.style.display = 'none';

		L.DomEvent
			.on(alert, 'click', L.DomEvent.stop, this)
			.on(alert, 'click', this.hideAlert, this);

		return alert;
	},

	_createInput: function (text, className) {
		var self = this;
		var label = L.DomUtil.create('label', className, this._container);
		var input = L.DomUtil.create('input', className, this._container);
		input.type = 'text';
		input.size = this._inputMinSize;
		input.value = '';
		input.autocomplete = 'off';
		input.autocorrect = 'off';
		input.autocapitalize = 'off';
		input.placeholder = text;
		input.style.display = 'none';
		input.role = 'search';
		input.id = input.role + input.type + input.size;
		
		label.htmlFor = input.id;
		label.style.display = 'none';
		label.value = text;

		L.DomEvent
			.disableClickPropagation(input)
			.on(input, 'keyup', this._handleKeypress, this)
			.on(input, 'paste', function(e) {
				setTimeout(function(e) {
					self._handleKeypress(e);
				},10,e);
			}, this)
			.on(input, 'blur', this.collapseDelayed, this)
			.on(input, 'focus', this.collapseDelayedStop, this);
		
		return input;
	},

	_createCancel: function (title, className) {
		var cancel = L.DomUtil.create('a', className, this._container);
		cancel.href = '#';
		cancel.title = title;
		cancel.style.display = 'none';
		cancel.innerHTML = "&lt;span&gt;&amp;otimes;&lt;/span&gt;";//imageless(see css)

		L.DomEvent
			.on(cancel, 'click', L.DomEvent.stop, this)
			.on(cancel, 'click', this.cancel, this);

		return cancel;
	},
	
	_createButton: function (title, className) {
		var button = L.DomUtil.create('a', className, this._container);
		button.href = '#';
		button.title = title;

		L.DomEvent
			.on(button, 'click', L.DomEvent.stop, this)
			.on(button, 'click', this._handleSubmit, this)			
			.on(button, 'focus', this.collapseDelayedStop, this)
			.on(button, 'blur', this.collapseDelayed, this);

		return button;
	},

	_createTooltip: function(className) {
		var self = this;		
		var tool = L.DomUtil.create('ul', className, this._container);
		tool.style.display = 'none';
		L.DomEvent
			.disableClickPropagation(tool)
			.on(tool, 'blur', this.collapseDelayed, this)
			.on(tool, 'mousewheel', function(e) {
				self.collapseDelayedStop();
				L.DomEvent.stopPropagation(e);//disable zoom map
			}, this)
			.on(tool, 'mouseover', function(e) {
				self.collapseDelayedStop();
			}, this);
		return tool;
	},

	_createTip: function(text, val) {//val is object in recordCache, usually is Latlng
		var tip;
		
		if(this.options.buildTip)
		{
			tip = this.options.buildTip.call(this, text, val); //custom tip node or html string
			if(typeof tip === 'string')
			{
				var tmpNode = L.DomUtil.create('div');
				tmpNode.innerHTML = tip;
				tip = tmpNode.firstChild;
			}
		}
		else
		{
			tip = L.DomUtil.create('li', '');
			tip.innerHTML = text;
		}
		
		L.DomUtil.addClass(tip, 'search-tip');
		tip._text = text; //value replaced in this._input and used by _autoType

		if(this.options.tipAutoSubmit)
			L.DomEvent
				.disableClickPropagation(tip)		
				.on(tip, 'click', L.DomEvent.stop, this)
				.on(tip, 'click', function(e) {
					this._input.value = text;
					this._handleAutoresize();
					this._input.focus();
					this._hideTooltip();	
					this._handleSubmit();
				}, this);

		return tip;
	},

	//////end DOM creations

	_getUrl: function(text) {
		return (typeof this.options.url === 'function') ? this.options.url(text) : this.options.url;
	},

	_defaultFilterData: function(text, records) {
	
		var I, icase, regSearch, frecords = {};

		text = text.replace(/[.*+?^${}()|[\]\\]/g, '');  //sanitize remove all special characters
		if(text==='')
			return [];

		I = this.options.initial ? '^' : '';  //search only initial text
		icase = !this.options.casesensitive ? 'i' : undefined;

		regSearch = new RegExp(I + text, icase);

		//TODO use .filter or .map
		for(var key in records) {
			if( regSearch.test(key) )
				frecords[key]= records[key];
		}
		
		return frecords;
	},

	showTooltip: function(records) {
		

		this._countertips = 0;
		this._tooltip.innerHTML = '';
		this._tooltip.currentSelection = -1;  //inizialized for _handleArrowSelect()

		if(this.options.tooltipLimit)
		{
			for(var key in records)//fill tooltip
			{
				if(this._countertips === this.options.tooltipLimit)
					break;
				
				this._countertips++;

				this._tooltip.appendChild( this._createTip(key, records[key]) );
			}
		}
		
		if(this._countertips &gt; 0)
		{
			this._tooltip.style.display = 'block';
			
			if(this._autoTypeTmp)
				this._autoType();

			this._autoTypeTmp = this.options.autoType;//reset default value
		}
		else
			this._hideTooltip();

		this._tooltip.scrollTop = 0;

		return this._countertips;
	},

	_hideTooltip: function() {
		this._tooltip.style.display = 'none';
		this._tooltip.innerHTML = '';
		return 0;
	},

	_defaultFormatData: function(json) {	//default callback for format data to indexed data
		var self = this,
			propName = this.options.propertyName,
			propLoc = this.options.propertyLoc,
			i, jsonret = {};

		if( L.Util.isArray(propLoc) )
			for(i in json)
				jsonret[ self._getPath(json[i],propName) ]= L.latLng( json[i][ propLoc[0] ], json[i][ propLoc[1] ] );
		else
			for(i in json)
				jsonret[ self._getPath(json[i],propName) ]= L.latLng( self._getPath(json[i],propLoc) );
		//TODO throw new Error("propertyName '"+propName+"' not found in JSON data");
		return jsonret;
	},

	_recordsFromJsonp: function(text, callAfter) {  //extract searched records from remote jsonp service
		L.Control.Search.callJsonp = callAfter;
		var script = L.DomUtil.create('script','leaflet-search-jsonp', document.getElementsByTagName('body')[0] ),			
			url = L.Util.template(this._getUrl(text)+'&amp;'+this.options.jsonpParam+'=L.Control.Search.callJsonp', {s: text}); //parsing url
			//rnd = '&amp;_='+Math.floor(Math.random()*10000);
			//TODO add rnd param or randomize callback name! in recordsFromJsonp
		script.type = 'text/javascript';
		script.src = url;
		return { abort: function() { script.parentNode.removeChild(script); } };
	},

	_recordsFromAjax: function(text, callAfter) {	//Ajax request
		if (window.XMLHttpRequest === undefined) {
			window.XMLHttpRequest = function() {
				try { return new ActiveXObject("Microsoft.XMLHTTP.6.0"); }
				catch  (e1) {
					try { return new ActiveXObject("Microsoft.XMLHTTP.3.0"); }
					catch (e2) { throw new Error("XMLHttpRequest is not supported"); }
				}
			};
		}
		var IE8or9 = ( L.Browser.ie &amp;&amp; !window.atob &amp;&amp; document.querySelector ),
			request = IE8or9 ? new XDomainRequest() : new XMLHttpRequest(),
			url = L.Util.template(this._getUrl(text), {s: text});

		//rnd = '&amp;_='+Math.floor(Math.random()*10000);
		//TODO add rnd param or randomize callback name! in recordsFromAjax			
		
		request.open("GET", url);
		

		request.onload = function() {
			callAfter( JSON.parse(request.responseText) );
		};
		request.onreadystatechange = function() {
		    if(request.readyState === 4 &amp;&amp; request.status === 200) {
		    	this.onload();
		    }
		};

		request.send();
		return request;   
	},

  _searchInLayer: function(layer, retRecords, propName) {
    var self = this, loc;

    if(layer instanceof L.Control.Search.Marker) return;

    if(layer instanceof L.Marker || layer instanceof L.CircleMarker)
    {
      if(self._getPath(layer.options,propName))
      {
        loc = layer.getLatLng();
        loc.layer = layer;
        retRecords[ self._getPath(layer.options,propName) ] = loc;
      }
      else if(self._getPath(layer.feature.properties,propName))
      {
        loc = layer.getLatLng();
        loc.layer = layer;
        retRecords[ self._getPath(layer.feature.properties,propName) ] = loc;
      }
      else {
        //throw new Error("propertyName '"+propName+"' not found in marker"); 
        console.warn("propertyName '"+propName+"' not found in marker"); 
      }
    }
    else if(layer instanceof L.Path || layer instanceof L.Polyline || layer instanceof L.Polygon)
    {
      if(self._getPath(layer.options,propName))
      {
        loc = layer.getBounds().getCenter();
        loc.layer = layer;
        retRecords[ self._getPath(layer.options,propName) ] = loc;
      }
      else if(self._getPath(layer.feature.properties,propName))
      {
        loc = layer.getBounds().getCenter();
        loc.layer = layer;
        retRecords[ self._getPath(layer.feature.properties,propName) ] = loc;
      }
      else {
        //throw new Error("propertyName '"+propName+"' not found in shape"); 
        console.warn("propertyName '"+propName+"' not found in shape"); 
      }
    }
    else if(layer.hasOwnProperty('feature'))//GeoJSON
    {
      if(layer.feature.properties.hasOwnProperty(propName))
      {
        if(layer.getLatLng &amp;&amp; typeof layer.getLatLng === 'function') {
          loc = layer.getLatLng();
          loc.layer = layer;			
          retRecords[ layer.feature.properties[propName] ] = loc;
        } else if(layer.getBounds &amp;&amp; typeof layer.getBounds === 'function') {
          loc = layer.getBounds().getCenter();
          loc.layer = layer;			
          retRecords[ layer.feature.properties[propName] ] = loc;
        } else {
          console.warn("Unknown type of Layer");
        }
      }
      else {
        //throw new Error("propertyName '"+propName+"' not found in feature");
        console.warn("propertyName '"+propName+"' not found in feature"); 
      }
    }
    else if(layer instanceof L.LayerGroup)
    {
      layer.eachLayer(function (layer) {
        self._searchInLayer(layer, retRecords, propName);
      });
    }
  },
	
	_recordsFromLayer: function() {	//return table: key,value from layer
		var self = this,
			retRecords = {},
			propName = this.options.propertyName;
		
		this._layer.eachLayer(function (layer) {
			self._searchInLayer(layer, retRecords, propName);
		});
		
		return retRecords;
	},
	
	_autoType: function() {
		
		//TODO implements autype without selection(useful for mobile device)
		
		var start = this._input.value.length,
			firstRecord = this._tooltip.firstChild ? this._tooltip.firstChild._text : '',
			end = firstRecord.length;

		if (firstRecord.indexOf(this._input.value) === 0) { // If prefix match
			this._input.value = firstRecord;
			this._handleAutoresize();

			if (this._input.createTextRange) {
				var selRange = this._input.createTextRange();
				selRange.collapse(true);
				selRange.moveStart('character', start);
				selRange.moveEnd('character', end);
				selRange.select();
			}
			else if(this._input.setSelectionRange) {
				this._input.setSelectionRange(start, end);
			}
			else if(this._input.selectionStart) {
				this._input.selectionStart = start;
				this._input.selectionEnd = end;
			}
		}
	},

	_hideAutoType: function() {	// deselect text:

		var sel;
		if ((sel = this._input.selection) &amp;&amp; sel.empty) {
			sel.empty();
		}
		else if (this._input.createTextRange) {
			sel = this._input.createTextRange();
			sel.collapse(true);
			var end = this._input.value.length;
			sel.moveStart('character', end);
			sel.moveEnd('character', end);
			sel.select();
		}
		else {
			if (this._input.getSelection) {
				this._input.getSelection().removeAllRanges();
			}
			this._input.selectionStart = this._input.selectionEnd;
		}
	},
	
	_handleKeypress: function (e) {	//run _input keyup event
		var self = this;

		switch(e.keyCode)
		{
			case 27://Esc
				this.collapse();
			break;
			case 13://Enter
				if(this._countertips == 1 || (this.options.firstTipSubmit &amp;&amp; this._countertips &gt; 0)) {
          			if(this._tooltip.currentSelection == -1) {
						this._handleArrowSelect(1);
          			}
				}
				this._handleSubmit();	//do search
			break;
			case 38://Up
				this._handleArrowSelect(-1);
			break;
			case 40://Down
				this._handleArrowSelect(1);
			break;
			case  8://Backspace
			case 45://Insert
			case 46://Delete
				this._autoTypeTmp = false;//disable temporarily autoType
			break;
			case 37://Left
			case 39://Right
			case 16://Shift
			case 17://Ctrl
			case 35://End
			case 36://Home
			break;
			default://All keys
				if(this._input.value.length)
					this._cancel.style.display = 'block';
				else
					this._cancel.style.display = 'none';

				if(this._input.value.length &gt;= this.options.minLength)
				{
					clearTimeout(this.timerKeypress);	//cancel last search request while type in				
					this.timerKeypress = setTimeout(function() {	//delay before request, for limit jsonp/ajax request

						self._fillRecordsCache();
					
					}, this.options.delayType);
				}
				else
					this._hideTooltip();
		}

		this._handleAutoresize();
	},

	searchText: function(text) {
		var code = text.charCodeAt(text.length);

		this._input.value = text;

		this._input.style.display = 'block';
		L.DomUtil.addClass(this._container, 'search-exp');

		this._autoTypeTmp = false;

		this._handleKeypress({keyCode: code});
	},
	
	_fillRecordsCache: function() {

		var self = this,
			inputText = this._input.value, records;

		if(this._curReq &amp;&amp; this._curReq.abort)
			this._curReq.abort();
		//abort previous requests

		L.DomUtil.addClass(this._container, 'search-load');	

		if(this.options.layer)
		{
			//TODO _recordsFromLayer must return array of objects, formatted from _formatData
			this._recordsCache = this._recordsFromLayer();
			
			records = this._filterData( this._input.value, this._recordsCache );

			this.showTooltip( records );

			L.DomUtil.removeClass(this._container, 'search-load');
		}
		else
		{
			if(this.options.sourceData)
				this._retrieveData = this.options.sourceData;

			else if(this.options.url)	//jsonp or ajax
				this._retrieveData = this.options.jsonpParam ? this._recordsFromJsonp : this._recordsFromAjax;

			this._curReq = this._retrieveData.call(this, inputText, function(data) {
				
				self._recordsCache = self._formatData.call(self, data);

				//TODO refact!
				if(self.options.sourceData)
					records = self._filterData( self._input.value, self._recordsCache );
				else
					records = self._recordsCache;

				self.showTooltip( records );
 
				L.DomUtil.removeClass(self._container, 'search-load');
			});
		}
	},
	
	_handleAutoresize: function() {
	    var maxWidth;

		if (this._input.style.maxWidth !== this._map._container.offsetWidth) {
			maxWidth = this._map._container.clientWidth;

			// other side margin + padding + width border + width search-button + width search-cancel
			maxWidth -= 10 + 20 + 1 + 30 + 22; 

			this._input.style.maxWidth = maxWidth.toString() + 'px';
		}

		if (this.options.autoResize &amp;&amp; (this._container.offsetWidth + 20 &lt; this._map._container.offsetWidth)) {
			this._input.size = this._input.value.length &lt; this._inputMinSize ? this._inputMinSize : this._input.value.length;
		}
	},

	_handleArrowSelect: function(velocity) {
	
		var searchTips = this._tooltip.hasChildNodes() ? this._tooltip.childNodes : [];
			
		for (i=0; i&lt;searchTips.length; i++)
			L.DomUtil.removeClass(searchTips[i], 'search-tip-select');
		
		if ((velocity == 1 ) &amp;&amp; (this._tooltip.currentSelection &gt;= (searchTips.length - 1))) {// If at end of list.
			L.DomUtil.addClass(searchTips[this._tooltip.currentSelection], 'search-tip-select');
		}
		else if ((velocity == -1 ) &amp;&amp; (this._tooltip.currentSelection &lt;= 0)) { // Going back up to the search box.
			this._tooltip.currentSelection = -1;
		}
		else if (this._tooltip.style.display != 'none') {
			this._tooltip.currentSelection += velocity;
			
			L.DomUtil.addClass(searchTips[this._tooltip.currentSelection], 'search-tip-select');
			
			this._input.value = searchTips[this._tooltip.currentSelection]._text;

			// scroll:
			var tipOffsetTop = searchTips[this._tooltip.currentSelection].offsetTop;
			
			if (tipOffsetTop + searchTips[this._tooltip.currentSelection].clientHeight &gt;= this._tooltip.scrollTop + this._tooltip.clientHeight) {
				this._tooltip.scrollTop = tipOffsetTop - this._tooltip.clientHeight + searchTips[this._tooltip.currentSelection].clientHeight;
			}
			else if (tipOffsetTop &lt;= this._tooltip.scrollTop) {
				this._tooltip.scrollTop = tipOffsetTop;
			}
		}
	},

	_handleSubmit: function() {	//button and tooltip click and enter submit

		this._hideAutoType();
		
		this.hideAlert();
		this._hideTooltip();

		if(this._input.style.display == 'none')	//on first click show _input only
			this.expand();
		else
		{
			if(this._input.value === '')	//hide _input only
				this.collapse();
			else
			{
				var loc = this._getLocation(this._input.value);
				
				if(loc===false)
					this.showAlert();
				else
				{
					this.showLocation(loc, this._input.value);
					this.fire('search:locationfound', {
							latlng: loc,
							text: this._input.value,
							layer: loc.layer ? loc.layer : null
						});
				}
			}
		}
	},

	_getLocation: function(key) {	//extract latlng from _recordsCache

		if( this._recordsCache.hasOwnProperty(key) )
			return this._recordsCache[key];//then after use .loc attribute
		else
			return false;
	},

	_defaultMoveToLocation: function(latlng, title, map) {
		if(this.options.zoom)
 			this._map.setView(latlng, this.options.zoom);
 		else
			this._map.panTo(latlng);
	},

	showLocation: function(latlng, title) {	//set location on map from _recordsCache
		var self = this;

		self._map.once('moveend zoomend', function(e) {

			if(self._markerSearch) {
				self._markerSearch.addTo(self._map).setLatLng(latlng);
			}
			
		});

		self._moveToLocation(latlng, title, self._map);
		//FIXME autoCollapse option hide self._markerSearch before visualized!!
		if(self.options.autoCollapse)
			self.collapse();

		return self;
	}
});

L.Control.Search.Marker = L.Marker.extend({

	includes: L.version[0]==='1' ? L.Evented.prototype : L.Mixin.Events,
	
	options: {
		icon: new L.Icon.Default(),
		animate: true,
		circle: {
			radius: 10,
			weight: 3,
			color: '#e03',
			stroke: true,
			fill: false
		}
	},
	
	initialize: function (latlng, options) {
		L.setOptions(this, options);

		if(options.icon === true)
			options.icon = new L.Icon.Default();

		L.Marker.prototype.initialize.call(this, latlng, options);
		
		if( L.Control.Search.prototype._isObject(this.options.circle) )
			this._circleLoc = new L.CircleMarker(latlng, this.options.circle);
	},

	onAdd: function (map) {
		L.Marker.prototype.onAdd.call(this, map);
		if(this._circleLoc) {
			map.addLayer(this._circleLoc);
			if(this.options.animate)
				this.animate();
		}
	},

	onRemove: function (map) {
		L.Marker.prototype.onRemove.call(this, map);
		if(this._circleLoc)
			map.removeLayer(this._circleLoc);
	},
	
	setLatLng: function (latlng) {
		L.Marker.prototype.setLatLng.call(this, latlng);
		if(this._circleLoc)
			this._circleLoc.setLatLng(latlng);
		return this;
	},
	
	_initIcon: function () {
		if(this.options.icon)
			L.Marker.prototype._initIcon.call(this);
	},

	_removeIcon: function () {
		if(this.options.icon)
			L.Marker.prototype._removeIcon.call(this);
	},

	animate: function() {
	//TODO refact animate() more smooth! like this: http://goo.gl/DDlRs
		if(this._circleLoc)
		{
			var circle = this._circleLoc,
				tInt = 200,	//time interval
				ss = 5,	//frames
				mr = parseInt(circle._radius/ss),
				oldrad = this.options.circle.radius,
				newrad = circle._radius * 2,
				acc = 0;

			circle._timerAnimLoc = setInterval(function() {
				acc += 0.5;
				mr += acc;	//adding acceleration
				newrad -= mr;
				
				circle.setRadius(newrad);

				if(newrad&lt;oldrad)
				{
					clearInterval(circle._timerAnimLoc);
					circle.setRadius(oldrad);//reset radius
					//if(typeof afterAnimCall == 'function')
						//afterAnimCall();
						//TODO use create event 'animateEnd' in L.Control.Search.Marker 
				}
			}, tInt);
		}
		
		return this;
	}
});

L.Map.addInitHook(function () {
    if (this.options.searchControl) {
        this.searchControl = L.control.search(this.options.searchControl);
        this.addControl(this.searchControl);
    }
});

L.control.search = function (options) {
    return new L.Control.Search(options);
};

return L.Control.Search;

});
]]&gt;&lt;/script&gt;&lt;script_name&gt;leaflet search js&lt;/script_name&gt;&lt;sys_class_name&gt;sys_ui_script&lt;/sys_class_name&gt;&lt;sys_created_by&gt;brian.nguyen&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-08-21 21:52:19&lt;/sys_created_on&gt;&lt;sys_id&gt;a292939b1b93b70074f3db9cdc4bcb6a&lt;/sys_id&gt;&lt;sys_mod_count&gt;2&lt;/sys_mod_count&gt;&lt;sys_name&gt;x_snc_sp_asset_map.leaflet search js&lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_ui_script_a292939b1b93b70074f3db9cdc4bcb6a&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;brian.nguyen&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-08-22 16:41:53&lt;/sys_updated_on&gt;&lt;ui_type&gt;10&lt;/ui_type&gt;&lt;use_scoped_format&gt;false&lt;/use_scoped_format&gt;&lt;/sys_ui_script&gt;&lt;/record_update&gt;</payload>
<payload_hash>-1260164964</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2395faeedb48c410993fdc965e961919</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d92360000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>x_snc_sp_asset_map.leaflet search js</target_name>
<type>UI Script</type>
<update_domain>global</update_domain>
<update_guid>9d459fabc517f700a829da485bc76531</update_guid>
<update_guid_history>9d459fabc517f700a829da485bc76531:-1260164964,cd355fabbb17f700443913b60b27fb3e:1681104983,c3b2939b5b93b700315bfd987058ed70:-1260164964</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_css_include_03ef4b971b93b70074f3db9cdc4bcb63</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_css_include"><m2m_sp_dependency_css_include action="INSERT_OR_UPDATE"><order>50</order><sp_css_include display_value="leaflet search">71ef4b971b93b70074f3db9cdc4bcb4f</sp_css_include><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sys_class_name>m2m_sp_dependency_css_include</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 21:40:02</sys_created_on><sys_id>03ef4b971b93b70074f3db9cdc4bcb63</sys_id><sys_mod_count>1</sys_mod_count><sys_name>leaflet search.Leaflet NG</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_css_include_03ef4b971b93b70074f3db9cdc4bcb63</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-22 15:40:29</sys_updated_on></m2m_sp_dependency_css_include></record_update>]]></payload>
<payload_hash>-1516646907</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>27957aeedb48c410993fdc965e9619fd</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d920c0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>leaflet search.Leaflet NG</target_name>
<type>Dependency CSS Includes</type>
<update_domain>global</update_domain>
<update_guid>3537cbab73d3f700d234b4f757496a14</update_guid>
<update_guid_history>3537cbab73d3f700d234b4f757496a14:-1516646907,0bef4b973593b700f94e8b429ee6b664:-962824163</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_container_9516d9fbdb15f7409eb1d311ce961974</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_container"><sp_container action="INSERT_OR_UPDATE"><background_color/><background_image/><background_style>default</background_style><bootstrap_alt>false</bootstrap_alt><class_name/><container_class_name/><name>Asset Map - Container 1</name><order>1</order><sp_page display_value="asset_map">9916d9fbdb15f7409eb1d311ce961971</sp_page><subheader>false</subheader><sys_class_name>sp_container</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:59:07</sys_created_on><sys_id>9516d9fbdb15f7409eb1d311ce961974</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Asset Map - Container 1</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_container_9516d9fbdb15f7409eb1d311ce961974</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:59:07</sys_updated_on><title/><width>container</width></sp_container></record_update>]]></payload>
<payload_hash>-2043175784</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2795faeedb48c410993fdc965e961912</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90c80000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Asset Map - Container 1</target_name>
<type>Container</type>
<update_domain>global</update_domain>
<update_guid>d916d9fbb215f7405a0b43757a602175</update_guid>
<update_guid_history>d916d9fbb215f7405a0b43757a602175:-2043175784,d916d9fbb215f7405a0b43757a602175:-2043175784</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_js_include_e84519bbdb15f7409eb1d311ce9619fb</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_js_include"><sp_js_include action="INSERT_OR_UPDATE"><display_name>leaflet asset directive</display_name><source>local</source><sys_class_name>sp_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:56:23</sys_created_on><sys_id>e84519bbdb15f7409eb1d311ce9619fb</sys_id><sys_mod_count>0</sys_mod_count><sys_name>leaflet asset directive</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_ui_script display_value="x_snc_sp_asset_map.Leaflet Directive Ass">ab4559bbdb15f7409eb1d311ce9619d9</sys_ui_script><sys_update_name>sp_js_include_e84519bbdb15f7409eb1d311ce9619fb</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:56:23</sys_updated_on><url/></sp_js_include></record_update>]]></payload>
<payload_hash>1139391220</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2795faeedb48c410993fdc965e961915</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90ac0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>leaflet asset directive</target_name>
<type>JS Include</type>
<update_domain>global</update_domain>
<update_guid>2d751dbb9215f740d05f2cf630072348</update_guid>
<update_guid_history>2d751dbb9215f740d05f2cf630072348:1139391220,2d751dbb9215f740d05f2cf630072348:1139391220</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_ui_script_31a51ec8dba93b409eb1d311ce9619fb</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_ui_script"&gt;&lt;sys_ui_script action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;description/&gt;&lt;global&gt;false&lt;/global&gt;&lt;name&gt;x_snc_sp_asset_map.Awesome Marker&lt;/name&gt;&lt;script&gt;&lt;![CDATA[/*
  Leaflet.AwesomeMarkers, a plugin that adds colorful iconic markers for Leaflet, based on the Font Awesome icons
  (c) 2012-2013, Lennard Voogdt

  http://leafletjs.com
  https://github.com/lvoogdt
*/

/*global L*/

(function (window, document, undefined) {
    "use strict";
    /*
     * Leaflet.AwesomeMarkers assumes that you have already included the Leaflet library.
     */
    L.AwesomeMarkers = {};

    L.AwesomeMarkers.version = '2.0.1';

    L.AwesomeMarkers.Icon = L.Icon.extend({
        options: {
            iconSize: [35, 45],
            iconAnchor:   [17, 42],
            popupAnchor: [1, -32],
            shadowAnchor: [10, 12],
            shadowSize: [36, 16],
            className: 'awesome-marker',
            prefix: 'glyphicon',
            spinClass: 'fa-spin',
            extraClasses: '',
            icon: 'home',
            markerColor: 'blue',
            iconColor: 'white'
        },

        initialize: function (options) {
            options = L.Util.setOptions(this, options);
        },

        createIcon: function () {
            var div = document.createElement('div'),
                options = this.options;

            if (options.icon) {
                div.innerHTML = this._createInner();
            }

            if (options.bgPos) {
                div.style.backgroundPosition =
                    (-options.bgPos.x) + 'px ' + (-options.bgPos.y) + 'px';
            }

            this._setIconStyles(div, 'icon-' + options.markerColor);
            return div;
        },

        _createInner: function() {
            var iconClass, iconSpinClass = "", iconColorClass = "", iconColorStyle = "", options = this.options;

            if(options.icon.slice(0,options.prefix.length+1) === options.prefix + "-") {
                iconClass = options.icon;
            } else {
                iconClass = options.prefix + "-" + options.icon;
            }

            if(options.spin &amp;&amp; typeof options.spinClass === "string") {
                iconSpinClass = options.spinClass;
            }

            if(options.iconColor) {
                if(options.iconColor === 'white' || options.iconColor === 'black') {
                    iconColorClass = "icon-" + options.iconColor;
                } else {
                    iconColorStyle = "style='color: " + options.iconColor + "' ";
                }
            }

            return "&lt;i " + iconColorStyle + "class='" + options.extraClasses + " " + options.prefix + " " + iconClass + " " + iconSpinClass + " " + iconColorClass + "'&gt;&lt;/i&gt;";
        },

        _setIconStyles: function (img, name) {
            var options = this.options,
                size = L.point(options[name === 'shadow' ? 'shadowSize' : 'iconSize']),
                anchor;

            if (name === 'shadow') {
                anchor = L.point(options.shadowAnchor || options.iconAnchor);
            } else {
                anchor = L.point(options.iconAnchor);
            }

            if (!anchor &amp;&amp; size) {
                anchor = size.divideBy(2, true);
            }

            img.className = 'awesome-marker-' + name + ' ' + options.className;

            if (anchor) {
                img.style.marginLeft = (-anchor.x) + 'px';
                img.style.marginTop  = (-anchor.y) + 'px';
            }

            if (size) {
                img.style.width  = size.x + 'px';
                img.style.height = size.y + 'px';
            }
        },

        createShadow: function () {
            var div = document.createElement('div');

            this._setIconStyles(div, 'shadow');
            return div;
      }
    });
        
    L.AwesomeMarkers.icon = function (options) {
        return new L.AwesomeMarkers.Icon(options);
    };

}(this, document));
]]&gt;&lt;/script&gt;&lt;script_name&gt;Awesome Marker&lt;/script_name&gt;&lt;sys_class_name&gt;sys_ui_script&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-05-16 15:15:39&lt;/sys_created_on&gt;&lt;sys_id&gt;31a51ec8dba93b409eb1d311ce9619fb&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;x_snc_sp_asset_map.Awesome Marker&lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_ui_script_31a51ec8dba93b409eb1d311ce9619fb&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-05-16 15:15:39&lt;/sys_updated_on&gt;&lt;ui_type&gt;0&lt;/ui_type&gt;&lt;use_scoped_format&gt;false&lt;/use_scoped_format&gt;&lt;/sys_ui_script&gt;&lt;/record_update&gt;</payload>
<payload_hash>980720269</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2795faeedb48c410993fdc965e961918</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d912c0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>x_snc_sp_asset_map.Awesome Marker</target_name>
<type>UI Script</type>
<update_domain>global</update_domain>
<update_guid>9eb55ec80da93b409899b991bbab250e</update_guid>
<update_guid_history>9eb55ec80da93b409899b991bbab250e:980720269,9eb55ec80da93b409899b991bbab250e:980720269</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>db_image_88983fccdb617b409eb1d311ce9619a2</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="db_image"><db_image action="INSERT_OR_UPDATE"><active>true</active><category/><format>png</format><height>46</height><image>2a98bfccdb617b409eb1d311ce961993</image><name>markers-plain.png</name><size_bytes>6281</size_bytes><sys_class_name>db_image</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 22:27:35</sys_created_on><sys_id>88983fccdb617b409eb1d311ce9619a2</sys_id><sys_mod_count>4</sys_mod_count><sys_name>markers-plain.png</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>db_image_88983fccdb617b409eb1d311ce9619a2</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 22:51:03</sys_updated_on><thumbnail/><width>360</width></db_image><sys_attachment action="INSERT_OR_UPDATE"><average_image_color>#0</average_image_color><chunk_size_bytes>734003</chunk_size_bytes><compressed>true</compressed><content_type>image/png</content_type><encryption_context/><file_name>image</file_name><image_height>46</image_height><image_width>360</image_width><size_bytes>6281</size_bytes><size_compressed>6204</size_compressed><state>available</state><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 22:27:39</sys_created_on><sys_id>2a98bfccdb617b409eb1d311ce961993</sys_id><sys_mod_count>3</sys_mod_count><sys_updated_by>guest</sys_updated_by><sys_updated_on>2019-08-21 22:50:48</sys_updated_on><table_name>ZZ_YYdb_image</table_name><table_sys_id>88983fccdb617b409eb1d311ce9619a2</table_sys_id></sys_attachment><sys_attachment_doc action="INSERT_OR_UPDATE"><data>H4sIAAAAAAAAAA==</data><length>16</length><position>0</position><sys_attachment display_value="image" sys_id="2a98bfccdb617b409eb1d311ce961993">2a98bfccdb617b409eb1d311ce961993</sys_attachment><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 22:27:39</sys_created_on><sys_id>6a98bfccdb617b409eb1d311ce961993</sys_id></sys_attachment_doc><sys_attachment_doc action="INSERT_OR_UPDATE"><data>dXh5NFR/+H8bY21Q9poJiSJLFOoaZV/TStYsCUnWmMHwYTDWJsnO2EIpI0ZZs2QZ+5Dsu2EGkVlsg/jp8/md7znfP773nnPvs7ye1+v93HPuc5foO7f1uDlEOI4cOcJtoK9978iRoy6Hthwb6+GRJRHFc3g66nNPT/MIrvfM0pEjQloG2rcewI+uZgU+fzCcRSCuYQMJSo7oXNWTJ1tH7d5XcNossMQbkaSVS1n5IMmRDWaTN+EuSZe63nAX6k+edZK8NPdCNkL8SxT3+doHUa6fnymJGXzw5GK/465iwmZR8oPH/ebF3M5LYJLwcwwxmPgl0Y6YtZvug7Fx1dWE/yZlEoNCGhjf/HvVKVyOg+YPQ4uPPWQp5njA//7SnYc5xTf/d2CGaHuUY4e9pfjhRmturpNxlFNYWbW0nYBEMWEXQ9vXqgsBr/lMlHv/HNzw6qOjIPKvwopCjoGPgzMa74OwgXkU5n7ItI3G6xSggivbCWfnIMD7UTAMaRwHa7m2KOHdEZ4UuF8afKoa9jH40jIadzolN5gaVR3VI8s3I7ap6MAKCQAHqX2MpNQE30xgWD+SXAahY/rQYiEn6OinoQUQ43Zo6J7YYrO3Yizlqb8O0Wfnd+0vEIh1JSgSEiWYEXEGRziIEtzlCRhlnjG64FN5oKtVFwyvCJ6JeXQtbFPnim05MhR08OQ57HQf4eau4dAd3C/Cljak9OGc5p87d9ueabdxMRlJMDgYORLYEpfZaoGLfarXy5ioDLbUgCNkbcPh7NSg/no2wEHW9kvHxPT+JiiBAdT8cUEe2AULywT3TxVAObbF4smY52vW88sO0RM49yZSxJn1Lb6uFKKMQOx4wmd3TbbfLwV4+ROoaFXK+PvaXbAtATQpH8wCOXq4k1HoUHSj1oxFLlbqT20tmZ1vxv4ofESMr+JyoFWpNzJZ4/JzJI/dNC3s4uiOr8eFBYCSEovQ8tvfpoQmo2XnTe9XBmCHG/64L0p8JSlVipmqM4QRj8OT+9BfL8MQ96phWwfNZQiJ5y432EP37LGA3UWOPC1W/NdvE9XaakRvL8hqljs4UyPT/VfhIXegAKBuGiW2bfp5T6z8a8mNWgs1okRaCpkbw+WBFvzaVAuQIhxjqC1ahfYvdiu7t4IYN0O2UvSLHJsjvp8UEUacjnashtrUCPJzsTePOLWRVt/2nEyG8D6PVeXEakjPpIGwLEmMd00SHNDVxiK2EnDvpA4tbdWCHwDpfPIMhhPY8vXsgVASi4TIldQRfo8r4/iPH+jwAp0Va3s4SPQomLOp2SVK2MHcZ0J7/0GvjwBzjwaCrty0jXwlONaE2xF94fI451z2QBq+zFSj+vNx/7bcjaasTdzP9dHV0e6wGFKSQHv2LOOGbpRYSFilv9Dia7ERXNXoT2xBJ+mlZ1PTSNEKclECoTkPpguXTSU5+IyZZ9vYlMGEW34haTC6BdnUExKkpQ3D2/i43A5s06uz5hYhTyhkEqFhCv4n8HfR+dG3U6O1RY13TE8GIt355MMoHPDUYxBWrAhVlpuYuF8KEgkXUg2/+fAT+Jh/mPRo8rcNfRfkD2JU5F4fVSxo9WMmeiQ63OmrEzS/Dwgxjo0M3VOgF3lDlPdOdYSP+iGvAaaP3dyOc3PfgrLQNGGcXc9qGdu0vh2A2gyrKA2rCbrdMv5qb7u3D3ClESL3FNbtkwicbd7i9pbuFjUwZSK+EhhQAFRzZEO6H5W7r4piIsgW+D+tkQ657+PQBMT4lLuRDaJTpEKZMtfYePHEx9GUwB1VtqQsUscTI6HEZLJ1Hd9RU264ZuohgteLeRr29QryzpAa6pnV97+h0Ny5i9bGgzSeLCPLOsk4AyOfXvDpBI1luCfvjRR9erLCBfcMxkwOPUig7NEh39ee6jt3IPJB993ZHX/8yATFaM3cTSW29EpWD/K1vStQEwT1T/HTc0p3zmAk/xNI+M4GP01WGkvhVbGcMB7zpD+stTru33upx2JIoivRf748qCigyx1fe9WTcoYdIys4eXph2W/shb/bTK/w7s+0WRedHvor6+S1Bx7V7q6+bu03nAvIsjJaVzq9nZh/kXJ9JWJrmQ/T8fHH8ZVdOszbG8njF2qvrtxwbqW9YUp3JS2kfBx3rV0Z+ryWyX/NrxbyVuowdmPQ6kXGytBr/17DHgszVp+khU561+BqhY3fX4Uk8nPSP3rJMl3+xZUT10b/E2BIY1yS/4O59JUTLQwqI++XbAe4pqxVlHZfG6V8KrRq/nCMOrJwY9Vn6sJu5kNfN9Ukua6zvwb8xlarTDbVPi4OeV6y/ss6Zv4iY5LyKe9vwVu3/yH468MtcLLTro+r3cuJap1BkMsN1qsF407ZSnLX+P1jk5Jl1UWYKHrWZtL4oYKXw3mg3Lp2zzvpxvPK3UyJ+bIu//fmLy4tzQmJltBOhnPv//PBWPKUSv4PsbjfqWvOvmh1S8d3QuqYoxBo/o2VfpHn570hXDbphxnCiEu8v+eteFlbepOYbkP3llKN1qshIVmB6VsDca9AYEuHdqjGvzUS/YRY0bag/xwHaW8kVzl5V3hS8bql1rmQPLe1w3qK8jRx8aSa5fF8C3Gic1xw2n/S+apxmxAbWBcIfUGFciP+t3Q1KllrKU/Z2XWoPCiwfUqb4geXR/9wnU3Q2gyqm79z/Syw+VodCuRrcecbQUSPkj2GSSgCxFDQ/gpGnM2tAuKRU5bry2sr20YX1tqscxWC7Du+T2VF6v6iXXijtSR+1Tn6CKPyF62tCcm6Hk1/2kzmTbbBgCGB0jYttDdk+V9e34X9QerX2BckgtwZSjjiB2B6fF7V1fhp2tK1tFZsOJ3Zp7d9pJ9hl6ncwArIJVqsGEgfbx6DvzHwKRx/klxmID02F9EhqzR5AR9notnfhvrPbjeQNpd7vM/GDaPvJZDeuT1zc64xeWoRYSCdwtCZx5R64evH3wyEuoy0jp2YW7iS5uTLF9MnIB87YFzZIZufeEfOjRQtZvsi0WL+/Fsig4nJ8VhnouA2ifrdmappThNnKzLF3jdnOml2BKwIR98evfrVpJfnp33vNbDcsc04bUGImtYdKYy6RH+Es29kDivjKCou5RORBd0hHHadQcAmLB5TvqZ1R4/05phXLexfNFrN6IQF5i9mVOnES+u685huaLe+LylB6cQXMiYzYZFe7sy2rOhs0ERYFtVT7s3JzZOhVik9rKMVE90aOCI/dlGLPXx3NgedtXcr9ZDwf4qu2mI3XMmhnNUhwaXw4ldYPaT3ztflS5OdjGIitn7V7J855CFgiDCwplvkIWPWVKCK3mkTVsbV+NjcNq/v+ggr/VMcGvSz6CE0CIbZWfki8qBr5h42ELntN9v0655vlA12w949nqc1UqM1v77sy9XvKVCqMXFnfkzk+mPbwxR3luqjnaZ/abyMlkWd+xYr0wtqdCvpdcuMsTUzv1Sk7UYTT8UyyQIqAONgqGllk+5CsbpuC7RisKB1CQBbHuhEqdYOoyMwmhTN1FPqy80qyiWA7QYzylmIvxNLejCtimpDnax+ltw7/OV3ksllyKF5o3TsW5Vd1bKEecF9q3xnVxzg/fA6ke805J9wv4XQYEtE3VwEBpekx5Z+b2eGUctw6YVuZ8lgvl3K+h60canzYkibqLJjNpw/D35AgSyYXIQIhdlCHELMds4lW27c0qz9pfUuCcQ9lYVeWhDjux8DGpCzRny2ezsER5Ax5KA2OI0PeXgRuRbfoO0vTcYv8NkMuw32Nk8gPld8sEXWwVP7OlEFCjakCOcNS4SC2QRKzweGwY1a18ez9QCPEqsArk0XcoJbcC3NrmFqjzbTxKIjA567m0c8bJV/4bjKUYmRrVyrtMV7qfeAqu+uC01aEHOkJ6EwCZQ9/XdNt+pr6DPHSh9CTSE9TJKw/CQAoYUJusSnFME05cEvVA3po1Vj5xQR8yODaxIHVmzVItajgpBjh82AIZM7Co6GS8ebfSj9n8AQehV9JkVvnYxJgTnE0F73FWOc94UCEHbBOCaKE2eG5NKVBEhcYzN7LhaVcXYg4Tb2SgduxS9wHoWSHTt7D3Pk532UGeT8axmw1zegmzoj9qMYXN9ftYxib7NERE2Mp2zu0fqctRd7snnBkLkABvoMHZF5C4/DqdhrUiaM7w/CJkq2SBSU7cvLHgW6EFbIbK8PlezoEWaeARuYG7DeWBprmQq/6ELKXZpIorTJRe71N6OIkxrxEwiBhs30r0HJQNWs5yAlqej3oID8evYmoadKxlRw9zp8fUGJJmKO3fDQoBVa40cHTz1YPT9EvP89yXlNQ54Fgwt6+uetfhI1Tsmlcab6rHq+4XGM90m7q7VvipLNsx0ZQunwqLONz/ywQGRTxRJj5XEA45zDGLwG6hXCUaoUElV2nHtyCmiXct+ZoI25TTHzYwl2oJrsmuZEPefAtUJWKBCZDJ/VnWuUKP0SSLeTC4NAmk4C47YipV6sl3v69Qs2xV1wM+YZLiMNtI1lSnDvVVkTYB4jZWZeKziR8Aslple/btAa903/azuCa64eXlgQ960qIy6ToLxHe6T01KXD2Re884Ogb3LcdJ3pyE6OlXI6X/QWRhurKgza/AgGma7T5iZGQwy50jfXDrhY/5zSIAtvCgXNnPmNPRggMitOA7IOkGNEjhBgt8FrXgkIirHOFnyxulFA3CcsKq3b6HSiSrvUPrGsxhYFa+jgMPPVueNQ064EiezoKFIE0Dv7ezQFpnflcgJFSe51teCNNUYrPnu5f8qignkc+yJ9IZbicVtDoPogx0pqq318tR7u9zQ5ODIo9gF02/33aPcVPSwfKrnQtYV0VqH/YMMx5xbmqDGvP3H1Vq8SLva1npySyGv0VevhUF2eeNgMbyboh1Rv3Mnzd5WBqBT7EyRFEitd6jpkQh30g/Dk03GEYDSsHZVnnx4KLyyrYWOg+bkF4qRefF6Ev4MBQsQK16fvmM3GAtK2SvXXJMo3WaCyV1L2vJRd9t67QaRgvC3aSKhMC2R5Se3XLvyMfmyTo3bL4UcHJE5q/G0PCSchgmxkfO8hHFtKnDRGTPBrf0fl3g0MuHb/HLZQFi7eCeUqGWcIqjfBqUZSfWjxflCi/+bMb7XXsNHe1oRWzhInYlfWNHeblkmUufJODtjfFGwDjXLe6OhBWM9IRAvWm6yOUslDN4GsDEFKfNSYYH38GuJ3dr15MqE/pwCRXm2dLLSbtGc1yLlg01gaAKoJQN6trBYXx455Ag11C4OyxpYfYAoJnG9jIn5IbVWltTKfIYRs9IdYaq3+iNv2qJ1i5mPRks20CiyQxpLhgByJaLk6HB4zXJpdb4rYb99MKs69A6j5XKPrlcHaKedLOVvxv7MuL/8BAQNuupq0lUD6rY1VTqDsSbyMqQUqmTue4CDKs66B7F+89Afq7/jL03/fdcQbfk8RHEqZogLskOkjiWaF4BrLIScKhLvEVLZDpfFdEs1OjlqzosvRkxgXiv5AUmxUUhHFghpQ0fBDh7c0Qq+ZwNkwkFuBFD7DxJOm+mgxtNSxPd52aDpvelHbW9q94XpPlYYXG2tfI8kGIgJzBXIhqnueW2Zb8GoR5eBXy3wie22fIwM2EAo7k2ZyW/TB8bB9ky0ZsoWFMLFher1TEsi5nweOe67SZmH+znR4ul/yfMUV7ISGJT9N2a9fEhcF4nbcyrR2AqYRf14WMONwiTHriAWprcffzV9I0jQn/BvWS7fMWgZ04lP6bidRG1X8KJ9EL80x961Mb0Jx4SBB8qRo74uSKIqzsLB8biSIWbfVAVJHWHNbirxHbHsKhm0ycp5en91WWhwbUba3el9JNqTeiQBaeqlpz+DlKg2WiuBuSpzX5EvDdbW60RVN0ntZ2z4pV09JQAXCiiGKoeTYvdoMi2dvmestMI19Waf93i4yfvXuNt53rVs0jrHJD6d8Hg3f+/AZKZadmHlxdpS6ecqmm/J6opyJCrptgn9LBQ7mtWwWVXDvkR2br0CYejjAbRnsMtV3jnMXaXHU2m+mc9DDGwsJpC56vzuwAVggHB0oYbMLoXow+IP14t30MvZspQrYExFX5sxd3pNuqfYZFi6Q3p6KP4fu6/5GlVlxaAxIMCP4GHEEpSepjT8VHQNXIKu5a8AfaKIebhRZzbCnaFRtb/hw0t6AIfzfROADF96KXrIt/+aTRtxE6V29OfSFO3dcMCgv28ewC4R55nIn5q6VsGlc0QJKTwOoP5xkqzKp2h/FgqnsbNscaEXiAQnUtqZYcQKoO4blf4bY7Fm63KL/iTXEDqmA8HHcLHQ03BitjOR4kvaxf1GL+jl+MkP/IjET+eBzuzU3nrsbxfq1rNpK0dTDo8lB9gGM9NtVQtddetD58VMDsacG2BmmBMI2YLn2GYKN6Rg5oOeX4DswnET/tGRzX+FyxRYPkws1vt1utWqIeFLXzjfDzivfPLK9goFQe0hdOQVeP2ab1/JCSxhueZtqcavKgQHBvPNnGgg/tGYUj9F54Ga6zYxYq52pVq1sux2e1e6pH4czDH2AnZKUEALP1eKd8cLspgP21JncT9Pbr8jg1czxU9ymXUsDh6Qsc6HCv+tI8x3662oTXlB43E0gaq035cZafCQ6vfHUJ+Qo0/Gaznc8ectqij+S7ROxBm8lMTu6lY/um0K1Gi3j5fGyPBiPw3uZ9Wkgz8HLzgZk3c52nk4G8ozgDo+PGrxdClwGw8YkUyIydk/O5eZqHA7AHivpe0i7r6FzXxbNIBdNfTAIHnaKETTVeTpTp58+4bX881YqTh5y3nXaf46mvxE6Cmnh8K2H22GRsUWt4gtLis6gduiyVYuzXid+drWkfry2OxsxPAW5SPRJc4pKadhr8kL26LrbYW+yXs76aV3hwok7QZi05leg9DySNUnr/jzudWkz7WI2wE6VjcZSMlQGBJQP34qo1UQpBJCVO9W+YeGbUc3ij8MBV2zLLJWyLDQTGBNV7Rkg5kuYsFKCRj+j0ZdX3h/5pE5BW97kWz/BzavTCtrCAJR0rida8CHqBNJMsDsjTEfLdsoiaSM+clx9PGW+iefb+pupxY00x595yOpK//lhZvhRpGYLJ4U1JNq3pkxVgcradlXlNiDKIvC6uyR4eCwVHpy6JQ7CilHZQJBj4FACxVLUfjkbfntnxSY+71wOxrMPzSFkObjsXxIf7YRGZE9JioDorSoKuOpwUJY5ywuqWYObe/iHkDm1tSKdfCHp5EEQOMnqD+6LYtmKwlpI4LBNfEQQZOctGSwnwAKcfr5RO6SbuiOFxa9HO8Y3N6NeMWURfSFT/8MvkCICiolQoSYaFzAlxgVV/lLxFu5HU1ZsqA9IClq7fAVM2T8EhfeDa5aip7pOMvZnjXF3497O3qpThXeWfJl9+HjmhovFOd0n1i3nfg3y5K9z9DIDssjPGbKiJLHDHjG6PsnAKMs3QcVpKJjbaE36s+Hkv3nAUDCt6SxC4Tbi2+1DiE/5jH0vsEh4XDqQKUmsDAiUd1DnZvLglbMjHv0bij1rJPfmJyEaRPvh2vtGymjY5smEBfRV0NCh59wzenlGbJHUN8Vdb1ukZgRZl3ncsnbxepuR0HPkI59kJ/QVF4T4gjeh7CZTgLmVIp93El+7q1EfVEoDW7JDyI14B294MGLgY7mVfR0s7rptVYn/vfUO90JSFV6IgOJ8rrdFIr+jKlOoXzzFwWWvyL87ZkPZb7TEvpxA7Ky/W2R4U9TbnRVhtk987WK231HnXYa81ocxlFsw/wyTxO/4/ZLLhHj21bM23GcfrYfcg2/+6UJFDcORnkeX4DCGnQ6Qy20ZIL+2tKQtkeJ2ZsbBVK87grOys0HqV6t5GLoNLgQ3M5YjclZ+44Ds3MtuqH/Z8W55AJ/mL34nH+hznj1cG717dbY9+y7E82wa3tMb8Rt4+cy6zhIKt7u3gShg7HvRLDNrnO8hArZXSuE8pRHkFYMFC3+/LvPDB4BtytSVDwBRvXqleM9eLz0eJENWlLl6v5vH2qqbchmrD8ShwySSks2XmAAL1rTpPickPQhSnPslr1HW0ALsXHjE9ErvMJlTR+YuoUkrEVJac/7xLqLepeyE3r4xjBgHD1o9EMs+9fLlffHsoqJPX7KDr7jY875DK92/mX2+1CJD3raMr87PcN40ZnkoWHynZIldUZJeNPTeJrB6xGPwPAns/PV2MMx8uWiQ8fH/+hn//wMcp7dDZLfY4vm8WyyPHG4GOre1cZp2Yf8PnE4o0okYAAA=</data><length>8260</length><position>1</position><sys_attachment display_value="image" sys_id="2a98bfccdb617b409eb1d311ce961993">2a98bfccdb617b409eb1d311ce961993</sys_attachment><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 22:27:39</sys_created_on><sys_id>2e98bfccdb617b409eb1d311ce961993</sys_id></sys_attachment_doc></record_update>]]></payload>
<payload_hash>590313381</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2b957aeedb48c410993fdc965e9619fc</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91f40000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>markers-plain.png</target_name>
<type>Images</type>
<update_domain>global</update_domain>
<update_guid>df20a3df7bd3b700bf28bce0e7299fa1</update_guid>
<update_guid_history>df20a3df7bd3b700bf28bce0e7299fa1:590313381,b820a3dfefd3b700037ef9cc5e431000:-718101410,5e01eb9bd49f7b80d2a9e4cd9e3b247e:-1768893159,e698ffccf1617b40f19f66bea6ce8bbb:203832243,6e98ffcc3f617b401d540229957a68b6:422466859,2e98bfccb5617b40261dbb1fa3774696:422466859,e9983fcc4b617b40c4f5a31f21bb77a6:-2123287434</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>DELETE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_widget_dependency_49a591fbdb15f7409eb1d311ce96192a</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_widget_dependency"><m2m_sp_widget_dependency action="DELETE"><sp_dependency display_value="awesome marker asset">ed9591fbdb15f7409eb1d311ce961924</sp_dependency><sp_widget display_value="Service Portal Asset Map">4a7a40abdb5d77409eb1d311ce9619e6</sp_widget><sys_class_name>m2m_sp_widget_dependency</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:57:11</sys_created_on><sys_id>49a591fbdb15f7409eb1d311ce96192a</sys_id><sys_mod_count>0</sys_mod_count><sys_name>awesome marker asset.Service Portal Asset Map</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_widget_dependency_49a591fbdb15f7409eb1d311ce96192a</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:57:11</sys_updated_on></m2m_sp_widget_dependency></record_update>]]></payload>
<payload_hash>1688750409</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2b95faeedb48c410993fdc965e961911</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91700000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>awesome marker asset.Service Portal Asset Map</target_name>
<type>Widget Dependency</type>
<update_domain>global</update_domain>
<update_guid>5af733cc50617b407172f5393094f560</update_guid>
<update_guid_history>5af733cc50617b407172f5393094f560:1688750409,5af733cc50617b407172f5393094f560:1688750409,8da591fbc715f740f41ba26c086d8d2b:1350617813</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_js_include_27951ec8dba93b409eb1d311ce961922</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_js_include"><sp_js_include action="INSERT_OR_UPDATE"><display_name>Marker</display_name><source>local</source><sys_class_name>sp_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 15:15:44</sys_created_on><sys_id>27951ec8dba93b409eb1d311ce961922</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Marker</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_ui_script display_value="x_snc_sp_asset_map.Awesome Marker">31a51ec8dba93b409eb1d311ce9619fb</sys_ui_script><sys_update_name>sp_js_include_27951ec8dba93b409eb1d311ce961922</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-16 15:15:44</sys_updated_on><url/></sp_js_include></record_update>]]></payload>
<payload_hash>-1507811303</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2b95faeedb48c410993fdc965e961914</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91350000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Marker</target_name>
<type>JS Include</type>
<update_domain>global</update_domain>
<update_guid>ebb59ec879a93b40d3e0ab8eaa85c74d</update_guid>
<update_guid_history>ebb59ec879a93b40d3e0ab8eaa85c74d:-1507811303,ebb59ec879a93b40d3e0ab8eaa85c74d:-1507811303</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_scope_privilege_d95d87d31b93b70074f3db9cdc4bcb70</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_scope_privilege"><sys_scope_privilege action="INSERT_OR_UPDATE"><operation>read</operation><source_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</source_scope><status>allowed</status><sys_class_name>sys_scope_privilege</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 21:28:43</sys_created_on><sys_id>d95d87d31b93b70074f3db9cdc4bcb70</sys_id><sys_mod_count>0</sys_mod_count><sys_name>u_site</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sys_scope_privilege_d95d87d31b93b70074f3db9cdc4bcb70</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 21:28:43</sys_updated_on><target_name>u_site</target_name><target_scope display_value="Global">global</target_scope><target_type>sys_db_object</target_type></sys_scope_privilege></record_update>]]></payload>
<payload_hash>-1395517231</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2b95faeedb48c410993fdc965e961917</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91ba0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>u_site</target_name>
<type>Cross scope privilege</type>
<update_domain>global</update_domain>
<update_guid>9d5d87d33093b700f47822d7f3c08171</update_guid>
<update_guid_history>9d5d87d33093b700f47822d7f3c08171:-1395517231</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>db_image_0f8913971bd3b70074f3db9cdc4bcbc8</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="db_image"><db_image action="INSERT_OR_UPDATE"><active>true</active><category/><format>gif</format><height>16</height><image>d8c953971bd3b70074f3db9cdc4bcb92</image><name>loader.gif</name><size_bytes>1849</size_bytes><sys_class_name>db_image</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 22:22:54</sys_created_on><sys_id>0f8913971bd3b70074f3db9cdc4bcbc8</sys_id><sys_mod_count>2</sys_mod_count><sys_name>loader.gif</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>db_image_0f8913971bd3b70074f3db9cdc4bcbc8</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 22:23:00</sys_updated_on><thumbnail/><width>16</width></db_image><sys_attachment action="INSERT_OR_UPDATE"><average_image_color>#ffffff</average_image_color><chunk_size_bytes>734003</chunk_size_bytes><compressed>true</compressed><content_type>image/gif</content_type><encryption_context/><file_name>image</file_name><image_height>16</image_height><image_width>16</image_width><size_bytes>1849</size_bytes><size_compressed>1596</size_compressed><state>pending</state><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 22:23:00</sys_created_on><sys_id>d8c953971bd3b70074f3db9cdc4bcb92</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 22:23:00</sys_updated_on><table_name>ZZ_YYdb_image</table_name><table_sys_id>0f8913971bd3b70074f3db9cdc4bcbc8</table_sys_id></sys_attachment><sys_attachment_doc action="INSERT_OR_UPDATE"><data>H4sIAAAAAAAAAA==</data><length>16</length><position>0</position><sys_attachment display_value="image" sys_id="d8c953971bd3b70074f3db9cdc4bcb92">d8c953971bd3b70074f3db9cdc4bcb92</sys_attachment><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 22:23:00</sys_created_on><sys_id>1cc953971bd3b70074f3db9cdc4bcb92</sys_id></sys_attachment_doc><sys_attachment_doc action="INSERT_OR_UPDATE"><data>ldV9TFP3Ggfwwzm/03N6XtofFVmpzJRStC2tLW+livOeFhAELheYwsbLpRXLLINZmAjbEOkLQpFXZTqYTtzYQFEGiGZ3DsRKomxxSmZmtntJdOHe6ObdBe9dhsk2R5dBSNw/9/fnk9+TfPJ98uRJ2rbVsNECEYj8D0GePHnS1dW1sLBw8+bNR48ejY6OTk1NLVYuXbrU19c3MzMzOzvb09Nz586d7u7uwcFBr9eL/D8v5BdJfIXVste6S1pl27tbaimxVJfusezaYHuleA8S8hgglO/XEzo9cfvz8caMxMgNOsxvsaT2dfuQCF4llaIoP+Sf/WiCibxmbB9IDvbcve49Kzp/xTKEfZDg9MJ/cdK/XgwwPnhhoT2jl5v/SLbD5TyfGcr//J7JkR938gZ9NeKMiBHje25uipRL9mEcoOQ16iggpCkWOAtDUZKHsLtAXQzgRR2T0a/G0LQ15Hee30rLPp/Fxlk3tiYYySkjbB5pmpyfEPhrB4LM9t1ycUu8JYyT4s3XHtiTT5PkCThUPbYVdXgrn/cEQJdfdWg9zgLg3XB5xn3wxYDiVn+QhhbKMJyyU1EmV44DQEA3FtSk8dh8/eE3al7vNpyIzYtdoqArKdU+ylfMIgUkkIkysm2kye2aiKxQDzzTU54xGdCA1iEB4pJRr3nOAHnEdyIvB0nDzsBkkVqqmv5GJ9Z8wM6Vbc0Rfz+7cSwtozcxKhyloMKJmmQsjy5ueaNRZcop1HoOoCxXKPc4a1MrHLHGimUM9lQuX0UvYtwhZPK87DOVqG0NfSuzTcu5hhs1AihyRNdBgF89bYfRguas8B8/0YiIk/cv2M+R1/vM0xmKo3rSda/nhGRuh/YnKZ+kVWrgVgJMEa4tkJX+pV57UGV8uePAkSY6tbO5qcBYq9f36JcoYCWl9LcRiX25yMhr82sXKQ1raGZsHME0Xxp0yUDkHK57Lj3uFHPrU//t7sSHt+BY4ODq78tXQ8n93n8PW99hvt2xJzWyMCf30Uxztmc0ouSlHGDl9lYma7VV5j/Ve4prQw97juo7j4QuAfCVgFof4G/qRYBTRrrmJZMq6mAcY886H4a6h0J1vN5u8ynphGT91aIuRW8g1pnCccFrLz9z5YIoQKKNuGLDomGj1zyWfU7iAZjpm/FsIGQr97tlRQSBW9JtWoYoIBilskVDkEiatfQAn6DLbPsRQLBl1rzwJRJvJek1H2kbXCR5ZeSf/6ufVHn7ZbGJN466HVySQpG27ra9vITLre/zPP7YX8q4/xPGnQMQrzqbq5RCt70UU1BtDY7b51pJsvyHStWqQILIWlfEg3zCTAiVSgVDYMSrBwpT2kHjlsJ8AbFekFQWSzbLlzXEUwv9mwZVqQ9JFZOqccVPppg8UYTYb0T6fu7IF9ssu0N4ScfOWKvFr488TNE1Wi/rJ7xcds2OARzMR398MaFspD5MLrjx9nd2MUPx8wk8CcGq+Xx2P8KFgxrAMKiQeC6cIiKOaPiJlhi0VLlsIZ9KRnl8tv+d9cbjqacPf3j36xb1uxd/FoAjnsR8Ranr+Ol1cTHSlrswRpTgmQyq091fez7KaTmr04gOrW6/oAkWTD97akLcCVqvuuzJ0QEQz+bDMNaGEZhQSNnzsmQ1fLQZJQUdoVQXyhfqcVtuVVGVaknD/2ONOrVT9fjiJHqoX3eStnTH3Tl0a8jvRYNjpzn6wSu9a2lvv2kn4tx5qTp4HFcPX7ntHzTe0TP8WeD4jVWz0wq+iLg+NvSsFNAkL4zaghEsidMMFakChBBtQnlCm4rma3F8E+wKl2PYvmUNtVJTuawpzTsjv0eNpMDyvPe85UxUlzkzb0EQs8qxsClI0PTmHNj2QohuosKYYBAz8fsG2qcC8H8kZxTb/MdnbUhmJ2hzGTM4+xoYz2PDEhA2gweBMDNaz+CLGNZWZEMhmV6iq2LdyuWVov8wlw1M+Xg/pU5C6cEUiFQoPgxOaTcwZEP83KzKv6nhoGlU3SVprf92nXgzVe9oHv17kGj3MJNTq4GfdJin1Xym4egPvWL1wy0YCnlxFGvISt+sprF6uDliuxAW8FDqrSLQcWw9W/6ynOJ8mrjlW/YrIxDC9TkHAAA=</data><length>2116</length><position>1</position><sys_attachment display_value="image" sys_id="d8c953971bd3b70074f3db9cdc4bcb92">d8c953971bd3b70074f3db9cdc4bcb92</sys_attachment><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 22:23:00</sys_created_on><sys_id>9cc953971bd3b70074f3db9cdc4bcb92</sys_id></sys_attachment_doc></record_update>]]></payload>
<payload_hash>102709645</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2f957aeedb48c410993fdc965e9619fb</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91e60000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>loader.gif</target_name>
<type>Images</type>
<update_domain>global</update_domain>
<update_guid>24c95b9799d3b70019410c3d416b943e</update_guid>
<update_guid_history>24c95b9799d3b70019410c3d416b943e:102709645,18c95b9783d3b70082bfdb8cc64bb539:-1500765659,54c95b97f4d3b700ca28a51db8d29837:-1500765659,07b95f57cdd3b70071f19037221fe223:-1400488256</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>DELETE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_js_include_4dd1d7a71b17f70074f3db9cdc4bcbe9</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_js_include"><m2m_sp_dependency_js_include action="DELETE"><order>350</order><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sp_js_include display_value="Leaflet geocoder">93c1d7a71b17f70074f3db9cdc4bcb4c</sp_js_include><sys_class_name>m2m_sp_dependency_js_include</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-22 16:26:51</sys_created_on><sys_id>4dd1d7a71b17f70074f3db9cdc4bcbe9</sys_id><sys_mod_count>1</sys_mod_count><sys_name>Leaflet NG.Leaflet geocoder</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_js_include_4dd1d7a71b17f70074f3db9cdc4bcbe9</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-22 16:35:01</sys_updated_on></m2m_sp_dependency_js_include></record_update>]]></payload>
<payload_hash>1000631093</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2f957aeedb48c410993fdc965e9619fe</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d92300000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Leaflet NG.Leaflet geocoder</target_name>
<type>Dependency JS Includes</type>
<update_domain>global</update_domain>
<update_guid>5ef3936ba417f7007e4e87f839451e04</update_guid>
<update_guid_history>5ef3936ba417f7007e4e87f839451e04:1000631093,b4b31f2b0417f700991a016514b370fd:1347731393,c1d1d7a75a17f700aad5c5c44788f2eb:-926029954</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_js_include_a277f38cdb617b409eb1d311ce961984</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_js_include"><m2m_sp_dependency_js_include action="INSERT_OR_UPDATE"><order>200</order><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sp_js_include display_value="awesome marker asset">62a515fbdb15f7409eb1d311ce96190c</sp_js_include><sys_class_name>m2m_sp_dependency_js_include</sys_class_name><sys_created_by>lil.dicky</sys_created_by><sys_created_on>2019-05-16 22:22:44</sys_created_on><sys_id>a277f38cdb617b409eb1d311ce961984</sys_id><sys_mod_count>2</sys_mod_count><sys_name>Leaflet NG.awesome marker asset</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_js_include_a277f38cdb617b409eb1d311ce961984</sys_update_name><sys_updated_by>lil.dicky</sys_updated_by><sys_updated_on>2019-05-16 22:23:20</sys_updated_on></m2m_sp_dependency_js_include></record_update>]]></payload>
<payload_hash>543061056</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2f95faeedb48c410993fdc965e961910</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d915a0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Leaflet NG.awesome marker asset</target_name>
<type>Dependency JS Includes</type>
<update_domain>global</update_domain>
<update_guid>9b97378c15617b40f651c2b449dec51a</update_guid>
<update_guid_history>9b97378c15617b40f651c2b449dec51a:543061056,9b97378c15617b40f651c2b449dec51a:543061056,bc87f38c53617b407d469cb377316c9c:444374367,2e77f38c5b617b404d0583040a62df85:641747745</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_dependency_1884d97bdb15f7409eb1d311ce96194b</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_dependency"><sp_dependency action="INSERT_OR_UPDATE"><module>leaflet-directive-two</module><name>Leaflet NG</name><page_load>true</page_load><sp_portals/><sys_class_name>sp_dependency</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:52:41</sys_created_on><sys_id>1884d97bdb15f7409eb1d311ce96194b</sys_id><sys_mod_count>7</sys_mod_count><sys_name>Leaflet NG</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_dependency_1884d97bdb15f7409eb1d311ce96194b</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-16 20:35:59</sys_updated_on></sp_dependency></record_update>]]></payload>
<payload_hash>947489956</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2f95faeedb48c410993fdc965e961913</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91530000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Leaflet NG</target_name>
<type>Widget Dependency</type>
<update_domain>global</update_domain>
<update_guid>fe0fdb4ca0ed3b400257717071f60aaa</update_guid>
<update_guid_history>fe0fdb4ca0ed3b400257717071f60aaa:947489956,fe0fdb4ca0ed3b400257717071f60aaa:947489956,5fd84f446bad3b40dabff33ac5b3af99:-804060851,c23e6e7f2a99f74007b143fb498c74d8:947489956,e42ea67f5c99f740e80b765f73493e27:-804060851,f5d816b70c59f74007a737fef7b119ae:947489956,fbc816b70659f7403d6eebd7f70bc1a7:-804060851,4e3aadb3b795f740d982429b52268f36:947489956,57941d7bc515f7401a36eeb93177f76e:-804060851</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_scope_privilege_7e8fb308dba17b409eb1d311ce9619a0</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_scope_privilege"><sys_scope_privilege action="INSERT_OR_UPDATE"><operation>read</operation><source_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</source_scope><status>allowed</status><sys_class_name>sys_scope_privilege</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 22:57:59</sys_created_on><sys_id>7e8fb308dba17b409eb1d311ce9619a0</sys_id><sys_mod_count>0</sys_mod_count><sys_name>sn_customerservice_case</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sys_scope_privilege_7e8fb308dba17b409eb1d311ce9619a0</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-16 22:57:59</sys_updated_on><target_name>sn_customerservice_case</target_name><target_scope display_value="Customer Service">51d811fad7223100b7490ee60e61034f</target_scope><target_type>sys_db_object</target_type></sys_scope_privilege></record_update>]]></payload>
<payload_hash>1473455107</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>2f95faeedb48c410993fdc965e961916</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91780000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>sn_customerservice_case</target_name>
<type>Cross scope privilege</type>
<update_domain>global</update_domain>
<update_guid>328fb30877a17b402c043488895a9aa2</update_guid>
<update_guid_history>328fb30877a17b402c043488895a9aa2:1473455107,328fb30877a17b402c043488895a9aa2:1473455107</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>db_image_e2787fccdb617b409eb1d311ce961936</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="db_image"><db_image action="INSERT_OR_UPDATE"><active>true</active><category/><format>png</format><height>16</height><image>a288bfccdb617b409eb1d311ce961968</image><name>markers-shadow.png</name><size_bytes>535</size_bytes><sys_class_name>db_image</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 22:27:13</sys_created_on><sys_id>e2787fccdb617b409eb1d311ce961936</sys_id><sys_mod_count>4</sys_mod_count><sys_name>markers-shadow.png</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>db_image_e2787fccdb617b409eb1d311ce961936</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 22:51:54</sys_updated_on><thumbnail/><width>35</width></db_image><sys_attachment action="INSERT_OR_UPDATE"><average_image_color>#0</average_image_color><chunk_size_bytes>734003</chunk_size_bytes><compressed>true</compressed><content_type>image/png</content_type><encryption_context/><file_name>image</file_name><image_height>16</image_height><image_width>35</image_width><size_bytes>535</size_bytes><size_compressed>558</size_compressed><state>available</state><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 22:27:23</sys_created_on><sys_id>a288bfccdb617b409eb1d311ce961968</sys_id><sys_mod_count>3</sys_mod_count><sys_updated_by>guest</sys_updated_by><sys_updated_on>2019-08-21 22:50:48</sys_updated_on><table_name>ZZ_YYdb_image</table_name><table_sys_id>e2787fccdb617b409eb1d311ce961936</table_sys_id></sys_attachment><sys_attachment_doc action="INSERT_OR_UPDATE"><data>H4sIAAAAAAAAAA==</data><length>16</length><position>0</position><sys_attachment display_value="image" sys_id="a288bfccdb617b409eb1d311ce961968">a288bfccdb617b409eb1d311ce961968</sys_attachment><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 22:27:23</sys_created_on><sys_id>e288bfccdb617b409eb1d311ce961968</sys_id></sys_attachment_doc><sys_attachment_doc action="INSERT_OR_UPDATE"><data>ARcC6P2JUE5HDQoaCgAAAA1JSERSAAAAIwAAABAIBgAAAJw3xloAAAHeSURBVHjazdThR0NRHMbxzMxcmcnVXDNzpUlmNpkl2UyWlCwp2ZQU05SylFJKpSiV9B+v58X3xXHmbC/2psPHst3Oec7v/s6Z6Pf7/4ZrRAxRiSFu8GCaHMJDHDGJsgasYQXwJCFT4su0pCRA2pJxSCPFHFMEjFuB+AP8GCeEzyQzkpN5yUtBioaSQxEFyTNHyJz+YCB3kEBmmWxRqrIiDawO0eDZutRkmTlKbCikSslRYTxKmZMyE2/JrrRl39I2tHhuR5qyQbi6LBFmTrKskRgWJsYDGf6xwQIdOZOe5ULO+a3Lc8dyIHtsYo3qVCTPKw+oiseakWFhspS1yQLX8ijPhke5l1u5ItiJHFGlJlVZdlXEDMLRHgiTlJCy7rDzJ3mXb/mSD3kj1J1cyhlB9ghSN6oRSuA6RcY943hNhGHHLwT5lR/55LsHuaIih7JtVKMoOeby7f6AfekNNjC7WKABO+z+leq8EqJHiLZs0l+LVl9QCeOCs4bzBjaq43MEq5T9lL65IUSXk7TFEa5QiVkJzDvEblA+R4dhRI1XlZcai7awLesELQuN6eoJcY7RYSJMlrQuvgqLF0cGsMa4YaJGoJSkWTykYilC0JTunhg/DFjEQwKTVoAxBmHwBzw99sjNg8k7AAAAAElFTkSuQmCCmdD5OBcCAAA=</data><length>732</length><position>1</position><sys_attachment display_value="image" sys_id="a288bfccdb617b409eb1d311ce961968">a288bfccdb617b409eb1d311ce961968</sys_attachment><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 22:27:23</sys_created_on><sys_id>a688bfccdb617b409eb1d311ce961968</sys_id></sys_attachment_doc></record_update>]]></payload>
<payload_hash>-809315706</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>63957aeedb48c410993fdc965e9619fd</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91fc0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>markers-shadow.png</target_name>
<type>Images</type>
<update_domain>global</update_domain>
<update_guid>f750e7df66d3b700fb14c0a8b4355692</update_guid>
<update_guid_history>f750e7df66d3b700fb14c0a8b4355692:-809315706,a85027dfc6d3b7005d01b283dc5295ed:651598015,b688bfccef617b405bd0e68f06a6a873:482592376,2e88bfcc30617b40b8ee7d35fc47946e:-1549224769,6288bfcce2617b405293ef32a56f226c:-1549224769,50883fcc92617b40c7360599e300db94:-83922176</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_column_b216ddfbdb15f7409eb1d311ce9619f6</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_column"><sp_column action="INSERT_OR_UPDATE"><class_name/><order>1</order><size>12</size><size_lg/><size_sm/><size_xs/><sp_row display_value="1">fe16ddfbdb15f7409eb1d311ce9619f3</sp_row><sys_class_name>sp_column</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:59:12</sys_created_on><sys_id>b216ddfbdb15f7409eb1d311ce9619f6</sys_id><sys_mod_count>0</sys_mod_count><sys_name>1</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_column_b216ddfbdb15f7409eb1d311ce9619f6</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:59:12</sys_updated_on></sp_column></record_update>]]></payload>
<payload_hash>1198374514</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6395faeedb48c410993fdc965e961912</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90da0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>1</target_name>
<type>Column</type>
<update_domain>global</update_domain>
<update_guid>7616ddfb7e15f7408e98b5f6e31c67f7</update_guid>
<update_guid_history>7616ddfb7e15f7408e98b5f6e31c67f7:1198374514,7616ddfb7e15f7408e98b5f6e31c67f7:1198374514</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_js_include_c3321b5b1b93b70074f3db9cdc4bcb57</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_js_include"><sp_js_include action="INSERT_OR_UPDATE"><display_name>leaflet search js</display_name><source>local</source><sys_class_name>sp_js_include</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 21:50:14</sys_created_on><sys_id>c3321b5b1b93b70074f3db9cdc4bcb57</sys_id><sys_mod_count>1</sys_mod_count><sys_name>leaflet search js</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_ui_script display_value="x_snc_sp_asset_map.leaflet search js">a292939b1b93b70074f3db9cdc4bcb6a</sys_ui_script><sys_update_name>sp_js_include_c3321b5b1b93b70074f3db9cdc4bcb57</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 21:52:29</sys_updated_on><url/></sp_js_include></record_update>]]></payload>
<payload_hash>-375215887</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6395faeedb48c410993fdc965e961915</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91d30000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>leaflet search js</target_name>
<type>JS Include</type>
<update_domain>global</update_domain>
<update_guid>9dc2179be293b70097bb9b5925bba5d7</update_guid>
<update_guid_history>9dc2179be293b70097bb9b5925bba5d7:-375215887,18421b5b7893b700f6b8134774113e5c:644505615</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_ui_script_2f429b5b1b93b70074f3db9cdc4bcb50</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_ui_script"&gt;&lt;sys_ui_script action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;description/&gt;&lt;global&gt;false&lt;/global&gt;&lt;name&gt;x_snc_sp_asset_map.leaflet search js&lt;/name&gt;&lt;script&gt;&lt;![CDATA[/*
	Name					Data passed			   Description
	Managed Events:
	 search:locationfound	{latlng, title, layer} fired after moved and show markerLocation
	 search:expanded		{}					   fired after control was expanded
	 search:collapsed		{}					   fired after control was collapsed
 	 search:cancel			{}					   fired after cancel button clicked
	Public methods:
	 setLayer()				L.LayerGroup()         set layer search at runtime
	 showAlert()            'Text message'         show alert message
	 searchText()			'Text searched'        search text by external code
*/

//TODO implement can do research on multiple sources layers and remote		
//TODO history: false,		//show latest searches in tooltip		
//FIXME option condition problem {autoCollapse: true, markerLocation: true} not show location
//FIXME option condition problem {autoCollapse: false }
//
//TODO here insert function  search inputText FIRST in _recordsCache keys and if not find results.. 
//  run one of callbacks search(sourceData,jsonpUrl or options.layer) and run this.showTooltip
//
//TODO change structure of _recordsCache
//	like this: _recordsCache = {"text-key1": {loc:[lat,lng], ..other attributes.. }, {"text-key2": {loc:[lat,lng]}...}, ...}
//	in this mode every record can have a free structure of attributes, only 'loc' is required
//TODO important optimization!!! always append data in this._recordsCache
//  now _recordsCache content is emptied and replaced with new data founded
//  always appending data on _recordsCache give the possibility of caching ajax, jsonp and layersearch!
//
//TODO here insert function  search inputText FIRST in _recordsCache keys and if not find results.. 
//  run one of callbacks search(sourceData,jsonpUrl or options.layer) and run this.showTooltip
//
//TODO change structure of _recordsCache
//	like this: _recordsCache = {"text-key1": {loc:[lat,lng], ..other attributes.. }, {"text-key2": {loc:[lat,lng]}...}, ...}
//	in this way every record can have a free structure of attributes, only 'loc' is required

(function (factory) {
    if(typeof define === 'function' &amp;&amp; define.amd) {
    //AMD
        define(['leaflet'], factory);
    } else if(typeof module !== 'undefined') {
    // Node/CommonJS
        module.exports = factory(require('leaflet'));
    } else {
    // Browser globals
        if(typeof window.L === 'undefined')
            throw 'Leaflet must be loaded first';
        factory(window.L);
    }
})(function (L) {


L.Control.Search = L.Control.extend({
	
	includes: L.version[0]==='1' ? L.Evented.prototype : L.Mixin.Events,

	options: {
		url: '',						//url for search by ajax request, ex: "search.php?q={s}". Can be function to returns string for dynamic parameter setting
		layer: null,					//layer where search markers(is a L.LayerGroup)				
		sourceData: null,				//function to fill _recordsCache, passed searching text by first param and callback in second				
		//TODO implements uniq option 'sourceData' to recognizes source type: url,array,callback or layer				
		jsonpParam: null,				//jsonp param name for search by jsonp service, ex: "callback"
		propertyLoc: 'loc',				//field for remapping location, using array: ['latname','lonname'] for select double fields(ex. ['lat','lon'] ) support dotted format: 'prop.subprop.title'
		propertyName: 'title',			//property in marker.options(or feature.properties for vector layer) trough filter elements in layer,
		formatData: null,				//callback for reformat all data from source to indexed data object
		filterData: null,				//callback for filtering data from text searched, params: textSearch, allRecords
		moveToLocation: null,			//callback run on location found, params: latlng, title, map
		buildTip: null,					//function to return row tip html node(or html string), receive text tooltip in first param
		container: '',					//container id to insert Search Control		
		zoom: null,						//default zoom level for move to location
		minLength: 1,					//minimal text length for autocomplete
		initial: true,					//search elements only by initial text
		casesensitive: false,			//search elements in case sensitive text
		autoType: true,					//complete input with first suggested result and select this filled-in text.
		delayType: 400,					//delay while typing for show tooltip
		tooltipLimit: -1,				//limit max results to show in tooltip. -1 for no limit, 0 for no results
		tipAutoSubmit: true,			//auto map panTo when click on tooltip
		firstTipSubmit: false,			//auto select first result con enter click
		autoResize: true,				//autoresize on input change
		collapsed: true,				//collapse search control at startup
		autoCollapse: false,			//collapse search control after submit(on button or on tips if enabled tipAutoSubmit)
		autoCollapseTime: 1200,			//delay for autoclosing alert and collapse after blur
		textErr: 'Location not found',	//error message
		textCancel: 'Cancel',		    //title in cancel button		
		textPlaceholder: 'Search...',   //placeholder value			
		hideMarkerOnCollapse: false,    //remove circle and marker on search control collapsed		
		position: 'topleft',		
		marker: {						//custom L.Marker or false for hide
			icon: false,				//custom L.Icon for maker location or false for hide
			animate: true,				//animate a circle over location found
			circle: {					//draw a circle in location found
				radius: 10,
				weight: 3,
				color: '#e03',
				stroke: true,
				fill: false
			}
		}
	},

	_getPath: function(obj, prop) {
		var parts = prop.split('.'),
			last = parts.pop(),
			len = parts.length,
			cur = parts[0],
			i = 1;

		if(len &gt; 0)
			while((obj = obj[cur]) &amp;&amp; i &lt; len)
				cur = parts[i++];

		if(obj)
			return obj[last];
	},

	_isObject: function(obj) {
		return Object.prototype.toString.call(obj) === "[object Object]";
	},

	initialize: function(options) {
		L.Util.setOptions(this, options || {});
		this._inputMinSize = this.options.textPlaceholder ? this.options.textPlaceholder.length : 10;
		this._layer = this.options.layer || new L.LayerGroup();
		this._filterData = this.options.filterData || this._defaultFilterData;
		this._formatData = this.options.formatData || this._defaultFormatData;
		this._moveToLocation = this.options.moveToLocation || this._defaultMoveToLocation;
		this._autoTypeTmp = this.options.autoType;	//useful for disable autoType temporarily in delete/backspace keydown
		this._countertips = 0;		//number of tips items
		this._recordsCache = {};	//key,value table! to store locations! format: key,latlng
		this._curReq = null;
	},

	onAdd: function (map) {
		this._map = map;
		this._container = L.DomUtil.create('div', 'leaflet-control-search');
		this._input = this._createInput(this.options.textPlaceholder, 'search-input');
		this._tooltip = this._createTooltip('search-tooltip');
		this._cancel = this._createCancel(this.options.textCancel, 'search-cancel');
		this._button = this._createButton(this.options.textPlaceholder, 'search-button');
		this._alert = this._createAlert('search-alert');

		if(this.options.collapsed===false)
			this.expand(this.options.collapsed);

		if(this.options.marker) {
			
			if(this.options.marker instanceof L.Marker || this.options.marker instanceof L.CircleMarker)
				this._markerSearch = this.options.marker;

			else if(this._isObject(this.options.marker))
				this._markerSearch = new L.Control.Search.Marker([0,0], this.options.marker);

			this._markerSearch._isMarkerSearch = true;
		}

		this.setLayer( this._layer );

		map.on({
			// 		'layeradd': this._onLayerAddRemove,
			// 		'layerremove': this._onLayerAddRemove
			'resize': this._handleAutoresize
			}, this);
		return this._container;
	},
	addTo: function (map) {

		if(this.options.container) {
			this._container = this.onAdd(map);
			this._wrapper = L.DomUtil.get(this.options.container);
			this._wrapper.style.position = 'relative';
			this._wrapper.appendChild(this._container);
		}
		else
			L.Control.prototype.addTo.call(this, map);

		return this;
	},

	onRemove: function(map) {
		this._recordsCache = {};
		// map.off({
		// 		'layeradd': this._onLayerAddRemove,
		// 		'layerremove': this._onLayerAddRemove
		// 	}, this);
		map.off({
			// 		'layeradd': this._onLayerAddRemove,
			// 		'layerremove': this._onLayerAddRemove
			'resize': this._handleAutoresize
			}, this);
	},

	// _onLayerAddRemove: function(e) {
	// 	//without this, run setLayer also for each Markers!! to optimize!
	// 	if(e.layer instanceof L.LayerGroup)
	// 		if( L.stamp(e.layer) != L.stamp(this._layer) )
	// 			this.setLayer(e.layer);
	// },

	setLayer: function(layer) {	//set search layer at runtime
		//this.options.layer = layer; //setting this, run only this._recordsFromLayer()
		this._layer = layer;
		this._layer.addTo(this._map);
		return this;
	},
	
	showAlert: function(text) {
		var self = this;
		text = text || this.options.textErr;
		this._alert.style.display = 'block';
		this._alert.innerHTML = text;
		clearTimeout(this.timerAlert);
		
		this.timerAlert = setTimeout(function() {
			self.hideAlert();
		},this.options.autoCollapseTime);
		return this;
	},
	
	hideAlert: function() {
		this._alert.style.display = 'none';
		return this;
	},
		
	cancel: function() {
		this._input.value = '';
		this._handleKeypress({ keyCode: 8 });//simulate backspace keypress
		this._input.size = this._inputMinSize;
		this._input.focus();
		this._cancel.style.display = 'none';
		this._hideTooltip();
		this.fire('search:cancel');
		return this;
	},
	
	expand: function(toggle) {
		toggle = typeof toggle === 'boolean' ? toggle : true;
		this._input.style.display = 'block';
		L.DomUtil.addClass(this._container, 'search-exp');
		if ( toggle !== false ) {
			this._input.focus();
			this._map.on('dragstart click', this.collapse, this);
		}
		this.fire('search:expanded');
		return this;	
	},

	collapse: function() {
		this._hideTooltip();
		this.cancel();
		this._alert.style.display = 'none';
		this._input.blur();
		if(this.options.collapsed)
		{
			this._input.style.display = 'none';
			this._cancel.style.display = 'none';			
			L.DomUtil.removeClass(this._container, 'search-exp');		
			if (this.options.hideMarkerOnCollapse) {
				this._map.removeLayer(this._markerSearch);
			}
			this._map.off('dragstart click', this.collapse, this);
		}
		this.fire('search:collapsed');
		return this;
	},
	
	collapseDelayed: function() {	//collapse after delay, used on_input blur
		var self = this;
		if (!this.options.autoCollapse) return this;
		clearTimeout(this.timerCollapse);
		this.timerCollapse = setTimeout(function() {
			self.collapse();
		}, this.options.autoCollapseTime);
		return this;		
	},

	collapseDelayedStop: function() {
		clearTimeout(this.timerCollapse);
		return this;		
	},

	////start DOM creations
	_createAlert: function(className) {
		var alert = L.DomUtil.create('div', className, this._container);
		alert.style.display = 'none';

		L.DomEvent
			.on(alert, 'click', L.DomEvent.stop, this)
			.on(alert, 'click', this.hideAlert, this);

		return alert;
	},

	_createInput: function (text, className) {
		var self = this;
		var label = L.DomUtil.create('label', className, this._container);
		var input = L.DomUtil.create('input', className, this._container);
		input.type = 'text';
		input.size = this._inputMinSize;
		input.value = '';
		input.autocomplete = 'off';
		input.autocorrect = 'off';
		input.autocapitalize = 'off';
		input.placeholder = text;
		input.style.display = 'none';
		input.role = 'search';
		input.id = input.role + input.type + input.size;
		
		label.htmlFor = input.id;
		label.style.display = 'none';
		label.value = text;

		L.DomEvent
			.disableClickPropagation(input)
			.on(input, 'keyup', this._handleKeypress, this)
			.on(input, 'paste', function(e) {
				setTimeout(function(e) {
					self._handleKeypress(e);
				},10,e);
			}, this)
			.on(input, 'blur', this.collapseDelayed, this)
			.on(input, 'focus', this.collapseDelayedStop, this);
		
		return input;
	},

	_createCancel: function (title, className) {
		var cancel = L.DomUtil.create('a', className, this._container);
		cancel.href = '#';
		cancel.title = title;
		cancel.style.display = 'none';
		cancel.innerHTML = "&lt;span&gt;&amp;otimes;&lt;/span&gt;";//imageless(see css)

		L.DomEvent
			.on(cancel, 'click', L.DomEvent.stop, this)
			.on(cancel, 'click', this.cancel, this);

		return cancel;
	},
	
	_createButton: function (title, className) {
		var button = L.DomUtil.create('a', className, this._container);
		button.href = '#';
		button.title = title;

		L.DomEvent
			.on(button, 'click', L.DomEvent.stop, this)
			.on(button, 'click', this._handleSubmit, this)			
			.on(button, 'focus', this.collapseDelayedStop, this)
			.on(button, 'blur', this.collapseDelayed, this);

		return button;
	},

	_createTooltip: function(className) {
		var self = this;		
		var tool = L.DomUtil.create('ul', className, this._container);
		tool.style.display = 'none';
		L.DomEvent
			.disableClickPropagation(tool)
			.on(tool, 'blur', this.collapseDelayed, this)
			.on(tool, 'mousewheel', function(e) {
				self.collapseDelayedStop();
				L.DomEvent.stopPropagation(e);//disable zoom map
			}, this)
			.on(tool, 'mouseover', function(e) {
				self.collapseDelayedStop();
			}, this);
		return tool;
	},

	_createTip: function(text, val) {//val is object in recordCache, usually is Latlng
		var tip;
		
		if(this.options.buildTip)
		{
			tip = this.options.buildTip.call(this, text, val); //custom tip node or html string
			if(typeof tip === 'string')
			{
				var tmpNode = L.DomUtil.create('div');
				tmpNode.innerHTML = tip;
				tip = tmpNode.firstChild;
			}
		}
		else
		{
			tip = L.DomUtil.create('li', '');
			tip.innerHTML = text;
		}
		
		L.DomUtil.addClass(tip, 'search-tip');
		tip._text = text; //value replaced in this._input and used by _autoType

		if(this.options.tipAutoSubmit)
			L.DomEvent
				.disableClickPropagation(tip)		
				.on(tip, 'click', L.DomEvent.stop, this)
				.on(tip, 'click', function(e) {
					this._input.value = text;
					this._handleAutoresize();
					this._input.focus();
					this._hideTooltip();	
					this._handleSubmit();
				}, this);

		return tip;
	},

	//////end DOM creations

	_getUrl: function(text) {
		return (typeof this.options.url === 'function') ? this.options.url(text) : this.options.url;
	},

	_defaultFilterData: function(text, records) {
	
		var I, icase, regSearch, frecords = {};

		text = text.replace(/[.*+?^${}()|[\]\\]/g, '');  //sanitize remove all special characters
		if(text==='')
			return [];

		I = this.options.initial ? '^' : '';  //search only initial text
		icase = !this.options.casesensitive ? 'i' : undefined;

		regSearch = new RegExp(I + text, icase);

		//TODO use .filter or .map
		for(var key in records) {
			if( regSearch.test(key) )
				frecords[key]= records[key];
		}
		
		return frecords;
	},

	showTooltip: function(records) {
		

		this._countertips = 0;
		this._tooltip.innerHTML = '';
		this._tooltip.currentSelection = -1;  //inizialized for _handleArrowSelect()

		if(this.options.tooltipLimit)
		{
			for(var key in records)//fill tooltip
			{
				if(this._countertips === this.options.tooltipLimit)
					break;
				
				this._countertips++;

				this._tooltip.appendChild( this._createTip(key, records[key]) );
			}
		}
		
		if(this._countertips &gt; 0)
		{
			this._tooltip.style.display = 'block';
			
			if(this._autoTypeTmp)
				this._autoType();

			this._autoTypeTmp = this.options.autoType;//reset default value
		}
		else
			this._hideTooltip();

		this._tooltip.scrollTop = 0;

		return this._countertips;
	},

	_hideTooltip: function() {
		this._tooltip.style.display = 'none';
		this._tooltip.innerHTML = '';
		return 0;
	},

	_defaultFormatData: function(json) {	//default callback for format data to indexed data
		var self = this,
			propName = this.options.propertyName,
			propLoc = this.options.propertyLoc,
			i, jsonret = {};

		if( L.Util.isArray(propLoc) )
			for(i in json)
				jsonret[ self._getPath(json[i],propName) ]= L.latLng( json[i][ propLoc[0] ], json[i][ propLoc[1] ] );
		else
			for(i in json)
				jsonret[ self._getPath(json[i],propName) ]= L.latLng( self._getPath(json[i],propLoc) );
		//TODO throw new Error("propertyName '"+propName+"' not found in JSON data");
		return jsonret;
	},

	_recordsFromJsonp: function(text, callAfter) {  //extract searched records from remote jsonp service
		L.Control.Search.callJsonp = callAfter;
		var script = L.DomUtil.create('script','leaflet-search-jsonp', document.getElementsByTagName('body')[0] ),			
			url = L.Util.template(this._getUrl(text)+'&amp;'+this.options.jsonpParam+'=L.Control.Search.callJsonp', {s: text}); //parsing url
			//rnd = '&amp;_='+Math.floor(Math.random()*10000);
			//TODO add rnd param or randomize callback name! in recordsFromJsonp
		script.type = 'text/javascript';
		script.src = url;
		return { abort: function() { script.parentNode.removeChild(script); } };
	},

	_recordsFromAjax: function(text, callAfter) {	//Ajax request
		if (window.XMLHttpRequest === undefined) {
			window.XMLHttpRequest = function() {
				try { return new ActiveXObject("Microsoft.XMLHTTP.6.0"); }
				catch  (e1) {
					try { return new ActiveXObject("Microsoft.XMLHTTP.3.0"); }
					catch (e2) { throw new Error("XMLHttpRequest is not supported"); }
				}
			};
		}
		var IE8or9 = ( L.Browser.ie &amp;&amp; !window.atob &amp;&amp; document.querySelector ),
			request = IE8or9 ? new XDomainRequest() : new XMLHttpRequest(),
			url = L.Util.template(this._getUrl(text), {s: text});

		//rnd = '&amp;_='+Math.floor(Math.random()*10000);
		//TODO add rnd param or randomize callback name! in recordsFromAjax			
		
		request.open("GET", url);
		

		request.onload = function() {
			callAfter( JSON.parse(request.responseText) );
		};
		request.onreadystatechange = function() {
		    if(request.readyState === 4 &amp;&amp; request.status === 200) {
		    	this.onload();
		    }
		};

		request.send();
		return request;   
	},

  _searchInLayer: function(layer, retRecords, propName) {
    var self = this, loc;

    if(layer instanceof L.Control.Search.Marker) return;

    if(layer instanceof L.Marker || layer instanceof L.CircleMarker)
    {
      if(self._getPath(layer.options,propName))
      {
        loc = layer.getLatLng();
        loc.layer = layer;
        retRecords[ self._getPath(layer.options,propName) ] = loc;
      }
      else if(self._getPath(layer.feature.properties,propName))
      {
        loc = layer.getLatLng();
        loc.layer = layer;
        retRecords[ self._getPath(layer.feature.properties,propName) ] = loc;
      }
      else {
        //throw new Error("propertyName '"+propName+"' not found in marker"); 
        console.warn("propertyName '"+propName+"' not found in marker"); 
      }
    }
    else if(layer instanceof L.Path || layer instanceof L.Polyline || layer instanceof L.Polygon)
    {
      if(self._getPath(layer.options,propName))
      {
        loc = layer.getBounds().getCenter();
        loc.layer = layer;
        retRecords[ self._getPath(layer.options,propName) ] = loc;
      }
      else if(self._getPath(layer.feature.properties,propName))
      {
        loc = layer.getBounds().getCenter();
        loc.layer = layer;
        retRecords[ self._getPath(layer.feature.properties,propName) ] = loc;
      }
      else {
        //throw new Error("propertyName '"+propName+"' not found in shape"); 
        console.warn("propertyName '"+propName+"' not found in shape"); 
      }
    }
    else if(layer.hasOwnProperty('feature'))//GeoJSON
    {
      if(layer.feature.properties.hasOwnProperty(propName))
      {
        if(layer.getLatLng &amp;&amp; typeof layer.getLatLng === 'function') {
          loc = layer.getLatLng();
          loc.layer = layer;			
          retRecords[ layer.feature.properties[propName] ] = loc;
        } else if(layer.getBounds &amp;&amp; typeof layer.getBounds === 'function') {
          loc = layer.getBounds().getCenter();
          loc.layer = layer;			
          retRecords[ layer.feature.properties[propName] ] = loc;
        } else {
          console.warn("Unknown type of Layer");
        }
      }
      else {
        //throw new Error("propertyName '"+propName+"' not found in feature");
        console.warn("propertyName '"+propName+"' not found in feature"); 
      }
    }
    else if(layer instanceof L.LayerGroup)
    {
      layer.eachLayer(function (layer) {
        self._searchInLayer(layer, retRecords, propName);
      });
    }
  },
	
	_recordsFromLayer: function() {	//return table: key,value from layer
		var self = this,
			retRecords = {},
			propName = this.options.propertyName;
		
		this._layer.eachLayer(function (layer) {
			self._searchInLayer(layer, retRecords, propName);
		});
		
		return retRecords;
	},
	
	_autoType: function() {
		
		//TODO implements autype without selection(useful for mobile device)
		
		var start = this._input.value.length,
			firstRecord = this._tooltip.firstChild ? this._tooltip.firstChild._text : '',
			end = firstRecord.length;

		if (firstRecord.indexOf(this._input.value) === 0) { // If prefix match
			this._input.value = firstRecord;
			this._handleAutoresize();

			if (this._input.createTextRange) {
				var selRange = this._input.createTextRange();
				selRange.collapse(true);
				selRange.moveStart('character', start);
				selRange.moveEnd('character', end);
				selRange.select();
			}
			else if(this._input.setSelectionRange) {
				this._input.setSelectionRange(start, end);
			}
			else if(this._input.selectionStart) {
				this._input.selectionStart = start;
				this._input.selectionEnd = end;
			}
		}
	},

	_hideAutoType: function() {	// deselect text:

		var sel;
		if ((sel = this._input.selection) &amp;&amp; sel.empty) {
			sel.empty();
		}
		else if (this._input.createTextRange) {
			sel = this._input.createTextRange();
			sel.collapse(true);
			var end = this._input.value.length;
			sel.moveStart('character', end);
			sel.moveEnd('character', end);
			sel.select();
		}
		else {
			if (this._input.getSelection) {
				this._input.getSelection().removeAllRanges();
			}
			this._input.selectionStart = this._input.selectionEnd;
		}
	},
	
	_handleKeypress: function (e) {	//run _input keyup event
		var self = this;

		switch(e.keyCode)
		{
			case 27://Esc
				this.collapse();
			break;
			case 13://Enter
				if(this._countertips == 1 || (this.options.firstTipSubmit &amp;&amp; this._countertips &gt; 0)) {
          			if(this._tooltip.currentSelection == -1) {
						this._handleArrowSelect(1);
          			}
				}
				this._handleSubmit();	//do search
			break;
			case 38://Up
				this._handleArrowSelect(-1);
			break;
			case 40://Down
				this._handleArrowSelect(1);
			break;
			case  8://Backspace
			case 45://Insert
			case 46://Delete
				this._autoTypeTmp = false;//disable temporarily autoType
			break;
			case 37://Left
			case 39://Right
			case 16://Shift
			case 17://Ctrl
			case 35://End
			case 36://Home
			break;
			default://All keys
				if(this._input.value.length)
					this._cancel.style.display = 'block';
				else
					this._cancel.style.display = 'none';

				if(this._input.value.length &gt;= this.options.minLength)
				{
					clearTimeout(this.timerKeypress);	//cancel last search request while type in				
					this.timerKeypress = setTimeout(function() {	//delay before request, for limit jsonp/ajax request

						self._fillRecordsCache();
					
					}, this.options.delayType);
				}
				else
					this._hideTooltip();
		}

		this._handleAutoresize();
	},

	searchText: function(text) {
		var code = text.charCodeAt(text.length);

		this._input.value = text;

		this._input.style.display = 'block';
		L.DomUtil.addClass(this._container, 'search-exp');

		this._autoTypeTmp = false;

		this._handleKeypress({keyCode: code});
	},
	
	_fillRecordsCache: function() {

		var self = this,
			inputText = this._input.value, records;

		if(this._curReq &amp;&amp; this._curReq.abort)
			this._curReq.abort();
		//abort previous requests

		L.DomUtil.addClass(this._container, 'search-load');	

		if(this.options.layer)
		{
			//TODO _recordsFromLayer must return array of objects, formatted from _formatData
			this._recordsCache = this._recordsFromLayer();
			
			records = this._filterData( this._input.value, this._recordsCache );

			this.showTooltip( records );

			L.DomUtil.removeClass(this._container, 'search-load');
		}
		else
		{
			if(this.options.sourceData)
				this._retrieveData = this.options.sourceData;

			else if(this.options.url)	//jsonp or ajax
				this._retrieveData = this.options.jsonpParam ? this._recordsFromJsonp : this._recordsFromAjax;

			this._curReq = this._retrieveData.call(this, inputText, function(data) {
				
				self._recordsCache = self._formatData.call(self, data);

				//TODO refact!
				if(self.options.sourceData)
					records = self._filterData( self._input.value, self._recordsCache );
				else
					records = self._recordsCache;

				self.showTooltip( records );
 
				L.DomUtil.removeClass(self._container, 'search-load');
			});
		}
	},
	
	_handleAutoresize: function() {
	    var maxWidth;

		if (this._input.style.maxWidth !== this._map._container.offsetWidth) {
			maxWidth = this._map._container.clientWidth;

			// other side margin + padding + width border + width search-button + width search-cancel
			maxWidth -= 10 + 20 + 1 + 30 + 22; 

			this._input.style.maxWidth = maxWidth.toString() + 'px';
		}

		if (this.options.autoResize &amp;&amp; (this._container.offsetWidth + 20 &lt; this._map._container.offsetWidth)) {
			this._input.size = this._input.value.length &lt; this._inputMinSize ? this._inputMinSize : this._input.value.length;
		}
	},

	_handleArrowSelect: function(velocity) {
	
		var searchTips = this._tooltip.hasChildNodes() ? this._tooltip.childNodes : [];
			
		for (i=0; i&lt;searchTips.length; i++)
			L.DomUtil.removeClass(searchTips[i], 'search-tip-select');
		
		if ((velocity == 1 ) &amp;&amp; (this._tooltip.currentSelection &gt;= (searchTips.length - 1))) {// If at end of list.
			L.DomUtil.addClass(searchTips[this._tooltip.currentSelection], 'search-tip-select');
		}
		else if ((velocity == -1 ) &amp;&amp; (this._tooltip.currentSelection &lt;= 0)) { // Going back up to the search box.
			this._tooltip.currentSelection = -1;
		}
		else if (this._tooltip.style.display != 'none') {
			this._tooltip.currentSelection += velocity;
			
			L.DomUtil.addClass(searchTips[this._tooltip.currentSelection], 'search-tip-select');
			
			this._input.value = searchTips[this._tooltip.currentSelection]._text;

			// scroll:
			var tipOffsetTop = searchTips[this._tooltip.currentSelection].offsetTop;
			
			if (tipOffsetTop + searchTips[this._tooltip.currentSelection].clientHeight &gt;= this._tooltip.scrollTop + this._tooltip.clientHeight) {
				this._tooltip.scrollTop = tipOffsetTop - this._tooltip.clientHeight + searchTips[this._tooltip.currentSelection].clientHeight;
			}
			else if (tipOffsetTop &lt;= this._tooltip.scrollTop) {
				this._tooltip.scrollTop = tipOffsetTop;
			}
		}
	},

	_handleSubmit: function() {	//button and tooltip click and enter submit

		this._hideAutoType();
		
		this.hideAlert();
		this._hideTooltip();

		if(this._input.style.display == 'none')	//on first click show _input only
			this.expand();
		else
		{
			if(this._input.value === '')	//hide _input only
				this.collapse();
			else
			{
				var loc = this._getLocation(this._input.value);
				
				if(loc===false)
					this.showAlert();
				else
				{
					this.showLocation(loc, this._input.value);
					this.fire('search:locationfound', {
							latlng: loc,
							text: this._input.value,
							layer: loc.layer ? loc.layer : null
						});
				}
			}
		}
	},

	_getLocation: function(key) {	//extract latlng from _recordsCache

		if( this._recordsCache.hasOwnProperty(key) )
			return this._recordsCache[key];//then after use .loc attribute
		else
			return false;
	},

	_defaultMoveToLocation: function(latlng, title, map) {
		if(this.options.zoom)
 			this._map.setView(latlng, this.options.zoom);
 		else
			this._map.panTo(latlng);
	},

	showLocation: function(latlng, title) {	//set location on map from _recordsCache
		var self = this;

		self._map.once('moveend zoomend', function(e) {

			if(self._markerSearch) {
				self._markerSearch.addTo(self._map).setLatLng(latlng);
			}
			
		});

		self._moveToLocation(latlng, title, self._map);
		//FIXME autoCollapse option hide self._markerSearch before visualized!!
		if(self.options.autoCollapse)
			self.collapse();

		return self;
	}
});

L.Control.Search.Marker = L.Marker.extend({

	includes: L.version[0]==='1' ? L.Evented.prototype : L.Mixin.Events,
	
	options: {
		icon: new L.Icon.Default(),
		animate: true,
		circle: {
			radius: 10,
			weight: 3,
			color: '#e03',
			stroke: true,
			fill: false
		}
	},
	
	initialize: function (latlng, options) {
		L.setOptions(this, options);

		if(options.icon === true)
			options.icon = new L.Icon.Default();

		L.Marker.prototype.initialize.call(this, latlng, options);
		
		if( L.Control.Search.prototype._isObject(this.options.circle) )
			this._circleLoc = new L.CircleMarker(latlng, this.options.circle);
	},

	onAdd: function (map) {
		L.Marker.prototype.onAdd.call(this, map);
		if(this._circleLoc) {
			map.addLayer(this._circleLoc);
			if(this.options.animate)
				this.animate();
		}
	},

	onRemove: function (map) {
		L.Marker.prototype.onRemove.call(this, map);
		if(this._circleLoc)
			map.removeLayer(this._circleLoc);
	},
	
	setLatLng: function (latlng) {
		L.Marker.prototype.setLatLng.call(this, latlng);
		if(this._circleLoc)
			this._circleLoc.setLatLng(latlng);
		return this;
	},
	
	_initIcon: function () {
		if(this.options.icon)
			L.Marker.prototype._initIcon.call(this);
	},

	_removeIcon: function () {
		if(this.options.icon)
			L.Marker.prototype._removeIcon.call(this);
	},

	animate: function() {
	//TODO refact animate() more smooth! like this: http://goo.gl/DDlRs
		if(this._circleLoc)
		{
			var circle = this._circleLoc,
				tInt = 200,	//time interval
				ss = 5,	//frames
				mr = parseInt(circle._radius/ss),
				oldrad = this.options.circle.radius,
				newrad = circle._radius * 2,
				acc = 0;

			circle._timerAnimLoc = setInterval(function() {
				acc += 0.5;
				mr += acc;	//adding acceleration
				newrad -= mr;
				
				circle.setRadius(newrad);

				if(newrad&lt;oldrad)
				{
					clearInterval(circle._timerAnimLoc);
					circle.setRadius(oldrad);//reset radius
					//if(typeof afterAnimCall == 'function')
						//afterAnimCall();
						//TODO use create event 'animateEnd' in L.Control.Search.Marker 
				}
			}, tInt);
		}
		
		return this;
	}
});

L.Map.addInitHook(function () {
    if (this.options.searchControl) {
        this.searchControl = L.control.search(this.options.searchControl);
        this.addControl(this.searchControl);
    }
});

L.control.search = function (options) {
    return new L.Control.Search(options);
};

return L.Control.Search;

});
]]&gt;&lt;/script&gt;&lt;script_name&gt;leaflet search js&lt;/script_name&gt;&lt;sys_class_name&gt;sys_ui_script&lt;/sys_class_name&gt;&lt;sys_created_by&gt;brian.nguyen&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-08-21 21:51:08&lt;/sys_created_on&gt;&lt;sys_id&gt;2f429b5b1b93b70074f3db9cdc4bcb50&lt;/sys_id&gt;&lt;sys_mod_count&gt;1&lt;/sys_mod_count&gt;&lt;sys_name&gt;x_snc_sp_asset_map.leaflet search js&lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_ui_script_2f429b5b1b93b70074f3db9cdc4bcb50&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;brian.nguyen&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-08-21 21:51:27&lt;/sys_updated_on&gt;&lt;ui_type&gt;10&lt;/ui_type&gt;&lt;use_scoped_format&gt;false&lt;/use_scoped_format&gt;&lt;/sys_ui_script&gt;&lt;/record_update&gt;</payload>
<payload_hash>-1260164964</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6395faeedb48c410993fdc965e961918</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91c90000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>x_snc_sp_asset_map.leaflet search js</target_name>
<type>UI Script</type>
<update_domain>global</update_domain>
<update_guid>5e82df5b4a93b700f1053cc8dae8540e</update_guid>
<update_guid_history>5e82df5b4a93b700f1053cc8dae8540e:-1260164964,8672db5b1f93b70033c879dab554724a:1781729706</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>db_image_7da7db931bd3b70074f3db9cdc4bcb55</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="db_image"><db_image action="INSERT_OR_UPDATE"><active>true</active><category/><format>png</format><height>70</height><image>a5b7db931bd3b70074f3db9cdc4bcbcf</image><name>search-icon.png</name><size_bytes>3838</size_bytes><sys_class_name>db_image</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 22:13:58</sys_created_on><sys_id>7da7db931bd3b70074f3db9cdc4bcb55</sys_id><sys_mod_count>2</sys_mod_count><sys_name>search-icon.png</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>db_image_7da7db931bd3b70074f3db9cdc4bcb55</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 22:14:05</sys_updated_on><thumbnail/><width>20</width></db_image><sys_attachment action="INSERT_OR_UPDATE"><average_image_color>#0</average_image_color><chunk_size_bytes>734003</chunk_size_bytes><compressed>true</compressed><content_type>image/png</content_type><encryption_context/><file_name>image</file_name><image_height>70</image_height><image_width>20</image_width><size_bytes>3838</size_bytes><size_compressed>3861</size_compressed><state>pending</state><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 22:14:05</sys_created_on><sys_id>a5b7db931bd3b70074f3db9cdc4bcbcf</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 22:14:05</sys_updated_on><table_name>ZZ_YYdb_image</table_name><table_sys_id>7da7db931bd3b70074f3db9cdc4bcb55</table_sys_id></sys_attachment><sys_attachment_doc action="INSERT_OR_UPDATE"><data>H4sIAAAAAAAAAA==</data><length>16</length><position>0</position><sys_attachment display_value="image" sys_id="a5b7db931bd3b70074f3db9cdc4bcbcf">a5b7db931bd3b70074f3db9cdc4bcbcf</sys_attachment><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 22:14:05</sys_created_on><sys_id>e5b7db931bd3b70074f3db9cdc4bcbcf</sys_id></sys_attachment_doc><sys_attachment_doc action="INSERT_OR_UPDATE"><data>Af4OAfGJUE5HDQoaCgAAAA1JSERSAAAAFAAAAEYIBgAAAMzPtPEAAApDaUNDUElDQyBwcm9maWxlAAB42p1Td1iT9xY+3/dlD1ZC2PCxl2yBACIjrAjIEFmiEJIAYYQQEkDFhYgKVhQVEZxIVcSC1QpInYjioCi4Z0GKiFqLVVw47h/cp7V9eu/t7fvX+7znnOf8znnPD4AREiaR5qJqADlShTw62B+PT0jEyb2AAhVI4AQgEObLwmcFxQAA8AN5eH50sD/8Aa9vAAIAcNUuJBLH4f+DulAmVwAgkQDgIhLnCwGQUgDILlTIFADIGACwU7NkCgCUAABseXxCIgCqDQDs9Ek+BQDYqZPcFwDYohypCACNAQCZKEckAkC7AGBVgVIsAsDCAKCsQCIuBMCuAYBZtjJHAoC9BQB2jliQD0BgAICZQizMACA4AgBDHhPNAyBMA6Aw0r/gqV9whbhIAQDAy5XNl0vSMxS4ldAad/Lw4OIh4sJssUJhFykQZgnkIpyXmyMTSOcDTM4MAAAa+dHB/jg/kOfm5OHmZuds7/TFov5r8G8iPiHx3/68jAIEABBOz+/aX+Xl1gNwxwGwdb9rqVsA2lYAaN/5XTPbCaBaCtB6+Yt5OPxAHp6hUMg8HRwKCwvtJWKhvTDjiz7/M+Fv4It+9vxAHv7bevAAcZpAma3Ao4P9cWFudq5SjufLBEIxbvfnI/7HhX/9jinR4jSxXCwVivFYibhQIk3HeblSkUQhyZXiEul/MvEflv0Jk3cNAKyGT8BOtge1y2zAfu4BAosOWNJ2AEB+8y2MGguRABBnNDJ59wAAk7/5j0ArAQDNl6TjAAC86BhcqJQXTMYIAABEoIEqsEEHDMEUrMAOnMEdvMAXAmEGREAMJMA8EEIG5IAcCqEYlkEZVMA62AS1sAMaoBGa4RC0wTE4DefgElyB63AXBmAYnsIYvIYJBEHICBNhITqIEWKO2CLOCBeZjgQiYUg0koCkIOmIFFEixchypAKpQmqRXUgj8i1yFDmNXED6kNvIIDKK/Iq8RzGUgbJRA9QCdUC5qB8aisagc9F0NA9dgJaia9EatB49gLaip9FL6HV0AH2KjmOA0TEOZozZYVyMh0VgiVgaJscWY+VYNVaPNWMdWDd2FRvAnmHvCCQCi4AT7AhehBDCbIKQkEdYTFhDqCXsI7QSughXCYOEMcInIpOoT7QlehL5xHhiOrGQWEasJu4hHiGeJV4nDhNfk0gkDsmS5E4KISWQMkkLSWtI20gtpFOkPtIQaZxMJuuQbcne5AiygKwgl5G3kA+QT5L7ycPktxQ6xYjiTAmiJFKklBJKNWU/5QSlnzJCmaCqUc2pntQIqog6n1pJbaB2UC9Th6kTNHWaJc2bFkPLpC2j1dCaaWdp92gv6XS6Cd2DHkWX0JfSa+gH6efpg/R3DA2GDYPHSGIoGWsZexmnGLcZL5lMpgXTl5nIVDDXMhuZZ5gPmG9VWCr2KnwVkcoSlTqVVpV+leeqVFVzVT/VeaoLVKtVD6teVn2mRlWzUOOpCdQWq9WpHVW7qTauzlJ3Uo9Qz1Ffo75f/YL6Yw2yhoVGoIZIo1Rjt8YZjSEWxjJl8VhC1nJWA+ssa5hNYluy+exMdgX7G3Yve0xTQ3OqZqxmkWad5nHNAQ7GseDwOdmcSs4hzg3Oey0DLT8tsdZqrWatfq032nravtpi7XLtFu3r2u91cJ1AnSyd9TptOvd1Cbo2ulG6hbrbdc/qPtNj63npCfXK9Q7p3dFH9W30o/UX6u/W79EfNzA0CDaQGWwxOGPwzJBj6GuYabjR8IThqBHLaLqRxGij0UmjJ7gm7odn4zV4Fz5mrG8cYqw03mXcazxhYmky26TEpMXkvinNlGuaZrrRtNN0zMzILNys2KzJ7I451ZxrnmG+2bzb/I2FpUWcxUqLNovHltqWfMsFlk2W96yYVj5WeVb1VtesSdZc6yzrbdZXbFAbV5sMmzqby7aorZutxHabbd8U4hSPKdIp9VNu2jHs/OwK7JrsBu059mH2JfZt9s8dzBwSHdY7dDt8cnR1zHZscLzrpOE0w6nEqcPpV2cbZ6FznfM1F6ZLkMsSl3aXF1Ntp4qnbp96y5XlGu660rXT9aObu5vcrdlt1N3MPcV9q/tNLpsbyV3DPe9B9PD3WOJxzOOdp5unwvOQ5y9edl5ZXvu9Hk+znCae1jBtyNvEW+C9y3tgOj49ZfrO6QM+xj4Cn3qfh76mviLfPb4jftZ+mX4H/J77O/rL/Y/4v+F58hbxTgVgAcEB5QG9gRqBswNrAx8EmQSlBzUFjQW7Bi8MPhVCDAkNWR9yk2/AF/Ib+WMz3GcsmtEVygidFVob+jDMJkwe1hGOhs8I3xB+b6b5TOnMtgiI4EdsiLgfaRmZF/l9FCkqMqou6lG0U3RxdPcs1qzkWftnvY7xj6mMuTvbarZydmesamxSbGPsm7iAuKq4gXiH+EXxlxJ0EyQJ7YnkxNjEPYnjcwLnbJoznOSaVJZ0Y67l3KK5F+bpzsuedzxZNVmQfDiFmBKXsj/lgyBCUC8YT+Wnbk0dE/KEm4VPRb6ijaJRsbe4SjyS5p1WlfY43Tt9Q/pohk9GdcYzCU9SK3mRGZK5I/NNVkTW3qzP2XHZLTmUnJSco1INaZa0K9cwtyi3T2YrK5MN5Hnmbcobk4fK9+Qj+XPz2xVshUzRo7RSrlAOFkwvqCt4WxhbeLhIvUha1DPfZv7q+SMLghZ8vZCwULiws9i4eFnx4CK/RbsWI4tTF3cuMV1SumR4afDSfctoy7KW/VDiWFJV8mp53PKOUoPSpaVDK4JXNJWplMnLbq70WrljFWGVZFXvapfVW1Z/KheVX6xwrKiu+LBGuObiV05f1Xz1eW3a2t5Kt8rt60jrpOturPdZv69KvWpB1dCG8A2tG/GN5RtfbUredKF6avWOzbTNys0DNWE17VvMtqzb8qE2o/Z6nX9dy1b9rau3vtkm2ta/3Xd78w6DHRU73u+U7Ly1K3hXa71FffVu0u6C3Y8aYhu6v+Z+3bhHd0/Fno97pXsH9kXv62p0b2zcr7+/sgltUjaNHkg6cOWbgG/am+2ad7VwWioOwkHlwSffpnx741Dooc7D3MPN35l/t/UI60h5K9I6v3WsLaNtoD2hve/ojKOdHV4dR763/37vMeNjdcc1j1eeoJ0oPfH55IKT46dkp56dTj891JncefdM/JlrXVFdvWdDz54/F3TuTLdf98nz3uePXfC8cPQi92LbJbdLrT2uPUd+cP3hSK9bb+tl98vtVzyudPRN6zvR79N/+mrA1XPX+NcuXZ95ve/G7Bu3bibdHLgluvX4dvbtF3cK7kzcXXqPeK/8vtr96gf6D+p/tP6xZcBt4PhgwGDPw1kP7w4Jh57+lP/Th+HSR8xH1SNGI42PnR8fGw0avfJkzpPhp7KnE8/Kflb/eetzq+ff/eL7S89Y/NjwC/mLz7+ueanzcu+rqa86xyPHH7zOeT3xpvytztt977jvut/HvR+ZKPxA/lDz0fpjx6fQT/c+53z+/C/3hPP7gDklEQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAPYQAAD2EBqD+naQAAAAd0SU1FB90JHQ4rNJBNbLQAAAQ8SURBVFjD7ZddaFtlGMd/y8fsjpvZ6qKEsi1diApN+4IKW6s4xQlugjIZXvmCQt2Nrjci6MUQvHBXwphXQoXBeyH4AeJNmSiiFhQcYztLhzZmieA8W+NST7Un3dqk3jyJh/Qk/TCIF3kg5OQ97/t/vv7P+Z/A/902tbl3G3AX0CO/q8B1YH69gFFgEDgCjAA7Zd88cB74FJgEKmuN+jngW+AmcAuYAa4BfwE1oAC8AWwLOhz2XYeAA8BbwIPAj8A4cAb4DLgIbAbuAwYAF7ggTgJtJ/C+RDUJPAVEmhzeD3wALMqeTLtUHwOKQBkYlaYE2UGJvgK83NyHkO96N7AduAJ8IzUMsu+AH6T7u30sWAEYFW8usNAmk3lgrulMIOCifO9o1UGxbbLHfyYQ8GdgFkgBT4j3IN6OAPukhlcAr5Xn7dLlilDkGWCrL6UeYD/wkUzNOWCoHQ8XpMMZocc+IAn0CveOAK9Il0PyKazGxRBwGPgc+ENqdNM3NR5QkvUaMA28ANweFCHAstTlnBxclq5fk2g+kZQtYK8MQwb4UyJdbkf0KHAn0C+NSsjobQIeBs5K5DXgJ3kG/Ct7VEpTE16+StOsrte+llq6wG/Ax3Stax3WZa11oC4bY9any1rrNemyMaaymowCoJQ6Crwps7lHZtoCdomDR4CoUuqibdu3WkaotQ7J5ncABVyWaLIyYntFWvcDvwNvA+PGmCU/oH+WewEt6X4PnATO1g+Iw6+A14CjwPOizdlWmjIIPC6vHGeAL/zejTE1Y8x5kYk88ABwQGu9Nl02xvw3uiy06Zwua603psvCx2awFbpsjPFaAU4BX4puvAgc1lpvrRdda90jQKMir5elnsHEtm17QSkVqMtKqZa6rJS6YNt2LXBSlFK/Ag5wN5AGhoGngWeF9HFpyGap872Aq5TK2ba9uALQtu1lpdSGdFkiXW73tIkCd8gnJG8NN6SzDwEnREqjQA44YYz5MNKGb4sCcCPg9qTW+qRw8KC8BOzq6nLXOimjxWKhb7ZcPu667iHP84aABcuypmOx2MSO3t53k8n+q2sGzGYvHXMc55TneVuCDliWVUkkEmOZzOD4qoDZ7KVjvxSL7y1Vq23TioTD7EkmXwoCDfnTdBznVB0sHo+vAKqvLVWrOI5zulgs9LUEnC2Xx+ppxuNxhodHGBj459/rwECG4eGRBqjneVtmy+XjK6KvX7iu+2T9ulQqkc/nSaVSjY2pVIp8Pk+pVMJ35hDweiCg53n3+G9MTWUbQAD5fL6x1upMs6Z0xCI+Oky7c3ND/prV0/RH6o/SsqzploCxWGyiDhiPxxtgfoBUKsXMzPVGHWOx2ERLHhaLhb5cLpfzd9rfgOY1y7Iq6XQ63Tw1jRomk/1XE4nEWCQcbnS62eprkXCYRCIxFjSCQaM36jjO6Y6MXiceDl3r2gbsb0vGuGFZd0TuAAAAAElFTkSuQmCC54tsOv4OAAA=</data><length>5136</length><position>1</position><sys_attachment display_value="image" sys_id="a5b7db931bd3b70074f3db9cdc4bcbcf">a5b7db931bd3b70074f3db9cdc4bcbcf</sys_attachment><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 22:14:05</sys_created_on><sys_id>69b7db931bd3b70074f3db9cdc4bcbcf</sys_id></sys_attachment_doc></record_update>]]></payload>
<payload_hash>489594096</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>67957aeedb48c410993fdc965e9619fc</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91df0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>search-icon.png</target_name>
<type>Images</type>
<update_domain>global</update_domain>
<update_guid>fdb71f9365d3b700d68d9d587068ef88</update_guid>
<update_guid_history>fdb71f9365d3b700d68d9d587068ef88:489594096,71b7db9364d3b700a0e8a7da8318c6d6:1937993370,b5b7db93e2d3b7001258d13d5cfeadd3:1937993370,80b75b93d6d3b700ab85a343f11e51a4:1399007270</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_ng_pro_sp_widget_9274197bdb15f7409eb1d311ce96195e</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_ng_pro_sp_widget"><m2m_sp_ng_pro_sp_widget action="INSERT_OR_UPDATE"><sp_angular_provider display_value="flippy">e474597bdb15f7409eb1d311ce9619c3</sp_angular_provider><sp_widget display_value="Service Portal Asset Map">4a7a40abdb5d77409eb1d311ce9619e6</sp_widget><sys_class_name>m2m_sp_ng_pro_sp_widget</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:52:05</sys_created_on><sys_id>9274197bdb15f7409eb1d311ce96195e</sys_id><sys_mod_count>0</sys_mod_count><sys_name>flippy.Service Portal Asset Map</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_ng_pro_sp_widget_9274197bdb15f7409eb1d311ce96195e</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:52:05</sys_updated_on></m2m_sp_ng_pro_sp_widget></record_update>]]></payload>
<payload_hash>423449233</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6795faeedb48c410993fdc965e961911</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90880000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>flippy.Service Portal Asset Map</target_name>
<type>Angular Providers</type>
<update_domain>global</update_domain>
<update_guid>da74197b1b15f740a3e9e77cde06d55f</update_guid>
<update_guid_history>da74197b1b15f740a3e9e77cde06d55f:423449233,da74197b1b15f740a3e9e77cde06d55f:423449233</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_js_include_0ba49d7bdb15f7409eb1d311ce961997</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_js_include"><sp_js_include action="INSERT_OR_UPDATE"><display_name>leaflet asset app</display_name><source>local</source><sys_class_name>sp_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:55:03</sys_created_on><sys_id>0ba49d7bdb15f7409eb1d311ce961997</sys_id><sys_mod_count>0</sys_mod_count><sys_name>leaflet asset app</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_ui_script display_value="x_snc_sp_asset_map.leafletjs asset app">2cc411bbdb15f7409eb1d311ce961991</sys_ui_script><sys_update_name>sp_js_include_0ba49d7bdb15f7409eb1d311ce961997</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:55:03</sys_updated_on><url/></sp_js_include></record_update>]]></payload>
<payload_hash>-1136472210</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6795faeedb48c410993fdc965e961914</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d909a0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>leaflet asset app</target_name>
<type>JS Include</type>
<update_domain>global</update_domain>
<update_guid>b92595bbf915f7409e670fcbecadde62</update_guid>
<update_guid_history>b92595bbf915f7409e670fcbecadde62:-1136472210,b92595bbf915f7409e670fcbecadde62:-1136472210</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_scope_privilege_ca36ddfbdb15f7409eb1d311ce961982</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_scope_privilege"><sys_scope_privilege action="INSERT_OR_UPDATE"><operation>execute</operation><source_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</source_scope><status>allowed</status><sys_class_name>sys_scope_privilege</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:59:43</sys_created_on><sys_id>ca36ddfbdb15f7409eb1d311ce961982</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Glide API: properties</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sys_scope_privilege_ca36ddfbdb15f7409eb1d311ce961982</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:59:43</sys_updated_on><target_name>Glide API: properties</target_name><target_scope display_value="Global">global</target_scope><target_type>scriptable</target_type></sys_scope_privilege></record_update>]]></payload>
<payload_hash>1996019017</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6795faeedb48c410993fdc965e961917</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90e10000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Glide API: properties</target_name>
<type>Cross scope privilege</type>
<update_domain>global</update_domain>
<update_guid>9236913fe015f740103ce9392a295a6e</update_guid>
<update_guid_history>9236913fe015f740103ce9392a295a6e:1996019017,9236913fe015f740103ce9392a295a6e:1996019017</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>DELETE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_js_include_3977576f1b17f70074f3db9cdc4bcb3c</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_js_include"><m2m_sp_dependency_js_include action="DELETE"><order>350</order><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sp_js_include display_value="Leaflet Search">3757d36f1b17f70074f3db9cdc4bcb71</sp_js_include><sys_class_name>m2m_sp_dependency_js_include</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-22 16:51:28</sys_created_on><sys_id>3977576f1b17f70074f3db9cdc4bcb3c</sys_id><sys_mod_count>1</sys_mod_count><sys_name>Leaflet NG.Leaflet Search</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_js_include_3977576f1b17f70074f3db9cdc4bcb3c</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-22 16:51:33</sys_updated_on></m2m_sp_dependency_js_include></record_update>]]></payload>
<payload_hash>-1207112690</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6b957aeedb48c410993fdc965e9619fe</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d924e0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Leaflet NG.Leaflet Search</target_name>
<type>Dependency JS Includes</type>
<update_domain>global</update_domain>
<update_guid>c287976f9017f700995d1cecad3f5981</update_guid>
<update_guid_history>c287976f9017f700995d1cecad3f5981:-1207112690,b277d36fe217f70061a48a7296927b79:836069018,bd77576f0b17f700621b8004d6d64e3d:-1444649</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_js_include_54421b5b1b93b70074f3db9cdc4bcb5d</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_js_include"><m2m_sp_dependency_js_include action="INSERT_OR_UPDATE"><order>250</order><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sp_js_include display_value="leaflet search js">c3321b5b1b93b70074f3db9cdc4bcb57</sp_js_include><sys_class_name>m2m_sp_dependency_js_include</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 21:50:14</sys_created_on><sys_id>54421b5b1b93b70074f3db9cdc4bcb5d</sys_id><sys_mod_count>3</sys_mod_count><sys_name>Leaflet NG.leaflet search js</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_js_include_54421b5b1b93b70074f3db9cdc4bcb5d</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 22:43:00</sys_updated_on></m2m_sp_dependency_js_include></record_update>]]></payload>
<payload_hash>1093191059</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6b95faeedb48c410993fdc965e961910</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91ed0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Leaflet NG.leaflet search js</target_name>
<type>Dependency JS Includes</type>
<update_domain>global</update_domain>
<update_guid>1d5e97db4fd3b700070a293dfab358ba</update_guid>
<update_guid_history>1d5e97db4fd3b700070a293dfab358ba:1093191059,ef3e17dbacd3b700e6edb3d1fea80aec:-1830293006,8fc2579b7693b700e7f9ad05899c1447:1093191059,6c421b5b7993b700f42bd95d5fdbe95e:-776593809</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_css_include_f4f5560cdba93b409eb1d311ce96197b</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_css_include"><sp_css_include action="INSERT_OR_UPDATE"><name>Awesome Marker CSS</name><source>local</source><sp_css display_value="Awesome Market Style">6985a57fdb55f7409eb1d311ce961957</sp_css><sys_class_name>sp_css_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 15:16:52</sys_created_on><sys_id>f4f5560cdba93b409eb1d311ce96197b</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Awesome Marker CSS</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_css_include_f4f5560cdba93b409eb1d311ce96197b</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-16 15:16:52</sys_updated_on><url/></sp_css_include></record_update>]]></payload>
<payload_hash>387965107</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6b95faeedb48c410993fdc965e961913</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d913c0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Awesome Marker CSS</target_name>
<type>CSS Include</type>
<update_domain>global</update_domain>
<update_guid>9806560c0ba93b404ac1be2aa3c9e281</update_guid>
<update_guid_history>9806560c0ba93b404ac1be2aa3c9e281:387965107,9806560c0ba93b404ac1be2aa3c9e281:387965107</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_scope_privilege_728fb308dba17b409eb1d311ce9619a3</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_scope_privilege"><sys_scope_privilege action="INSERT_OR_UPDATE"><operation>execute</operation><source_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</source_scope><status>allowed</status><sys_class_name>sys_scope_privilege</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 22:57:59</sys_created_on><sys_id>728fb308dba17b409eb1d311ce9619a3</sys_id><sys_mod_count>0</sys_mod_count><sys_name>ScopedGlideElement</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sys_scope_privilege_728fb308dba17b409eb1d311ce9619a3</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-16 22:57:59</sys_updated_on><target_name>ScopedGlideElement</target_name><target_scope display_value="Global">global</target_scope><target_type>scriptable</target_type></sys_scope_privilege></record_update>]]></payload>
<payload_hash>-1435590303</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6b95faeedb48c410993fdc965e961916</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91800000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>ScopedGlideElement</target_name>
<type>Cross scope privilege</type>
<update_domain>global</update_domain>
<update_guid>7e8fb3086ca17b40c39fafb6166d4ca3</update_guid>
<update_guid_history>7e8fb3086ca17b40c39fafb6166d4ca3:-1435590303,7e8fb3086ca17b40c39fafb6166d4ca3:-1435590303</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_css_include_bb25693fdb55f7409eb1d311ce9619fb</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_css_include"><m2m_sp_dependency_css_include action="INSERT_OR_UPDATE"><order>100</order><sp_css_include display_value="leaflet style asset">ad15e93fdb55f7409eb1d311ce96194b</sp_css_include><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sys_class_name>m2m_sp_dependency_css_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 17:05:05</sys_created_on><sys_id>bb25693fdb55f7409eb1d311ce9619fb</sys_id><sys_mod_count>0</sys_mod_count><sys_name>leaflet style asset.Leaflet NG</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_css_include_bb25693fdb55f7409eb1d311ce9619fb</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 17:05:05</sys_updated_on></m2m_sp_dependency_css_include></record_update>]]></payload>
<payload_hash>189739096</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6f957aeedb48c410993fdc965e9619fd</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90f40000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>leaflet style asset.Leaflet NG</target_name>
<type>Dependency CSS Includes</type>
<update_domain>global</update_domain>
<update_guid>f325693fdf55f740671048d6c1c125fd</update_guid>
<update_guid_history>f325693fdf55f740671048d6c1c125fd:189739096,f325693fdf55f740671048d6c1c125fd:189739096</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_css_a9256d3fdb55f7409eb1d311ce961935</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_css"><sp_css action="INSERT_OR_UPDATE"><css>/* required styles */&#13;
&#13;
.leaflet-pane,&#13;
.leaflet-tile,&#13;
.leaflet-marker-icon,&#13;
.leaflet-marker-shadow,&#13;
.leaflet-tile-container,&#13;
.leaflet-pane &gt; svg,&#13;
.leaflet-pane &gt; canvas,&#13;
.leaflet-zoom-box,&#13;
.leaflet-image-layer,&#13;
.leaflet-layer {&#13;
	position: absolute;&#13;
	left: 0;&#13;
	top: 0;&#13;
	}&#13;
.leaflet-container {&#13;
	overflow: hidden;&#13;
	}&#13;
.leaflet-tile,&#13;
.leaflet-marker-icon,&#13;
.leaflet-marker-shadow {&#13;
	-webkit-user-select: none;&#13;
	   -moz-user-select: none;&#13;
	        user-select: none;&#13;
	  -webkit-user-drag: none;&#13;
	}&#13;
/* Safari renders non-retina tile on retina better with this, but Chrome is worse */&#13;
.leaflet-safari .leaflet-tile {&#13;
	image-rendering: -webkit-optimize-contrast;&#13;
	}&#13;
/* hack that prevents hw layers "stretching" when loading new tiles */&#13;
.leaflet-safari .leaflet-tile-container {&#13;
	width: 1600px;&#13;
	height: 1600px;&#13;
	-webkit-transform-origin: 0 0;&#13;
	}&#13;
.leaflet-marker-icon,&#13;
.leaflet-marker-shadow {&#13;
	display: block;&#13;
	}&#13;
/* .leaflet-container svg: reset svg max-width decleration shipped in Joomla! (joomla.org) 3.x */&#13;
/* .leaflet-container img: map is broken in FF if you have max-width: 100% on tiles */&#13;
.leaflet-container .leaflet-overlay-pane svg,&#13;
.leaflet-container .leaflet-marker-pane img,&#13;
.leaflet-container .leaflet-shadow-pane img,&#13;
.leaflet-container .leaflet-tile-pane img,&#13;
.leaflet-container img.leaflet-image-layer {&#13;
	max-width: none !important;&#13;
	}&#13;
&#13;
.leaflet-container.leaflet-touch-zoom {&#13;
	-ms-touch-action: pan-x pan-y;&#13;
	touch-action: pan-x pan-y;&#13;
	}&#13;
.leaflet-container.leaflet-touch-drag {&#13;
	-ms-touch-action: pinch-zoom;&#13;
	}&#13;
.leaflet-container.leaflet-touch-drag.leaflet-touch-zoom {&#13;
	-ms-touch-action: none;&#13;
	touch-action: none;&#13;
}&#13;
.leaflet-tile {&#13;
	filter: inherit;&#13;
	visibility: hidden;&#13;
	}&#13;
.leaflet-tile-loaded {&#13;
	visibility: inherit;&#13;
	}&#13;
.leaflet-zoom-box {&#13;
	width: 0;&#13;
	height: 0;&#13;
	-moz-box-sizing: border-box;&#13;
	     box-sizing: border-box;&#13;
	z-index: 800;&#13;
	}&#13;
/* workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=888319 */&#13;
.leaflet-overlay-pane svg {&#13;
	-moz-user-select: none;&#13;
	}&#13;
&#13;
.leaflet-pane         { z-index: 400; }&#13;
&#13;
.leaflet-tile-pane    { z-index: 200; }&#13;
.leaflet-overlay-pane { z-index: 400; }&#13;
.leaflet-shadow-pane  { z-index: 500; }&#13;
.leaflet-marker-pane  { z-index: 600; }&#13;
.leaflet-tooltip-pane   { z-index: 650; }&#13;
.leaflet-popup-pane   { z-index: 700; }&#13;
&#13;
.leaflet-map-pane canvas { z-index: 100; }&#13;
.leaflet-map-pane svg    { z-index: 200; }&#13;
&#13;
.leaflet-vml-shape {&#13;
	width: 1px;&#13;
	height: 1px;&#13;
	}&#13;
.lvml {&#13;
	behavior: url(#default#VML);&#13;
	display: inline-block;&#13;
	position: absolute;&#13;
	}&#13;
&#13;
&#13;
/* control positioning */&#13;
&#13;
.leaflet-control {&#13;
	position: relative;&#13;
	z-index: 800;&#13;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */&#13;
	pointer-events: auto;&#13;
	}&#13;
.leaflet-top,&#13;
.leaflet-bottom {&#13;
	position: absolute;&#13;
	z-index: 1000;&#13;
	pointer-events: none;&#13;
	}&#13;
.leaflet-top {&#13;
	top: 0;&#13;
	}&#13;
.leaflet-right {&#13;
	right: 0;&#13;
	}&#13;
.leaflet-bottom {&#13;
	bottom: 0;&#13;
	}&#13;
.leaflet-left {&#13;
	left: 0;&#13;
	}&#13;
.leaflet-control {&#13;
	float: left;&#13;
	clear: both;&#13;
	}&#13;
.leaflet-right .leaflet-control {&#13;
	float: right;&#13;
	}&#13;
.leaflet-top .leaflet-control {&#13;
	margin-top: 10px;&#13;
	}&#13;
.leaflet-bottom .leaflet-control {&#13;
	margin-bottom: 10px;&#13;
	}&#13;
.leaflet-left .leaflet-control {&#13;
	margin-left: 10px;&#13;
	}&#13;
.leaflet-right .leaflet-control {&#13;
	margin-right: 10px;&#13;
	}&#13;
&#13;
&#13;
/* zoom and fade animations */&#13;
&#13;
.leaflet-fade-anim .leaflet-tile {&#13;
	will-change: opacity;&#13;
	}&#13;
.leaflet-fade-anim .leaflet-popup {&#13;
	opacity: 0;&#13;
	-webkit-transition: opacity 0.2s linear;&#13;
	   -moz-transition: opacity 0.2s linear;&#13;
	     -o-transition: opacity 0.2s linear;&#13;
	        transition: opacity 0.2s linear;&#13;
	}&#13;
.leaflet-fade-anim .leaflet-map-pane .leaflet-popup {&#13;
	opacity: 1;&#13;
	}&#13;
.leaflet-zoom-animated {&#13;
	-webkit-transform-origin: 0 0;&#13;
	    -ms-transform-origin: 0 0;&#13;
	        transform-origin: 0 0;&#13;
	}&#13;
.leaflet-zoom-anim .leaflet-zoom-animated {&#13;
	will-change: transform;&#13;
	}&#13;
.leaflet-zoom-anim .leaflet-zoom-animated {&#13;
	-webkit-transition: -webkit-transform 0.25s cubic-bezier(0,0,0.25,1);&#13;
	   -moz-transition:    -moz-transform 0.25s cubic-bezier(0,0,0.25,1);&#13;
	     -o-transition:      -o-transform 0.25s cubic-bezier(0,0,0.25,1);&#13;
	        transition:         transform 0.25s cubic-bezier(0,0,0.25,1);&#13;
	}&#13;
.leaflet-zoom-anim .leaflet-tile,&#13;
.leaflet-pan-anim .leaflet-tile {&#13;
	-webkit-transition: none;&#13;
	   -moz-transition: none;&#13;
	     -o-transition: none;&#13;
	        transition: none;&#13;
	}&#13;
&#13;
.leaflet-zoom-anim .leaflet-zoom-hide {&#13;
	visibility: hidden;&#13;
	}&#13;
&#13;
&#13;
/* cursors */&#13;
&#13;
.leaflet-interactive {&#13;
	cursor: pointer;&#13;
	}&#13;
.leaflet-grab {&#13;
	cursor: -webkit-grab;&#13;
	cursor:    -moz-grab;&#13;
	}&#13;
.leaflet-crosshair,&#13;
.leaflet-crosshair .leaflet-interactive {&#13;
	cursor: crosshair;&#13;
	}&#13;
.leaflet-popup-pane,&#13;
.leaflet-control {&#13;
	cursor: auto;&#13;
	}&#13;
.leaflet-dragging .leaflet-grab,&#13;
.leaflet-dragging .leaflet-grab .leaflet-interactive,&#13;
.leaflet-dragging .leaflet-marker-draggable {&#13;
	cursor: move;&#13;
	cursor: -webkit-grabbing;&#13;
	cursor:    -moz-grabbing;&#13;
	}&#13;
&#13;
/* marker &amp; overlays interactivity */&#13;
.leaflet-marker-icon,&#13;
.leaflet-marker-shadow,&#13;
.leaflet-image-layer,&#13;
.leaflet-pane &gt; svg path,&#13;
.leaflet-tile-container {&#13;
	pointer-events: none;&#13;
	}&#13;
&#13;
.leaflet-marker-icon.leaflet-interactive,&#13;
.leaflet-image-layer.leaflet-interactive,&#13;
.leaflet-pane &gt; svg path.leaflet-interactive {&#13;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */&#13;
	pointer-events: auto;&#13;
	}&#13;
&#13;
/* visual tweaks */&#13;
&#13;
.leaflet-container {&#13;
	background: #ddd;&#13;
	outline: 0;&#13;
	}&#13;
.leaflet-container a {&#13;
	color: #0078A8;&#13;
	}&#13;
.leaflet-container a.leaflet-active {&#13;
	outline: 2px solid orange;&#13;
	}&#13;
.leaflet-zoom-box {&#13;
	border: 2px dotted #38f;&#13;
	background: rgba(255,255,255,0.5);&#13;
	}&#13;
&#13;
&#13;
/* general typography */&#13;
.leaflet-container {&#13;
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;&#13;
	}&#13;
&#13;
&#13;
/* general toolbar styles */&#13;
&#13;
.leaflet-bar {&#13;
	box-shadow: 0 1px 5px rgba(0,0,0,0.65);&#13;
	border-radius: 4px;&#13;
	}&#13;
.leaflet-bar a,&#13;
.leaflet-bar a:hover {&#13;
	background-color: #fff;&#13;
	border-bottom: 1px solid #ccc;&#13;
	width: 26px;&#13;
	height: 26px;&#13;
	line-height: 26px;&#13;
	display: block;&#13;
	text-align: center;&#13;
	text-decoration: none;&#13;
	color: black;&#13;
	}&#13;
.leaflet-bar a,&#13;
.leaflet-control-layers-toggle {&#13;
	background-position: 50% 50%;&#13;
	background-repeat: no-repeat;&#13;
	display: block;&#13;
	}&#13;
.leaflet-bar a:hover {&#13;
	background-color: #f4f4f4;&#13;
	}&#13;
.leaflet-bar a:first-child {&#13;
	border-top-left-radius: 4px;&#13;
	border-top-right-radius: 4px;&#13;
	}&#13;
.leaflet-bar a:last-child {&#13;
	border-bottom-left-radius: 4px;&#13;
	border-bottom-right-radius: 4px;&#13;
	border-bottom: none;&#13;
	}&#13;
.leaflet-bar a.leaflet-disabled {&#13;
	cursor: default;&#13;
	background-color: #f4f4f4;&#13;
	color: #bbb;&#13;
	}&#13;
&#13;
.leaflet-touch .leaflet-bar a {&#13;
	width: 30px;&#13;
	height: 30px;&#13;
	line-height: 30px;&#13;
	}&#13;
&#13;
&#13;
/* zoom control */&#13;
&#13;
.leaflet-control-zoom-in,&#13;
.leaflet-control-zoom-out {&#13;
	font: bold 18px 'Lucida Console', Monaco, monospace;&#13;
	text-indent: 1px;&#13;
	}&#13;
.leaflet-control-zoom-out {&#13;
	font-size: 20px;&#13;
	}&#13;
&#13;
.leaflet-touch .leaflet-control-zoom-in {&#13;
	font-size: 22px;&#13;
	}&#13;
.leaflet-touch .leaflet-control-zoom-out {&#13;
	font-size: 24px;&#13;
	}&#13;
&#13;
&#13;
/* layers control */&#13;
&#13;
.leaflet-control-layers {&#13;
	box-shadow: 0 1px 5px rgba(0,0,0,0.4);&#13;
	background: #fff;&#13;
	border-radius: 5px;&#13;
	}&#13;
.leaflet-control-layers-toggle {&#13;
	background-image: url(/layers.png);&#13;
	width: 36px;&#13;
	height: 36px;&#13;
	}&#13;
.leaflet-retina .leaflet-control-layers-toggle {&#13;
	background-image: url(/layers-2x.png);&#13;
	background-size: 26px 26px;&#13;
	}&#13;
.leaflet-touch .leaflet-control-layers-toggle {&#13;
	width: 44px;&#13;
	height: 44px;&#13;
	}&#13;
.leaflet-control-layers .leaflet-control-layers-list,&#13;
.leaflet-control-layers-expanded .leaflet-control-layers-toggle {&#13;
	display: none;&#13;
	}&#13;
.leaflet-control-layers-expanded .leaflet-control-layers-list {&#13;
	display: block;&#13;
	position: relative;&#13;
	}&#13;
.leaflet-control-layers-expanded {&#13;
	padding: 6px 10px 6px 6px;&#13;
	color: #333;&#13;
	background: #fff;&#13;
	}&#13;
.leaflet-control-layers-scrollbar {&#13;
	overflow-y: scroll;&#13;
	padding-right: 5px;&#13;
	}&#13;
.leaflet-control-layers-selector {&#13;
	margin-top: 2px;&#13;
	position: relative;&#13;
	top: 1px;&#13;
	}&#13;
.leaflet-control-layers label {&#13;
	display: block;&#13;
	}&#13;
.leaflet-control-layers-separator {&#13;
	height: 0;&#13;
	border-top: 1px solid #ddd;&#13;
	margin: 5px -10px 5px -6px;&#13;
	}&#13;
&#13;
/* Default icon URLs */&#13;
.leaflet-default-icon-path {&#13;
	background-image: url(/marker-icon.png);&#13;
	}&#13;
&#13;
&#13;
/* attribution and scale controls */&#13;
&#13;
.leaflet-container .leaflet-control-attribution {&#13;
	background: #fff;&#13;
	background: rgba(255, 255, 255, 0.7);&#13;
	margin: 0;&#13;
	}&#13;
.leaflet-control-attribution,&#13;
.leaflet-control-scale-line {&#13;
	padding: 0 5px;&#13;
	color: #333;&#13;
	}&#13;
.leaflet-control-attribution a {&#13;
	text-decoration: none;&#13;
	}&#13;
.leaflet-control-attribution a:hover {&#13;
	text-decoration: underline;&#13;
	}&#13;
.leaflet-container .leaflet-control-attribution,&#13;
.leaflet-container .leaflet-control-scale {&#13;
	font-size: 11px;&#13;
	}&#13;
.leaflet-left .leaflet-control-scale {&#13;
	margin-left: 5px;&#13;
	}&#13;
.leaflet-bottom .leaflet-control-scale {&#13;
	margin-bottom: 5px;&#13;
	}&#13;
.leaflet-control-scale-line {&#13;
	border: 2px solid #777;&#13;
	border-top: none;&#13;
	line-height: 1.1;&#13;
	padding: 2px 5px 1px;&#13;
	font-size: 11px;&#13;
	white-space: nowrap;&#13;
	overflow: hidden;&#13;
	-moz-box-sizing: border-box;&#13;
	     box-sizing: border-box;&#13;
&#13;
	background: #fff;&#13;
	background: rgba(255, 255, 255, 0.5);&#13;
	}&#13;
.leaflet-control-scale-line:not(:first-child) {&#13;
	border-top: 2px solid #777;&#13;
	border-bottom: none;&#13;
	margin-top: -2px;&#13;
	}&#13;
.leaflet-control-scale-line:not(:first-child):not(:last-child) {&#13;
	border-bottom: 2px solid #777;&#13;
	}&#13;
&#13;
.leaflet-touch .leaflet-control-attribution,&#13;
.leaflet-touch .leaflet-control-layers,&#13;
.leaflet-touch .leaflet-bar {&#13;
	box-shadow: none;&#13;
	}&#13;
.leaflet-touch .leaflet-control-layers,&#13;
.leaflet-touch .leaflet-bar {&#13;
	border: 2px solid rgba(0,0,0,0.2);&#13;
	background-clip: padding-box;&#13;
	}&#13;
&#13;
&#13;
/* popup */&#13;
&#13;
.leaflet-popup {&#13;
	position: absolute;&#13;
	text-align: center;&#13;
	margin-bottom: 20px;&#13;
	}&#13;
.leaflet-popup-content-wrapper {&#13;
	padding: 1px;&#13;
	text-align: left;&#13;
	border-radius: 12px;&#13;
	}&#13;
.leaflet-popup-content {&#13;
	margin: 13px 19px;&#13;
	line-height: 1.4;&#13;
	}&#13;
.leaflet-popup-content p {&#13;
	margin: 18px 0;&#13;
	}&#13;
.leaflet-popup-tip-container {&#13;
	width: 40px;&#13;
	height: 20px;&#13;
	position: absolute;&#13;
	left: 50%;&#13;
	margin-left: -20px;&#13;
	overflow: hidden;&#13;
	pointer-events: none;&#13;
	}&#13;
.leaflet-popup-tip {&#13;
	width: 17px;&#13;
	height: 17px;&#13;
	padding: 1px;&#13;
&#13;
	margin: -10px auto 0;&#13;
&#13;
	-webkit-transform: rotate(45deg);&#13;
	   -moz-transform: rotate(45deg);&#13;
	    -ms-transform: rotate(45deg);&#13;
	     -o-transform: rotate(45deg);&#13;
	        transform: rotate(45deg);&#13;
	}&#13;
.leaflet-popup-content-wrapper,&#13;
.leaflet-popup-tip {&#13;
	background: white;&#13;
	color: #333;&#13;
	box-shadow: 0 3px 14px rgba(0,0,0,0.4);&#13;
	}&#13;
.leaflet-container a.leaflet-popup-close-button {&#13;
	position: absolute;&#13;
	top: 0;&#13;
	right: 0;&#13;
	padding: 4px 4px 0 0;&#13;
	border: none;&#13;
	text-align: center;&#13;
	width: 18px;&#13;
	height: 14px;&#13;
	font: 16px/14px Tahoma, Verdana, sans-serif;&#13;
	color: #c3c3c3;&#13;
	text-decoration: none;&#13;
	font-weight: bold;&#13;
	background: transparent;&#13;
	}&#13;
.leaflet-container a.leaflet-popup-close-button:hover {&#13;
	color: #999;&#13;
	}&#13;
.leaflet-popup-scrolled {&#13;
	overflow: auto;&#13;
	border-bottom: 1px solid #ddd;&#13;
	border-top: 1px solid #ddd;&#13;
	}&#13;
&#13;
.leaflet-oldie .leaflet-popup-content-wrapper {&#13;
	zoom: 1;&#13;
	}&#13;
.leaflet-oldie .leaflet-popup-tip {&#13;
	width: 24px;&#13;
	margin: 0 auto;&#13;
&#13;
	-ms-filter: "progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)";&#13;
	filter: progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678);&#13;
	}&#13;
.leaflet-oldie .leaflet-popup-tip-container {&#13;
	margin-top: -1px;&#13;
	}&#13;
&#13;
.leaflet-oldie .leaflet-control-zoom,&#13;
.leaflet-oldie .leaflet-control-layers,&#13;
.leaflet-oldie .leaflet-popup-content-wrapper,&#13;
.leaflet-oldie .leaflet-popup-tip {&#13;
	border: 1px solid #999;&#13;
	}&#13;
&#13;
&#13;
/* div icon */&#13;
&#13;
.leaflet-div-icon {&#13;
	background: #fff;&#13;
	border: 1px solid #666;&#13;
	}&#13;
&#13;
&#13;
/* Tooltip */&#13;
/* Base styles for the element that has a tooltip */&#13;
.leaflet-tooltip {&#13;
	position: absolute;&#13;
	padding: 6px;&#13;
	background-color: #fff;&#13;
	border: 1px solid #fff;&#13;
	border-radius: 3px;&#13;
	color: #222;&#13;
	white-space: nowrap;&#13;
	-webkit-user-select: none;&#13;
	-moz-user-select: none;&#13;
	-ms-user-select: none;&#13;
	user-select: none;&#13;
	pointer-events: none;&#13;
	box-shadow: 0 1px 3px rgba(0,0,0,0.4);&#13;
	}&#13;
.leaflet-tooltip.leaflet-clickable {&#13;
	cursor: pointer;&#13;
	pointer-events: auto;&#13;
	}&#13;
.leaflet-tooltip-top:before,&#13;
.leaflet-tooltip-bottom:before,&#13;
.leaflet-tooltip-left:before,&#13;
.leaflet-tooltip-right:before {&#13;
	position: absolute;&#13;
	pointer-events: none;&#13;
	border: 6px solid transparent;&#13;
	background: transparent;&#13;
	content: "";&#13;
	}&#13;
&#13;
/* Directions */&#13;
&#13;
.leaflet-tooltip-bottom {&#13;
	margin-top: 6px;&#13;
}&#13;
.leaflet-tooltip-top {&#13;
	margin-top: -6px;&#13;
}&#13;
.leaflet-tooltip-bottom:before,&#13;
.leaflet-tooltip-top:before {&#13;
	left: 50%;&#13;
	margin-left: -6px;&#13;
	}&#13;
.leaflet-tooltip-top:before {&#13;
	bottom: 0;&#13;
	margin-bottom: -12px;&#13;
	border-top-color: #fff;&#13;
	}&#13;
.leaflet-tooltip-bottom:before {&#13;
	top: 0;&#13;
	margin-top: -12px;&#13;
	margin-left: -6px;&#13;
	border-bottom-color: #fff;&#13;
	}&#13;
.leaflet-tooltip-left {&#13;
	margin-left: -6px;&#13;
}&#13;
.leaflet-tooltip-right {&#13;
	margin-left: 6px;&#13;
}&#13;
.leaflet-tooltip-left:before,&#13;
.leaflet-tooltip-right:before {&#13;
	top: 50%;&#13;
	margin-top: -6px;&#13;
	}&#13;
.leaflet-tooltip-left:before {&#13;
	right: 0;&#13;
	margin-right: -12px;&#13;
	border-left-color: #fff;&#13;
	}&#13;
.leaflet-tooltip-right:before {&#13;
	left: 0;&#13;
	margin-left: -12px;&#13;
	border-right-color: #fff;&#13;
	}&#13;
</css><name>leaflet style bank</name><sys_class_name>sp_css</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 17:05:03</sys_created_on><sys_id>a9256d3fdb55f7409eb1d311ce961935</sys_id><sys_mod_count>2</sys_mod_count><sys_name>leaflet style bank</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_css_a9256d3fdb55f7409eb1d311ce961935</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-22 16:01:28</sys_updated_on></sp_css></record_update>]]></payload>
<payload_hash>203820809</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6f95faeedb48c410993fdc965e961912</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d92210000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>leaflet style bank</target_name>
<type>Style Sheet</type>
<update_domain>global</update_domain>
<update_guid>d50c8fef2cd3f700af4915346fe32792</update_guid>
<update_guid_history>d50c8fef2cd3f700af4915346fe32792:203820809,0fcb4feffed3f700929dea91964fab64:-2141420027,df252d3f5755f740cedd61d76bf3e245:203820809</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_widget_4a7a40abdb5d77409eb1d311ce9619e6</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sp_widget"&gt;&lt;sp_widget action="INSERT_OR_UPDATE"&gt;&lt;category&gt;custom&lt;/category&gt;&lt;client_script&gt;&lt;![CDATA[function MapPageController($scope, $rootScope, $window,$location, $anchorScroll, $timeout, leafletData, $q, spModal, $http) {
	/* widget controller */
	var c = this;
	$scope.firstFlip = true;
	$location.hash('ff');
	c.siteName = "";



	c.awesomeMarkerIconCurrentLocation = {
		type: 'awesomeMarker',
		icon: 'user',
		markerColor: 'green',
		prefix: 'fa',
		iconColor: '#fff'
	};
	c.awesomeMarkerIconSite = {
		type: 'awesomeMarker',
		icon: 'building',
		markerColor: 'blue',
		prefix: 'fa',
		iconColor: '#fff'
	};

	//Center of the USA
	c.centerLocation = {
		lat: parseFloat(c.options.center_latitude),
		lng: parseFloat(c.options.center_longitude),
		zoom: 12,
		icon: c.awesomeMarkerIconCurrentLocation
	}
	c.startLocation = {
		lat: parseFloat(c.options.center_latitude),
		lng: parseFloat(c.options.center_longitude),
		zoom: 12,
		icon: c.awesomeMarkerIconCurrentLocation
	}
	function getDeviceLocation() {
		var defer = $q.defer();

		if(navigator.geolocation &amp;&amp; c.liveApp) {
			navigator.geolocation.getCurrentPosition(function(location) {
				c.centerLocation.lat = location.coords.latitude;
				c.centerLocation.lng = location.coords.longitude;
				c.startLocation.lat = location.coords.latitude;
				c.startLocation.lng = location.coords.longitude;
				if(location.coords.accuracy &gt; 14){
					c.centerLocation.zoom = Math.round(location.coords.accuracy*0.25);			
					c.startLocation.zoom = Math.round(location.coords.accuracy*0.25);
				}
				defer.resolve();
			});
		}else{
			//Default to New York
			c.centerLocation = {
				lat: parseFloat(c.options.center_latitude),
				lng: parseFloat(c.options.center_longitude),
				zoom: 12,
				icon: c.awesomeMarkerIconCurrentLocation
			};
			angular.copy(c.centerLocation,c.startLocation);
			defer.resolve();
		}
		return defer.promise;
	}

	c.mapbox = {
		mapbox_layer: {
			name: 'Mapbox',
			
			url: 'https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/256/{z}/{x}/{y}?access_token={apikey}',
			type: 'xyz',
			options: {
				apikey: c.data.apiKey,
				mapid: 'testing'
			}
		}
	};
	

	c.$onInit = function() {
		$rootScope.$broadcast('refreshFooterUrl');

		c.loading = true;
		c.liveApp = false;
		c.masterMarkers = [];
		c.markers = [];	
		c.masterList = [];
		c.list = []
		c.searchObject = $location.search();

		c.tile = c.mapbox.mapbox_layer;	
		
		getDeviceLocation().then(function(){
			$timeout(function() {
				demoMarkers();
				c.loading = false;	
			}, 3000);
		});
	};
	
	$scope.$watch("c.loading", function(value) {
		if (value === false) {
			leafletData.getMap().then(function(map) {
				$timeout(function() {
					map.invalidateSize();
				}, 300);
			});
		}
	});

	function demoMarkers(){
		var list = [];
		for(var j = 0; j &lt; c.data.list.length; j++){
			list[j] = {
				name: c.data.list[j].name,
				address: c.data.list[j].street +' ' + c.data.list[j].city +', '+ c.data.list[j].state +' '+ c.data.list[j].zip,
				types: c.data.list[j].types,
				lat: c.data.list[j].lat,
				lng: c.data.list[j].lng,
				sysId: c.data.list[j].sysId,
				attachmentSysId: c.data.list[j].attachmentSysId
			};

		}
		var markers = [];
		for(var i = 0; i &lt; c.data.sites.length; i++){
			
			markers[i] = {
				name: '',
				icon: c.awesomeMarkerIconBank,
				message : '',
				image : '',
				title: c.data.sites[i].name,
				lat: parseFloat(c.data.sites[i].lat),
				lng: parseFloat(c.data.sites[i].lng),
				getMessageScope: function(){ return $scope; }
			};
			var msg = [];
			msg.push('&lt;div class="flex-it"&gt;');
			if(c.data.sites[i].types.indexOf('site')&gt;-1){
				markers[i].icon = c.awesomeMarkerIconSite;
				markers[i].type = 'site';
				markers[i].address = c.data.sites[i].street +' ' + c.data.sites[i].city +', '+ c.data.sites[i].state +' '+ c.data.sites[i].zip;
				markers[i].title = markers[i].address;

				msg.push('&lt;div&gt;&lt;div class="info-title"&gt; '+ c.data.sites[i].name +'&lt;/div&gt;');
				msg.push('&lt;div class="info"&gt;'+ c.data.sites[i].street +'&lt;/div&gt;');
				msg.push('&lt;div class="info"&gt;'+ c.data.sites[i].city +', '+ c.data.sites[i].state +' '+ c.data.sites[i].zip +'&lt;/div&gt;');
				msg.push('&lt;div class="information" ng-click="information('+ "'" + c.data.sites[i].sysId + "'" + "," + "'" + c.data.sites[i].attachmentSysId + "'" + ')"&gt;Site Information&lt;/div&gt;');
				msg.push("&lt;a target='_blank' class='redirect' href=https://www.google.com/maps/dir/?api=1&amp;destination=" + c.data.sites[i].lat +"," + c.data.sites[i].lng + ")&gt;Google Maps Directions&lt;/div&gt;");
			

			}
			msg.push('&lt;/div&gt;');
			markers[i].message = msg.join('');
		}
		
		markers[c.data.sites.length] = {
				name: '',
				icon: c.startLocation.icon,
				message : 'You are Here!',
				image : '',
				lat: c.startLocation.lat,
				lng: c.startLocation.lng
			};
		angular.copy(markers, c.markers);
		angular.copy(list, c.list);
		angular.copy(c.markers, c.masterMarkers);
		angular.copy(c.list, c.masterList);
	}

	$scope.clearSearch = function(){
		c.search = false;
		angular.copy(c.masterList,c.list);
	}

	
	$scope.$on('leafletDirectiveMarker.click', function(e, args) {
		var marker = args.leafletObject.getLatLng();
		c.centerLocation.lat = marker.lat + 0.002;
		c.centerLocation.lng = marker.lng;
	});
	$scope.search = function (val) {

		return $http.get('/api/now/table/cmn_location?sysparm_query=name!%3DNULL%5EnameLIKE' + val + '&amp;sysparm_limit=10',{
			headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json',
				'X-UserToken': $window.g_ck
			}
		}).then(function (response) {
			return response.data.result
		});
	};
	$scope.changeLocation = function(item){
		var defer = $q.defer();
		c.centerLocation = {
			lat: parseFloat(item.lat),
			lng: parseFloat(item.lng),
			zoom: 16
		};
		angular.copy(c.centerLocation,c.startLocation);
		defer.resolve();
		return defer.promise;
	}
	$scope.sitePicked = function (item){
		var defer = $q.defer();
		c.search = true;
		c.server.get({
			sysId: item.sys_id
		}).then(function(r){

			c.latitude = r.data.locationLatitude;
			c.longitude = r.data.locationLongitude;
			c.centerLocation = {
				lat: c.latitude,
				lng: c.longitude,
				zoom: 16
			};
			angular.copy(c.centerLocation,c.startLocation);
			defer.resolve();
			c.list = []
			c.list[0] = {
				name: r.data.list[0].name,
				address: r.data.list[0].street + ' ' + r.data.list[0].city +', '+ r.data.list[0].state +' '+ r.data.list[0].zip,
				types: r.data.list[0].types,
				lat: r.data.list[0].lat,
				lng: r.data.list[0].lng,
				sysId: r.data.list[0].sysId,
				attachmentSysId: r.data.list[0].attachmentSysId
			};
			
		
		return defer.promise;
		});
	
	}
	$scope.information = function(sysId, attachmentSysId){

		spModal.open({
			widget:'site_information',
			widgetInput:{sysId:sysId, attachmentSysId:attachmentSysId},
			size:'md'
		})
	};
}]]&gt;&lt;/client_script&gt;&lt;controller_as&gt;c&lt;/controller_as&gt;&lt;css&gt;#mapid {
  height: 100vh;
  width: 100vw;
}
.drive, .information{
	color: #0645AD;
  display: table;
}
.information:hover{
	border-bottom: 1px solid #0645AD;
}
.map{
	margin-top:20px;
}
.main-search{
  float:left;
  width: 12vw;
}
.fa-arrow-left{
  margin-left:12vw;
}
.search-icon{
  height:34px;
  float:left;
  width:2vw;
	padding-top:0.5vw;
  padding-bottom:0.3vw;
	text-align:center;
  background-color: #ddd;
  font-size:18px;
   border-bottom: 1px solid #ddd;
    border-top: 1px solid #ddd;
    border-right: 1px solid #ddd;
}
.search-bar{
  margin-bottom:30px;
}

.fa-stack-1x {
  color: red;
}
.fa-exclamation-circle{
  color: red;
}
.sk-spinner-pulse {
  width: 60px;
  height: 60px;
  margin: 60px auto;
  background-color: $bam-darkblue;
  border-radius: 100%;
  -webkit-animation: sk-pulseScaleOut 1s infinite ease-in-out;
  animation: sk-pulseScaleOut 1s infinite ease-in-out;
}

@-webkit-keyframes sk-pulseScaleOut {
  0% {
    -webkit-transform: scale(0);
    transform: scale(0);
  }
  100% {
    -webkit-transform: scale(1);
    transform: scale(1);
    opacity: 0;
  }
}

@keyframes sk-pulseScaleOut {
  0% {
    -webkit-transform: scale(0);
    transform: scale(0);
  }
  100% {
    -webkit-transform: scale(1);
    transform: scale(1);
    opacity: 0;
  }
}

.flex-it {
  display: flex;
  //align-items: center;
  .image {
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-position: center;
    background-size: cover;
    position: relative;
    margin-right: 5px;
  }
  .info-title{
    color: $bam-blue;
    font-weight: 500;
    display: block;
  }
  .info{
    color: $bam-blue;
    font-weight: 400;
    display: block;
  }
}
.redirect{
    color: #0645AD;
    font-weight: 400;
    display: block;
 }
.type-icons {
  position: absolute;
  z-index: 1200;
  top:15px;
  right:15px;
  .each-type {
    margin: 0px;
    margin-top: 20px;
  }
  .exp {
    width: 34px;
    height: 34px;
    background-color: white;
    border-radius: 100%;
    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.54);
    border: 0;
    line-height: 80px;
    text-align: center;
    vertical-align: middle;
    display: flex;
    align-items: center;
    color: $bam-white;
    justify-content: center;
    .fa {
      color: $bam-blue;
      font-size: 16px;
    }
  }
}
.back-type-icons {
  position: absolute;
  z-index: 1200;
  top:15px;
  right:75px;
  .each-type {
    margin: 0px;
    margin-top: 20px;
  }
  .exp {
    width: 34px;
    height: 34px;
    background-color: white;
    border-radius: 100%;
    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.54);
    border: 0;
    line-height: 80px;
    text-align: center;
    vertical-align: middle;
    display: flex;
    align-items: center;
    color: $bam-white;
    justify-content: center;
    .fa {
      color: $bam-blue;
      font-size: 16px;
    }
  }
}
.map-icon {
  fill: $bam-white;
  stroke: $bam-blue;
  object-fit: contain;
  height: 20px;
  width: 20px;
}
.near-by {
  min-height: 100vh;
  background: $brand-secondary;
  margin-top: -10px;
  float:left;
  margin-left:10px;
}

.angular-leaflet-map {
  margin-top: 20px;
  height: 80vh;
  width: 80vw;
  .leaflet-popup-content p {
    margin: 5px 0px !important;
  }
}

.loading {
  color: $brand-primary;
  .loading-span {
    padding-left: 10px;
  }
}

.spinny {
  position: absolute;
  top: 50px;
  margin-left: auto;
  margin-right: auto;
  left: 0;
  right: 0;
  z-index: 12000;
}


.side-bar {
  margin-top:10px;
  float:left;
  width: 15vw;
  height: 80vh;
  overflow-y:scroll;
  background: $bam-white;
  color: $bam-dark-gray;
  .each-marker {
    background: $bam-white;
    padding: 10px;
    border-bottom: 1px solid #ddd;
    border-left: 1px solid #ddd;
    border-right: 1px solid #ddd;
    h3 {
      font-size: 20px;
      font-weight: 400;
    }
    h4 {
      font-size: 18px;
      font-weight: 300;
      margin-top: -4px;
    }
    a {
      font-size: 14px;
      color: %bam-blue;
    }
  }
}

/*******************leaflet overrides**********************/
.leaflet-bar {
  border: 0px solid transparent;
  margin-left: 14px;
}
.leaflet-bar a,
.leaflet-bar a:hover {
  background-color: $bam-white;
  width: 26px;
  height: 26px;
  line-height: 26px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: $bam-black;
  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.54);
  border: 0;
  z-index: 810;
}
.leaflet-bar a,
.leaflet-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.leaflet-bar a:hover {
  background-color: #f4f4f4;
}
.leaflet-bar a:first-child {
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
}
.leaflet-bar a:last-child {
  border-bottom-left-radius: 4px;
  border-bottom-right-radius: 4px;
  
}
.leaflet-bar a.leaflet-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

.leaflet-touch .leaflet-bar a {
  border-radius: 50%;
  background-color: $bam-white;
  color: $bam-blue;
  margin-top: 10px;
  margin-bottom: 10px;
  width: 34px;
  height: 34px;
}


/* zoom control */

.leaflet-control-zoom-in,
.leaflet-control-zoom-out {
  font-family : 'SFUIDisplay','SourceSansPro', Helvetica, Arial, sans-serif !important;
  font-size: 34px;
  font-weight: 200;
  text-indent: 0px;
  padding-top: 1px;
}
.leaflet-control-zoom-out {
  font-size: 36px;
  padding-top: 2px;
}

.leaflet-touch .leaflet-control-zoom-in {
  font-size: 34px;
}
.leaflet-touch .leaflet-control-zoom-out {
  font-size: 36px;
  padding-top: 2px;
}



/*******************flippy animations**********************/

flippy {
  float: left;
  -webkit-perspective: 600px;
  -moz-perspective: 600px;
  -ms-perspective: 600px;
  perspective: 600px;
}

flippy-front {
  position: absolute;
  z-index: 900;
  width: inherit;
  height: inherit;
  -webkit-transform: rotate3d(0, 0, 0, 0deg);
  -moz-transform: rotate3d(0, 0, 0, 0deg);
  -ms-transform: rotate3d(0, 0, 0, 0deg);
  transform: rotate3d(0, 0, 0, 0deg);
  -webkit-transform-style: preserve-3d;
  -moz-transform-style: preserve-3d;
  -ms-transform-style: preserve-3d;
  transform-style: preserve-3d;
  -webkit-backface-visibility: hidden;
  -moz-backface-visibility: hidden;
  -ms-backface-visibility: hidden;
  backface-visibility: hidden;
}

&lt;/css&gt;&lt;data_table&gt;sp_instance&lt;/data_table&gt;&lt;demo_data/&gt;&lt;description/&gt;&lt;docs/&gt;&lt;field_list/&gt;&lt;has_preview&gt;false&lt;/has_preview&gt;&lt;id&gt;service_portal_location_map&lt;/id&gt;&lt;internal&gt;false&lt;/internal&gt;&lt;link&gt;&lt;![CDATA[function link(scope, element, attrs, controller) {  }]]&gt;&lt;/link&gt;&lt;name&gt;Service Portal Location Map&lt;/name&gt;&lt;option_schema&gt;[{"name":"mapbox_apikey","default_value":"","section":"other","label":"Mapbox ApiKey","type":"string"},{"hint":"Latitude of where you want the map to be initially centered, Default is San Francisco","name":"center_latitude","section":"Data","default_value":"37.7749","label":"Center Latitude","type":"string"},{"hint":"Longitude of where you want the map to be initially centered, Default is San Francisco","name":"center_longitude","section":"Data","default_value":"-122.4194","label":"Center Longitude","type":"string"}]&lt;/option_schema&gt;&lt;public&gt;true&lt;/public&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[(function() {
	options.central_latitude = options.central_latitude || 37.7749;
	options.central_longitude = options.central_longitude || -122.4194;
	data.apiKey = options.mapbox_apikey;
	var currentUser = gs.getUserID();
	data.instanceURL = gs.getProperty('glide.servlet.uri');

	data.sites = [];
	data.list = [];
	var grSites = new GlideRecord('cmn_location');
	latLonQuery = 'latitudeISNOTEMPTY^longitudeISNOTEMPTY';
	grSites.addEncodedQuery(latLonQuery);
	grSites.query();


	while (grSites.next()) {

		attachmentSysId = ''
		var attachment = new GlideRecord('sys_attachment');
		attachment.addQuery('table_sys_id', grSites.sys_id);
		attachment.query()
		if(attachment.next()){
			attachmentSysId = attachment.sys_id.getDisplayValue();
		}
		data.sites.push({
			sysId: grSites.sys_id.getDisplayValue(),
			name: grSites.getDisplayValue(),
			street : grSites.street.getDisplayValue(),
			city : grSites.city.getDisplayValue(),
			state : grSites.state.getDisplayValue(),
			zip : grSites.zip.getDisplayValue(),
			lat : grSites.latitude.getDisplayValue(),
			lng : grSites.longitude.getDisplayValue(),
			attachmentSysId: attachmentSysId,
			types: 'site'
		});
		data.list.push({
			sysId: grSites.sys_id.getDisplayValue(),
			name: grSites.getDisplayValue(),
			street : grSites.street.getDisplayValue(),
			city : grSites.city.getDisplayValue(),
			state : grSites.state.getDisplayValue(),
			zip : grSites.zip.getDisplayValue(),
			lat : grSites.latitude.getDisplayValue(),
			lng : grSites.longitude.getDisplayValue(),
			attachmentSysId: attachmentSysId,
			types: 'site'
		});

	}
	if(input &amp;&amp; input.sysId){
		data.list = [];

		var sites = new GlideRecord('cmn_location');
		sites.get(input.sysId);
		
		data.locationLatitude = parseFloat(sites.latitude.getDisplayValue());
		data.locationLongitude = parseFloat(sites.longitude.getDisplayValue());
		var filteredAttachment = new GlideRecord('sys_attachment');
		filteredAttachment.addQuery('table_sys_id', grSites.sys_id);
		filteredAttachment.query()
		if(filteredAttachment.next()){
			attachmentSysId = filteredAttachment.sys_id.getDisplayValue();
		}
		data.list.push({
			sysId: sites.sys_id.getDisplayValue(),
			name: sites.getDisplayValue(),
			location: sites.getDisplayValue(),
			street : sites.street.getDisplayValue(),
			city : sites.city.getDisplayValue(),
			state : sites.state.getDisplayValue(),
			zip : sites.zip.getDisplayValue(),
			lat : sites.latitude.getDisplayValue(),
			lng : sites.longitude.getDisplayValue(),
			attachmentSysId: attachmentSysId,
			types: 'site'
		});

	}

	
})();]]&gt;&lt;/script&gt;&lt;servicenow&gt;false&lt;/servicenow&gt;&lt;sys_class_name&gt;sp_widget&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-05-14 15:50:16&lt;/sys_created_on&gt;&lt;sys_id&gt;4a7a40abdb5d77409eb1d311ce9619e6&lt;/sys_id&gt;&lt;sys_mod_count&gt;461&lt;/sys_mod_count&gt;&lt;sys_name&gt;Service Portal Location Map&lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sp_widget_4a7a40abdb5d77409eb1d311ce9619e6&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-09-25 18:28:42&lt;/sys_updated_on&gt;&lt;template&gt;&lt;![CDATA[&lt;div class="map"&gt;
  &lt;div class="side-bar"&gt;
    &lt;div class="search-bar"&gt;


      &lt;input autocomplete="off" ng-value="c.siteName" name='acct' id="picker" type="text" ng-model="accountSelected" uib-typeahead="item as item.name for item in search($viewValue)" typeahead-on-select="sitePicked($item)"  class="form-control ng-valid ng-dirty ng-valid-parse ng-touched main-search"/&gt;
      &lt;i class="fa fa-search search-icon" aria-hidden="true"&gt;&lt;/i&gt;
      &lt;i class="fa fa-arrow-left search-icon" aria-hidden="true" ng-click="clearSearch()" ng-if="c.search"&gt;&lt;/i&gt;
    &lt;/div&gt;
    
    &lt;div class="each-marker" ng-repeat="eachmarker in c.list" ng-if='eachmarker.name.length&gt;0'&gt;
      &lt;div target="_blank" ng-click="changeLocation(eachmarker)"&gt;  
        &lt;h3&gt;{{eachmarker.name}}&lt;/h3&gt;
        &lt;h4&gt;{{eachmarker.address}}&lt;/h4&gt;
       
      &lt;/div&gt;

			
      
 
			&lt;div class="information" ng-click="information(eachmarker.sysId, eachmarker.attachmentSysId)"&gt;
        Site Information
      &lt;/div&gt;
      &lt;a class="drive" target="_blank" href="https://www.google.com/maps/dir/?api=1&amp;destination={{eachmarker.lat}},{{eachmarker.lng}}"&gt;Google Maps Directions&lt;/a&gt;
      
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;svg xmlns="http://www.w3.org/2000/svg" style="display:none;"&gt;
    &lt;symbol id="icon-flippy" width="20" height="12" viewBox="0 0 20 12"&gt;
      &lt;g fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"&gt;
        &lt;path d="M1 1h18M1 6h18M1 11h18"/&gt;
      &lt;/g&gt;
    &lt;/symbol&gt;
  &lt;/svg&gt;
  &lt;div class="row near-by"&gt;
    &lt;flippy class="fancy" flip-duration="900" timing-function="ease-in-out"&gt;

      &lt;flippy-front id='ff'&gt;
        &lt;leaflet lf-center="c.centerLocation" markers="c.markers" tiles="c.tile" defaults="defaults"&gt;&lt;/leaflet&gt;
        &lt;div class="spinny" ng-show="c.loading"&gt;
          &lt;div class="sk-spinner sk-spinner-pulse"&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/flippy-front&gt;
      
    &lt;/flippy&gt;

  &lt;/div&gt;
&lt;/div&gt;]]&gt;&lt;/template&gt;&lt;/sp_widget&gt;&lt;/record_update&gt;</payload>
<payload_hash>1520653561</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6f95faeedb48c410993fdc965e961915</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d69aebd730000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Service Portal Location Map</target_name>
<type>Widget</type>
<update_domain>global</update_domain>
<update_guid>65c3766ecd48c410519230990eb3b385</update_guid>
<update_guid_history>65c3766ecd48c410519230990eb3b385:1520653561,88f1feaa7e48c4104dddac57bcab88a7:273035754,55d1feaa4948c4101f4510b445f74d91:1097258575,88b13eaa9848c4106c79f349027c2269:156612490,0a4eaea6f948c410d4d1fc91c225cbf3:1256464327,a84eaea6bc48c41034883a1d6870b783:1504688178,cb2e66a68c48c410198983c4f0156478:168367102,a8adae66eb48c410214e97629f8065ed:-1149466919,067dea665d48c410a9a9223a37eaad27:-1349219433,795de666cd48c4109dbf3b8c1999a88f:1366951106,7e1d62662a48c410ebd400bbcdbf6ed1:1117033816,a90d62669b48c410c12b738fac8dadea:1189343208,efdc6e267548c41096a77a08719e140c:2043795976,b10a2eaeb508c410c38da49e4d70daaa:-142017244,06a9a2aec508c410024034a0bcf950b8:462163758,57196e6ecb08c4108130cd311a05a31f:1443958205,c766eeaafc08c4104502d34432103932:-1630294136,14566aaaef08c410ce35c4dbf720aabc:-333939499,c7166aaa2208c4100dde6e92369469b3:-1983058992,d905e26a1508c41075a5e0a0e8379a32:-2091742201,d0d4626a3c08c410e39890e67e8339da:-1038213757,97b42e2a9a08c410d45e396e7cdde4f5:-1412865807,e36dde229908c41028376510776fe2ae:-807185776,e74dde226e08c4108ff72520ae8466a6:2027520976,330dda22f208c410c5f50e2864b98cc2:41836911,510dd6222808c4105df1779656452181:-893666731,6bec1a22f808c410bb8043bcfcbe13d9:-450311626,9bcc96223108c410e48e560812ce0e1e:1538924370,117c1222d108c41078f4eee185c9db34:32079829,8d2c56ee05c4c410e3b28ba96a5d4749:-843236682,90f9566e86c4c41072352be00c260e65:-1060937575,b5e79eaab1c4c410df0aba2e651313be:1872182913,e9055e69132bf3001f0f9a431a03959a:-1147255256,65f416a9242bf300f1b45674e31cc048:-1514943620,7494de69232bf30019c53538b59ef322:657881660,139a8621ec2bf30055a6103e3d858b24:2091672578,a57a4221372bf3003201eca31e5c878b:1335235745,066a8221922bf3000202f3cd28ca608e:-628336681,ff4a8eedf5e7f300d055b55e355f201e:56343695,70a942ed53e7f300970401dca0e9f8d1:-1044883504,cd99c2ed82e7f3003720abee65114afe:-2046139400,a079cead66e7f300c3606863ff3b2a55:-1044883504,d15942ed3ce7f300f0a17b54039f3c14:-136061195,45298eadece7f300c95f6565a0e544b7:1462433437,baf8c6ad20e7f30075da28a2224ba210:-541462518,f34846ad95e7f300b39068500b312f87:-175710590,713846ad0ee7f3009104da01e41e2d11:1996698752,7af7426d32e7f30069553f4d341253a8:-1592578712,2be742ad52e7f300c6becd2ceaeb902a:-590462024,fad7426d21e7f30011a33f712a8be874:-780872881,95b6426dcce7f30010f5b08850b5d80b:-599722190,ea86462daae7f300a0040f2a0f30feb1:1801240346,7446822dd2e7f3007fe5e7e074eaf2ec:-996862505,a0f50ee9a0e7f3003b2475eb79d5f9b8:1103426300,3de5822db1e7f3008c945926f61173fd:448957244,f3c5422d6be7f300827467aacb1a8db9:1852650448,59b5422d60e7f3001031ec1243f11a28:-299065785,e795cee95be7f30062d0386f224e9c9b:206630352,64754ae9ebe7f300db902848d107787f:-427785444,ba650ae989e7f300282c51eca046d6b0:1506231226,d03586e98ce7f3008239b057e52a7fec:-2143935011,83058ea93ce7f300ccbb9ad23b1bec90:-1406556149,6aa14ee52ee7f3005fe57761fd9e5132:-1467188819,5da10ee5abe7f3005495f49f4b9276ca:-305677139,68918ae5e9e7f300cb6a49584fbcf23c:332315739,095106e5e7e7f300530b4781414723e8:2117310560,a61106e578e7f30059deb6f8aee2c04e:-650221653,04900ea557e7f300728987239f6de263:-573325213,b0808aa544e7f300fcfeb04ecc22dc77:-1122658856,d4708aa5cfe7f300bdd87a305d98ff19:-1569480616,9a6042a5d4e7f300a0f3b1891acd65f3:-1122658856,d810ce6586e7f300c495fef77f5f09e8:2147008495,5adf756556e7f300e46466aad3931c5f:1524817277,babf3965e8e7f300c42c10507ce1ebd6:-277314947,8a4f396585e7f300e3a631acc511632a:1122462717,913fb56536e7f300354ce4a24cb089b6:527316632,8d1f356505e7f300ad33a5cddeb88e7b:-718319156,14ce3d25d5e7f3001d5dd0d0564013e5:-1583566233,b5bef5256be7f300a3916bdc4b2866af:739304856,ad5ef52552e7f300db28ce2cdd138ea7:1748353049,540eb125f7e7f3008b7d198f6eec54d8:1403815895,35edbde137e7f300e15c947ccde534e4:262642427,a6dd31250ee7f300ad88e311f883ec41:-998488265,bfbd71e140e7f300635f7aba9f7f9087:-555616265,7b2d75e1bfe7f3006984304acc3b981c:-1881390351,1bac3da1c3e7f300e208e2d97e8276a6:559873963,a7968b554defb3002a70cd52c1914814:-1163394763,dea28b11cdefb3000f6405956875afcc:-842314763,2c2cb61db6afb300e5f8c36f53a67929:-1551080516,1d0cbe99b5afb300f03637fb76fb17db:798477049,18583e197dafb30094a21f994d72b083:-1551080516,e02d1e994febb300dac2376edd1d8f00:1189577725,f40d5699abebb3004af24571ebfa0e14:1137133781,75bc9699bbebb30044165c4dc1cc236d:585963334,70acde59feebb300899fddc34c78c551:543265559,0a2cda597febb3000af5f2d379f89499:-887235576,943b5259ffebb30087b1f407dab410f7:719058210,aefad21983ebb300bd9ece4461948dd8:-1490579720,1be856d508ebb300ff9897ff16995cfe:-538998830,618b8ed997abb3005fd4ea2dbf86ac1a:1722878186,148b4ed9b7abb30042707aeadac21fe7:-2002812739,0b1b0e1934abb30059919e43da2c8922:-380812529,b7caca1920abb300afd40c9a72a89bb9:1753445647,6cc74a199aabb30011804e9c37c96e42:-1515257297,e6b78619d7abb300dd6863bd4128b6ee:-1957578197,fda70a1983abb30004d47b66a84b7d90:-2018694932,8a97c61969abb30046d3877e584d9122:-1896461462,1687829540abb30039c62fa4dd32aa6e:-1018989723,82b4829591abb30055783919b4ea9f05:-1713111257,e4340655b4abb3002c4c95ed3d046b11:-1218581123,65f3c65517abb3000deca9238e752601:2103535353,45b3825582abb300d868a6cebf5e8e1a:447708156,ca93ce1541abb300979f48e894c87066:-2026689185,60938e15d8abb3005331146d2308230c:-1337072214,60438215bfabb300e8c254996bc84e61:447708156,d8724ed195abb300b9cec45342d35d48:-1030277674,785bd915bd2bb300e78d42451b24d214:-383529884,e53bd115fd2bb3002247be7f681821ac:180062425,8fca5115bc2bb300213d14c2bd7610a9:-462302737,ad695d91f32bb300305d64dc8d722d74:371830735,4a295d917b2bb3007242db32311f60be:1706268165,59199d91dc2bb300ad6a1a876e6ca98a:1308719854,b7f85d91d92bb30060d0d81cace55e95:-659283616,cc589191ab2bb3001de7ce58e20a3b30:-1184037247,e8489d51e92bb300f2fd237e4b336f73:691667006,b3089d51d42bb3001980b3b9289b206c:-809589899,53c7d551af2bb3003723558a598252f0:513237842,91c719513c2bb3006bb845ab4a1f7f1e:1599217112,f2b75951912bb300d8547e57fcdc0a5f:299576989,bda7d911332bb300370c397188ad79cb:-1443636059,6bd3519d5ce7b3005e6412225e1c758d:299576989,e2c3155df3e7b300657229a997812d36:-1067458043,26b3d15df5e7b30007220b8e8cb8e7ea:-216476940,3ac21d1d3ce7b30030cf5b6fe35ee37e:-983008056,2752551d81e7b300821b46dfecd1ca0e:-1003973277,f212591ddce7b3009a9af4662f2b3623:-831933042,7702191d04e7b300e69f7397b67594c6:1104361890,5ae1511dd0e7b3004248931c70aaea9d:-960774657,4fc1151d06e7b30047a98aaa6afd9f97:-831933042,ca81511dc6e7b30026a004c03a3f7894:-538777040,9471111deae7b30053f4a780f37f4144:-450314980,0b5115997ce7b300b3719bdc1f66a48a:1220016260,67838ddd5ca7b300c8dd5e45559fbe7e:743517521,a5638111c5e7b3009feea74ad1814871:670071264,8643011126e7b30017421c94680a208d:-1143256056,5f230d9d22a7b3002b644fb1d5dd9737:454492420,65238dddf6a7b300118dd34c686b6c74:1876511284,8191899defa7b30007c8d3362c1e3304:-1238641761,0d8f8dc57cab7300efb813cf1389735e:516128872,7e7f01096dab73006701015a73090b56:571579953,0afb89c187ab7300645db465bd821e4d:567240200,a2cb490588ab730039d9b95abf684a4b:-1109996214,0cab89c15eab730052e696d7f8ac20ca:710524060,c6aa89c1afab7300dd8d84d8df12c944:1833287515,157ac58192ab730013fdf8575ab6aba3:1292421714,662801419eab73004c1ee3324a1ee429:-1136213021,8df701414dab7300635ceb827faf8119:2102880789,2065c98d886b7300cea613663ef9b12f:128603620,56e4c18d286b7300a7dcd79daa2afcac:-919141563,a554018d9e6b73005eb6b0d70047dc59:-1023796472,7f14018d5f6b7300b53e63bf24aadf4a:-1409921068,15e2c90d3a6b7300282443f222cf162b:-1489096694,3bd2890dc66b7300ea3080e03d5f8ce0:805104089,2482c50d8a6b730094fe020a0ec60042:1214788451,bf72450d486b730004da23d01ffe4bee:244994805,0442450dad6b730027887a0780e19902:-1409921068,7712050d246b730049e78a7589073f18:-1947908460,f112810d2a6b7300e3bc4cc7be6c5c0f:-331083473,ec02810d636b73009393a033cc7e6b90:148187375,e1e1010dfb6b7300415f6492ab61eb00:339496885,b1b14dc92d6b73007b466196fd9d93ed:225706446,9f910dc9596b7300a90cfe91570d566b:-1506019720,f1810dc9966b73008a99dd8eac53a164:1893852249,0d7109c9cf6b730006c9b93b7ee553d2:2046301572,fd4109c9036b73000938efede6ba5ec9:-646698587,c2208d49576b7300afa518717a28d698:453727007,3faf3089d86b730058783316fda0593a:-30494028,cb6ffc49836b73001510d3676db659eb:-1843892643,785fbc49256b7300376c406f7a7ccd07:989098757,28fe7449226b73006a3b711484e2fc72:81981212,4dce7449026b73001498d9aeaf76076a:664425214,958e70490e6b730060455ecd217e1cae:-240957089,184e7809bb6b7300cac41a4dbaebfb93:-31271989,3cadf4c5a26b7300e7c7805edd59460a:-334121979,fb8d3cc5c16b7300ab78c654b95a6cec:2121281299,7c5db4c5436b7300723aeb20b5c60ee0:-1778041614,403db8c5256b73001fd5a010ca9bfc07:1983277683,6bfc34c5e36b7300d93d8c674d3511f2:-1632738447,54fc74c5516b7300dce348c371b16f2d:1792983112,50ec34c59b6b7300be5cdec4182689dd:314148786,15bcbc85966b7300b9b4db067c3fd624:-1014226503,f39c30c58b6b730031137b86cf752066:-1733090209,949cbc850e6b7300d89821fbba6ca394:-388069614,fc8cbc857b6b7300b13a634f515d5005:1203914454,086cb885e66b7300b3b7320358d91503:-54408295,163c7885e16b7300d4ee94d5744cbcb3:507771332,5a2c34859e6b730097663e39929e84ac:600643397,f3eb7c452f6b7300b6e55d011e447496:-1188341379,847b7c45686b730041d09917caaef06a:-1155378493,28558c0974a7730049a732354ca2ef26:319983521,2c350c09eba7730056a4068040c96bc6:-272724080,a5250c095aa7730045fc9bfcdf61ff8f:1202517070,5db3c8c59fa773004bc82b1c698bbd39:626046960,f69384c532a7730002f43f8ef16f7cad:1552607057,aa8308c5c7a77300550a1a09e00fb1b2:1367148817,75634085f9a77300886d3678eec1fee5:171567353,7d43c0c56aa773007f0f6468207642a7:-1700803006,c233c0c5a0a773000654446778a6f57d:-510742338,4932808561a77300225ff39d0662465d:1970361016,830240856ba77300e16b14a9d26728cf:546370658,80028c45cfa77300df4e80f381b1872f:1412628075,12c14c459aa77300e6a7100ea094ebc6:-356196422,c251444583a77300b14dcb598d75654c:-1087027199,2d41c045bea77300b8527dcc1486fe12:-8524158,3a21444504a773007fba6dc57f497344:1722061862,a5018c05e7a773008405c2aa8fca1ffa:1839098460,15c0cc05ffa77300261016c56ad1300f:-1701629354,55a04c0562a77300b845a194a905ee59:642532206,1d204c49e9677300e1a77b35661e4539:-444976173,2dffb3345fa773000347b8cf17e865e9:733814972,009037f4d0677300107ddeec3508ce2a:-1329661626,9740f3f48c6773005b41752afde56aba:-2124061205,3c407fb4e0677300a52f160a4b96d03f:-1259870046,9dce23b4a5677300d96cbbdd10b8541e:-554589008,bcbe2f744c677300935be323f0273606:337430589,9cae2f74dc6773005210c77d44fe0b34:2120259402,03dba7f0506773004300a9add7c17b71:-2146091553,9bcb67f03f67730009e7d12f6e0f3353:-467533429,f1bb27b01367730031adb5f5d69b7c57:-408700081,ee9aef70f1677300800dea2f3945c644:-1260936560,c0e46c371e9bf700c31b51c792a1ea1c:-874351987,58b4e837069bf700c5a8ebe20fe8ec5a:741062457,21942437a49bf700ec6a444a5eb62d84:591967101,f5a16873a49bf700e0768d8057d14623:2120363245,f5816473819bf7000fd1fcabeb0fa516:-665875071,041fd8bfc65bf7009f56f43e3436f3f5:-1658778000,40fe94bfc45bf700209e2a2131921328:1157931716,ee9c58fb5c5bf70050b79db38b0da9d7:-1658778000,f58b18bbd65bf7004c2b3fadcde436ef:50678125,0a968b6b2ed3f700201f4a213ecd06be:-1506265783,919b931bfdd3b70022f65a6d69545b35:139732963,cd69139791d3b700b6b0fa84fa92bb94:903297784,fc395f5727d3b7005601f4c105b5131d:2125548597,87581f1763d3b7005eb20dcb1068fd53:1962696349,c4481717aed3b7001bde33e4afb96e49:151709959,0338db17c2d3b700157e7ab2aa48aeb1:551560851,41f7d31792d3b700d88a908066f5b971:462430886,c76017d76193b700d85b0aba63dd3112:-1486812603,b3405b97be93b7009b2c1fca738c1bc1:1893643717,959f4f570193b7009e6144e9057ea3f4:-1486812603,d67e4f17e493b7004563e9c878493b57:-196419215,9afd07d36093b700a0afd977722591a7:996032675,e85d07d33693b700fd1fce7979b99bfb:1181869157,b44d07d3b993b70086cba3fa4a95a89c:1281187141,132d4b93e993b7005dbff2b0c3647b68:-43766887,959e8b530f5f7b80ae445482deb7188e:243678054,e68e83935f5f7b808f56426cbe02f057:1818860709,3c1cb587c1573b80ede0413ad5bc284b:2009813530,0dfb358787573b809afa3e862b6a3967:633322007,a2abfd4799573b8000341a8009bdc386:1400589539,768b3d47ae573b80da8cb6bbf95012d7:-1138536832,037bf54749573b8090c2795160fcb994:99614720,761b31477d573b80eef91efff8da79d5:-801538560,ba0b35474b573b802ca530843d247906:543183554,e4aaf90752573b808d8d8474079189e5:2051410248,bb8ab9072c573b804c6befdfd893391c:-1575596439,9f7a390708573b809eb7b9a3c0559a41:1125095328,ca6a750765573b80fd7ed686539a8322:169931077,180a7dc35c573b801448067912b46642:637227997,e9e93dc302573b80e816678d7694077f:-1919665431,f7c939c3e6573b80fa600fc39b234ffd:-334516251,ceb939c3e3573b80b481843f7338625f:-187259724,ba597d8367573b804d8eae0e752fe92b:-692983263,de28b943f0573b80f3a5ee060e86618b:-459236983,3af7f54360573b80657d8d4de2432ea1:262901114,e5d6f4ab298b3b40943970572edc0dab:-280724880,afa6786beb8b3b40b835019904c9e81c:1458433423,98c4b8e75b8b3b4027ee81619f545c21:-288575810,2a03b867978b3b4041907a3bca89fb61:-1684503426,13f1b827688b3b40570b4f24de578f18:2016834774,67817ca3408b3b40a444b3c00c738d36:-1119589684,63df2063f08b3b40dd41a2ea6354c016:-384508464,5ccfe823df8b3b40992bc41421ef8833:499340569,349fb868cd69bb40b8a68c15097f0a40:95481725,a62ffc283869bb4075d87ed50b3d35f8:-1660642807,8bc9f4207869bb408ae243f6b68e94ea:-1695995173,48b9b4209c69bb40e80635b783a65b2e:1918852681,9779b0208c69bb4044e13e67a2219ad4:1942352469,c969f8ec0029bb405f79aedd12a26321:-1381698357,1709bc6c6929bb406055b05c45111240:1942352469,da08342c6929bb40c49ece0a5626fdc2:-1083020289,1ee7342c9c29bb40c38530b0f7589594:-1899250729,745434285c29bb40117a6aaad8a8eca4:1992286975,f5243028ee29bb408cffdf6143a576c5:-265339242,7422b0a46729bb40899e48bfeb01a225:1237170615,e09e2c60f129bb4025a7fbe0344fc50e:-1677384604,e95ee4601729bb4008a2925d3af64186:-1423015185,f81ee4208f29bb40f5b3be97c20a9721:-1458621375,f4bd2820f229bb403d128544812ff993:-1735457467,a26d24205429bb40390893b252b2c508:226229138,144de0209029bb4072736eb3e0fefeff:750239376,02fcececd1e5bb408b4cd7103fad9eb8:-763179138,4ddca8ec5ee5bb40979b820cbfbc2271:1538311255,eefb68ac9ee5bb40cd4236042757fae7:705313484,81fb24ac18e5bb402f2764148f324931:2054087492,69fa606c14e5bb40d75c8168743b3357:1194047960,e8aa206cede5bb40a336a1afbf174ed5:1600725322,ee9ae82cf0e5bb408a7cbf356f35cb2a:2138755115,0a7928e89fe5bb400803f8c4aafd04fa:591748266,7759a4e8f9e5bb40e14b5b56f1795280:2022394623,3f29a0e835e5bb409b0d4342cf01a8c4:-1232665315,c038ec6837e5bb408035d86f62187163:1048894770,a2f7ac2847e5bb40d4bc2c6ef45cecbc:-17899658,f5b76068d7e5bb40a6e3988f4117b5b7:1296327028,7043ac247ee5bb40552bb5509e55de47:-1005703962,d3236c24b4e5bb403531d9c2ba6dc0dd:-547593610,11f2a0241be5bb40c26f9f13471e9d09:-1084046664,3de2a024e9e5bb40ef4286c8fb722c2f:-1612568709,4792ace060e5bb408d487f62f98139b6:-421436019,0b62ace0bbe5bb4003ff25fe750dc114:-1673471942,80626ce008e5bb403f4e64cf836604ad:-1348472304,0952aca043e5bb40c80c7d3c5517bcd0:136581882,6d422c60aae5bb40c3b7fcf9ee6495ef:-930105191,d542a0600ee5bb40a49b55eb4e863b95:591424052,5f1164ec14a5bb405b5ee943f9b6fa83:-1870968909,e8e0acacd0a5bb40ff96370e403b63d7:1301323090,14a0e8ac33a5bb40fe5c97277aa8a507:-547525859,317028ac5aa5bb402d66fed2dc3abb6f:-1076031183,1a6024acc5a5bb408ac38a3fe7f5ce20:-1588168288,27cf9c6cfaa5bb4011a5f7a902a6bea8:-717115976,211580604265bb40aff155454c6fe71e:2139792314,650f3398e325bb40212a24e0b0024014:1619828523,2cfeff585325bb40c4bea9f81df07618:1632449963,11deff58c225bb40795a377f32941511:1889168075,e09ebb586a25bb404f7827fa8886ed1d:-1920534965,5d3e37588525bb4058353d58176f0d5d:1619828523,942eff186425bb40db3f81ef33ae3d13:-1772584155,f5edff183a25bb40639d5d8951ee050a:1528311558,786d73185d25bb40de089f9dc73d29dc:142587966,26fcbfd45325bb405cbebabe0661e0bb:1954906161,f9dcbfd42725bb4018b5be1bb6d81d2d:-588896884,6bbc7f947125bb404a12767d6a0193fe:-737704445,60db37940625bb409398d75a0d3c754f:1232588448,967b33949725bb40658cbe581a5e8d57:1401276699,d73bff540025bb401cce635fb65c38d1:-56592005,121b7f54e425bb402fa0991db1050e18:2132808222,e18a73542d25bb40103f78b30ac1a155:-1608502458,2c6abb145a25bb40e99f5790a25f0f23:-676157047,7aa87b90e725bb40f412f9ba917f9213:1214144925,9b57b3504d25bb4083ce7242f7a862df:1359182691,474733504d25bb40f11ac0a573bacaa8:290228035,2937fb10b525bb40b690a40a655a6199:-1459634749,31f67b103625bb401d0e8917ad4e1e7f:-184520862,fbb6f7107f25bb40ceafc5d219612b33:-389075712,e39677100325bb40e05dd1655cbe8111:-272407002,d396b3107825bb408641e5edadff7e8f:-628818165,20867fdc00e1bb4023173aa9010c0fb7:-501443328,17367fdc75e1bb40b816d37b981fa14b:1559534967,c606f7dc29e1bb40f006a734ac1e400d:1355861045,bd05bb5cdce1bb4021e31f6138391e55:242177749,70b23bd849e1bb406fb4b04e43c636ba:-1595379310,8532ff9817e1bb409a336f2e0894e5f5:910513490,7af17b98a6e1bb40467125021984c342:-741898290,88513b1850e1bb40b0ae066f534370c2:-1680602134,56e03b18bee1bb409efea5216ba6d481:767897044,99d0b7184de1bb405ac942c8f10f6978:-1454630505,311f67949ee1bb40a6b454e00bc6f242:-90785993,c3be235493e1bb404d1822af341a79f5:-670771317,328e6f1498e1bb40102c5817526cd321:241743792,d85ee714bbe1bb40d8727c3eea6c0546:-93381596,fc2e271409e1bb40efb5fb5470b0a9b2:104484481,920ee3143ee1bb40589ec78852e7bcb3:759391954,62ed631409e1bb40d517d0709fbf9444:-1218556904,75cd6bd0afe1bb401d60c01a456db285:-1089634088,e0ad6bd0f5e1bb40a1269071e5f5f3b3:-378342595,aa8de7d080e1bb40d0efdd77f89b3fbc:-312363223,4f6de3d07de1bb40508a133b8f2dd7fd:1299433205,e13d23d0aee1bb40d53071d1731873ab:-1519644044,952d63d0fbe1bb40677b2c41c44359e0:-974045953,767ce390f8e1bb40f1f63ee28339a966:24411446,893c6f50dce1bb4033671e9725893654:2015349608,a43cab5007e1bb407a3bcf03ab91b356:-1622116472,33fbab5083e1bb40f3a15db9c31d74d3:-54061492,94ebab50cbe1bb40f02bf91616c7c84c:282708396,71ab63dcffa1bb4038dd82617d3ee137:-54061492,064b63dca8a1bb40a303cbed5b3fb429:-1731543776,ad3bef9c97a1bb408e5f4393401ae3e4:1933200522,ebeae79cdca1bb40c3d1e18239c48c40:207194434,36ba279cf6a1bb40df140a000bd52741:-353274918,7c9aef5c03a1bb403e349eccf0b164e3:-1973134,c87ae75c89a1bb400eb1de126ae26cbb:1078752745,d32a6b5cc9a1bb400ef2494323c2667a:393540442,c6c9ef1cffa1bb40134964f6c3f32011:-1865251497,4eb9235c7aa1bb40148c91ea4b89a782:-1092808361,87d867d881a1bb40ea9470f3f4544cc1:330084470,a47867d879a1bb4090ed528e885cde4a:1294124732,d58ffbc40aa17b40b79d909fbe77b5a2:-1821069936,362ff7c49da17b405db8abac98796484:-116762383,ba2dff041ba17b4093d49e3e6a0ce0b0:2144050941,3efcfb0476a17b409b3979718ba7e2d5:-64587218,29ecfb0450a17b40cc2bc0e93cb9079d:240453234,7cbb77c01ea17b4022db34829ab13c3d:-64587218,565bbf80fca17b40745a5341933d0349:-202254797,fd4b7f80f3a17b4094f69f50834002f5:-1564069835,103bbf8050a17b4088bbb900bff16a3b:621044564,4d2b3b8000a17b408dcc5946412c1fcf:-1868700140,3b0bf78098a17b404d157884f7f9ce0c:1783148468,ccdab78009a17b407ba2b0196ea527e0:1877307065,b0ca378049a17b4007a266de4d7a7c3c:-152817160,43aaf3801ca17b4035d02178a5c0bdae:-677135881,1caab74044a17b40a26e8029cad55add:-1408285289,eff7070447ad3b404c73424b253e166e:-1918821734,9071fa73ffd9f74060064e65649ce3f3:732118330,8d617e734dd9f7408928a345e2fbfef6:528354068,e3513e739bd9f74017520d589213efad:489168633,05513e73a6d9f740dab94f5cfd7d6e16:-640164710,17413e73cfd9f7405cc07ec9dd7a8fa4:1415909972,00417a735bd9f740321cea47da081d91:1517205974,dd213a731ad9f7403b761a3b7b2ea522:1375552279,0e11f6733bd9f740ab93e9a42f0ece94:-1136354412,a20136735dd9f7406bf253e31a1bb296:236825434,04d072739ad9f740acdf455c87e537fe:642341480,bca07e3333d9f740db0658d51bac83ad:-917965800,e6903e3314d9f740796099586d43c59d:-1772340126,a97ceefb6999f74026e6cfb0edc0c5e6:-917965800,50c5d6b35559f74046f09149e1a26597:-411363147,7ab5d6b3f359f7402af59e67f6451a3f:-1588161835,041e753b1dd5f740261d4723c27413e0:19841701,165db9f707d5f740a8f728b42393a940:-1375291611,b4dcfdb73ed5f740b0c332bb765b4cf9:359781428,39bcfdb777d5f740c458e8a8bb166743:-1997443289,96acf9b7ebd5f740366ca77d9547d9f5:-1033765355,3c9c3db75cd5f740a72a0f8ddc0707d6:-1997443289,c18cf9b7dfd5f74022432f95fb6d7feb:-1432892918,057cb9b737d5f7400d48c47ee5d46752:-1205651064,5b5cb5b775d5f7404aa122e7d78ce011:-1863635252,dd5cf5b72cd5f7405d4a70b2f8bce2a3:-827943337,6b3c35b7dfd5f7405cab859a795a9e6b:-1872909075,c61cf1b77bd5f740b80770b06ee1513a:-444257576,470c31b76cd5f740cb6e053ea9a6faee:1175558584,44fbbd778dd5f740196181623908ff88:1448791020,34ebfd778cd5f7403aa488699a1c134d:-226008992,28dbbd7744d5f740e197bbc7a4dad51f:729226048,8bbb3d7741d5f740bbd3a832061c39f4:1448791020,9fab7977e7d5f740d8a311893aff5357:1024452044,f69bb977b9d5f74096de8e775d1c1f3f:1703476812,bb8bb5779ad5f740c456996fd5d11131:1448791020,f48b397725d5f740eaba69a81c53ca1b:-552445300,4d7b7577f7d5f7402e87365603eb2f20:1448791020,b26b7577b0d5f740c4a47bba93372b96:-1639266420,716b75772fd5f740e0fa383a04c06169:1448791020,6b5bfd37ced5f740ea0a40394478d31a:437042956,ceba79376ed5f740a745e41b16439502:1448791020,c0ba39376ed5f740266f2b8942e3a7ad:1038074926,e7aa3937a1d5f740096a9e27301690a5:-1653181648,2ff9f9f358d5f740e2e32ef26917ff70:81586248,b7b9b5f3f1d5f7400d6e0ffdd8d75641:-1655626975,4e5971f3e2d5f74028db68f3ead1d23d:1173185220,046da5b75295f740b8cc9c5f073f323f:-1616491772,8e4de5778e95f740cf788e83909a3a27:-1414581423,854d21b7f395f74025d645b29a8152f8:1714127773,3b00ddf37115f7405002f4564ef8c9a9:-1764881731,5f0fcdb3b015f74037128b73dc64c97e:536617008,827a40ab395d7740c95eb9c3c8e33fe8:-488487739</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>DELETE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_ui_script_73f1dba71b17f70074f3db9cdc4bcb5c</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_ui_script"&gt;&lt;sys_ui_script action="DELETE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;description/&gt;&lt;global&gt;false&lt;/global&gt;&lt;name&gt;x_snc_sp_asset_map.Leaflet Geocoder&lt;/name&gt;&lt;script&gt;&lt;![CDATA[(function (factory) {
    if(typeof define === 'function' &amp;&amp; define.amd) {
    //AMD
        define(['leaflet'], factory);
    } else if(typeof module !== 'undefined') {
    // Node/CommonJS
        module.exports = factory(require('leaflet'));
    } else {
    // Browser globals
        if(typeof window.L === 'undefined')
            throw 'Leaflet must be loaded first';
        factory(window.L);
    }
})(function (L) {

L.Control.Search.include({
	options: {
		geocoder: 'google',
		markerLocation: true,
		autoType: false,
		autoCollapse: true,
		minLength: 2
	},
/*	onAdd: function (map) {
		L.Control.Search.prototype.onAdd.call(this, map);
		console.log('Geocoder',this.options)
	},*/
	geocoders: {
/*		'google': {
			url: "//maps.googleapis.com/maps/api/geocode/json?key={key}&amp;address={text}"
		},
		'nominatim': {
			    
	      format: 'json',
	      q: query,
	    });
    		"//nominatim.openstreetmap.org/search?"
		}*/
	}
});

});
]]&gt;&lt;/script&gt;&lt;script_name&gt;Leaflet Geocoder&lt;/script_name&gt;&lt;sys_class_name&gt;sys_ui_script&lt;/sys_class_name&gt;&lt;sys_created_by&gt;brian.nguyen&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-08-22 16:27:55&lt;/sys_created_on&gt;&lt;sys_id&gt;73f1dba71b17f70074f3db9cdc4bcb5c&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;x_snc_sp_asset_map.Leaflet Geocoder&lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_ui_script_73f1dba71b17f70074f3db9cdc4bcb5c&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;brian.nguyen&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-08-22 16:27:55&lt;/sys_updated_on&gt;&lt;ui_type&gt;10&lt;/ui_type&gt;&lt;use_scoped_format&gt;false&lt;/use_scoped_format&gt;&lt;/sys_ui_script&gt;&lt;/record_update&gt;</payload>
<payload_hash>1121739535</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>6f95faeedb48c410993fdc965e961918</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d922a0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>x_snc_sp_asset_map.Leaflet Geocoder</target_name>
<type>UI Script</type>
<update_domain>global</update_domain>
<update_guid>a6e3136b0117f70061899137009e3a54</update_guid>
<update_guid_history>a6e3136b0117f70061899137009e3a54:1121739535,e412dba71617f700dc716875780e5762:-470515813</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>db_image_448c64ecdbe5bb409eb1d311ce9619c2</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="db_image"><db_image action="INSERT_OR_UPDATE"><active>true</active><category/><format>png</format><height>41</height><image>d28ca4ecdbe5bb409eb1d311ce96191a</image><name>marker-icon.png</name><size_bytes>1466</size_bytes><sys_class_name>db_image</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:52:57</sys_created_on><sys_id>448c64ecdbe5bb409eb1d311ce9619c2</sys_id><sys_mod_count>4</sys_mod_count><sys_name>marker-icon.png</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>db_image_448c64ecdbe5bb409eb1d311ce9619c2</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 22:52:44</sys_updated_on><thumbnail/><width>25</width></db_image><sys_attachment action="INSERT_OR_UPDATE"><average_image_color>#2e85cb</average_image_color><chunk_size_bytes>734003</chunk_size_bytes><compressed>true</compressed><content_type>image/png</content_type><encryption_context/><file_name>image</file_name><image_height>41</image_height><image_width>25</image_width><size_bytes>1466</size_bytes><size_compressed>1489</size_compressed><state>available</state><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:02</sys_created_on><sys_id>d28ca4ecdbe5bb409eb1d311ce96191a</sys_id><sys_mod_count>3</sys_mod_count><sys_updated_by>guest</sys_updated_by><sys_updated_on>2019-08-21 22:52:18</sys_updated_on><table_name>ZZ_YYdb_image</table_name><table_sys_id>448c64ecdbe5bb409eb1d311ce9619c2</table_sys_id></sys_attachment><sys_attachment_doc action="INSERT_OR_UPDATE"><data>H4sIAAAAAAAAAA==</data><length>16</length><position>0</position><sys_attachment display_value="image" sys_id="d28ca4ecdbe5bb409eb1d311ce96191a">d28ca4ecdbe5bb409eb1d311ce96191a</sys_attachment><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:02</sys_created_on><sys_id>168ca4ecdbe5bb409eb1d311ce96191a</sys_id></sys_attachment_doc><sys_attachment_doc action="INSERT_OR_UPDATE"><data>AboFRfqJUE5HDQoaCgAAAA1JSERSAAAAGQAAACkIBgAAAMCTgs4AAAWBSURBVHgBrVcDkGNZFM3ahbXt3dhpm2vb3rYdTNsM2mOzNbbiZG3bynju/vOr9tdm2un+VadevffuPec8J7zk1zKmBIV26AKlbligMAxFogypGLpoqrkTdioNA7eoDCNVasPw1yr9EGnKR3yhlRv+Rom62jDyvVo/0gjRaYsosiwnK/XD+SrD0KHYxh0H77XY6fF579AzC9/j8OT8t+n+LifFNe06hDilbkCPvCmJyLUD16t0A3Y4frjHw5I/2PcW3dvtpaROD8Wb3WyJOtrR/2ifmxCv0g16MfoJRRSlq+MU2rUH45p2HGad9rxF8SY3xU0CxCE+oXnnEeQzPPeNKYKFZTp/v9dko0f736EEs4dijO4pA/HIw9QqStf8rS5ad8VokZLVA9G1mw4+2vc2xbS7KHo00I6RTdjP5tdtPcjwbfETkRcte0JdturAI73M9Bg9FNnm8gNcPtT7DusUMShRR/uJschHjLpstU9evPwlVkSqXXe2vHC57+4OK93d+RZFtLr8gDZsgPi6TRSkXU3youVsGVezgR7sctN9XWPngA+84OdJ85YGq0pW+OAsrMXlh0STl7BGQaUrSLfcSh999zsdPnqMPv/pT6ofcLHtIEs2e0flgg+84OfJ8hdlhFUM+qAe0uzkAEcPdjMu56ylvu3v0VjfgOMzCtWtxO7CVPnlgw+84GdGsnhVdN02di6Dm5wcsGMSm3fTvTUDdOz4cRrve7p1PcU1bB+Vjzp4wc+T5i76LqnNSlGtbtI0ODkkdHgpqmYzla/YTxN9xvUeiqocwdT65YMPvODnibPn/YFKeLOL1PUODhBBctOgY0KRvq1vU1T5ACUavX754AOvOGf+7xDZhmFBWVnn4IA62p9uGZpQJLV7M0VWbaKYNs+Y+eDnCbP6DCH6gcNx7R5S1Do4YMjJHS5SFSyg7e98OaaA57MfSZk3n3HswGL75YMvWD94SJTdq+WJ07rvVuQt/BvDldXY/w/OjTJ3Li3b/R67ffFhI4w4PyFN/gKsG0YxKhd88tyFf4nSu5J4/Dctl4rSO48ltjOuGQfSKjsHeTXriGIa9rCE4owuStAvJWlmDyscVbsTa4c4vzzwgE+U1nUU/Oy1Ikzr3h9avpHCm9wkrrT7QcIgtMHNksU120DMlqiHN7rRPyoHPKHlm46Dl7u7BCmmh8SZ/b74Ni+bJKoYG4pqJwXVuVCOG4d28Igy+nzCFNN9nMjtGV2nC1LMv4XX7CR1nZME5baAgXzw8FPMP+Cl5EQAwRvGclxokc0eunOOLSBAJLqF2QR5i30MX/ao9wQLxEzbwfCavex03KG3TRvIC63aTeC59Y22C04Q4UZTBxdY0Nt01umAEbES8qQ5CzGK8nHfeKjDRXDlLpJVOulWrXXKwDZGnuBN89+S1zrOG1cEEL5p1EuyF/qwbZF8c9nkQBzixVnzfII3TQWT/iSCC7jRlO8gSbmDbiq1TgqMGvH8FNMfyJ9UBIAbuAqudbEkNxTvHxfoRxzOGbejpiJy+wtdZ+HcKHVbSTzHSdcX7R8XGC3imHPxC/KmLAIIUoypcKepcTGOrXRt4f5RQDv6cbqZ0b8+7R/cuAVwauXazSQ02Omagn2jgHb0Iw7x0xPhDmjHy6K0Xp+qysk6vyqfA1tHO/qFKcbnA/7rgLuH2WnfSEo20p1aO12Ru48DX2cntPPfNH+JuABFuFvgCWFq9wF5uZMdwWXZ+9gSdbSjH3EzEoFLxu0n4qIRur3MDhG2FBcOE9rRP1MR7r2Ba6nBzq4FSmGq5eB/78WsiPB4dBLj+l24x7kRFQwdR33G/xlH3wLGRLgXafcRStRnXQRg3DsFab3HUaI+yyLcaCIZEMpZFhl9eU435181sz4aAjBh3AAAAABJRU5ErkJggrrbGIG6BQAA</data><length>1972</length><position>1</position><sys_attachment display_value="image" sys_id="d28ca4ecdbe5bb409eb1d311ce96191a">d28ca4ecdbe5bb409eb1d311ce96191a</sys_attachment><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:02</sys_created_on><sys_id>d68ca4ecdbe5bb409eb1d311ce96191a</sys_id></sys_attachment_doc></record_update>]]></payload>
<payload_hash>-1412315074</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>a3957aeedb48c410993fdc965e9619fc</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d92040000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>marker-icon.png</target_name>
<type>Images</type>
<update_domain>global</update_domain>
<update_guid>0090ebdfd5d3b7004630ac72cfc03e13</update_guid>
<update_guid_history>0090ebdfd5d3b7004630ac72cfc03e13:-1412315074,0c802bdf11d3b700b422c7af7a6c96ff:-893174171,aa8ca4ec21e5bb404f90fea0b0b6797c:763081612,ee8ca4ec0ce5bb40ffa7f635684cd720:-63486970,168ca4ec8fe5bb40f85cf5163fe7ca1e:-63486970,818c24ece0e5bb400e8728e640ff4669:256940490</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_js_include_f52595bbdb15f7409eb1d311ce961963</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_js_include"><m2m_sp_dependency_js_include action="INSERT_OR_UPDATE"><order>100</order><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sp_js_include display_value="leaflet asset app">0ba49d7bdb15f7409eb1d311ce961997</sp_js_include><sys_class_name>m2m_sp_dependency_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:55:03</sys_created_on><sys_id>f52595bbdb15f7409eb1d311ce961963</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Leaflet NG.leaflet asset app</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_js_include_f52595bbdb15f7409eb1d311ce961963</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:55:03</sys_updated_on></m2m_sp_dependency_js_include></record_update>]]></payload>
<payload_hash>-838374565</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>a395faeedb48c410993fdc965e961911</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90a40000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Leaflet NG.leaflet asset app</target_name>
<type>Dependency JS Includes</type>
<update_domain>global</update_domain>
<update_guid>3d2595bb5615f740937a7e2442d973ed</update_guid>
<update_guid_history>3d2595bb5615f740937a7e2442d973ed:-838374565,3d2595bb5615f740937a7e2442d973ed:-838374565</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_instance_0e36ddfbdb15f7409eb1d311ce96197c</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sp_instance"&gt;&lt;sp_instance action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;class_name/&gt;&lt;color&gt;default&lt;/color&gt;&lt;css/&gt;&lt;glyph/&gt;&lt;id/&gt;&lt;order&gt;1&lt;/order&gt;&lt;roles/&gt;&lt;short_description/&gt;&lt;size&gt;md&lt;/size&gt;&lt;sp_column display_value="1"&gt;b216ddfbdb15f7409eb1d311ce9619f6&lt;/sp_column&gt;&lt;sp_widget display_value="Service Portal Asset Map"&gt;4a7a40abdb5d77409eb1d311ce9619e6&lt;/sp_widget&gt;&lt;sys_class_name&gt;sp_instance&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-05-15 15:59:43&lt;/sys_created_on&gt;&lt;sys_id&gt;0e36ddfbdb15f7409eb1d311ce96197c&lt;/sys_id&gt;&lt;sys_mod_count&gt;4&lt;/sys_mod_count&gt;&lt;sys_name/&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sp_instance_0e36ddfbdb15f7409eb1d311ce96197c&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-09-25 18:22:02&lt;/sys_updated_on&gt;&lt;title/&gt;&lt;url/&gt;&lt;widget_parameters&gt;&lt;![CDATA[{
	"mapbox_apikey": {
		"value": "pk.eyJ1Ijoic3VzaC1jaGFuZHJhc2hla2FyIiwiYSI6ImNqMnFwcnplZTAwMDEycWt6cm1yNDF0bzEifQ.krI_R9WCDI_GBKrfY6bf1g",
		"displayValue": "pk.eyJ1Ijoic3VzaC1jaGFuZHJhc2hla2FyIiwiYSI6ImNqMnFwcnplZTAwMDEycWt6cm1yNDF0bzEifQ.krI_R9WCDI_GBKrfY6bf1g"
	},
	"center_latitude": {
		"value": "37.7749",
		"displayValue": "37.7749"
	},
	"center_longitude": {
		"value": "",
		"displayValue": ""
	}
}]]&gt;&lt;/widget_parameters&gt;&lt;/sp_instance&gt;&lt;sys_translated_text action="delete_multiple" query="documentkey=0e36ddfbdb15f7409eb1d311ce96197c"/&gt;&lt;/record_update&gt;</payload>
<payload_hash>-1112129469</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>a395faeedb48c410993fdc965e961914</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d69a8a5cb0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name/>
<type>Instance</type>
<update_domain>global</update_domain>
<update_guid>4442baea5e48c410e90c7490086bd192</update_guid>
<update_guid_history>4442baea5e48c410e90c7490086bd192:-1112129469,fe12b6ea2148c410b5342c4b5497620e:1129004453,13f1b2ea4548c410d3e5d1d9d8e8e31c:1518010243,e14d07d37793b700c599af70798aaba1:-2033947558,4e36ddfbf815f74052326bd61869717e:-591059620</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_scope_privilege_c62da3d0dbe1bb409eb1d311ce96191d</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_scope_privilege"><sys_scope_privilege action="INSERT_OR_UPDATE"><operation>read</operation><source_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</source_scope><status>allowed</status><sys_class_name>sys_scope_privilege</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 16:16:07</sys_created_on><sys_id>c62da3d0dbe1bb409eb1d311ce96191d</sys_id><sys_mod_count>0</sys_mod_count><sys_name>alm_asset</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sys_scope_privilege_c62da3d0dbe1bb409eb1d311ce96191d</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-17 16:16:07</sys_updated_on><target_name>alm_asset</target_name><target_scope display_value="Global">global</target_scope><target_type>sys_db_object</target_type></sys_scope_privilege></record_update>]]></payload>
<payload_hash>-1586593057</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>a395faeedb48c410993fdc965e961917</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91890000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>alm_asset</target_name>
<type>Cross scope privilege</type>
<update_domain>global</update_domain>
<update_guid>0a2da3d05be1bb40733dc03f46bfc51e</update_guid>
<update_guid_history>0a2da3d05be1bb40733dc03f46bfc51e:-1586593057,0a2da3d05be1bb40733dc03f46bfc51e:-1586593057</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>DELETE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_js_include_2bb59ec8dba93b409eb1d311ce96194e</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_js_include"><m2m_sp_dependency_js_include action="DELETE"><order>100</order><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sp_js_include display_value="Marker">27951ec8dba93b409eb1d311ce961922</sp_js_include><sys_class_name>m2m_sp_dependency_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-16 15:15:44</sys_created_on><sys_id>2bb59ec8dba93b409eb1d311ce96194e</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Leaflet NG.Marker</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_js_include_2bb59ec8dba93b409eb1d311ce96194e</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-16 15:15:44</sys_updated_on></m2m_sp_dependency_js_include></record_update>]]></payload>
<payload_hash>728250262</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>a7957aeedb48c410993fdc965e9619fe</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91430000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Leaflet NG.Marker</target_name>
<type>Dependency JS Includes</type>
<update_domain>global</update_domain>
<update_guid>9c36da0c4aa93b401dab2d62d639a1ab</update_guid>
<update_guid_history>9c36da0c4aa93b401dab2d62d639a1ab:728250262,9c36da0c4aa93b401dab2d62d639a1ab:728250262,afb59ec89ba93b408433edad27fb854f:78596642</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_css_include_c175257fdb55f7409eb1d311ce9619c5</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_css_include"><sp_css_include action="INSERT_OR_UPDATE"><name>awesome marker asset css</name><source>local</source><sp_css display_value="Awesome Market Style">6985a57fdb55f7409eb1d311ce961957</sp_css><sys_class_name>sp_css_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 17:06:46</sys_created_on><sys_id>c175257fdb55f7409eb1d311ce9619c5</sys_id><sys_mod_count>0</sys_mod_count><sys_name>awesome marker asset css</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_css_include_c175257fdb55f7409eb1d311ce9619c5</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 17:06:46</sys_updated_on><url/></sp_css_include></record_update>]]></payload>
<payload_hash>914414739</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>a795faeedb48c410993fdc965e961913</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90fd0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>awesome marker asset css</target_name>
<type>CSS Include</type>
<update_domain>global</update_domain>
<update_guid>6c95657fcf55f740a6c05ee81eb624dd</update_guid>
<update_guid_history>6c95657fcf55f740a6c05ee81eb624dd:914414739,6c95657fcf55f740a6c05ee81eb624dd:914414739</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_scope_privilege_496da5b7db95f7409eb1d311ce9619d3</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_scope_privilege"><sys_scope_privilege action="INSERT_OR_UPDATE"><operation>read</operation><source_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</source_scope><status>allowed</status><sys_class_name>sys_scope_privilege</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 17:40:56</sys_created_on><sys_id>496da5b7db95f7409eb1d311ce9619d3</sys_id><sys_mod_count>0</sys_mod_count><sys_name>cmn_location</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sys_scope_privilege_496da5b7db95f7409eb1d311ce9619d3</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 17:40:56</sys_updated_on><target_name>cmn_location</target_name><target_scope display_value="Global">global</target_scope><target_type>sys_db_object</target_type></sys_scope_privilege></record_update>]]></payload>
<payload_hash>-946291087</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>a795faeedb48c410993fdc965e961916</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d910d0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>cmn_location</target_name>
<type>Cross scope privilege</type>
<update_domain>global</update_domain>
<update_guid>0d6da5b7f995f740e62e711097a28fd4</update_guid>
<update_guid_history>0d6da5b7f995f740e62e711097a28fd4:-946291087,0d6da5b7f995f740e62e711097a28fd4:-946291087</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_css_include_6895657fdb55f7409eb1d311ce9619de</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_css_include"><m2m_sp_dependency_css_include action="INSERT_OR_UPDATE"><order>100</order><sp_css_include display_value="awesome marker asset css">c175257fdb55f7409eb1d311ce9619c5</sp_css_include><sp_dependency display_value="awesome marker asset">ed9591fbdb15f7409eb1d311ce961924</sp_dependency><sys_class_name>m2m_sp_dependency_css_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 17:06:46</sys_created_on><sys_id>6895657fdb55f7409eb1d311ce9619de</sys_id><sys_mod_count>0</sys_mod_count><sys_name>awesome marker asset css.awesome marker asset</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_css_include_6895657fdb55f7409eb1d311ce9619de</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 17:06:46</sys_updated_on></m2m_sp_dependency_css_include></record_update>]]></payload>
<payload_hash>1808329714</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>ab957aeedb48c410993fdc965e9619fd</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91050000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>awesome marker asset css.awesome marker asset</target_name>
<type>Dependency CSS Includes</type>
<update_domain>global</update_domain>
<update_guid>a895657ff455f740c41141a59b9b24df</update_guid>
<update_guid_history>a895657ff455f740c41141a59b9b24df:1808329714,a895657ff455f740c41141a59b9b24df:1808329714</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_css_6985a57fdb55f7409eb1d311ce961957</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_css"><sp_css action="INSERT_OR_UPDATE"><css>/*&#13;
Author: L. Voogdt&#13;
License: MIT&#13;
Version: 1.0&#13;
*/&#13;
&#13;
/* Marker setup */&#13;
.awesome-marker {&#13;
  background: url('markers-plain.png') no-repeat 0 0;&#13;
  width: 35px;&#13;
  height: 46px;&#13;
  position:absolute;&#13;
  left:0;&#13;
  top:0;&#13;
  display: block;&#13;
  text-align: center;&#13;
}&#13;
&#13;
.awesome-marker-shadow {&#13;
  background: url('markers-shadow.png') no-repeat 0 0;&#13;
  width: 36px;&#13;
  height: 16px;&#13;
}&#13;
&#13;
/* Retina displays */&#13;
@media (min--moz-device-pixel-ratio: 1.5),(-o-min-device-pixel-ratio: 3/2),&#13;
(-webkit-min-device-pixel-ratio: 1.5),(min-device-pixel-ratio: 1.5),(min-resolution: 1.5dppx) {&#13;
 .awesome-marker {&#13;
  background-image: url('markers-plain.png');&#13;
  background-size: 360px 46px;&#13;
 }&#13;
 .awesome-marker-shadow {&#13;
  background-image: url('markers-shadow@2x.png');&#13;
  background-size: 35px 16px;&#13;
 }&#13;
}&#13;
&#13;
.awesome-marker i {&#13;
  color: #333;&#13;
  margin-top: 10px;&#13;
  display: inline-block;&#13;
  font-size: 14px;&#13;
}&#13;
&#13;
.awesome-marker .icon-white {&#13;
  color: #fff;&#13;
}&#13;
&#13;
/* Colors */&#13;
.awesome-marker-icon-red {&#13;
  background-position: 0 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-darkred {&#13;
  background-position: -180px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-lightred {&#13;
  background-position: -360px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-orange {&#13;
  background-position: -36px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-beige {&#13;
  background-position: -396px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-green {&#13;
  background-position: -72px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-darkgreen {&#13;
  background-position: -252px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-lightgreen {&#13;
  background-position: -432px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-blue {&#13;
  background-position: -108px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-darkblue {&#13;
  background-position: -216px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-lightblue {&#13;
  background-position: -468px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-purple {&#13;
  background-position: -144px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-darkpurple {&#13;
  background-position: -288px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-pink {&#13;
  background-position: -504px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-cadetblue {&#13;
  background-position: -324px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-white {&#13;
  background-position: -574px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-gray {&#13;
  background-position: -648px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-lightgray {&#13;
  background-position: -612px 0;&#13;
}&#13;
&#13;
.awesome-marker-icon-black {&#13;
  background-position: -682px 0;&#13;
}&#13;
</css><name>Awesome Market Style</name><sys_class_name>sp_css</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 17:06:44</sys_created_on><sys_id>6985a57fdb55f7409eb1d311ce961957</sys_id><sys_mod_count>2</sys_mod_count><sys_name>Awesome Market Style</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_css_6985a57fdb55f7409eb1d311ce961957</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-22 16:01:01</sys_updated_on></sp_css></record_update>]]></payload>
<payload_hash>-637556038</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>ab95faeedb48c410993fdc965e961912</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d921a0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Awesome Market Style</target_name>
<type>Style Sheet</type>
<update_domain>global</update_domain>
<update_guid>2eeb8fef9ed3f70097238350c6b99176</update_guid>
<update_guid_history>2eeb8fef9ed3f70097238350c6b99176:-637556038,c4cb47ef5fd3f70091e0831e4cd7ef21:1586736388,3f85a57f5155f740e8614b0027ed527d:-637556038</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_row_fe16ddfbdb15f7409eb1d311ce9619f3</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_row"><sp_row action="INSERT_OR_UPDATE"><class_name/><order>1</order><sp_column/><sp_container display_value="Asset Map - Container 1">9516d9fbdb15f7409eb1d311ce961974</sp_container><sys_class_name>sp_row</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:59:12</sys_created_on><sys_id>fe16ddfbdb15f7409eb1d311ce9619f3</sys_id><sys_mod_count>0</sys_mod_count><sys_name>1</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_row_fe16ddfbdb15f7409eb1d311ce9619f3</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:59:12</sys_updated_on></sp_row></record_update>]]></payload>
<payload_hash>-1167256632</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>ab95faeedb48c410993fdc965e961915</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90d20000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>1</target_name>
<type>Row</type>
<update_domain>global</update_domain>
<update_guid>7616ddfb3b15f7409b4267391645e2f5</update_guid>
<update_guid_history>7616ddfb3b15f7409b4267391645e2f5:-1167256632,7616ddfb3b15f7409b4267391645e2f5:-1167256632</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_ui_script_70b555fbdb15f7409eb1d311ce96194f</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_ui_script"&gt;&lt;sys_ui_script action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;description/&gt;&lt;global&gt;false&lt;/global&gt;&lt;name&gt;x_snc_sp_asset_map.Awesome Marker Asset &lt;/name&gt;&lt;script&gt;&lt;![CDATA[/*
  Leaflet.AwesomeMarkers, a plugin that adds colorful iconic markers for Leaflet, based on the Font Awesome icons
  (c) 2012-2013, Lennard Voogdt

  http://leafletjs.com
  https://github.com/lvoogdt
*/

/*global L*/

(function (window, document, undefined) {
    "use strict";
    /*
     * Leaflet.AwesomeMarkers assumes that you have already included the Leaflet library.
     */
    L.AwesomeMarkers = {};

    L.AwesomeMarkers.version = '2.0.1';

    L.AwesomeMarkers.Icon = L.Icon.extend({
        options: {
            iconSize: [35, 45],
            iconAnchor:   [17, 42],
            popupAnchor: [1, -32],
            shadowAnchor: [10, 12],
            shadowSize: [36, 16],
            className: 'awesome-marker',
            prefix: 'glyphicon',
            spinClass: 'fa-spin',
            extraClasses: '',
            icon: 'home',
            markerColor: 'blue',
            iconColor: 'white'
        },

        initialize: function (options) {
            options = L.Util.setOptions(this, options);
        },

        createIcon: function () {
            var div = document.createElement('div'),
                options = this.options;

            if (options.icon) {
                div.innerHTML = this._createInner();
            }

            if (options.bgPos) {
                div.style.backgroundPosition =
                    (-options.bgPos.x) + 'px ' + (-options.bgPos.y) + 'px';
            }

            this._setIconStyles(div, 'icon-' + options.markerColor);
            return div;
        },

        _createInner: function() {
            var iconClass, iconSpinClass = "", iconColorClass = "", iconColorStyle = "", options = this.options;

            if(options.icon.slice(0,options.prefix.length+1) === options.prefix + "-") {
                iconClass = options.icon;
            } else {
                iconClass = options.prefix + "-" + options.icon;
            }

            if(options.spin &amp;&amp; typeof options.spinClass === "string") {
                iconSpinClass = options.spinClass;
            }

            if(options.iconColor) {
                if(options.iconColor === 'white' || options.iconColor === 'black') {
                    iconColorClass = "icon-" + options.iconColor;
                } else {
                    iconColorStyle = "style='color: " + options.iconColor + "' ";
                }
            }

            return "&lt;i " + iconColorStyle + "class='" + options.extraClasses + " " + options.prefix + " " + iconClass + " " + iconSpinClass + " " + iconColorClass + "'&gt;&lt;/i&gt;";
        },

        _setIconStyles: function (img, name) {
            var options = this.options,
                size = L.point(options[name === 'shadow' ? 'shadowSize' : 'iconSize']),
                anchor;

            if (name === 'shadow') {
                anchor = L.point(options.shadowAnchor || options.iconAnchor);
            } else {
                anchor = L.point(options.iconAnchor);
            }

            if (!anchor &amp;&amp; size) {
                anchor = size.divideBy(2, true);
            }

            img.className = 'awesome-marker-' + name + ' ' + options.className;

            if (anchor) {
                img.style.marginLeft = (-anchor.x) + 'px';
                img.style.marginTop  = (-anchor.y) + 'px';
            }

            if (size) {
                img.style.width  = size.x + 'px';
                img.style.height = size.y + 'px';
            }
        },

        createShadow: function () {
            var div = document.createElement('div');

            this._setIconStyles(div, 'shadow');
            return div;
      }
    });
        
    L.AwesomeMarkers.icon = function (options) {
        return new L.AwesomeMarkers.Icon(options);
    };

}(this, document));



]]&gt;&lt;/script&gt;&lt;script_name&gt;Awesome Marker Asset app&lt;/script_name&gt;&lt;sys_class_name&gt;sys_ui_script&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-05-15 15:57:46&lt;/sys_created_on&gt;&lt;sys_id&gt;70b555fbdb15f7409eb1d311ce96194f&lt;/sys_id&gt;&lt;sys_mod_count&gt;6&lt;/sys_mod_count&gt;&lt;sys_name&gt;x_snc_sp_asset_map.Awesome Marker Asset &lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_ui_script_70b555fbdb15f7409eb1d311ce96194f&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-05-15 21:15:11&lt;/sys_updated_on&gt;&lt;ui_type&gt;0&lt;/ui_type&gt;&lt;use_scoped_format&gt;false&lt;/use_scoped_format&gt;&lt;/sys_ui_script&gt;&lt;/record_update&gt;</payload>
<payload_hash>-838047040</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>ab95faeedb48c410993fdc965e961918</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91170000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>x_snc_sp_asset_map.Awesome Marker Asset </target_name>
<type>UI Script</type>
<update_domain>global</update_domain>
<update_guid>d76ed63fe459f740ca434e10c855f8fe</update_guid>
<update_guid_history>d76ed63fe459f740ca434e10c855f8fe:-838047040,d76ed63fe459f740ca434e10c855f8fe:-838047040,686ed63f9e59f740f0e451507b00b579:-1950344032,f107517fea15f7406e3daa94415b5bd4:-838047040,10f6dd3f8615f7403a8c4f996fc03cfd:1907300372,8ce65d3fc415f740e3c0e4f3fc4bd9b8:-1370508844,2cd65d3fc715f740379336c78226bc8e:-2050403737,29c595fb9d15f740774ef65554e02ad1:-1370508844</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>DELETE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>db_image_df93d3db1b93b70074f3db9cdc4bcb99</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="db_image"><db_image action="DELETE"><active>true</active><category/><format>png</format><height>70</height><image>73a39f9b1b93b70074f3db9cdc4bcbbf</image><name>search-icon.png</name><size_bytes>3838</size_bytes><sys_class_name>db_image</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 21:56:18</sys_created_on><sys_id>df93d3db1b93b70074f3db9cdc4bcb99</sys_id><sys_mod_count>2</sys_mod_count><sys_name>search-icon.png</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>db_image_df93d3db1b93b70074f3db9cdc4bcb99</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-21 21:56:29</sys_updated_on><thumbnail/><width>20</width></db_image><sys_attachment action="INSERT_OR_UPDATE"><average_image_color>#0</average_image_color><chunk_size_bytes>734003</chunk_size_bytes><compressed>true</compressed><content_type>image/png</content_type><encryption_context/><file_name>image</file_name><image_height>70</image_height><image_width>20</image_width><size_bytes>3838</size_bytes><size_compressed>3861</size_compressed><state>available</state><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 21:56:29</sys_created_on><sys_id>73a39f9b1b93b70074f3db9cdc4bcbbf</sys_id><sys_mod_count>3</sys_mod_count><sys_updated_by>guest</sys_updated_by><sys_updated_on>2019-08-21 21:56:30</sys_updated_on><table_name>ZZ_YYdb_image</table_name><table_sys_id>df93d3db1b93b70074f3db9cdc4bcb99</table_sys_id></sys_attachment><sys_attachment_doc action="INSERT_OR_UPDATE"><data>H4sIAAAAAAAAAA==</data><length>16</length><position>0</position><sys_attachment display_value="image" sys_id="73a39f9b1b93b70074f3db9cdc4bcbbf">73a39f9b1b93b70074f3db9cdc4bcbbf</sys_attachment><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 21:56:29</sys_created_on><sys_id>b3a39f9b1b93b70074f3db9cdc4bcbbf</sys_id></sys_attachment_doc><sys_attachment_doc action="INSERT_OR_UPDATE"><data>Af4OAfGJUE5HDQoaCgAAAA1JSERSAAAAFAAAAEYIBgAAAMzPtPEAAApDaUNDUElDQyBwcm9maWxlAAB42p1Td1iT9xY+3/dlD1ZC2PCxl2yBACIjrAjIEFmiEJIAYYQQEkDFhYgKVhQVEZxIVcSC1QpInYjioCi4Z0GKiFqLVVw47h/cp7V9eu/t7fvX+7znnOf8znnPD4AREiaR5qJqADlShTw62B+PT0jEyb2AAhVI4AQgEObLwmcFxQAA8AN5eH50sD/8Aa9vAAIAcNUuJBLH4f+DulAmVwAgkQDgIhLnCwGQUgDILlTIFADIGACwU7NkCgCUAABseXxCIgCqDQDs9Ek+BQDYqZPcFwDYohypCACNAQCZKEckAkC7AGBVgVIsAsDCAKCsQCIuBMCuAYBZtjJHAoC9BQB2jliQD0BgAICZQizMACA4AgBDHhPNAyBMA6Aw0r/gqV9whbhIAQDAy5XNl0vSMxS4ldAad/Lw4OIh4sJssUJhFykQZgnkIpyXmyMTSOcDTM4MAAAa+dHB/jg/kOfm5OHmZuds7/TFov5r8G8iPiHx3/68jAIEABBOz+/aX+Xl1gNwxwGwdb9rqVsA2lYAaN/5XTPbCaBaCtB6+Yt5OPxAHp6hUMg8HRwKCwvtJWKhvTDjiz7/M+Fv4It+9vxAHv7bevAAcZpAma3Ao4P9cWFudq5SjufLBEIxbvfnI/7HhX/9jinR4jSxXCwVivFYibhQIk3HeblSkUQhyZXiEul/MvEflv0Jk3cNAKyGT8BOtge1y2zAfu4BAosOWNJ2AEB+8y2MGguRABBnNDJ59wAAk7/5j0ArAQDNl6TjAAC86BhcqJQXTMYIAABEoIEqsEEHDMEUrMAOnMEdvMAXAmEGREAMJMA8EEIG5IAcCqEYlkEZVMA62AS1sAMaoBGa4RC0wTE4DefgElyB63AXBmAYnsIYvIYJBEHICBNhITqIEWKO2CLOCBeZjgQiYUg0koCkIOmIFFEixchypAKpQmqRXUgj8i1yFDmNXED6kNvIIDKK/Iq8RzGUgbJRA9QCdUC5qB8aisagc9F0NA9dgJaia9EatB49gLaip9FL6HV0AH2KjmOA0TEOZozZYVyMh0VgiVgaJscWY+VYNVaPNWMdWDd2FRvAnmHvCCQCi4AT7AhehBDCbIKQkEdYTFhDqCXsI7QSughXCYOEMcInIpOoT7QlehL5xHhiOrGQWEasJu4hHiGeJV4nDhNfk0gkDsmS5E4KISWQMkkLSWtI20gtpFOkPtIQaZxMJuuQbcne5AiygKwgl5G3kA+QT5L7ycPktxQ6xYjiTAmiJFKklBJKNWU/5QSlnzJCmaCqUc2pntQIqog6n1pJbaB2UC9Th6kTNHWaJc2bFkPLpC2j1dCaaWdp92gv6XS6Cd2DHkWX0JfSa+gH6efpg/R3DA2GDYPHSGIoGWsZexmnGLcZL5lMpgXTl5nIVDDXMhuZZ5gPmG9VWCr2KnwVkcoSlTqVVpV+leeqVFVzVT/VeaoLVKtVD6teVn2mRlWzUOOpCdQWq9WpHVW7qTauzlJ3Uo9Qz1Ffo75f/YL6Yw2yhoVGoIZIo1Rjt8YZjSEWxjJl8VhC1nJWA+ssa5hNYluy+exMdgX7G3Yve0xTQ3OqZqxmkWad5nHNAQ7GseDwOdmcSs4hzg3Oey0DLT8tsdZqrWatfq032nravtpi7XLtFu3r2u91cJ1AnSyd9TptOvd1Cbo2ulG6hbrbdc/qPtNj63npCfXK9Q7p3dFH9W30o/UX6u/W79EfNzA0CDaQGWwxOGPwzJBj6GuYabjR8IThqBHLaLqRxGij0UmjJ7gm7odn4zV4Fz5mrG8cYqw03mXcazxhYmky26TEpMXkvinNlGuaZrrRtNN0zMzILNys2KzJ7I451ZxrnmG+2bzb/I2FpUWcxUqLNovHltqWfMsFlk2W96yYVj5WeVb1VtesSdZc6yzrbdZXbFAbV5sMmzqby7aorZutxHabbd8U4hSPKdIp9VNu2jHs/OwK7JrsBu059mH2JfZt9s8dzBwSHdY7dDt8cnR1zHZscLzrpOE0w6nEqcPpV2cbZ6FznfM1F6ZLkMsSl3aXF1Ntp4qnbp96y5XlGu660rXT9aObu5vcrdlt1N3MPcV9q/tNLpsbyV3DPe9B9PD3WOJxzOOdp5unwvOQ5y9edl5ZXvu9Hk+znCae1jBtyNvEW+C9y3tgOj49ZfrO6QM+xj4Cn3qfh76mviLfPb4jftZ+mX4H/J77O/rL/Y/4v+F58hbxTgVgAcEB5QG9gRqBswNrAx8EmQSlBzUFjQW7Bi8MPhVCDAkNWR9yk2/AF/Ib+WMz3GcsmtEVygidFVob+jDMJkwe1hGOhs8I3xB+b6b5TOnMtgiI4EdsiLgfaRmZF/l9FCkqMqou6lG0U3RxdPcs1qzkWftnvY7xj6mMuTvbarZydmesamxSbGPsm7iAuKq4gXiH+EXxlxJ0EyQJ7YnkxNjEPYnjcwLnbJoznOSaVJZ0Y67l3KK5F+bpzsuedzxZNVmQfDiFmBKXsj/lgyBCUC8YT+Wnbk0dE/KEm4VPRb6ijaJRsbe4SjyS5p1WlfY43Tt9Q/pohk9GdcYzCU9SK3mRGZK5I/NNVkTW3qzP2XHZLTmUnJSco1INaZa0K9cwtyi3T2YrK5MN5Hnmbcobk4fK9+Qj+XPz2xVshUzRo7RSrlAOFkwvqCt4WxhbeLhIvUha1DPfZv7q+SMLghZ8vZCwULiws9i4eFnx4CK/RbsWI4tTF3cuMV1SumR4afDSfctoy7KW/VDiWFJV8mp53PKOUoPSpaVDK4JXNJWplMnLbq70WrljFWGVZFXvapfVW1Z/KheVX6xwrKiu+LBGuObiV05f1Xz1eW3a2t5Kt8rt60jrpOturPdZv69KvWpB1dCG8A2tG/GN5RtfbUredKF6avWOzbTNys0DNWE17VvMtqzb8qE2o/Z6nX9dy1b9rau3vtkm2ta/3Xd78w6DHRU73u+U7Ly1K3hXa71FffVu0u6C3Y8aYhu6v+Z+3bhHd0/Fno97pXsH9kXv62p0b2zcr7+/sgltUjaNHkg6cOWbgG/am+2ad7VwWioOwkHlwSffpnx741Dooc7D3MPN35l/t/UI60h5K9I6v3WsLaNtoD2hve/ojKOdHV4dR763/37vMeNjdcc1j1eeoJ0oPfH55IKT46dkp56dTj891JncefdM/JlrXVFdvWdDz54/F3TuTLdf98nz3uePXfC8cPQi92LbJbdLrT2uPUd+cP3hSK9bb+tl98vtVzyudPRN6zvR79N/+mrA1XPX+NcuXZ95ve/G7Bu3bibdHLgluvX4dvbtF3cK7kzcXXqPeK/8vtr96gf6D+p/tP6xZcBt4PhgwGDPw1kP7w4Jh57+lP/Th+HSR8xH1SNGI42PnR8fGw0avfJkzpPhp7KnE8/Kflb/eetzq+ff/eL7S89Y/NjwC/mLz7+ueanzcu+rqa86xyPHH7zOeT3xpvytztt977jvut/HvR+ZKPxA/lDz0fpjx6fQT/c+53z+/C/3hPP7gDklEQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAPYQAAD2EBqD+naQAAAAd0SU1FB90JHQ4rNJBNbLQAAAQ8SURBVFjD7ZddaFtlGMd/y8fsjpvZ6qKEsi1diApN+4IKW6s4xQlugjIZXvmCQt2Nrjci6MUQvHBXwphXQoXBeyH4AeJNmSiiFhQcYztLhzZmieA8W+NST7Un3dqk3jyJh/Qk/TCIF3kg5OQ97/t/vv7P+Z/A/902tbl3G3AX0CO/q8B1YH69gFFgEDgCjAA7Zd88cB74FJgEKmuN+jngW+AmcAuYAa4BfwE1oAC8AWwLOhz2XYeAA8BbwIPAj8A4cAb4DLgIbAbuAwYAF7ggTgJtJ/C+RDUJPAVEmhzeD3wALMqeTLtUHwOKQBkYlaYE2UGJvgK83NyHkO96N7AduAJ8IzUMsu+AH6T7u30sWAEYFW8usNAmk3lgrulMIOCifO9o1UGxbbLHfyYQ8GdgFkgBT4j3IN6OAPukhlcAr5Xn7dLlilDkGWCrL6UeYD/wkUzNOWCoHQ8XpMMZocc+IAn0CveOAK9Il0PyKazGxRBwGPgc+ENqdNM3NR5QkvUaMA28ANweFCHAstTlnBxclq5fk2g+kZQtYK8MQwb4UyJdbkf0KHAn0C+NSsjobQIeBs5K5DXgJ3kG/Ct7VEpTE16+StOsrte+llq6wG/Ax3Stax3WZa11oC4bY9any1rrNemyMaaymowCoJQ6Crwps7lHZtoCdomDR4CoUuqibdu3WkaotQ7J5ncABVyWaLIyYntFWvcDvwNvA+PGmCU/oH+WewEt6X4PnATO1g+Iw6+A14CjwPOizdlWmjIIPC6vHGeAL/zejTE1Y8x5kYk88ABwQGu9Nl02xvw3uiy06Zwua603psvCx2awFbpsjPFaAU4BX4puvAgc1lpvrRdda90jQKMir5elnsHEtm17QSkVqMtKqZa6rJS6YNt2LXBSlFK/Ag5wN5AGhoGngWeF9HFpyGap872Aq5TK2ba9uALQtu1lpdSGdFkiXW73tIkCd8gnJG8NN6SzDwEnREqjQA44YYz5MNKGb4sCcCPg9qTW+qRw8KC8BOzq6nLXOimjxWKhb7ZcPu667iHP84aABcuypmOx2MSO3t53k8n+q2sGzGYvHXMc55TneVuCDliWVUkkEmOZzOD4qoDZ7KVjvxSL7y1Vq23TioTD7EkmXwoCDfnTdBznVB0sHo+vAKqvLVWrOI5zulgs9LUEnC2Xx+ppxuNxhodHGBj459/rwECG4eGRBqjneVtmy+XjK6KvX7iu+2T9ulQqkc/nSaVSjY2pVIp8Pk+pVMJ35hDweiCg53n3+G9MTWUbQAD5fL6x1upMs6Z0xCI+Oky7c3ND/prV0/RH6o/SsqzploCxWGyiDhiPxxtgfoBUKsXMzPVGHWOx2ERLHhaLhb5cLpfzd9rfgOY1y7Iq6XQ63Tw1jRomk/1XE4nEWCQcbnS62eprkXCYRCIxFjSCQaM36jjO6Y6MXiceDl3r2gbsb0vGuGFZd0TuAAAAAElFTkSuQmCC54tsOv4OAAA=</data><length>5136</length><position>1</position><sys_attachment display_value="image" sys_id="73a39f9b1b93b70074f3db9cdc4bcbbf">73a39f9b1b93b70074f3db9cdc4bcbbf</sys_attachment><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 21:56:29</sys_created_on><sys_id>37a39f9b1b93b70074f3db9cdc4bcbbf</sys_id></sys_attachment_doc></record_update>]]></payload>
<payload_hash>839510176</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>af957aeedb48c410993fdc965e9619fc</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91d80000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>search-icon.png</target_name>
<type>Images</type>
<update_domain>global</update_domain>
<update_guid>8da79b936ad3b700602f0ecdb84f0bce</update_guid>
<update_guid_history>8da79b936ad3b700602f0ecdb84f0bce:839510176,84b3d7db5893b7008f00211651ab7f00:-1520601862,0cb397db1893b700bdc23a6ae03ea4fb:-534435917,40b397dbd893b7009e12af72b03abaf9:-534435917,91a353db7393b7005646f33b94b7a04d:1399007270</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_angular_provider_e474597bdb15f7409eb1d311ce9619c3</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sp_angular_provider"&gt;&lt;sp_angular_provider action="INSERT_OR_UPDATE"&gt;&lt;name&gt;flippy&lt;/name&gt;&lt;script&gt;&lt;![CDATA[function flippy(){
			return {
			restrict: 'EA',
			link: function($scope, $elem, $attrs) {

				var options = {
					flipDuration: ($attrs.flipDuration) ? $attrs.flipDuration : 400,
					timingFunction: 'ease-in-out',
				};

				// setting flip options
				angular.forEach(['flippy-front', 'flippy-back'], function(name) {
					var el = $elem.find(name);
					if (el.length == 1) {
						angular.forEach(['', '-ms-', '-webkit-'], function(prefix) {
							angular.element(el[0]).css(prefix + 'transition', 'all ' + options.flipDuration/1000 + 's ' + options.timingFunction);
						});
					}
				});

				/**
				 * behaviour for flipping effect.
				 */
				$scope.flip = function() {
					$elem.toggleClass('flipped');
				}

			}
		};
}]]&gt;&lt;/script&gt;&lt;sys_class_name&gt;sp_angular_provider&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-05-15 15:52:05&lt;/sys_created_on&gt;&lt;sys_id&gt;e474597bdb15f7409eb1d311ce9619c3&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;flippy&lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sp_angular_provider_e474597bdb15f7409eb1d311ce9619c3&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-05-15 15:52:05&lt;/sys_updated_on&gt;&lt;type&gt;directive&lt;/type&gt;&lt;/sp_angular_provider&gt;&lt;/record_update&gt;</payload>
<payload_hash>2017291194</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>af95faeedb48c410993fdc965e961911</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d907b0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>flippy</target_name>
<type>Widget Angular Provider</type>
<update_domain>global</update_domain>
<update_guid>5674197bc315f740d30c968e3270235d</update_guid>
<update_guid_history>5674197bc315f740d30c968e3270235d:2017291194,5674197bc315f740d30c968e3270235d:2017291194</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_js_include_62a515fbdb15f7409eb1d311ce96190c</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_js_include"><sp_js_include action="INSERT_OR_UPDATE"><display_name>awesome marker asset</display_name><source>local</source><sys_class_name>sp_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:57:49</sys_created_on><sys_id>62a515fbdb15f7409eb1d311ce96190c</sys_id><sys_mod_count>0</sys_mod_count><sys_name>awesome marker asset</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_ui_script display_value="x_snc_sp_asset_map.Awesome Marker Asset ">70b555fbdb15f7409eb1d311ce96194f</sys_ui_script><sys_update_name>sp_js_include_62a515fbdb15f7409eb1d311ce96190c</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:57:49</sys_updated_on><url/></sp_js_include></record_update>]]></payload>
<payload_hash>1922257054</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>af95faeedb48c410993fdc965e961914</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90b90000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>awesome marker asset</target_name>
<type>JS Include</type>
<update_domain>global</update_domain>
<update_guid>e6c515fb2715f740cd65e6d827263ab8</update_guid>
<update_guid_history>e6c515fb2715f740cd65e6d827263ab8:1922257054,e6c515fb2715f740cd65e6d827263ab8:1922257054</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_ui_script_2cc411bbdb15f7409eb1d311ce961991</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_ui_script"&gt;&lt;sys_ui_script action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;description/&gt;&lt;global&gt;false&lt;/global&gt;&lt;name&gt;x_snc_sp_asset_map.leafletjs asset app&lt;/name&gt;&lt;script&gt;&lt;![CDATA[/*
 Leaflet 1.0.3+ed36a04, a JS library for interactive maps. http://leafletjs.com
 (c) 2010-2016 Vladimir Agafonkin, (c) 2010-2011 CloudMade
*/
!function(t,e,i){function n(){var e=t.L;o.noConflict=function(){return t.L=e,this},t.L=o}var o={version:"1.0.3+ed36a04"};"object"==typeof module&amp;&amp;"object"==typeof module.exports?module.exports=o:"function"==typeof define&amp;&amp;define.amd&amp;&amp;define(o),"undefined"!=typeof t&amp;&amp;n(),o.Util={extend:function(t){var e,i,n,o;for(i=1,n=arguments.length;i&lt;n;i++){o=arguments[i];for(e in o)t[e]=o[e]}return t},create:Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}(),bind:function(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}},stamp:function(t){return t._leaflet_id=t._leaflet_id||++o.Util.lastId,t._leaflet_id},lastId:0,throttle:function(t,e,i){var n,o,s,r;return r=function(){n=!1,o&amp;&amp;(s.apply(i,o),o=!1)},s=function(){n?o=arguments:(t.apply(i,arguments),setTimeout(r,e),n=!0)}},wrapNum:function(t,e,i){var n=e[1],o=e[0],s=n-o;return t===n&amp;&amp;i?t:((t-o)%s+s)%s+o},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return o.Util.trim(t).split(/\s+/)},setOptions:function(t,e){t.hasOwnProperty("options")||(t.options=t.options?o.Util.create(t.options):{});for(var i in e)t.options[i]=e[i];return t.options},getParamString:function(t,e,i){var n=[];for(var o in t)n.push(encodeURIComponent(i?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&amp;&amp;e.indexOf("?")!==-1?"&amp;":"?")+n.join("&amp;")},template:function(t,e){return t.replace(o.Util.templateRe,function(t,n){var o=e[n];if(o===i)throw new Error("No value provided for variable "+t);return"function"==typeof o&amp;&amp;(o=o(e)),o})},templateRe:/\{ *([\w_\-]+) *\}/g,isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},indexOf:function(t,e){for(var i=0;i&lt;t.length;i++)if(t[i]===e)return i;return-1},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){return t["webkit"+e]||t["moz"+e]||t["ms"+e]}function i(e){var i=+new Date,o=Math.max(0,16-(i-n));return n=i+o,t.setTimeout(e,o)}var n=0,s=t.requestAnimationFrame||e("RequestAnimationFrame")||i,r=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};o.Util.requestAnimFrame=function(e,n,r){return r&amp;&amp;s===i?void e.call(n):s.call(t,o.bind(e,n))},o.Util.cancelAnimFrame=function(e){e&amp;&amp;r.call(t,e)}}(),o.extend=o.Util.extend,o.bind=o.Util.bind,o.stamp=o.Util.stamp,o.setOptions=o.Util.setOptions,o.Class=function(){},o.Class.extend=function(t){var e=function(){this.initialize&amp;&amp;this.initialize.apply(this,arguments),this.callInitHooks()},i=e.__super__=this.prototype,n=o.Util.create(i);n.constructor=e,e.prototype=n;for(var s in this)this.hasOwnProperty(s)&amp;&amp;"prototype"!==s&amp;&amp;(e[s]=this[s]);return t.statics&amp;&amp;(o.extend(e,t.statics),delete t.statics),t.includes&amp;&amp;(o.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),n.options&amp;&amp;(t.options=o.Util.extend(o.Util.create(n.options),t.options)),o.extend(n,t),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&amp;&amp;i.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;t&lt;e;t++)n._initHooks[t].call(this)}},e},o.Class.include=function(t){return o.extend(this.prototype,t),this},o.Class.mergeOptions=function(t){return o.extend(this.prototype.options,t),this},o.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this},o.Evented=o.Class.extend({on:function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e);else{t=o.Util.splitWords(t);for(var s=0,r=t.length;s&lt;r;s++)this._on(t[s],e,i)}return this},off:function(t,e,i){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],e);else{t=o.Util.splitWords(t);for(var s=0,r=t.length;s&lt;r;s++)this._off(t[s],e,i)}else delete this._events;return this},_on:function(t,e,n){this._events=this._events||{};var o=this._events[t];o||(o=[],this._events[t]=o),n===this&amp;&amp;(n=i);for(var s={fn:e,ctx:n},r=o,a=0,h=r.length;a&lt;h;a++)if(r[a].fn===e&amp;&amp;r[a].ctx===n)return;r.push(s)},_off:function(t,e,n){var s,r,a;if(this._events&amp;&amp;(s=this._events[t])){if(!e){for(r=0,a=s.length;r&lt;a;r++)s[r].fn=o.Util.falseFn;return void delete this._events[t]}if(n===this&amp;&amp;(n=i),s)for(r=0,a=s.length;r&lt;a;r++){var h=s[r];if(h.ctx===n&amp;&amp;h.fn===e)return h.fn=o.Util.falseFn,this._firingCount&amp;&amp;(this._events[t]=s=s.slice()),void s.splice(r,1)}}},fire:function(t,e,i){if(!this.listens(t,i))return this;var n=o.Util.extend({},e,{type:t,target:this});if(this._events){var s=this._events[t];if(s){this._firingCount=this._firingCount+1||1;for(var r=0,a=s.length;r&lt;a;r++){var h=s[r];h.fn.call(h.ctx||this,n)}this._firingCount--}}return i&amp;&amp;this._propagateEvent(n),this},listens:function(t,e){var i=this._events&amp;&amp;this._events[t];if(i&amp;&amp;i.length)return!0;if(e)for(var n in this._eventParents)if(this._eventParents[n].listens(t,e))return!0;return!1},once:function(t,e,i){if("object"==typeof t){for(var n in t)this.once(n,t[n],e);return this}var s=o.bind(function(){this.off(t,e,i).off(t,s,i)},this);return this.on(t,e,i).on(t,s,i)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[o.stamp(t)]=t,this},removeEventParent:function(t){return this._eventParents&amp;&amp;delete this._eventParents[o.stamp(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,o.extend({layer:t.target},t),!0)}});var s=o.Evented.prototype;s.addEventListener=s.on,s.removeEventListener=s.clearAllEventListeners=s.off,s.addOneTimeEventListener=s.once,s.fireEvent=s.fire,s.hasEventListeners=s.listens,o.Mixin={Events:s},function(){var i=navigator.userAgent.toLowerCase(),n=e.documentElement,s="ActiveXObject"in t,r=i.indexOf("webkit")!==-1,a=i.indexOf("phantom")!==-1,h=i.search("android [23]")!==-1,l=i.indexOf("chrome")!==-1,u=i.indexOf("gecko")!==-1&amp;&amp;!r&amp;&amp;!t.opera&amp;&amp;!s,c=0===navigator.platform.indexOf("Win"),d="undefined"!=typeof orientation||i.indexOf("mobile")!==-1,_=!t.PointerEvent&amp;&amp;t.MSPointerEvent,m=t.PointerEvent||_,p=s&amp;&amp;"transition"in n.style,f="WebKitCSSMatrix"in t&amp;&amp;"m11"in new t.WebKitCSSMatrix&amp;&amp;!h,g="MozPerspective"in n.style,v="OTransition"in n.style,y=!t.L_NO_TOUCH&amp;&amp;(m||"ontouchstart"in t||t.DocumentTouch&amp;&amp;e instanceof t.DocumentTouch);o.Browser={ie:s,ielt9:s&amp;&amp;!e.addEventListener,edge:"msLaunchUri"in navigator&amp;&amp;!("documentMode"in e),webkit:r,gecko:u,android:i.indexOf("android")!==-1,android23:h,chrome:l,safari:!l&amp;&amp;i.indexOf("safari")!==-1,win:c,ie3d:p,webkit3d:f,gecko3d:g,opera12:v,any3d:!t.L_DISABLE_3D&amp;&amp;(p||f||g)&amp;&amp;!v&amp;&amp;!a,mobile:d,mobileWebkit:d&amp;&amp;r,mobileWebkit3d:d&amp;&amp;f,mobileOpera:d&amp;&amp;t.opera,mobileGecko:d&amp;&amp;u,touch:!!y,msPointer:!!_,pointer:!!m,retina:(t.devicePixelRatio||t.screen.deviceXDPI/t.screen.logicalXDPI)&gt;1}}(),o.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},o.Point.prototype={clone:function(){return new o.Point(this.x,this.y)},add:function(t){return this.clone()._add(o.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(o.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new o.Point(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new o.Point(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(t){t=o.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=o.point(t),t.x===this.x&amp;&amp;t.y===this.y},contains:function(t){return t=o.point(t),Math.abs(t.x)&lt;=Math.abs(this.x)&amp;&amp;Math.abs(t.y)&lt;=Math.abs(this.y)},toString:function(){return"Point("+o.Util.formatNum(this.x)+", "+o.Util.formatNum(this.y)+")"}},o.point=function(t,e,n){return t instanceof o.Point?t:o.Util.isArray(t)?new o.Point(t[0],t[1]):t===i||null===t?t:"object"==typeof t&amp;&amp;"x"in t&amp;&amp;"y"in t?new o.Point(t.x,t.y):new o.Point(t,e,n)},o.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n&lt;o;n++)this.extend(i[n])},o.Bounds.prototype={extend:function(t){return t=o.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new o.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new o.Point(this.min.x,this.max.y)},getTopRight:function(){return new o.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof o.Point?o.point(t):o.bounds(t),t instanceof o.Bounds?(e=t.min,i=t.max):e=i=t,e.x&gt;=this.min.x&amp;&amp;i.x&lt;=this.max.x&amp;&amp;e.y&gt;=this.min.y&amp;&amp;i.y&lt;=this.max.y},intersects:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,s=t.max,r=s.x&gt;=e.x&amp;&amp;n.x&lt;=i.x,a=s.y&gt;=e.y&amp;&amp;n.y&lt;=i.y;return r&amp;&amp;a},overlaps:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,s=t.max,r=s.x&gt;e.x&amp;&amp;n.x&lt;i.x,a=s.y&gt;e.y&amp;&amp;n.y&lt;i.y;return r&amp;&amp;a},isValid:function(){return!(!this.min||!this.max)}},o.bounds=function(t,e){return!t||t instanceof o.Bounds?t:new o.Bounds(t,e)},o.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},o.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new o.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},o.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i]||t.currentStyle&amp;&amp;t.currentStyle[i];if((!n||"auto"===n)&amp;&amp;e.defaultView){var o=e.defaultView.getComputedStyle(t,null);n=o?o[i]:null}return"auto"===n?null:n},create:function(t,i,n){var o=e.createElement(t);return o.className=i||"",n&amp;&amp;n.appendChild(o),o},remove:function(t){var e=t.parentNode;e&amp;&amp;e.removeChild(t)},empty:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},toFront:function(t){t.parentNode.appendChild(t)},toBack:function(t){var e=t.parentNode;e.insertBefore(t,e.firstChild)},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=o.DomUtil.getClass(t);return n.length&gt;0&amp;&amp;new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=o.Util.splitWords(e),s=0,r=n.length;s&lt;r;s++)t.classList.add(n[s]);else if(!o.DomUtil.hasClass(t,e)){var a=o.DomUtil.getClass(t);o.DomUtil.setClass(t,(a?a+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):o.DomUtil.setClass(t,o.Util.trim((" "+o.DomUtil.getClass(t)+" ").replace(" "+e+" "," ")))},setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&amp;&amp;o.DomUtil._setOpacityIE(t,e)},_setOpacityIE:function(t,e){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"},testProp:function(t){for(var i=e.documentElement.style,n=0;n&lt;t.length;n++)if(t[n]in i)return t[n];return!1},setTransform:function(t,e,i){var n=e||new o.Point(0,0);t.style[o.DomUtil.TRANSFORM]=(o.Browser.ie3d?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(i?" scale("+i+")":"")},setPosition:function(t,e){t._leaflet_pos=e,o.Browser.any3d?o.DomUtil.setTransform(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos||new o.Point(0,0)}},function(){o.DomUtil.TRANSFORM=o.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var i=o.DomUtil.TRANSITION=o.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);if(o.DomUtil.TRANSITION_END="webkitTransition"===i||"OTransition"===i?i+"End":"transitionend","onselectstart"in e)o.DomUtil.disableTextSelection=function(){o.DomEvent.on(t,"selectstart",o.DomEvent.preventDefault)},o.DomUtil.enableTextSelection=function(){o.DomEvent.off(t,"selectstart",o.DomEvent.preventDefault)};else{var n=o.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);o.DomUtil.disableTextSelection=function(){if(n){var t=e.documentElement.style;this._userSelect=t[n],t[n]="none"}},o.DomUtil.enableTextSelection=function(){n&amp;&amp;(e.documentElement.style[n]=this._userSelect,delete this._userSelect)}}o.DomUtil.disableImageDrag=function(){o.DomEvent.on(t,"dragstart",o.DomEvent.preventDefault)},o.DomUtil.enableImageDrag=function(){o.DomEvent.off(t,"dragstart",o.DomEvent.preventDefault)},o.DomUtil.preventOutline=function(e){for(;e.tabIndex===-1;)e=e.parentNode;e&amp;&amp;e.style&amp;&amp;(o.DomUtil.restoreOutline(),this._outlineElement=e,this._outlineStyle=e.style.outline,e.style.outline="none",o.DomEvent.on(t,"keydown",o.DomUtil.restoreOutline,this))},o.DomUtil.restoreOutline=function(){this._outlineElement&amp;&amp;(this._outlineElement.style.outline=this._outlineStyle,delete this._outlineElement,delete this._outlineStyle,o.DomEvent.off(t,"keydown",o.DomUtil.restoreOutline,this))}}(),o.LatLng=function(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,n!==i&amp;&amp;(this.alt=+n)},o.LatLng.prototype={equals:function(t,e){if(!t)return!1;t=o.latLng(t);var n=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return n&lt;=(e===i?1e-9:e)},toString:function(t){return"LatLng("+o.Util.formatNum(this.lat,t)+", "+o.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){return o.CRS.Earth.distance(this,o.latLng(t))},wrap:function(){return o.CRS.Earth.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return o.latLngBounds([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new o.LatLng(this.lat,this.lng,this.alt)}},o.latLng=function(t,e,n){return t instanceof o.LatLng?t:o.Util.isArray(t)&amp;&amp;"object"!=typeof t[0]?3===t.length?new o.LatLng(t[0],t[1],t[2]):2===t.length?new o.LatLng(t[0],t[1]):null:t===i||null===t?t:"object"==typeof t&amp;&amp;"lat"in t?new o.LatLng(t.lat,"lng"in t?t.lng:t.lon,t.alt):e===i?null:new o.LatLng(t,e,n)},o.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n&lt;o;n++)this.extend(i[n])},o.LatLngBounds.prototype={extend:function(t){var e,i,n=this._southWest,s=this._northEast;if(t instanceof o.LatLng)e=t,i=t;else{if(!(t instanceof o.LatLngBounds))return t?this.extend(o.latLng(t)||o.latLngBounds(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return n||s?(n.lat=Math.min(e.lat,n.lat),n.lng=Math.min(e.lng,n.lng),s.lat=Math.max(i.lat,s.lat),s.lng=Math.max(i.lng,s.lng)):(this._southWest=new o.LatLng(e.lat,e.lng),this._northEast=new o.LatLng(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,s=Math.abs(e.lng-i.lng)*t;return new o.LatLngBounds(new o.LatLng(e.lat-n,e.lng-s),new o.LatLng(i.lat+n,i.lng+s))},getCenter:function(){return new o.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new o.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new o.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof o.LatLng||"lat"in t?o.latLng(t):o.latLngBounds(t);var e,i,n=this._southWest,s=this._northEast;return t instanceof o.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat&gt;=n.lat&amp;&amp;i.lat&lt;=s.lat&amp;&amp;e.lng&gt;=n.lng&amp;&amp;i.lng&lt;=s.lng},intersects:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),r=s.lat&gt;=e.lat&amp;&amp;n.lat&lt;=i.lat,a=s.lng&gt;=e.lng&amp;&amp;n.lng&lt;=i.lng;return r&amp;&amp;a},overlaps:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),r=s.lat&gt;e.lat&amp;&amp;n.lat&lt;i.lat,a=s.lng&gt;e.lng&amp;&amp;n.lng&lt;i.lng;return r&amp;&amp;a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return!!t&amp;&amp;(t=o.latLngBounds(t),this._southWest.equals(t.getSouthWest())&amp;&amp;this._northEast.equals(t.getNorthEast()))},isValid:function(){return!(!this._southWest||!this._northEast)}},o.latLngBounds=function(t,e){return t instanceof o.LatLngBounds?t:new o.LatLngBounds(t,e)},o.Projection={},o.Projection.LonLat={project:function(t){return new o.Point(t.lng,t.lat)},unproject:function(t){return new o.LatLng(t.y,t.x)},bounds:o.bounds([-180,-90],[180,90])},o.Projection.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=Math.sin(n*e);return new o.Point(this.R*t.lng*e,this.R*Math.log((1+s)/(1-s))/2)},unproject:function(t){var e=180/Math.PI;return new o.LatLng((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=6378137*Math.PI;return o.bounds([-t,-t],[t,t])}()},o.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t),n=this.transformation.transform(e.min,i),s=this.transformation.transform(e.max,i);return o.bounds(n,s)},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?o.Util.wrapNum(t.lng,this.wrapLng,!0):t.lng,i=this.wrapLat?o.Util.wrapNum(t.lat,this.wrapLat,!0):t.lat,n=t.alt;return o.latLng(i,e,n)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),n=e.lat-i.lat,s=e.lng-i.lng;if(0===n&amp;&amp;0===s)return t;var r=t.getSouthWest(),a=t.getNorthEast(),h=o.latLng({lat:r.lat-n,lng:r.lng-s}),l=o.latLng({lat:a.lat-n,lng:a.lng-s});return new o.LatLngBounds(h,l)}},o.CRS.Simple=o.extend({},o.CRS,{projection:o.Projection.LonLat,transformation:new o.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,n=e.lat-t.lat;return Math.sqrt(i*i+n*n)},infinite:!0}),o.CRS.Earth=o.extend({},o.CRS,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,o=e.lat*i,s=Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos((e.lng-t.lng)*i);return this.R*Math.acos(Math.min(s,1))}}),o.CRS.EPSG3857=o.extend({},o.CRS.Earth,{code:"EPSG:3857",projection:o.Projection.SphericalMercator,transformation:function(){var t=.5/(Math.PI*o.Projection.SphericalMercator.R);return new o.Transformation(t,.5,-t,.5)}()}),o.CRS.EPSG900913=o.extend({},o.CRS.EPSG3857,{code:"EPSG:900913"}),o.CRS.EPSG4326=o.extend({},o.CRS.Earth,{code:"EPSG:4326",projection:o.Projection.LonLat,transformation:new o.Transformation(1/180,1,-1/180,.5)}),o.Map=o.Evented.extend({options:{crs:o.CRS.EPSG3857,center:i,zoom:i,minZoom:i,maxZoom:i,layers:[],maxBounds:i,renderer:i,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=o.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=o.bind(this._onResize,this),this._initEvents(),e.maxBounds&amp;&amp;this.setMaxBounds(e.maxBounds),e.zoom!==i&amp;&amp;(this._zoom=this._limitZoom(e.zoom)),e.center&amp;&amp;e.zoom!==i&amp;&amp;this.setView(o.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this.callInitHooks(),this._zoomAnimated=o.DomUtil.TRANSITION&amp;&amp;o.Browser.any3d&amp;&amp;!o.Browser.mobileOpera&amp;&amp;this.options.zoomAnimation,this._zoomAnimated&amp;&amp;(this._createAnimProxy(),o.DomEvent.on(this._proxy,o.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(o.latLng(t),e,this.options.maxBounds),n=n||{},this._stop(),this._loaded&amp;&amp;!n.reset&amp;&amp;n!==!0){n.animate!==i&amp;&amp;(n.zoom=o.extend({animate:n.animate},n.zoom),n.pan=o.extend({animate:n.animate,duration:n.duration},n.pan));var s=this._zoom!==e?this._tryAnimatedZoom&amp;&amp;this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(o.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(o.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),s=this.getSize().divideBy(2),r=t instanceof o.Point?t:this.latLngToContainerPoint(t),a=r.subtract(s).multiplyBy(1-1/n),h=this.containerPointToLatLng(s.add(a));return this.setView(h,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():o.latLngBounds(t);var i=o.point(e.paddingTopLeft||e.padding||[0,0]),n=o.point(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,i.add(n));s="number"==typeof e.maxZoom?Math.min(e.maxZoom,s):s;var r=n.subtract(i).divideBy(2),a=this.project(t.getSouthWest(),s),h=this.project(t.getNorthEast(),s),l=this.unproject(a.add(h).divideBy(2).add(r),s);return{center:l,zoom:s}},fitBounds:function(t,e){if(t=o.latLngBounds(t),!t.isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(t=o.point(t).round(),e=e||{},!t.x&amp;&amp;!t.y)return this.fire("moveend");if(e.animate!==!0&amp;&amp;!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new o.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){o.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){function s(t){var e=t?-1:1,i=t?v:g,n=v*v-g*g+e*L*L*y*y,o=2*i*L*y,s=n/o,r=Math.sqrt(s*s+1)-s,a=r&lt;1e-9?-18:Math.log(r);return a}function r(t){return(Math.exp(t)-Math.exp(-t))/2}function a(t){return(Math.exp(t)+Math.exp(-t))/2}function h(t){return r(t)/a(t)}function l(t){return g*(a(x)/a(x+P*t))}function u(t){return g*(a(x)*h(x+P*t)-r(x))/L}function c(t){return 1-Math.pow(1-t,1.5)}function d(){var i=(Date.now()-w)/T,n=c(i)*b;i&lt;=1?(this._flyToFrame=o.Util.requestAnimFrame(d,this),this._move(this.unproject(_.add(m.subtract(_).multiplyBy(u(n)/y)),f),this.getScaleZoom(g/l(n),f),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}if(n=n||{},n.animate===!1||!o.Browser.any3d)return this.setView(t,e,n);this._stop();var _=this.project(this.getCenter()),m=this.project(t),p=this.getSize(),f=this._zoom;t=o.latLng(t),e=e===i?f:e;var g=Math.max(p.x,p.y),v=g*this.getZoomScale(f,e),y=m.distanceTo(_)||1,P=1.42,L=P*P,x=s(0),w=Date.now(),b=(s(1)-x)/P,T=n.duration?1e3*n.duration:1e3*b*.8;return this._moveStart(!0),d.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return t=o.latLngBounds(t),t.isValid()?(this.options.maxBounds&amp;&amp;this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&amp;&amp;this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){return this.options.minZoom=t,this._loaded&amp;&amp;this.getZoom()&lt;this.options.minZoom?this.setZoom(t):this},setMaxZoom:function(t){return this.options.maxZoom=t,this._loaded&amp;&amp;this.getZoom()&gt;this.options.maxZoom?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),n=this._limitCenter(i,this._zoom,o.latLngBounds(t));return i.equals(n)||this.panTo(n,e),this._enforcingBounds=!1,this},invalidateSize:function(t){if(!this._loaded)return this;t=o.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),s=i.divideBy(2).round(),r=n.subtract(s);return r.x||r.y?(t.animate&amp;&amp;t.pan?this.panBy(r):(t.pan&amp;&amp;this._rawPanBy(r),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=o.extend({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=o.bind(this._handleGeolocationResponse,this),i=o.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&amp;&amp;navigator.geolocation.clearWatch&amp;&amp;navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&amp;&amp;(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&amp;&amp;!this._loaded&amp;&amp;this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new o.LatLng(e,i),s=n.toBounds(t.coords.accuracy),r=this._locateOptions;if(r.setView){var a=this.getBoundsZoom(s);this.setView(n,r.maxZoom?Math.min(a,r.maxZoom):a)}var h={latlng:n,bounds:s,timestamp:t.timestamp};for(var l in t.coords)"number"==typeof t.coords[l]&amp;&amp;(h[l]=t.coords[l]);this.fire("locationfound",h)},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&amp;&amp;i.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=i,this._containerId=i}o.DomUtil.remove(this._mapPane),this._clearControlPos&amp;&amp;this._clearControlPos(),this._clearHandlers(),this._loaded&amp;&amp;this.fire("unload");for(var t in this._layers)this._layers[t].remove();return this},createPane:function(t,e){var i="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),n=o.DomUtil.create("div",i,e||this._mapPane);return t&amp;&amp;(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&amp;&amp;!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new o.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=o.latLngBounds(t),i=o.point(i||[0,0]);var n=this.getZoom()||0,s=this.getMinZoom(),r=this.getMaxZoom(),a=t.getNorthWest(),h=t.getSouthEast(),l=this.getSize().subtract(i),u=o.bounds(this.project(h,n),this.project(a,n)).getSize(),c=o.Browser.any3d?this.options.zoomSnap:1,d=Math.min(l.x/u.x,l.y/u.y);return n=this.getScaleZoom(d,n),c&amp;&amp;(n=Math.round(n/(c/100))*(c/100),n=e?Math.ceil(n/c)*c:Math.floor(n/c)*c),Math.max(s,Math.min(r,n))},getSize:function(){return this._size&amp;&amp;!this._sizeChanged||(this._size=new o.Point(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new o.Bounds(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===i?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=e===i?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=e===i?this._zoom:e;var o=n.zoom(t*n.scale(e));return isNaN(o)?1/0:o},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(o.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(o.point(t),e)},layerPointToLatLng:function(t){var e=o.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(o.latLng(t))._round();return e._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(o.latLng(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(o.latLngBounds(t))},distance:function(t,e){return this.options.crs.distance(o.latLng(t),o.latLng(e))},containerPointToLayerPoint:function(t){return o.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return o.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(o.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(o.latLng(t)))},mouseEventToContainerPoint:function(t){return o.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=o.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");o.DomEvent.addListener(e,"scroll",this._onScroll,this),this._containerId=o.Util.stamp(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&amp;&amp;o.Browser.any3d,
o.DomUtil.addClass(t,"leaflet-container"+(o.Browser.touch?" leaflet-touch":"")+(o.Browser.retina?" leaflet-retina":"")+(o.Browser.ielt9?" leaflet-oldie":"")+(o.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=o.DomUtil.getStyle(t,"position");"absolute"!==e&amp;&amp;"relative"!==e&amp;&amp;"fixed"!==e&amp;&amp;(t.style.position="relative"),this._initPanes(),this._initControlPos&amp;&amp;this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),o.DomUtil.setPosition(this._mapPane,new o.Point(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(o.DomUtil.addClass(t.markerPane,"leaflet-zoom-hide"),o.DomUtil.addClass(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){o.DomUtil.setPosition(this._mapPane,new o.Point(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n)._move(t,e)._moveEnd(n),this.fire("viewreset"),i&amp;&amp;this.fire("load")},_moveStart:function(t){return t&amp;&amp;this.fire("zoomstart"),this.fire("movestart")},_move:function(t,e,n){e===i&amp;&amp;(e=this._zoom);var o=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(o||n&amp;&amp;n.pinch)&amp;&amp;this.fire("zoom",n),this.fire("move",n)},_moveEnd:function(t){return t&amp;&amp;this.fire("zoomend"),this.fire("moveend")},_stop:function(){return o.Util.cancelAnimFrame(this._flyToFrame),this._panAnim&amp;&amp;this._panAnim.stop(),this},_rawPanBy:function(t){o.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(o.DomEvent){this._targets={},this._targets[o.stamp(this._container)]=this;var i=e?"off":"on";o.DomEvent[i](this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&amp;&amp;o.DomEvent[i](t,"resize",this._onResize,this),o.Browser.any3d&amp;&amp;this.options.transform3DLimit&amp;&amp;this[i]("moveend",this._onMoveEnd)}},_onResize:function(){o.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=o.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))&gt;=this.options.transform3DLimit&amp;&amp;this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,n=[],s="mouseout"===e||"mouseover"===e,r=t.target||t.srcElement,a=!1;r;){if(i=this._targets[o.stamp(r)],i&amp;&amp;("click"===e||"preclick"===e)&amp;&amp;!t._simulated&amp;&amp;this._draggableMoved(i)){a=!0;break}if(i&amp;&amp;i.listens(e,!0)){if(s&amp;&amp;!o.DomEvent._isExternalTarget(r,t))break;if(n.push(i),s)break}if(r===this._container)break;r=r.parentNode}return n.length||a||s||!o.DomEvent._isExternalTarget(r,t)||(n=[this]),n},_handleDOMEvent:function(t){if(this._loaded&amp;&amp;!o.DomEvent._skipped(t)){var e="keypress"===t.type&amp;&amp;13===t.keyCode?"click":t.type;"mousedown"===e&amp;&amp;o.DomUtil.preventOutline(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_fireDOMEvent:function(t,e,i){if("click"===t.type){var n=o.Util.extend({},t);n.type="preclick",this._fireDOMEvent(n,n.type,i)}if(!t._stopped&amp;&amp;(i=(i||[]).concat(this._findEventTargets(t,e)),i.length)){var s=i[0];"contextmenu"===e&amp;&amp;s.listens(e,!0)&amp;&amp;o.DomEvent.preventDefault(t);var r={originalEvent:t};if("keypress"!==t.type){var a=s instanceof o.Marker;r.containerPoint=a?this.latLngToContainerPoint(s.getLatLng()):this.mouseEventToContainerPoint(t),r.layerPoint=this.containerPointToLayerPoint(r.containerPoint),r.latlng=a?s.getLatLng():this.layerPointToLatLng(r.layerPoint)}for(var h=0;h&lt;i.length;h++)if(i[h].fire(e,r,!0),r.originalEvent._stopped||i[h].options.nonBubblingEvents&amp;&amp;o.Util.indexOf(i[h].options.nonBubblingEvents,e)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&amp;&amp;t.dragging.enabled()?t:this,t.dragging&amp;&amp;t.dragging.moved()||this.boxZoom&amp;&amp;this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t&lt;e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return o.DomUtil.getPosition(this._mapPane)||new o.Point(0,0)},_moved:function(){var t=this._getMapPanePos();return t&amp;&amp;!t.equals([0,0])},_getTopLeftPoint:function(t,e){var n=t&amp;&amp;e!==i?this._getNewPixelOrigin(t,e):this.getPixelOrigin();return n.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(n)},_latLngBoundsToNewLayerBounds:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return o.bounds([this.project(t.getSouthWest(),e)._subtract(n),this.project(t.getNorthWest(),e)._subtract(n),this.project(t.getSouthEast(),e)._subtract(n),this.project(t.getNorthEast(),e)._subtract(n)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),s=this.getSize().divideBy(2),r=new o.Bounds(n.subtract(s),n.add(s)),a=this._getBoundsOffset(r,i,e);return a.round().equals([0,0])?t:this.unproject(n.add(a),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new o.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=o.bounds(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),s=n.min.subtract(t.min),r=n.max.subtract(t.max),a=this._rebound(s.x,-r.x),h=this._rebound(s.y,-r.y);return new o.Point(a,h)},_rebound:function(t,e){return t+e&gt;0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=o.Browser.any3d?this.options.zoomSnap:1;return n&amp;&amp;(t=Math.round(t/n)*n),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){o.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return!((e&amp;&amp;e.animate)!==!0&amp;&amp;!this.getSize().contains(i))&amp;&amp;(this.panBy(i,e),!0)},_createAnimProxy:function(){var t=this._proxy=o.DomUtil.create("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(e){var i=o.DomUtil.TRANSFORM,n=t.style[i];o.DomUtil.setTransform(t,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===t.style[i]&amp;&amp;this._animatingZoom&amp;&amp;this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var e=this.getCenter(),i=this.getZoom();o.DomUtil.setTransform(t,this.project(e,i),this.getZoomScale(i,1))},this)},_catchTransitionEnd:function(t){this._animatingZoom&amp;&amp;t.propertyName.indexOf("transform")&gt;=0&amp;&amp;this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)&gt;this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),s=this._getCenterOffset(t)._divideBy(1-1/n);return!(i.animate!==!0&amp;&amp;!this.getSize().contains(s))&amp;&amp;(o.Util.requestAnimFrame(function(){this._moveStart(!0)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,i,n){i&amp;&amp;(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,o.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:n}),setTimeout(o.bind(this._onZoomTransitionEnd,this),250)},_onZoomTransitionEnd:function(){this._animatingZoom&amp;&amp;(o.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),o.Util.requestAnimFrame(function(){this._moveEnd(!0)},this))}}),o.map=function(t,e){return new o.Map(t,e)},o.Layer=o.Evented.extend({options:{pane:"overlayPane",nonBubblingEvents:[],attribution:null},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&amp;&amp;t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[o.stamp(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[o.stamp(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",function(){e.off(i,this)},this)}this.onAdd(e),this.getAttribution&amp;&amp;e.attributionControl&amp;&amp;e.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),e.fire("layeradd",{layer:this})}}}),o.Map.include({addLayer:function(t){var e=o.stamp(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&amp;&amp;t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=o.stamp(t);return this._layers[e]?(this._loaded&amp;&amp;t.onRemove(this),t.getAttribution&amp;&amp;this.attributionControl&amp;&amp;this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&amp;&amp;(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return!!t&amp;&amp;o.stamp(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){t=t?o.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;e&lt;i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&amp;&amp;isNaN(t.options.minZoom)||(this._zoomBoundLayers[o.stamp(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=o.stamp(t);this._zoomBoundLayers[e]&amp;&amp;(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-(1/0),n=this._getZoomSpan();for(var o in this._zoomBoundLayers){var s=this._zoomBoundLayers[o].options;t=s.minZoom===i?t:Math.min(t,s.minZoom),e=s.maxZoom===i?e:Math.max(e,s.maxZoom)}this._layersMaxZoom=e===-(1/0)?i:e,this._layersMinZoom=t===1/0?i:t,n!==this._getZoomSpan()&amp;&amp;this.fire("zoomlevelschange"),this.options.maxZoom===i&amp;&amp;this._layersMaxZoom&amp;&amp;this.getZoom()&gt;this._layersMaxZoom&amp;&amp;this.setZoom(this._layersMaxZoom),this.options.minZoom===i&amp;&amp;this._layersMinZoom&amp;&amp;this.getZoom()&lt;this._layersMinZoom&amp;&amp;this.setZoom(this._layersMinZoom)}});var r="_leaflet_events";o.DomEvent={on:function(t,e,i,n){if("object"==typeof e)for(var s in e)this._on(t,s,e[s],i);else{e=o.Util.splitWords(e);for(var r=0,a=e.length;r&lt;a;r++)this._on(t,e[r],i,n)}return this},off:function(t,e,i,n){if("object"==typeof e)for(var s in e)this._off(t,s,e[s],i);else{e=o.Util.splitWords(e);for(var r=0,a=e.length;r&lt;a;r++)this._off(t,e[r],i,n)}return this},_on:function(e,i,n,s){var a=i+o.stamp(n)+(s?"_"+o.stamp(s):"");if(e[r]&amp;&amp;e[r][a])return this;var h=function(i){return n.call(s||e,i||t.event)},l=h;return o.Browser.pointer&amp;&amp;0===i.indexOf("touch")?this.addPointerListener(e,i,h,a):!o.Browser.touch||"dblclick"!==i||!this.addDoubleTapListener||o.Browser.pointer&amp;&amp;o.Browser.chrome?"addEventListener"in e?"mousewheel"===i?e.addEventListener("onwheel"in e?"wheel":"mousewheel",h,!1):"mouseenter"===i||"mouseleave"===i?(h=function(i){i=i||t.event,o.DomEvent._isExternalTarget(e,i)&amp;&amp;l(i)},e.addEventListener("mouseenter"===i?"mouseover":"mouseout",h,!1)):("click"===i&amp;&amp;o.Browser.android&amp;&amp;(h=function(t){return o.DomEvent._filterClick(t,l)}),e.addEventListener(i,h,!1)):"attachEvent"in e&amp;&amp;e.attachEvent("on"+i,h):this.addDoubleTapListener(e,h,a),e[r]=e[r]||{},e[r][a]=h,this},_off:function(t,e,i,n){var s=e+o.stamp(i)+(n?"_"+o.stamp(n):""),a=t[r]&amp;&amp;t[r][s];return a?(o.Browser.pointer&amp;&amp;0===e.indexOf("touch")?this.removePointerListener(t,e,s):o.Browser.touch&amp;&amp;"dblclick"===e&amp;&amp;this.removeDoubleTapListener?this.removeDoubleTapListener(t,s):"removeEventListener"in t?"mousewheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",a,!1):t.removeEventListener("mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,a,!1):"detachEvent"in t&amp;&amp;t.detachEvent("on"+e,a),t[r][s]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,o.DomEvent._skipped(t),this},disableScrollPropagation:function(t){return o.DomEvent.on(t,"mousewheel",o.DomEvent.stopPropagation)},disableClickPropagation:function(t){var e=o.DomEvent.stopPropagation;return o.DomEvent.on(t,o.Draggable.START.join(" "),e),o.DomEvent.on(t,{click:o.DomEvent._fakeStop,dblclick:e})},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return o.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new o.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new o.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},_wheelPxFactor:o.Browser.win&amp;&amp;o.Browser.chrome?2:o.Browser.gecko?t.devicePixelRatio:1,getWheelDelta:function(t){return o.Browser.edge?t.wheelDeltaY/2:t.deltaY&amp;&amp;0===t.deltaMode?-t.deltaY/o.DomEvent._wheelPxFactor:t.deltaY&amp;&amp;1===t.deltaMode?20*-t.deltaY:t.deltaY&amp;&amp;2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&amp;&amp;Math.abs(t.detail)&lt;32765?20*-t.detail:t.detail?t.detail/-32765*60:0},_skipEvents:{},_fakeStop:function(t){o.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_isExternalTarget:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&amp;&amp;i!==t;)i=i.parentNode}catch(t){return!1}return i!==t},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent&amp;&amp;t.originalEvent.timeStamp,n=o.DomEvent._lastClick&amp;&amp;i-o.DomEvent._lastClick;return n&amp;&amp;n&gt;100&amp;&amp;n&lt;500||t.target._simulatedClick&amp;&amp;!t._simulated?void o.DomEvent.stop(t):(o.DomEvent._lastClick=i,void e(t))}},o.DomEvent.addListener=o.DomEvent.on,o.DomEvent.removeListener=o.DomEvent.off,o.PosAnimation=o.Evented.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=o.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&amp;&amp;(this._step(!0),this._complete())},_animate:function(){this._animId=o.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e&lt;i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&amp;&amp;i._round(),o.DomUtil.setPosition(this._el,i),this.fire("step")},_complete:function(){o.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),o.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:o.bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,n=t.lat*e,s=this.R_MINOR/i,r=Math.sqrt(1-s*s),a=r*Math.sin(n),h=Math.tan(Math.PI/4-n/2)/Math.pow((1-a)/(1+a),r/2);return n=-i*Math.log(Math.max(h,1e-10)),new o.Point(t.lng*e*i,n)},unproject:function(t){for(var e,i=180/Math.PI,n=this.R,s=this.R_MINOR/n,r=Math.sqrt(1-s*s),a=Math.exp(-t.y/n),h=Math.PI/2-2*Math.atan(a),l=0,u=.1;l&lt;15&amp;&amp;Math.abs(u)&gt;1e-7;l++)e=r*Math.sin(h),e=Math.pow((1-e)/(1+e),r/2),u=Math.PI/2-2*Math.atan(a*e)-h,h+=u;return new o.LatLng(h*i,t.x*i/n)}},o.CRS.EPSG3395=o.extend({},o.CRS.Earth,{code:"EPSG:3395",projection:o.Projection.Mercator,transformation:function(){var t=.5/(Math.PI*o.Projection.Mercator.R);return new o.Transformation(t,.5,-t,.5)}()}),o.GridLayer=o.Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:o.Browser.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:i,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){o.setOptions(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),o.DomUtil.remove(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=null},bringToFront:function(){return this._map&amp;&amp;(o.DomUtil.toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&amp;&amp;(o.DomUtil.toBack(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&amp;&amp;(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=o.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&amp;&amp;(t.zoomanim=this._animateZoom),t},createTile:function(){return e.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof o.Point?t:new o.Point(t,t)},_updateZIndex:function(){this._container&amp;&amp;this.options.zIndex!==i&amp;&amp;null!==this.options.zIndex&amp;&amp;(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,n=-t(-(1/0),1/0),o=0,s=i.length;o&lt;s;o++)e=i[o].style.zIndex,i[o]!==this._container&amp;&amp;e&amp;&amp;(n=t(n,+e));isFinite(n)&amp;&amp;(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&amp;&amp;!o.Browser.ielt9){o.DomUtil.setOpacity(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var n in this._tiles){var s=this._tiles[n];if(s.current&amp;&amp;s.loaded){var r=Math.min(1,(t-s.loaded)/200);o.DomUtil.setOpacity(s.el,r),r&lt;1?e=!0:(s.active&amp;&amp;(i=!0),s.active=!0)}}i&amp;&amp;!this._noPrune&amp;&amp;this._pruneTiles(),e&amp;&amp;(o.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=o.Util.requestAnimFrame(this._updateOpacity,this))}},_initContainer:function(){this._container||(this._container=o.DomUtil.create("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity&lt;1&amp;&amp;this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(t===i)return i;for(var n in this._levels)this._levels[n].el.children.length||n===t?this._levels[n].el.style.zIndex=e-Math.abs(t-n):(o.DomUtil.remove(this._levels[n].el),this._removeTilesAtZoom(n),delete this._levels[n]);var s=this._levels[t],r=this._map;return s||(s=this._levels[t]={},s.el=o.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),s.el.style.zIndex=e,s.origin=r.project(r.unproject(r.getPixelOrigin()),t).round(),s.zoom=t,this._setZoomTransform(s,r.getCenter(),r.getZoom()),o.Util.falseFn(s.el.offsetWidth)),this._level=s,s},_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i&gt;this.options.maxZoom||i&lt;this.options.minZoom)return void this._removeAllTiles();for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&amp;&amp;!e.active){var n=e.coords;this._retainParent(n.x,n.y,n.z,n.z-5)||this._retainChildren(n.x,n.y,n.z,n.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&amp;&amp;this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)o.DomUtil.remove(this._levels[t].el),delete this._levels[t];this._removeAllTiles(),this._tileZoom=null},_retainParent:function(t,e,i,n){var s=Math.floor(t/2),r=Math.floor(e/2),a=i-1,h=new o.Point(+s,+r);h.z=+a;var l=this._tileCoordsToKey(h),u=this._tiles[l];return u&amp;&amp;u.active?(u.retain=!0,!0):(u&amp;&amp;u.loaded&amp;&amp;(u.retain=!0),a&gt;n&amp;&amp;this._retainParent(s,r,a,n))},_retainChildren:function(t,e,i,n){for(var s=2*t;s&lt;2*t+2;s++)for(var r=2*e;r&lt;2*e+2;r++){var a=new o.Point(s,r);a.z=i+1;var h=this._tileCoordsToKey(a),l=this._tiles[h];l&amp;&amp;l.active?l.retain=!0:(l&amp;&amp;l.loaded&amp;&amp;(l.retain=!0),i+1&lt;n&amp;&amp;this._retainChildren(s,r,i+1,n))}},_resetView:function(t){var e=t&amp;&amp;(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_setView:function(t,e,n,o){var s=Math.round(e);(this.options.maxZoom!==i&amp;&amp;s&gt;this.options.maxZoom||this.options.minZoom!==i&amp;&amp;s&lt;this.options.minZoom)&amp;&amp;(s=i);var r=this.options.updateWhenZooming&amp;&amp;s!==this._tileZoom;o&amp;&amp;!r||(this._tileZoom=s,this._abortLoading&amp;&amp;this._abortLoading(),this._updateLevels(),this._resetGrid(),s!==i&amp;&amp;this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var n=this._map.getZoomScale(i,t.zoom),s=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(e,i)).round();o.Browser.any3d?o.DomUtil.setTransform(t.el,s,n):o.DomUtil.setPosition(t.el,s)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),n=this._tileZoom,o=this._map.getPixelWorldBounds(this._tileZoom);o&amp;&amp;(this._globalTileRange=this._pxBoundsToTileRange(o)),this._wrapX=e.wrapLng&amp;&amp;!this.options.noWrap&amp;&amp;[Math.floor(t.project([0,e.wrapLng[0]],n).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],n).x/i.y)],this._wrapY=e.wrapLat&amp;&amp;!this.options.noWrap&amp;&amp;[Math.floor(t.project([e.wrapLat[0],0],n).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],n).y/i.y)]},_onMoveEnd:function(){this._map&amp;&amp;!this._map._animatingZoom&amp;&amp;this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),n=e.getZoomScale(i,this._tileZoom),s=e.project(t,this._tileZoom).floor(),r=e.getSize().divideBy(2*n);return new o.Bounds(s.subtract(r),s.add(r))},_update:function(t){var n=this._map;if(n){var s=n.getZoom();if(t===i&amp;&amp;(t=n.getCenter()),this._tileZoom!==i){var r=this._getTiledPixelBounds(t),a=this._pxBoundsToTileRange(r),h=a.getCenter(),l=[],u=this.options.keepBuffer,c=new o.Bounds(a.getBottomLeft().subtract([u,-u]),a.getTopRight().add([u,-u]));for(var d in this._tiles){var _=this._tiles[d].coords;_.z===this._tileZoom&amp;&amp;c.contains(o.point(_.x,_.y))||(this._tiles[d].current=!1)}if(Math.abs(s-this._tileZoom)&gt;1)return void this._setView(t,s);for(var m=a.min.y;m&lt;=a.max.y;m++)for(var p=a.min.x;p&lt;=a.max.x;p++){var f=new o.Point(p,m);if(f.z=this._tileZoom,this._isValidTile(f)){var g=this._tiles[this._tileCoordsToKey(f)];g?g.current=!0:l.push(f)}}if(l.sort(function(t,e){return t.distanceTo(h)-e.distanceTo(h)}),0!==l.length){this._loading||(this._loading=!0,this.fire("loading"));var v=e.createDocumentFragment();for(p=0;p&lt;l.length;p++)this._addTile(l[p],v);this._level.el.appendChild(v)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&amp;&amp;(t.x&lt;i.min.x||t.x&gt;i.max.x)||!e.wrapLat&amp;&amp;(t.y&lt;i.min.y||t.y&gt;i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return o.latLngBounds(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToBounds:function(t){var e=this._map,i=this.getTileSize(),n=t.scaleBy(i),s=n.add(i),r=e.unproject(n,t.z),a=e.unproject(s,t.z),h=new o.LatLngBounds(r,a);return this.options.noWrap||e.wrapLatLngBounds(h),h},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new o.Point(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&amp;&amp;(o.DomUtil.remove(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){o.DomUtil.addClass(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=o.Util.falseFn,t.onmousemove=o.Util.falseFn,o.Browser.ielt9&amp;&amp;this.options.opacity&lt;1&amp;&amp;o.DomUtil.setOpacity(t,this.options.opacity),o.Browser.android&amp;&amp;!o.Browser.android23&amp;&amp;(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var i=this._getTilePos(t),n=this._tileCoordsToKey(t),s=this.createTile(this._wrapCoords(t),o.bind(this._tileReady,this,t));this._initTile(s),this.createTile.length&lt;2&amp;&amp;o.Util.requestAnimFrame(o.bind(this._tileReady,this,t,null,s)),o.DomUtil.setPosition(s,i),this._tiles[n]={el:s,coords:t,current:!0},e.appendChild(s),this.fire("tileloadstart",{tile:s,coords:t})},_tileReady:function(t,e,i){if(this._map){e&amp;&amp;this.fire("tileerror",{error:e,tile:i,coords:t});var n=this._tileCoordsToKey(t);i=this._tiles[n],i&amp;&amp;(i.loaded=+new Date,this._map._fadeAnimated?(o.DomUtil.setOpacity(i.el,0),o.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=o.Util.requestAnimFrame(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(o.DomUtil.addClass(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&amp;&amp;(this._loading=!1,this.fire("load"),o.Browser.ielt9||!this._map._fadeAnimated?o.Util.requestAnimFrame(this._pruneTiles,this):setTimeout(o.bind(this._pruneTiles,this),250)))}},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new o.Point(this._wrapX?o.Util.wrapNum(t.x,this._wrapX):t.x,this._wrapY?o.Util.wrapNum(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new o.Bounds(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),o.gridLayer=function(t){return new o.GridLayer(t)},o.TileLayer=o.GridLayer.extend({options:{minZoom:0,maxZoom:18,maxNativeZoom:null,minNativeZoom:null,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,e=o.setOptions(this,e),e.detectRetina&amp;&amp;o.Browser.retina&amp;&amp;e.maxZoom&gt;0&amp;&amp;(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&amp;&amp;(e.subdomains=e.subdomains.split("")),o.Browser.android||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},createTile:function(t,i){var n=e.createElement("img");return o.DomEvent.on(n,"load",o.bind(this._tileOnLoad,this,i,n)),o.DomEvent.on(n,"error",o.bind(this._tileOnError,this,i,n)),this.options.crossOrigin&amp;&amp;(n.crossOrigin=""),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(t),n},getTileUrl:function(t){var e={r:o.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&amp;&amp;!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&amp;&amp;(e.y=i),e["-y"]=i}return o.Util.template(this._url,o.extend(e,this.options))},_tileOnLoad:function(t,e){o.Browser.ielt9?setTimeout(o.bind(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var n=this.options.errorTileUrl;n&amp;&amp;e.src!==n&amp;&amp;(e.src=n),t(i,e)},getTileSize:function(){var t=this._map,e=o.GridLayer.prototype.getTileSize.call(this),i=this._tileZoom+this.options.zoomOffset,n=this.options.minNativeZoom,s=this.options.maxNativeZoom;return null!==n&amp;&amp;i&lt;n?e.divideBy(t.getZoomScale(n,i)).round():null!==s&amp;&amp;i&gt;s?e.divideBy(t.getZoomScale(s,i)).round():e},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom,i=this.options.zoomReverse,n=this.options.zoomOffset,o=this.options.minNativeZoom,s=this.options.maxNativeZoom;return i&amp;&amp;(t=e-t),t+=n,null!==o&amp;&amp;t&lt;o?o:null!==s&amp;&amp;t&gt;s?s:t},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&amp;&amp;(e=this._tiles[t].el,e.onload=o.Util.falseFn,e.onerror=o.Util.falseFn,e.complete||(e.src=o.Util.emptyImageUrl,o.DomUtil.remove(e)))}}),o.tileLayer=function(t,e){return new o.TileLayer(t,e)},o.TileLayer.WMS=o.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var i=o.extend({},this.defaultWmsParams);for(var n in e)n in this.options||(i[n]=e[n]);e=o.setOptions(this,e),i.width=i.height=e.tileSize*(e.detectRetina&amp;&amp;o.Browser.retina?2:1),this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion&gt;=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,o.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToBounds(t),i=this._crs.project(e.getNorthWest()),n=this._crs.project(e.getSouthEast()),s=(this._wmsVersion&gt;=1.3&amp;&amp;this._crs===o.CRS.EPSG4326?[n.y,i.x,i.y,n.x]:[i.x,n.y,n.x,i.y]).join(","),r=o.TileLayer.prototype.getTileUrl.call(this,t);return r+o.Util.getParamString(this.wmsParams,r,this.options.uppercase)+(this.options.uppercase?"&amp;BBOX=":"&amp;bbox=")+s},setParams:function(t,e){return o.extend(this.wmsParams,t),e||this.redraw(),this}}),o.tileLayer.wms=function(t,e){return new o.TileLayer.WMS(t,e)},o.ImageOverlay=o.Layer.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1},initialize:function(t,e,i){this._url=t,this._bounds=o.latLngBounds(e),o.setOptions(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity&lt;1&amp;&amp;this._updateOpacity()),this.options.interactive&amp;&amp;(o.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){o.DomUtil.remove(this._image),this.options.interactive&amp;&amp;this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&amp;&amp;this._updateOpacity(),this},setStyle:function(t){return t.opacity&amp;&amp;this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&amp;&amp;o.DomUtil.toFront(this._image),this},bringToBack:function(){return this._map&amp;&amp;o.DomUtil.toBack(this._image),this},setUrl:function(t){return this._url=t,this._image&amp;&amp;(this._image.src=t),this},setBounds:function(t){return this._bounds=t,this._map&amp;&amp;this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&amp;&amp;(t.zoomanim=this._animateZoom),t},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._image=o.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));t.onselectstart=o.Util.falseFn,t.onmousemove=o.Util.falseFn,t.onload=o.bind(this.fire,this,"load"),this.options.crossOrigin&amp;&amp;(t.crossOrigin=""),t.src=this._url,t.alt=this.options.alt},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;
o.DomUtil.setTransform(this._image,i,e)},_reset:function(){var t=this._image,e=new o.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();o.DomUtil.setPosition(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){o.DomUtil.setOpacity(this._image,this.options.opacity)}}),o.imageOverlay=function(t,e,i){return new o.ImageOverlay(t,e,i)},o.Icon=o.Class.extend({initialize:function(t){o.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(i,e&amp;&amp;"IMG"===e.tagName?e:null);return this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i=this.options,n=i[e+"Size"];"number"==typeof n&amp;&amp;(n=[n,n]);var s=o.point(n),r=o.point("shadow"===e&amp;&amp;i.shadowAnchor||i.iconAnchor||s&amp;&amp;s.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),r&amp;&amp;(t.style.marginLeft=-r.x+"px",t.style.marginTop=-r.y+"px"),s&amp;&amp;(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return o.Browser.retina&amp;&amp;this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),o.icon=function(t){return new o.Icon(t)},o.Icon.Default=o.Icon.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return o.Icon.Default.imagePath||(o.Icon.Default.imagePath=this._detectIconPath()),(this.options.imagePath||o.Icon.Default.imagePath)+o.Icon.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=o.DomUtil.create("div","leaflet-default-icon-path",e.body),i=o.DomUtil.getStyle(t,"background-image")||o.DomUtil.getStyle(t,"backgroundImage");return e.body.removeChild(t),0===i.indexOf("url")?i.replace(/^url\([\"\']?/,"").replace(/marker-icon\.png[\"\']?\)$/,""):""}}),o.Marker=o.Layer.extend({options:{icon:new o.Icon.Default,interactive:!0,draggable:!1,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",nonBubblingEvents:["click","dblclick","mouseover","mouseout","contextmenu"]},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&amp;&amp;t.options.markerZoomAnimation,this._zoomAnimated&amp;&amp;t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&amp;&amp;this.dragging.enabled()&amp;&amp;(this.options.draggable=!0,this.dragging.removeHooks()),this._zoomAnimated&amp;&amp;t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=o.latLng(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},setIcon:function(t){return this.options.icon=t,this._map&amp;&amp;(this._initIcon(),this.update()),this._popup&amp;&amp;this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),n=!1;i!==this._icon&amp;&amp;(this._icon&amp;&amp;this._removeIcon(),n=!0,t.title&amp;&amp;(i.title=t.title),t.alt&amp;&amp;(i.alt=t.alt)),o.DomUtil.addClass(i,e),t.keyboard&amp;&amp;(i.tabIndex="0"),this._icon=i,t.riseOnHover&amp;&amp;this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var s=t.icon.createShadow(this._shadow),r=!1;s!==this._shadow&amp;&amp;(this._removeShadow(),r=!0),s&amp;&amp;(o.DomUtil.addClass(s,e),s.alt=""),this._shadow=s,t.opacity&lt;1&amp;&amp;this._updateOpacity(),n&amp;&amp;this.getPane().appendChild(this._icon),this._initInteraction(),s&amp;&amp;r&amp;&amp;this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&amp;&amp;this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),o.DomUtil.remove(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&amp;&amp;o.DomUtil.remove(this._shadow),this._shadow=null},_setPos:function(t){o.DomUtil.setPosition(this._icon,t),this._shadow&amp;&amp;o.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&amp;&amp;(o.DomUtil.addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),o.Handler.MarkerDrag)){var t=this.options.draggable;this.dragging&amp;&amp;(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new o.Handler.MarkerDrag(this),t&amp;&amp;this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&amp;&amp;this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;o.DomUtil.setOpacity(this._icon,t),this._shadow&amp;&amp;o.DomUtil.setOpacity(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor||[0,0]},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor||[0,0]}}),o.marker=function(t,e){return new o.Marker(t,e)},o.DivIcon=o.Icon.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var i=t&amp;&amp;"DIV"===t.tagName?t:e.createElement("div"),n=this.options;if(i.innerHTML=n.html!==!1?n.html:"",n.bgPos){var s=o.point(n.bgPos);i.style.backgroundPosition=-s.x+"px "+-s.y+"px"}return this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),o.divIcon=function(t){return new o.DivIcon(t)},o.DivOverlay=o.Layer.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){o.setOptions(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&amp;&amp;o.DomUtil.setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&amp;&amp;o.DomUtil.setOpacity(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(o.DomUtil.setOpacity(this._container,0),this._removeTimeout=setTimeout(o.bind(o.DomUtil.remove,o.DomUtil,this._container),200)):o.DomUtil.remove(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this._map&amp;&amp;(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&amp;&amp;(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&amp;&amp;(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&amp;&amp;this._map.hasLayer(this)},bringToFront:function(){return this._map&amp;&amp;o.DomUtil.toFront(this._container),this},bringToBack:function(){return this._map&amp;&amp;o.DomUtil.toBack(this._container),this},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=o.point(this.options.offset),i=this._getAnchor();this._zoomAnimated?o.DomUtil.setPosition(this._container,t.add(i)):e=e.add(t).add(i);var n=this._containerBottom=-e.y,s=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=n+"px",this._container.style.left=s+"px"}},_getAnchor:function(){return[0,0]}}),o.Popup=o.DivOverlay.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){o.DivOverlay.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&amp;&amp;(this._source.fire("popupopen",{popup:this},!0),this._source instanceof o.Path||this._source.on("preclick",o.DomEvent.stopPropagation))},onRemove:function(t){o.DivOverlay.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&amp;&amp;(this._source.fire("popupclose",{popup:this},!0),this._source instanceof o.Path||this._source.off("preclick",o.DomEvent.stopPropagation))},getEvents:function(){var t=o.DivOverlay.prototype.getEvents.call(this);return("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&amp;&amp;(t.preclick=this._close),this.options.keepInView&amp;&amp;(t.moveend=this._adjustPan),t},_close:function(){this._map&amp;&amp;this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=o.DomUtil.create("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated");if(this.options.closeButton){var i=this._closeButton=o.DomUtil.create("a",t+"-close-button",e);i.href="#close",i.innerHTML="&amp;#215;",o.DomEvent.on(i,"click",this._onCloseButtonClick,this)}var n=this._wrapper=o.DomUtil.create("div",t+"-content-wrapper",e);this._contentNode=o.DomUtil.create("div",t+"-content",n),o.DomEvent.disableClickPropagation(n).disableScrollPropagation(this._contentNode).on(n,"contextmenu",o.DomEvent.stopPropagation),this._tipContainer=o.DomUtil.create("div",t+"-tip-container",e),this._tip=o.DomUtil.create("div",t+"-tip",this._tipContainer)},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,s=this.options.maxHeight,r="leaflet-popup-scrolled";s&amp;&amp;n&gt;s?(e.height=s+"px",o.DomUtil.addClass(t,r)):o.DomUtil.removeClass(t,r),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();o.DomUtil.setPosition(this._container,e.add(i))},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&amp;&amp;this._map._panAnim._inProgress)){var t=this._map,e=parseInt(o.DomUtil.getStyle(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,n=this._containerWidth,s=new o.Point(this._containerLeft,-i-this._containerBottom);s._add(o.DomUtil.getPosition(this._container));var r=t.layerPointToContainerPoint(s),a=o.point(this.options.autoPanPadding),h=o.point(this.options.autoPanPaddingTopLeft||a),l=o.point(this.options.autoPanPaddingBottomRight||a),u=t.getSize(),c=0,d=0;r.x+n+l.x&gt;u.x&amp;&amp;(c=r.x+n-u.x+l.x),r.x-c-h.x&lt;0&amp;&amp;(c=r.x-h.x),r.y+i+l.y&gt;u.y&amp;&amp;(d=r.y+i-u.y+l.y),r.y-d-h.y&lt;0&amp;&amp;(d=r.y-h.y),(c||d)&amp;&amp;t.fire("autopanstart").panBy([c,d])}},_onCloseButtonClick:function(t){this._close(),o.DomEvent.stop(t)},_getAnchor:function(){return o.point(this._source&amp;&amp;this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),o.popup=function(t,e){return new o.Popup(t,e)},o.Map.mergeOptions({closePopupOnClick:!0}),o.Map.include({openPopup:function(t,e,i){return t instanceof o.Popup||(t=new o.Popup(i).setContent(t)),e&amp;&amp;t.setLatLng(e),this.hasLayer(t)?this:(this._popup&amp;&amp;this._popup.options.autoClose&amp;&amp;this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&amp;&amp;t!==this._popup||(t=this._popup,this._popup=null),t&amp;&amp;this.removeLayer(t),this}}),o.Layer.include({bindPopup:function(t,e){return t instanceof o.Popup?(o.setOptions(t,e),this._popup=t,t._source=this):(this._popup&amp;&amp;!e||(this._popup=new o.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&amp;&amp;(this.off({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){if(t instanceof o.Layer||(e=t,t=this),t instanceof o.FeatureGroup)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._popup&amp;&amp;this._map&amp;&amp;(this._popup._source=t,this._popup.update(),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&amp;&amp;this._popup._close(),this},togglePopup:function(t){return this._popup&amp;&amp;(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return!!this._popup&amp;&amp;this._popup.isOpen()},setPopupContent:function(t){return this._popup&amp;&amp;this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;if(this._popup&amp;&amp;this._map)return o.DomEvent.stop(t),e instanceof o.Path?void this.openPopup(t.layer||t.target,t.latlng):void(this._map.hasLayer(this._popup)&amp;&amp;this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),o.Tooltip=o.DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){o.DivOverlay.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&amp;&amp;this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){o.DivOverlay.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&amp;&amp;this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=o.DivOverlay.prototype.getEvents.call(this);return o.Browser.touch&amp;&amp;!this.options.permanent&amp;&amp;(t.preclick=this._close),t},_close:function(){this._map&amp;&amp;this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip",e=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=o.DomUtil.create("div",e)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e=this._map,i=this._container,n=e.latLngToContainerPoint(e.getCenter()),s=e.layerPointToContainerPoint(t),r=this.options.direction,a=i.offsetWidth,h=i.offsetHeight,l=o.point(this.options.offset),u=this._getAnchor();"top"===r?t=t.add(o.point(-a/2+l.x,-h+l.y+u.y,!0)):"bottom"===r?t=t.subtract(o.point(a/2-l.x,-l.y,!0)):"center"===r?t=t.subtract(o.point(a/2+l.x,h/2-u.y+l.y,!0)):"right"===r||"auto"===r&amp;&amp;s.x&lt;n.x?(r="right",t=t.add(o.point(l.x+u.x,u.y-h/2+l.y,!0))):(r="left",t=t.subtract(o.point(a+u.x-l.x,h/2-u.y-l.y,!0))),o.DomUtil.removeClass(i,"leaflet-tooltip-right"),o.DomUtil.removeClass(i,"leaflet-tooltip-left"),o.DomUtil.removeClass(i,"leaflet-tooltip-top"),o.DomUtil.removeClass(i,"leaflet-tooltip-bottom"),o.DomUtil.addClass(i,"leaflet-tooltip-"+r),o.DomUtil.setPosition(i,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&amp;&amp;o.DomUtil.setOpacity(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return o.point(this._source&amp;&amp;this._source._getTooltipAnchor&amp;&amp;!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),o.tooltip=function(t,e){return new o.Tooltip(t,e)},o.Map.include({openTooltip:function(t,e,i){return t instanceof o.Tooltip||(t=new o.Tooltip(i).setContent(t)),e&amp;&amp;t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&amp;&amp;this.removeLayer(t),this}}),o.Layer.include({bindTooltip:function(t,e){return t instanceof o.Tooltip?(o.setOptions(t,e),this._tooltip=t,t._source=this):(this._tooltip&amp;&amp;!e||(this._tooltip=o.tooltip(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&amp;&amp;this._map&amp;&amp;this._map.hasLayer(this)&amp;&amp;this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&amp;&amp;(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,this._tooltip.options.sticky&amp;&amp;(i.mousemove=this._moveTooltip),o.Browser.touch&amp;&amp;(i.click=this._openTooltip)),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){if(t instanceof o.Layer||(e=t,t=this),t instanceof o.FeatureGroup)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._tooltip&amp;&amp;this._map&amp;&amp;(this._tooltip._source=t,this._tooltip.update(),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&amp;&amp;this._tooltip._container&amp;&amp;(o.DomUtil.addClass(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&amp;&amp;(this._tooltip._close(),this._tooltip.options.interactive&amp;&amp;this._tooltip._container&amp;&amp;(o.DomUtil.removeClass(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&amp;&amp;(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&amp;&amp;this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&amp;&amp;this._map&amp;&amp;this.openTooltip(e,this._tooltip.options.sticky?t.latlng:i)},_moveTooltip:function(t){var e,i,n=t.latlng;this._tooltip.options.sticky&amp;&amp;t.originalEvent&amp;&amp;(e=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(e),n=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(n)}}),o.LayerGroup=o.Layer.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;e&lt;i;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&amp;&amp;this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&amp;&amp;this._layers[e]&amp;&amp;this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&amp;&amp;(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){for(var t in this._layers)this.removeLayer(this._layers[t]);return this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&amp;&amp;i[t].apply(i,n);return this},onAdd:function(t){for(var e in this._layers)t.addLayer(this._layers[e])},onRemove:function(t){for(var e in this._layers)t.removeLayer(this._layers[e])},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o.stamp(t)}}),o.layerGroup=function(t){return new o.LayerGroup(t)},o.FeatureGroup=o.LayerGroup.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),o.LayerGroup.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&amp;&amp;(t=this._layers[t]),t.removeEventParent(this),o.LayerGroup.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new o.LatLngBounds;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),o.featureGroup=function(t){return new o.FeatureGroup(t)},o.Renderer=o.Layer.extend({options:{padding:.1},initialize:function(t){o.setOptions(this,t),o.stamp(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&amp;&amp;o.DomUtil.addClass(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){o.DomUtil.remove(this._container),this.off("update",this._updatePaths,this)},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&amp;&amp;(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),n=o.DomUtil.getPosition(this._container),s=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,e),a=this._map.project(t,e),h=a.subtract(r),l=s.multiplyBy(-i).add(n).add(s).subtract(h);o.Browser.any3d?o.DomUtil.setTransform(this._container,l,i):o.DomUtil.setPosition(this._container,l)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new o.Bounds(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),o.Map.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this.options.preferCanvas&amp;&amp;o.canvas()||o.svg()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||t===i)return!1;var e=this._paneRenderers[t];return e===i&amp;&amp;(e=o.SVG&amp;&amp;o.svg({pane:t})||o.Canvas&amp;&amp;o.canvas({pane:t}),this._paneRenderers[t]=e),e}}),o.Path=o.Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&amp;&amp;this._renderer._updatePath(this),this},setStyle:function(t){return o.setOptions(this,t),this._renderer&amp;&amp;this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&amp;&amp;this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&amp;&amp;this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(o.Browser.touch?10:0)}}),o.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,o=typeof Uint8Array!=i+""?Uint8Array:Array,s=new o(n);s[0]=s[n-1]=1,this._simplifyDPStep(t,s,e,0,n-1);var r,a=[];for(r=0;r&lt;n;r++)s[r]&amp;&amp;a.push(t[r]);return a},_simplifyDPStep:function(t,e,i,n,o){var s,r,a,h=0;for(r=n+1;r&lt;=o-1;r++)a=this._sqClosestPointOnSegment(t[r],t[n],t[o],!0),a&gt;h&amp;&amp;(s=r,h=a);h&gt;i&amp;&amp;(e[s]=1,this._simplifyDPStep(t,e,i,n,s),this._simplifyDPStep(t,e,i,s,o))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,o=0,s=t.length;n&lt;s;n++)this._sqDist(t[n],t[o])&gt;e&amp;&amp;(i.push(t[n]),o=n);return o&lt;s-1&amp;&amp;i.push(t[s-1]),i},clipSegment:function(t,e,i,n,o){var s,r,a,h=n?this._lastCode:this._getBitCode(t,i),l=this._getBitCode(e,i);for(this._lastCode=l;;){if(!(h|l))return[t,e];if(h&amp;l)return!1;s=h||l,r=this._getEdgeIntersection(t,e,s,i,o),a=this._getBitCode(r,i),s===h?(t=r,h=a):(e=r,l=a)}},_getEdgeIntersection:function(t,e,i,n,s){var r,a,h=e.x-t.x,l=e.y-t.y,u=n.min,c=n.max;return 8&amp;i?(r=t.x+h*(c.y-t.y)/l,a=c.y):4&amp;i?(r=t.x+h*(u.y-t.y)/l,a=u.y):2&amp;i?(r=c.x,a=t.y+l*(c.x-t.x)/h):1&amp;i&amp;&amp;(r=u.x,a=t.y+l*(u.x-t.x)/h),new o.Point(r,a,s)},_getBitCode:function(t,e){var i=0;return t.x&lt;e.min.x?i|=1:t.x&gt;e.max.x&amp;&amp;(i|=2),t.y&lt;e.min.y?i|=4:t.y&gt;e.max.y&amp;&amp;(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var s,r=e.x,a=e.y,h=i.x-r,l=i.y-a,u=h*h+l*l;return u&gt;0&amp;&amp;(s=((t.x-r)*h+(t.y-a)*l)/u,s&gt;1?(r=i.x,a=i.y):s&gt;0&amp;&amp;(r+=h*s,a+=l*s)),h=t.x-r,l=t.y-a,n?h*h+l*l:new o.Point(r,a)}},o.Polyline=o.Path.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){o.setOptions(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,n=1/0,s=null,r=o.LineUtil._sqClosestPointOnSegment,a=0,h=this._parts.length;a&lt;h;a++)for(var l=this._parts[a],u=1,c=l.length;u&lt;c;u++){e=l[u-1],i=l[u];var d=r(t,e,i,!0);d&lt;n&amp;&amp;(n=d,s=r(t,e,i))}return s&amp;&amp;(s.distance=Math.sqrt(n)),s},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,o,s,r,a=this._rings[0],h=a.length;if(!h)return null;for(t=0,e=0;t&lt;h-1;t++)e+=a[t].distanceTo(a[t+1])/2;if(0===e)return this._map.layerPointToLatLng(a[0]);for(t=0,n=0;t&lt;h-1;t++)if(o=a[t],s=a[t+1],i=o.distanceTo(s),n+=i,n&gt;e)return r=(n-e)/i,this._map.layerPointToLatLng([s.x-r*(s.x-o.x),s.y-r*(s.y-o.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=o.latLng(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new o.LatLngBounds,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return o.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=o.Polyline._flat(t),n=0,s=t.length;n&lt;s;n++)i?(e[n]=o.latLng(t[n]),this._bounds.extend(e[n])):e[n]=this._convertLatLngs(t[n]);return e},_project:function(){var t=new o.Bounds;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t);var e=this._clickTolerance(),i=new o.Point(e,e);this._bounds.isValid()&amp;&amp;t.isValid()&amp;&amp;(t.min._subtract(i),t.max._add(i),this._pxBounds=t)},_projectLatlngs:function(t,e,i){var n,s,r=t[0]instanceof o.LatLng,a=t.length;if(r){for(s=[],n=0;n&lt;a;n++)s[n]=this._map.latLngToLayerPoint(t[n]),i.extend(s[n]);e.push(s)}else for(n=0;n&lt;a;n++)this._projectLatlngs(t[n],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&amp;&amp;this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);var e,i,n,s,r,a,h,l=this._parts;for(e=0,n=0,s=this._rings.length;e&lt;s;e++)for(h=this._rings[e],i=0,r=h.length;i&lt;r-1;i++)a=o.LineUtil.clipSegment(h[i],h[i+1],t,i,!0),a&amp;&amp;(l[n]=l[n]||[],l[n].push(a[0]),a[1]===h[i+1]&amp;&amp;i!==r-2||(l[n].push(a[1]),n++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i&lt;n;i++)t[i]=o.LineUtil.simplify(t[i],e)},_update:function(){this._map&amp;&amp;(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)}}),o.polyline=function(t,e){return new o.Polyline(t,e)},o.Polyline._flat=function(t){return!o.Util.isArray(t[0])||"object"!=typeof t[0][0]&amp;&amp;"undefined"!=typeof t[0][0]},o.PolyUtil={},o.PolyUtil.clipPolygon=function(t,e,i){var n,s,r,a,h,l,u,c,d,_=[1,4,2,8],m=o.LineUtil;for(s=0,u=t.length;s&lt;u;s++)t[s]._code=m._getBitCode(t[s],e);for(a=0;a&lt;4;a++){for(c=_[a],n=[],s=0,u=t.length,r=u-1;s&lt;u;r=s++)h=t[s],l=t[r],h._code&amp;c?l._code&amp;c||(d=m._getEdgeIntersection(l,h,c,e,i),d._code=m._getBitCode(d,e),n.push(d)):(l._code&amp;c&amp;&amp;(d=m._getEdgeIntersection(l,h,c,e,i),d._code=m._getBitCode(d,e),n.push(d)),n.push(h));t=n}return t},o.Polygon=o.Polyline.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,o,s,r,a,h,l=this._rings[0],u=l.length;if(!u)return null;for(s=r=a=0,t=0,e=u-1;t&lt;u;e=t++)i=l[t],n=l[e],o=i.y*n.x-n.y*i.x,r+=(i.x+n.x)*o,a+=(i.y+n.y)*o,s+=3*o;return h=0===s?l[0]:[r/s,a/s],this._map.layerPointToLatLng(h)},_convertLatLngs:function(t){var e=o.Polyline.prototype._convertLatLngs.call(this,t),i=e.length;return i&gt;=2&amp;&amp;e[0]instanceof o.LatLng&amp;&amp;e[0].equals(e[i-1])&amp;&amp;e.pop(),e},_setLatLngs:function(t){o.Polyline.prototype._setLatLngs.call(this,t),o.Polyline._flat(this._latlngs)&amp;&amp;(this._latlngs=[this._latlngs])},_defaultShape:function(){return o.Polyline._flat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new o.Point(e,e);if(t=new o.Bounds(t.min.subtract(i),t.max.add(i)),this._parts=[],this._pxBounds&amp;&amp;this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);for(var n,s=0,r=this._rings.length;s&lt;r;s++)n=o.PolyUtil.clipPolygon(this._rings[s],t,!0),n.length&amp;&amp;this._parts.push(n)}},_updatePath:function(){this._renderer._updatePoly(this,!0)}}),o.polygon=function(t,e){return new o.Polygon(t,e)},o.Rectangle=o.Polygon.extend({initialize:function(t,e){o.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=o.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),o.rectangle=function(t,e){return new o.Rectangle(t,e)},o.CircleMarker=o.Path.extend({options:{fill:!0,radius:10},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=o.latLng(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&amp;&amp;t.radius||this._radius;return o.Path.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),n=[t+i,e+i];this._pxBounds=new o.Bounds(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&amp;&amp;this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&amp;&amp;!this._renderer._bounds.intersects(this._pxBounds)}}),o.circleMarker=function(t,e){return new o.CircleMarker(t,e)},o.Circle=o.CircleMarker.extend({initialize:function(t,e,i){if("number"==typeof e&amp;&amp;(e=o.extend({},i,{radius:e})),o.setOptions(this,e),this._latlng=o.latLng(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,
this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new o.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:o.Path.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,n=i.options.crs;if(n.distance===o.CRS.Earth.distance){var s=Math.PI/180,r=this._mRadius/o.CRS.Earth.R/s,a=i.project([e+r,t]),h=i.project([e-r,t]),l=a.add(h).divideBy(2),u=i.unproject(l).lat,c=Math.acos((Math.cos(r*s)-Math.sin(e*s)*Math.sin(u*s))/(Math.cos(e*s)*Math.cos(u*s)))/s;(isNaN(c)||0===c)&amp;&amp;(c=r/Math.cos(Math.PI/180*e)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(c)?0:Math.max(Math.round(l.x-i.project([u,t-c]).x),1),this._radiusY=Math.max(Math.round(l.y-a.y),1)}else{var d=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(d).x}this._updateBounds()}}),o.circle=function(t,e,i){return new o.Circle(t,e,i)},o.SVG=o.Renderer.extend({getEvents:function(){var t=o.Renderer.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=o.SVG.create("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=o.SVG.create("g"),this._container.appendChild(this._rootGroup)},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){o.Renderer.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;this._svgSize&amp;&amp;this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),o.DomUtil.setPosition(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=o.SVG.create("path");t.options.className&amp;&amp;o.DomUtil.addClass(e,t.options.className),t.options.interactive&amp;&amp;o.DomUtil.addClass(e,"leaflet-interactive"),this._updateStyle(t),this._layers[o.stamp(t)]=t},_addPath:function(t){this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){o.DomUtil.remove(t._path),t.removeInteractiveTarget(t._path),delete this._layers[o.stamp(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&amp;&amp;(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,o.SVG.pointsToPath(t._parts,e))},_updateCircle:function(t){var e=t._point,i=t._radius,n=t._radiusY||i,o="a"+i+","+n+" 0 1,0 ",s=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+o+2*i+",0 "+o+2*-i+",0 ";this._setPath(t,s)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){o.DomUtil.toFront(t._path)},_bringToBack:function(t){o.DomUtil.toBack(t._path)}}),o.extend(o.SVG,{create:function(t){return e.createElementNS("http://www.w3.org/2000/svg",t)},pointsToPath:function(t,e){var i,n,s,r,a,h,l="";for(i=0,s=t.length;i&lt;s;i++){for(a=t[i],n=0,r=a.length;n&lt;r;n++)h=a[n],l+=(n?"L":"M")+h.x+" "+h.y;l+=e?o.Browser.svg?"z":"x":""}return l||"M0 0"}}),o.Browser.svg=!(!e.createElementNS||!o.SVG.create("svg").createSVGRect),o.svg=function(t){return o.Browser.svg||o.Browser.vml?new o.SVG(t):null},o.Browser.vml=!o.Browser.svg&amp;&amp;function(){try{var t=e.createElement("div");t.innerHTML='&lt;v:shape adj="1"/&gt;';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&amp;&amp;"object"==typeof i.adj}catch(t){return!1}}(),o.SVG.include(o.Browser.vml?{_initContainer:function(){this._container=o.DomUtil.create("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(o.Renderer.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=o.SVG.create("shape");o.DomUtil.addClass(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=o.SVG.create("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[o.stamp(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&amp;&amp;t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;o.DomUtil.remove(e),t.removeInteractiveTarget(e),delete this._layers[o.stamp(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,n=t.options,s=t._container;s.stroked=!!n.stroke,s.filled=!!n.fill,n.stroke?(e||(e=t._stroke=o.SVG.create("stroke")),s.appendChild(e),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,n.dashArray?e.dashStyle=o.Util.isArray(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=n.lineCap.replace("butt","flat"),e.joinstyle=n.lineJoin):e&amp;&amp;(s.removeChild(e),t._stroke=null),n.fill?(i||(i=t._fill=o.SVG.create("fill")),s.appendChild(i),i.color=n.fillColor||n.color,i.opacity=n.fillOpacity):i&amp;&amp;(s.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),n=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+n+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){o.DomUtil.toFront(t._container)},_bringToBack:function(t){o.DomUtil.toBack(t._container)}}:{}),o.Browser.vml&amp;&amp;(o.SVG.create=function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("&lt;lvml:"+t+' class="lvml"&gt;')}}catch(t){return function(t){return e.createElement("&lt;"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml"&gt;')}}}()),o.Canvas=o.Renderer.extend({getEvents:function(){var t=o.Renderer.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){o.Renderer.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=e.createElement("canvas");o.DomEvent.on(t,"mousemove",o.Util.throttle(this._onMouseMove,32,this),this).on(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var e in this._layers)t=this._layers[e],t._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){this._drawnLayers={},o.Renderer.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),n=o.Browser.retina?2:1;o.DomUtil.setPosition(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",o.Browser.retina&amp;&amp;this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){o.Renderer.prototype._reset.call(this),this._postponeUpdatePaths&amp;&amp;(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[o.stamp(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&amp;&amp;(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,n=e.prev;i?i.prev=n:this._drawLast=n,n?n.next=i:this._drawFirst=i,delete t._order,delete this._layers[o.stamp(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(t.options.dashArray){var e,i=t.options.dashArray.split(","),n=[];for(e=0;e&lt;i.length;e++)n.push(Number(i[e]));t.options._dashArray=n}},_requestRedraw:function(t){this._map&amp;&amp;(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||o.Util.requestAnimFrame(this._redraw,this))},_extendRedrawBounds:function(t){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new o.Bounds,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))},_redraw:function(){this._redrawRequest=null,this._redrawBounds&amp;&amp;(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var n=this._drawFirst;n;n=n.next)t=n.layer,(!e||t._pxBounds&amp;&amp;t._pxBounds.intersects(e))&amp;&amp;t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,n,o,s,r=t._parts,a=r.length,h=this._ctx;if(a){for(this._drawnLayers[t._leaflet_id]=t,h.beginPath(),h.setLineDash&amp;&amp;h.setLineDash(t.options&amp;&amp;t.options._dashArray||[]),i=0;i&lt;a;i++){for(n=0,o=r[i].length;n&lt;o;n++)s=r[i][n],h[n?"lineTo":"moveTo"](s.x,s.y);e&amp;&amp;h.closePath()}this._fillStroke(h,t)}}},_updateCircle:function(t){if(this._drawing&amp;&amp;!t._empty()){var e=t._point,i=this._ctx,n=t._radius,o=(t._radiusY||n)/n;this._drawnLayers[t._leaflet_id]=t,1!==o&amp;&amp;(i.save(),i.scale(1,o)),i.beginPath(),i.arc(e.x,e.y/o,n,0,2*Math.PI,!1),1!==o&amp;&amp;i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&amp;&amp;(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&amp;&amp;0!==i.weight&amp;&amp;(t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e,i,n=this._map.mouseEventToLayerPoint(t),s=this._drawFirst;s;s=s.next)e=s.layer,e.options.interactive&amp;&amp;e._containsPoint(n)&amp;&amp;!this._map._draggableMoved(e)&amp;&amp;(i=e);i&amp;&amp;(o.DomEvent._fakeStop(t),this._fireEvent([i],t))},_onMouseMove:function(t){if(this._map&amp;&amp;!this._map.dragging.moving()&amp;&amp;!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&amp;&amp;(o.DomUtil.removeClass(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){for(var i,n,s=this._drawFirst;s;s=s.next)i=s.layer,i.options.interactive&amp;&amp;i._containsPoint(e)&amp;&amp;(n=i);n!==this._hoveredLayer&amp;&amp;(this._handleMouseOut(t),n&amp;&amp;(o.DomUtil.addClass(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._hoveredLayer&amp;&amp;this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order,i=e.next,n=e.prev;i&amp;&amp;(i.prev=n,n?n.next=i:i&amp;&amp;(this._drawFirst=i),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))},_bringToBack:function(t){var e=t._order,i=e.next,n=e.prev;n&amp;&amp;(n.next=i,i?i.prev=n:n&amp;&amp;(this._drawLast=n),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}),o.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),o.canvas=function(t){return o.Browser.canvas?new o.Canvas(t):null},o.Polyline.prototype._containsPoint=function(t,e){var i,n,s,r,a,h,l=this._clickTolerance();if(!this._pxBounds.contains(t))return!1;for(i=0,r=this._parts.length;i&lt;r;i++)for(h=this._parts[i],n=0,a=h.length,s=a-1;n&lt;a;s=n++)if((e||0!==n)&amp;&amp;o.LineUtil.pointToSegmentDistance(t,h[s],h[n])&lt;=l)return!0;return!1},o.Polygon.prototype._containsPoint=function(t){var e,i,n,s,r,a,h,l,u=!1;if(!this._pxBounds.contains(t))return!1;for(s=0,h=this._parts.length;s&lt;h;s++)for(e=this._parts[s],r=0,l=e.length,a=l-1;r&lt;l;a=r++)i=e[r],n=e[a],i.y&gt;t.y!=n.y&gt;t.y&amp;&amp;t.x&lt;(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&amp;&amp;(u=!u);return u||o.Polyline.prototype._containsPoint.call(this,t,!0)},o.CircleMarker.prototype._containsPoint=function(t){return t.distanceTo(this._point)&lt;=this._radius+this._clickTolerance()},o.GeoJSON=o.FeatureGroup.extend({initialize:function(t,e){o.setOptions(this,e),this._layers={},t&amp;&amp;this.addData(t)},addData:function(t){var e,i,n,s=o.Util.isArray(t)?t:t.features;if(s){for(e=0,i=s.length;e&lt;i;e++)n=s[e],(n.geometries||n.geometry||n.features||n.coordinates)&amp;&amp;this.addData(n);return this}var r=this.options;if(r.filter&amp;&amp;!r.filter(t))return this;var a=o.GeoJSON.geometryToLayer(t,r);return a?(a.feature=o.GeoJSON.asFeature(t),a.defaultOptions=a.options,this.resetStyle(a),r.onEachFeature&amp;&amp;r.onEachFeature(t,a),this.addLayer(a)):this},resetStyle:function(t){return t.options=o.Util.extend({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&amp;&amp;(e=e(t.feature)),t.setStyle&amp;&amp;t.setStyle(e)}}),o.extend(o.GeoJSON,{geometryToLayer:function(t,e){var i,n,s,r,a="Feature"===t.type?t.geometry:t,h=a?a.coordinates:null,l=[],u=e&amp;&amp;e.pointToLayer,c=e&amp;&amp;e.coordsToLatLng||this.coordsToLatLng;if(!h&amp;&amp;!a)return null;switch(a.type){case"Point":return i=c(h),u?u(t,i):new o.Marker(i);case"MultiPoint":for(s=0,r=h.length;s&lt;r;s++)i=c(h[s]),l.push(u?u(t,i):new o.Marker(i));return new o.FeatureGroup(l);case"LineString":case"MultiLineString":return n=this.coordsToLatLngs(h,"LineString"===a.type?0:1,c),new o.Polyline(n,e);case"Polygon":case"MultiPolygon":return n=this.coordsToLatLngs(h,"Polygon"===a.type?1:2,c),new o.Polygon(n,e);case"GeometryCollection":for(s=0,r=a.geometries.length;s&lt;r;s++){var d=this.geometryToLayer({geometry:a.geometries[s],type:"Feature",properties:t.properties},e);d&amp;&amp;l.push(d)}return new o.FeatureGroup(l);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new o.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){for(var n,o=[],s=0,r=t.length;s&lt;r;s++)n=e?this.coordsToLatLngs(t[s],e-1,i):(i||this.coordsToLatLng)(t[s]),o.push(n);return o},latLngToCoords:function(t){return t.alt!==i?[t.lng,t.lat,t.alt]:[t.lng,t.lat]},latLngsToCoords:function(t,e,i){for(var n=[],s=0,r=t.length;s&lt;r;s++)n.push(e?o.GeoJSON.latLngsToCoords(t[s],e-1,i):o.GeoJSON.latLngToCoords(t[s]));return!e&amp;&amp;i&amp;&amp;n.push(n[0]),n},getFeature:function(t,e){return t.feature?o.extend({},t.feature,{geometry:e}):o.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var a={toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"Point",coordinates:o.GeoJSON.latLngToCoords(this.getLatLng())})}};o.Marker.include(a),o.Circle.include(a),o.CircleMarker.include(a),o.Polyline.prototype.toGeoJSON=function(){var t=!o.Polyline._flat(this._latlngs),e=o.GeoJSON.latLngsToCoords(this._latlngs,t?1:0);return o.GeoJSON.getFeature(this,{type:(t?"Multi":"")+"LineString",coordinates:e})},o.Polygon.prototype.toGeoJSON=function(){var t=!o.Polyline._flat(this._latlngs),e=t&amp;&amp;!o.Polyline._flat(this._latlngs[0]),i=o.GeoJSON.latLngsToCoords(this._latlngs,e?2:t?1:0,!0);return t||(i=[i]),o.GeoJSON.getFeature(this,{type:(e?"Multi":"")+"Polygon",coordinates:i})},o.LayerGroup.include({toMultiPoint:function(){var t=[];return this.eachLayer(function(e){t.push(e.toGeoJSON().geometry.coordinates)}),o.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(){var t=this.feature&amp;&amp;this.feature.geometry&amp;&amp;this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint();var e="GeometryCollection"===t,i=[];return this.eachLayer(function(t){if(t.toGeoJSON){var n=t.toGeoJSON();i.push(e?n.geometry:o.GeoJSON.asFeature(n))}}),e?o.GeoJSON.getFeature(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}}),o.geoJSON=function(t,e){return new o.GeoJSON(t,e)},o.geoJson=o.geoJSON,o.Draggable=o.Evented.extend({options:{clickTolerance:3},statics:{START:o.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e,i){this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(o.DomEvent.on(this._dragStartTarget,o.Draggable.START.join(" "),this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&amp;&amp;(o.Draggable._dragging===this&amp;&amp;this.finishDrag(),o.DomEvent.off(this._dragStartTarget,o.Draggable.START.join(" "),this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&amp;&amp;this._enabled&amp;&amp;(this._moved=!1,!o.DomUtil.hasClass(this._element,"leaflet-zoom-anim")&amp;&amp;!(o.Draggable._dragging||t.shiftKey||1!==t.which&amp;&amp;1!==t.button&amp;&amp;!t.touches||(o.Draggable._dragging=this,this._preventOutline&amp;&amp;o.DomUtil.preventOutline(this._element),o.DomUtil.disableImageDrag(),o.DomUtil.disableTextSelection(),this._moving)))){this.fire("down");var i=t.touches?t.touches[0]:t;this._startPoint=new o.Point(i.clientX,i.clientY),o.DomEvent.on(e,o.Draggable.MOVE[t.type],this._onMove,this).on(e,o.Draggable.END[t.type],this._onUp,this)}},_onMove:function(i){if(!i._simulated&amp;&amp;this._enabled){if(i.touches&amp;&amp;i.touches.length&gt;1)return void(this._moved=!0);var n=i.touches&amp;&amp;1===i.touches.length?i.touches[0]:i,s=new o.Point(n.clientX,n.clientY),r=s.subtract(this._startPoint);(r.x||r.y)&amp;&amp;(Math.abs(r.x)+Math.abs(r.y)&lt;this.options.clickTolerance||(o.DomEvent.preventDefault(i),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=o.DomUtil.getPosition(this._element).subtract(r),o.DomUtil.addClass(e.body,"leaflet-dragging"),this._lastTarget=i.target||i.srcElement,t.SVGElementInstance&amp;&amp;this._lastTarget instanceof SVGElementInstance&amp;&amp;(this._lastTarget=this._lastTarget.correspondingUseElement),o.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(r),this._moving=!0,o.Util.cancelAnimFrame(this._animRequest),this._lastEvent=i,this._animRequest=o.Util.requestAnimFrame(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),o.DomUtil.setPosition(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&amp;&amp;this._enabled&amp;&amp;this.finishDrag()},finishDrag:function(){o.DomUtil.removeClass(e.body,"leaflet-dragging"),this._lastTarget&amp;&amp;(o.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in o.Draggable.MOVE)o.DomEvent.off(e,o.Draggable.MOVE[t],this._onMove,this).off(e,o.Draggable.END[t],this._onUp,this);o.DomUtil.enableImageDrag(),o.DomUtil.enableTextSelection(),this._moved&amp;&amp;this._moving&amp;&amp;(o.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,o.Draggable._dragging=!1}}),o.Handler=o.Class.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}}),o.Map.mergeOptions({dragging:!0,inertia:!o.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0}),o.Map.Drag=o.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new o.Draggable(t._mapPane,t._container),this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&amp;&amp;(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}o.DomUtil.addClass(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){o.DomUtil.removeClass(this._map._container,"leaflet-grab"),o.DomUtil.removeClass(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&amp;&amp;this._draggable._moved},moving:function(){return this._draggable&amp;&amp;this._draggable._moving},_onDown:function(){this._map._stop()},_onDragStart:function(){var t=this._map;if(this._map.options.maxBounds&amp;&amp;this._map.options.maxBoundsViscosity){var e=o.latLngBounds(this._map.options.maxBounds);this._offsetLimit=o.bounds(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&amp;&amp;(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),e-this._times[0]&gt;50&amp;&amp;(this._positions.shift(),this._times.shift())}this._map.fire("move",t).fire("drag",t)},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&amp;&amp;this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x&lt;e.min.x&amp;&amp;(t.x=this._viscousLimit(t.x,e.min.x)),t.y&lt;e.min.y&amp;&amp;(t.y=this._viscousLimit(t.y,e.min.y)),t.x&gt;e.max.x&amp;&amp;(t.x=this._viscousLimit(t.x,e.max.x)),t.y&gt;e.max.y&amp;&amp;(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,s=(n+e+i)%t-e-i,r=Math.abs(o+i)&lt;Math.abs(s+i)?o:s;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=r},_onDragEnd:function(t){var e=this._map,i=e.options,n=!i.inertia||this._times.length&lt;2;if(e.fire("dragend",t),n)e.fire("moveend");else{var s=this._lastPos.subtract(this._positions[0]),r=(this._lastTime-this._times[0])/1e3,a=i.easeLinearity,h=s.multiplyBy(a/r),l=h.distanceTo([0,0]),u=Math.min(i.inertiaMaxSpeed,l),c=h.multiplyBy(u/l),d=u/(i.inertiaDeceleration*a),_=c.multiplyBy(-d/2).round();_.x||_.y?(_=e._limitOffset(_,e.options.maxBounds),o.Util.requestAnimFrame(function(){e.panBy(_,{duration:d,easeLinearity:a,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}}),o.Map.addInitHook("addHandler","dragging",o.Map.Drag),o.Map.mergeOptions({doubleClickZoom:!0}),o.Map.DoubleClickZoom=o.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),n=e.options.zoomDelta,o=t.originalEvent.shiftKey?i-n:i+n;"center"===e.options.doubleClickZoom?e.setZoom(o):e.setZoomAround(t.containerPoint,o)}}),o.Map.addInitHook("addHandler","doubleClickZoom",o.Map.DoubleClickZoom),o.Map.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60}),o.Map.ScrollWheelZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){o.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=o.DomEvent.getWheelDelta(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var n=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o.bind(this._performZoom,this),n),o.DomEvent.stop(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),o=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,s=i?Math.ceil(o/i)*i:o,r=t._limitZoom(e+(this._delta&gt;0?s:-s))-e;this._delta=0,this._startTime=null,r&amp;&amp;("center"===t.options.scrollWheelZoom?t.setZoom(e+r):t.setZoomAround(this._lastMousePos,e+r))}}),o.Map.addInitHook("addHandler","scrollWheelZoom",o.Map.ScrollWheelZoom),o.extend(o.DomEvent,{_touchstart:o.Browser.msPointer?"MSPointerDown":o.Browser.pointer?"pointerdown":"touchstart",_touchend:o.Browser.msPointer?"MSPointerUp":o.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,e,i){function n(t){var e;if(o.Browser.pointer){if(!o.Browser.edge||"mouse"===t.pointerType)return;e=o.DomEvent._pointersCount}else e=t.touches.length;if(!(e&gt;1)){var i=Date.now(),n=i-(r||i);a=t.touches?t.touches[0]:t,h=n&gt;0&amp;&amp;n&lt;=l,r=i}}function s(t){if(h&amp;&amp;!a.cancelBubble){if(o.Browser.pointer){if(!o.Browser.edge||"mouse"===t.pointerType)return;var i,n,s={};for(n in a)i=a[n],s[n]=i&amp;&amp;i.bind?i.bind(a):i;a=s}a.type="dblclick",e(a),r=null}}var r,a,h=!1,l=250,u="_leaflet_",c=this._touchstart,d=this._touchend;return t[u+c+i]=n,t[u+d+i]=s,t[u+"dblclick"+i]=e,t.addEventListener(c,n,!1),t.addEventListener(d,s,!1),t.addEventListener("dblclick",e,!1),this},removeDoubleTapListener:function(t,e){var i="_leaflet_",n=t[i+this._touchstart+e],s=t[i+this._touchend+e],r=t[i+"dblclick"+e];return t.removeEventListener(this._touchstart,n,!1),t.removeEventListener(this._touchend,s,!1),o.Browser.edge||t.removeEventListener("dblclick",r,!1),this}}),o.extend(o.DomEvent,{POINTER_DOWN:o.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:o.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:o.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:o.Browser.msPointer?"MSPointerCancel":"pointercancel",TAG_WHITE_LIST:["INPUT","SELECT","OPTION"],_pointers:{},_pointersCount:0,addPointerListener:function(t,e,i,n){return"touchstart"===e?this._addPointerStart(t,i,n):"touchmove"===e?this._addPointerMove(t,i,n):"touchend"===e&amp;&amp;this._addPointerEnd(t,i,n),this},removePointerListener:function(t,e,i){var n=t["_leaflet_"+e+i];return"touchstart"===e?t.removeEventListener(this.POINTER_DOWN,n,!1):"touchmove"===e?t.removeEventListener(this.POINTER_MOVE,n,!1):"touchend"===e&amp;&amp;(t.removeEventListener(this.POINTER_UP,n,!1),t.removeEventListener(this.POINTER_CANCEL,n,!1)),this},_addPointerStart:function(t,i,n){var s=o.bind(function(t){if("mouse"!==t.pointerType&amp;&amp;t.MSPOINTER_TYPE_MOUSE&amp;&amp;t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(this.TAG_WHITE_LIST.indexOf(t.target.tagName)&lt;0))return;o.DomEvent.preventDefault(t)}this._handlePointer(t,i)},this);if(t["_leaflet_touchstart"+n]=s,t.addEventListener(this.POINTER_DOWN,s,!1),!this._pointerDocListener){var r=o.bind(this._globalPointerUp,this);e.documentElement.addEventListener(this.POINTER_DOWN,o.bind(this._globalPointerDown,this),!0),e.documentElement.addEventListener(this.POINTER_MOVE,o.bind(this._globalPointerMove,this),!0),e.documentElement.addEventListener(this.POINTER_UP,r,!0),e.documentElement.addEventListener(this.POINTER_CANCEL,r,!0),this._pointerDocListener=!0}},_globalPointerDown:function(t){this._pointers[t.pointerId]=t,this._pointersCount++},_globalPointerMove:function(t){this._pointers[t.pointerId]&amp;&amp;(this._pointers[t.pointerId]=t)},_globalPointerUp:function(t){delete this._pointers[t.pointerId],this._pointersCount--},_handlePointer:function(t,e){t.touches=[];for(var i in this._pointers)t.touches.push(this._pointers[i]);t.changedTouches=[t],e(t)},_addPointerMove:function(t,e,i){var n=o.bind(function(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&amp;&amp;"mouse"!==t.pointerType||0!==t.buttons)&amp;&amp;this._handlePointer(t,e)},this);t["_leaflet_touchmove"+i]=n,t.addEventListener(this.POINTER_MOVE,n,!1)},_addPointerEnd:function(t,e,i){var n=o.bind(function(t){this._handlePointer(t,e)},this);t["_leaflet_touchend"+i]=n,t.addEventListener(this.POINTER_UP,n,!1),t.addEventListener(this.POINTER_CANCEL,n,!1)}}),o.Map.mergeOptions({touchZoom:o.Browser.touch&amp;&amp;!o.Browser.android23,bounceAtZoomLimits:!0}),o.Map.TouchZoom=o.Handler.extend({addHooks:function(){o.DomUtil.addClass(this._map._container,"leaflet-touch-zoom"),o.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){o.DomUtil.removeClass(this._map._container,"leaflet-touch-zoom"),o.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&amp;&amp;2===t.touches.length&amp;&amp;!i._animatingZoom&amp;&amp;!this._zooming){var n=i.mouseEventToContainerPoint(t.touches[0]),s=i.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=i.getSize()._divideBy(2),this._startLatLng=i.containerPointToLatLng(this._centerPoint),"center"!==i.options.touchZoom&amp;&amp;(this._pinchStartLatLng=i.containerPointToLatLng(n.add(s)._divideBy(2))),this._startDist=n.distanceTo(s),this._startZoom=i.getZoom(),this._moved=!1,this._zooming=!0,i._stop(),o.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),o.DomEvent.preventDefault(t)}},_onTouchMove:function(t){if(t.touches&amp;&amp;2===t.touches.length&amp;&amp;this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]),s=i.distanceTo(n)/this._startDist;if(this._zoom=e.getScaleZoom(s,this._startZoom),!e.options.bounceAtZoomLimits&amp;&amp;(this._zoom&lt;e.getMinZoom()&amp;&amp;s&lt;1||this._zoom&gt;e.getMaxZoom()&amp;&amp;s&gt;1)&amp;&amp;(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===s)return}else{var r=i._add(n)._divideBy(2)._subtract(this._centerPoint);if(1===s&amp;&amp;0===r.x&amp;&amp;0===r.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(r),this._zoom)}this._moved||(e._moveStart(!0),this._moved=!0),o.Util.cancelAnimFrame(this._animRequest);var a=o.bind(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=o.Util.requestAnimFrame(a,this,!0),o.DomEvent.preventDefault(t)}},_onTouchEnd:function(){return this._moved&amp;&amp;this._zooming?(this._zooming=!1,o.Util.cancelAnimFrame(this._animRequest),o.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd),void(this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom)))):void(this._zooming=!1)}}),o.Map.addInitHook("addHandler","touchZoom",o.Map.TouchZoom),o.Map.mergeOptions({tap:!0,tapTolerance:15}),o.Map.Tap=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(o.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length&gt;1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var i=t.touches[0],n=i.target;this._startPos=this._newPos=new o.Point(i.clientX,i.clientY),n.tagName&amp;&amp;"a"===n.tagName.toLowerCase()&amp;&amp;o.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(o.bind(function(){this._isTapValid()&amp;&amp;(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),this._simulateEvent("mousedown",i),o.DomEvent.on(e,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),o.DomEvent.off(e,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&amp;&amp;t&amp;&amp;t.changedTouches){var i=t.changedTouches[0],n=i.target;n&amp;&amp;n.tagName&amp;&amp;"a"===n.tagName.toLowerCase()&amp;&amp;o.DomUtil.removeClass(n,"leaflet-active"),this._simulateEvent("mouseup",i),
this._isTapValid()&amp;&amp;this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)&lt;=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new o.Point(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(i,n){var o=e.createEvent("MouseEvents");o._simulated=!0,n.target._simulatedClick=!0,o.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(o)}}),o.Browser.touch&amp;&amp;!o.Browser.pointer&amp;&amp;o.Map.addInitHook("addHandler","tap",o.Map.Tap),o.Map.mergeOptions({boxZoom:!0}),o.Map.BoxZoom=o.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){o.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){o.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_resetState:function(){this._moved=!1},_onMouseDown:function(t){return!(!t.shiftKey||1!==t.which&amp;&amp;1!==t.button)&amp;&amp;(this._resetState(),o.DomUtil.disableTextSelection(),o.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(t),void o.DomEvent.on(e,{contextmenu:o.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this))},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=o.DomUtil.create("div","leaflet-zoom-box",this._container),o.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new o.Bounds(this._point,this._startPoint),i=e.getSize();o.DomUtil.setPosition(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&amp;&amp;(o.DomUtil.remove(this._box),o.DomUtil.removeClass(this._container,"leaflet-crosshair")),o.DomUtil.enableTextSelection(),o.DomUtil.enableImageDrag(),o.DomEvent.off(e,{contextmenu:o.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&amp;&amp;(this._finish(),this._moved)){setTimeout(o.bind(this._resetState,this),0);var e=new o.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&amp;&amp;this._finish()}}),o.Map.addInitHook("addHandler","boxZoom",o.Map.BoxZoom),o.Map.mergeOptions({keyboard:!0,keyboardPanDelta:80}),o.Map.Keyboard=o.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex&lt;=0&amp;&amp;(t.tabIndex="0"),o.DomEvent.on(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),o.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,o=i.scrollTop||n.scrollTop,s=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(s,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;e&lt;i;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;e&lt;i;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;e&lt;i;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;e&lt;i;e++)n[o.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;e&lt;i;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;e&lt;i;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){o.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){o.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,n=this._map;if(i in this._panKeys){if(n._panAnim&amp;&amp;n._panAnim._inProgress)return;e=this._panKeys[i],t.shiftKey&amp;&amp;(e=o.point(e).multiplyBy(3)),n.panBy(e),n.options.maxBounds&amp;&amp;n.panInsideBounds(n.options.maxBounds)}else if(i in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i)return;n.closePopup()}o.DomEvent.stop(t)}}}),o.Map.addInitHook("addHandler","keyboard",o.Map.Keyboard),o.Handler.MarkerDrag=o.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new o.Draggable(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),o.DomUtil.addClass(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&amp;&amp;o.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&amp;&amp;this._draggable._moved},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(t){var e=this._marker,i=e._shadow,n=o.DomUtil.getPosition(e._icon),s=e._map.layerPointToLatLng(n);i&amp;&amp;o.DomUtil.setPosition(i,n),e._latlng=s,t.latlng=s,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),o.Control=o.Class.extend({options:{position:"topright"},initialize:function(t){o.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&amp;&amp;e.removeControl(this),this.options.position=t,e&amp;&amp;e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return o.DomUtil.addClass(e,"leaflet-control"),i.indexOf("bottom")!==-1?n.insertBefore(e,n.firstChild):n.appendChild(e),this},remove:function(){return this._map?(o.DomUtil.remove(this._container),this.onRemove&amp;&amp;this.onRemove(this._map),this._map=null,this):this},_refocusOnMap:function(t){this._map&amp;&amp;t&amp;&amp;t.screenX&gt;0&amp;&amp;t.screenY&gt;0&amp;&amp;this._map.getContainer().focus()}}),o.control=function(t){return new o.Control(t)},o.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){function t(t,s){var r=i+t+" "+i+s;e[t+s]=o.DomUtil.create("div",r,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=o.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){o.DomUtil.remove(this._controlContainer)}}),o.Control.Zoom=o.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=o.DomUtil.create("div",e+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&amp;&amp;this._map._zoom&lt;this._map.getMaxZoom()&amp;&amp;this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&amp;&amp;this._map._zoom&gt;this._map.getMinZoom()&amp;&amp;this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,n,s){var r=o.DomUtil.create("a",i,n);return r.innerHTML=t,r.href="#",r.title=e,r.setAttribute("role","button"),r.setAttribute("aria-label",e),o.DomEvent.on(r,"mousedown dblclick",o.DomEvent.stopPropagation).on(r,"click",o.DomEvent.stop).on(r,"click",s,this).on(r,"click",this._refocusOnMap,this),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";o.DomUtil.removeClass(this._zoomInButton,e),o.DomUtil.removeClass(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMinZoom())&amp;&amp;o.DomUtil.addClass(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMaxZoom())&amp;&amp;o.DomUtil.addClass(this._zoomInButton,e)}}),o.Map.mergeOptions({zoomControl:!0}),o.Map.addInitHook(function(){this.options.zoomControl&amp;&amp;(this.zoomControl=new o.Control.Zoom,this.addControl(this.zoomControl))}),o.control.zoom=function(t){return new o.Control.Zoom(t)},o.Control.Attribution=o.Control.extend({options:{position:"bottomright",prefix:'&lt;a href="http://leafletjs.com" title="A JS library for interactive maps"&gt;Leaflet&lt;/a&gt;'},initialize:function(t){o.setOptions(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=o.DomUtil.create("div","leaflet-control-attribution"),o.DomEvent&amp;&amp;o.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&amp;&amp;this.addAttribution(t._layers[e].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&amp;&amp;(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&amp;&amp;t.push(e);var i=[];this.options.prefix&amp;&amp;i.push(this.options.prefix),t.length&amp;&amp;i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}}}),o.Map.mergeOptions({attributionControl:!0}),o.Map.addInitHook(function(){this.options.attributionControl&amp;&amp;(new o.Control.Attribution).addTo(this)}),o.control.attribution=function(t){return new o.Control.Attribution(t)},o.Control.Scale=o.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=o.DomUtil.create("div",e),n=this.options;return this._addScales(n,e+"-line",i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&amp;&amp;(this._mScale=o.DomUtil.create("div",e,i)),t.imperial&amp;&amp;(this._iScale=o.DomUtil.create("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&amp;&amp;t&amp;&amp;this._updateMetric(t),this.options.imperial&amp;&amp;t&amp;&amp;this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e&lt;1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e,i,n,o=3.2808399*t;o&gt;5280?(e=o/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mi",i/e)):(n=this._getRoundNum(o),this._updateScale(this._iScale,n+" ft",n/o))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i&gt;=10?10:i&gt;=5?5:i&gt;=3?3:i&gt;=2?2:1,e*i}}),o.control.scale=function(t){return new o.Control.Scale(t)},o.Control.Layers=o.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,n){return i&lt;n?-1:n&lt;i?1:0}},initialize:function(t,e,i){o.setOptions(this,i),this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this),this._container},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t&lt;this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(o.stamp(t));return e&amp;&amp;this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){o.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t&lt;this._form.clientHeight?(o.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=t+"px"):o.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return o.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=o.DomUtil.create("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),o.DomEvent.disableClickPropagation(e),o.Browser.touch||o.DomEvent.disableScrollPropagation(e);var n=this._form=o.DomUtil.create("form",t+"-list");i&amp;&amp;(this._map.on("click",this.collapse,this),o.Browser.android||o.DomEvent.on(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var s=this._layersLink=o.DomUtil.create("a",t+"-toggle",e);s.href="#",s.title="Layers",o.Browser.touch?o.DomEvent.on(s,"click",o.DomEvent.stop).on(s,"click",this.expand,this):o.DomEvent.on(s,"focus",this.expand,this),o.DomEvent.on(n,"click",function(){setTimeout(o.bind(this._onInputClick,this),0)},this),i||this.expand(),this._baseLayersList=o.DomUtil.create("div",t+"-base",n),this._separator=o.DomUtil.create("div",t+"-separator",n),this._overlaysList=o.DomUtil.create("div",t+"-overlays",n),e.appendChild(n)},_getLayer:function(t){for(var e=0;e&lt;this._layers.length;e++)if(this._layers[e]&amp;&amp;o.stamp(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&amp;&amp;this._layers.sort(o.bind(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&amp;&amp;t.setZIndex&amp;&amp;(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return this;o.DomUtil.empty(this._baseLayersList),o.DomUtil.empty(this._overlaysList);var t,e,i,n,s=0;for(i=0;i&lt;this._layers.length;i++)n=this._layers[i],this._addItem(n),e=e||n.overlay,t=t||!n.overlay,s+=n.overlay?0:1;return this.options.hideSingleBase&amp;&amp;(t=t&amp;&amp;s&gt;1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&amp;&amp;t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(o.stamp(t.target)),i=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;i&amp;&amp;this._map.fire(i,e)},_createRadioElement:function(t,i){var n='&lt;input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(i?' checked="checked"':"")+"/&gt;",o=e.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var i,n=e.createElement("label"),s=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=s):i=this._createRadioElement("leaflet-base-layers",s),i.layerId=o.stamp(t.layer),o.DomEvent.on(i,"click",this._onInputClick,this);var r=e.createElement("span");r.innerHTML=" "+t.name;var a=e.createElement("div");n.appendChild(a),a.appendChild(i),a.appendChild(r);var h=t.overlay?this._overlaysList:this._baseLayersList;return h.appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),o=[],s=[];this._handlingClick=!0;for(var r=n.length-1;r&gt;=0;r--)t=n[r],e=this._getLayer(t.layerId).layer,i=this._map.hasLayer(e),t.checked&amp;&amp;!i?o.push(e):!t.checked&amp;&amp;i&amp;&amp;s.push(e);for(r=0;r&lt;s.length;r++)this._map.removeLayer(s[r]);for(r=0;r&lt;o.length;r++)this._map.addLayer(o[r]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,n=this._form.getElementsByTagName("input"),o=this._map.getZoom(),s=n.length-1;s&gt;=0;s--)t=n[s],e=this._getLayer(t.layerId).layer,t.disabled=e.options.minZoom!==i&amp;&amp;o&lt;e.options.minZoom||e.options.maxZoom!==i&amp;&amp;o&gt;e.options.maxZoom},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),o.control.layers=function(t,e,i){return new o.Control.Layers(t,e,i)}}(window,document);]]&gt;&lt;/script&gt;&lt;script_name&gt;leafletjs asset app&lt;/script_name&gt;&lt;sys_class_name&gt;sys_ui_script&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-05-15 15:54:14&lt;/sys_created_on&gt;&lt;sys_id&gt;2cc411bbdb15f7409eb1d311ce961991&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;x_snc_sp_asset_map.leafletjs asset app&lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_ui_script_2cc411bbdb15f7409eb1d311ce961991&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-05-15 15:54:14&lt;/sys_updated_on&gt;&lt;ui_type&gt;0&lt;/ui_type&gt;&lt;use_scoped_format&gt;false&lt;/use_scoped_format&gt;&lt;/sys_ui_script&gt;&lt;/record_update&gt;</payload>
<payload_hash>1406205445</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>af95faeedb48c410993fdc965e961917</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d92540000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>x_snc_sp_asset_map.leafletjs asset app</target_name>
<type>UI Script</type>
<update_domain>global</update_domain>
<update_guid>7074ef2fdf57f700dde0943506d83c2f</update_guid>
<update_guid_history>7074ef2fdf57f700dde0943506d83c2f:1406205445,a70427ab8c57f700ecb3ff33d1776228:-221950006,fdf323ab7057f70079fa390e3ba40fe8:-1352169777,02f45d7bd115f7405fd084742925675b:1406205445</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_js_include_29751dbbdb15f7409eb1d311ce961949</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_js_include"><m2m_sp_dependency_js_include action="INSERT_OR_UPDATE"><order>300</order><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sp_js_include display_value="leaflet asset directive">e84519bbdb15f7409eb1d311ce9619fb</sp_js_include><sys_class_name>m2m_sp_dependency_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:56:23</sys_created_on><sys_id>29751dbbdb15f7409eb1d311ce961949</sys_id><sys_mod_count>3</sys_mod_count><sys_name>Leaflet NG.leaflet asset directive</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_js_include_29751dbbdb15f7409eb1d311ce961949</sys_update_name><sys_updated_by>lil.dicky</sys_updated_by><sys_updated_on>2019-05-16 22:23:24</sys_updated_on></m2m_sp_dependency_js_include></record_update>]]></payload>
<payload_hash>-1570874344</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>e3957aeedb48c410993fdc965e9619fe</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91610000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Leaflet NG.leaflet asset directive</target_name>
<type>Dependency JS Includes</type>
<update_domain>global</update_domain>
<update_guid>d4a7b78c65617b406365c17501fd8dfc</update_guid>
<update_guid_history>d4a7b78c65617b406365c17501fd8dfc:-1570874344,d4a7b78c65617b406365c17501fd8dfc:-1570874344,0197378c06617b40fc002f32c3d056fb:1432023543,8077b38cdb617b40228cd07e9eb26e21:-278804935,69751dbbe715f7409df577ef4341d24a:1013264474</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_css_include_ad15e93fdb55f7409eb1d311ce96194b</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_css_include"><sp_css_include action="INSERT_OR_UPDATE"><name>leaflet style asset</name><source>local</source><sp_css display_value="leaflet style bank">a9256d3fdb55f7409eb1d311ce961935</sp_css><sys_class_name>sp_css_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 17:05:05</sys_created_on><sys_id>ad15e93fdb55f7409eb1d311ce96194b</sys_id><sys_mod_count>0</sys_mod_count><sys_name>leaflet style asset</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_css_include_ad15e93fdb55f7409eb1d311ce96194b</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 17:05:05</sys_updated_on><url/></sp_css_include></record_update>]]></payload>
<payload_hash>1557760986</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>e395faeedb48c410993fdc965e961913</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90e90000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>leaflet style asset</target_name>
<type>CSS Include</type>
<update_domain>global</update_domain>
<update_guid>7f25693f0e55f7404929c8e83c7e20fa</update_guid>
<update_guid_history>7f25693f0e55f7404929c8e83c7e20fa:1557760986,7f25693f0e55f7404929c8e83c7e20fa:1557760986</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_app_fd6a882bdb5d77409eb1d311ce961975</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_app"><sys_app action="INSERT_OR_UPDATE"><active>true</active><can_edit_in_studio>false</can_edit_in_studio><enforce_license>none</enforce_license><js_level>helsinki_es5</js_level><licensable>true</licensable><license_category>none</license_category><license_model>none</license_model><logo/><menu/><name>SP Asset Map</name><private>false</private><restrict_table_access>false</restrict_table_access><runtime_access_tracking>permissive</runtime_access_tracking><scope>x_snc_sp_asset_map</scope><scoped_administration>false</scoped_administration><short_description/><source>x_snc_sp_asset_map</source><store_correlation_id/><store_url/><sys_class_name>sys_app</sys_class_name><sys_code/><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-14 15:49:59</sys_created_on><sys_id>fd6a882bdb5d77409eb1d311ce961975</sys_id><sys_mod_count>0</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-14 15:49:59</sys_updated_on><template/><trackable>true</trackable><user_role/><vendor/><vendor_prefix/><version>1.0.0</version></sys_app></record_update>]]></payload>
<payload_hash>1692039563</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>e395faeedb48c410993fdc965e961916</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90520000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>SP Asset Map</target_name>
<type>Custom Application</type>
<update_domain>global</update_domain>
<update_guid>426a00ab4c5d77409dc5102a01b26078</update_guid>
<update_guid_history>426a00ab4c5d77409dc5102a01b26078:1692039563,426a00ab4c5d77409dc5102a01b26078:1692039563</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_ui_script_ab4559bbdb15f7409eb1d311ce9619d9</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_ui_script"&gt;&lt;sys_ui_script action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;description/&gt;&lt;global&gt;false&lt;/global&gt;&lt;name&gt;x_snc_sp_asset_map.Leaflet Directive Ass&lt;/name&gt;&lt;script&gt;&lt;![CDATA[/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-leaflet-directive Team, http://tombatossals.github.io/angular-leaflet-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-leaflet-directive
 * https://github.com/tombatossals/angular-leaflet-directive
 *
 * @authors https://github.com/tombatossals/angular-leaflet-directive/graphs/contributors
 */

/*!
*  angular-leaflet-directive  2015-11-06
*  angular-leaflet-directive - An AngularJS directive to easily interact with Leaflet maps
*  git: https://github.com/tombatossals/angular-leaflet-directive
*/
(function(angular){
'use strict';
angular.module('leaflet-directive-two', []).directive('leaflet', ["$q", "leafletData", "leafletMapDefaults", "leafletHelpers", "leafletMapEvents", function($q, leafletData, leafletMapDefaults, leafletHelpers, leafletMapEvents) {
  return {
    restrict: 'EA',
    replace: true,
    scope: {
      center: '=',
      lfCenter: '=',
      defaults: '=',
      maxbounds: '=',
      bounds: '=',
      markers: '=',
      legend: '=',
      geojson: '=',
      paths: '=',
      tiles: '=',
      layers: '=',
      controls: '=',
      decorations: '=',
      eventBroadcast: '=',
      markersWatchOptions: '=',
      geojsonWatchOptions: '=',
    },
    transclude: true,
    template: '&lt;div class="angular-leaflet-map"&gt;&lt;div ng-transclude&gt;&lt;/div&gt;&lt;/div&gt;',
    controller: ["$scope", function($scope) {
      this._leafletMap = $q.defer();
      this.getMap = function() {
        return this._leafletMap.promise;
      };

      this.getLeafletScope = function() {
        return $scope;
      };
    }],

    link: function(scope, element, attrs, ctrl) {
      var isDefined = leafletHelpers.isDefined;
      var defaults  = leafletMapDefaults.setDefaults(scope.defaults, attrs.id);
      var mapEvents = leafletMapEvents.getAvailableMapEvents();
      var addEvents = leafletMapEvents.addEvents;

      scope.mapId =  attrs.id;
		leafletData.setDirectiveControls({}, attrs.id);

		// Set width and height utility functions
		function updateWidth() {
			if (isNaN(attrs.width)) {
				element.css('width', attrs.width);
			} else {
				element.css('width', attrs.width + 'px');
			}
		}

		function updateHeight() {
			if (isNaN(attrs.height)) {
				element.css('height', attrs.height);
			} else {
				element.css('height', attrs.height + 'px');
			}
		}

		// If the width attribute defined update css
		// Then watch if bound property changes and update css
		if (isDefined(attrs.width)) {
			updateWidth();

			scope.$watch(
				function() {
					return element[0].getAttribute('width');
				},

				function() {
					updateWidth();
					map.invalidateSize();
				});
		}

		// If the height attribute defined update css
		// Then watch if bound property changes and update css
		if (isDefined(attrs.height)) {
			updateHeight();

			scope.$watch(
				function() {
					return element[0].getAttribute('height');
				},

				function() {
					updateHeight();
					map.invalidateSize();
				});
		}

		// Create the Leaflet Map Object with the options
		var map = new L.Map(element[0], leafletMapDefaults.getMapCreationDefaults(attrs.id));
		ctrl._leafletMap.resolve(map);
		 
		

		if (!isDefined(attrs.center) &amp;&amp; !isDefined(attrs.lfCenter)) {
        map.setView([defaults.center.lat, defaults.center.lng], defaults.center.zoom);
      }

      // If no layers nor tiles defined, set the default tileLayer
      if (!isDefined(attrs.tiles) &amp;&amp; (!isDefined(attrs.layers))) {
        var tileLayerObj = L.tileLayer(defaults.tileLayer, defaults.tileLayerOptions);
        tileLayerObj.addTo(map);
        leafletData.setTiles(tileLayerObj, attrs.id);
      }

      // Set zoom control configuration
      if (isDefined(map.zoomControl) &amp;&amp;
          isDefined(defaults.zoomControlPosition)) {
        map.zoomControl.setPosition(defaults.zoomControlPosition);
      }

      if (isDefined(map.zoomControl) &amp;&amp; defaults.zoomControl === false) {
        map.zoomControl.removeFrom(map);
      }

      if (isDefined(map.zoomsliderControl) &amp;&amp;
          isDefined(defaults.zoomsliderControl) &amp;&amp;
          defaults.zoomsliderControl === false) {
        map.zoomsliderControl.removeFrom(map);
      }

      // if no event-broadcast attribute, all events are broadcasted
      if (!isDefined(attrs.eventBroadcast)) {
        var logic = 'broadcast';
        addEvents(map, mapEvents, 'eventName', scope, logic);
      }
		
      // Resolve the map object to the promises
      map.whenReady(function() {
        leafletData.setMap(map, attrs.id);
      });

      scope.$on('$destroy', function() {
        leafletMapDefaults.reset();
        map.remove();
        leafletData.unresolveMap(attrs.id);
      });

      //Handle request to invalidate the map size
      //Up scope using $scope.$emit('invalidateSize')
      //Down scope using $scope.$broadcast('invalidateSize')
      scope.$on('invalidateSize', function() {
		  map.invalidateSize();
	  });
		var searchLayer = L.layerGroup().addTo(map);
		//... adding data in searchLayer ...
		map.addControl( new L.Control.Search({
		url: 'https://nominatim.openstreetmap.org/search?format=json&amp;q={s}',
		jsonpParam: 'json_callback',
		propertyName: 'display_name',
		propertyLoc: ['lat','lon'],
		marker: L.circleMarker([0,0],{radius:0}),
		autoCollapse: true,
		autoType: false,
		minLength: 2}) );
		//searchLayer is a L.LayerGroup contains searched markers
	},
  };
}]);

angular.module('leaflet-directive-two').factory('leafletBoundsHelpers', ["$log", "leafletHelpers", function($log, leafletHelpers) {

  var isArray = leafletHelpers.isArray;
  var isNumber = leafletHelpers.isNumber;
  var isFunction = leafletHelpers.isFunction;
  var isDefined = leafletHelpers.isDefined;

  function _isValidBounds(bounds) {
    return angular.isDefined(bounds) &amp;&amp; angular.isDefined(bounds.southWest) &amp;&amp;
           angular.isDefined(bounds.northEast) &amp;&amp; angular.isNumber(bounds.southWest.lat) &amp;&amp;
           angular.isNumber(bounds.southWest.lng) &amp;&amp; angular.isNumber(bounds.northEast.lat) &amp;&amp;
           angular.isNumber(bounds.northEast.lng);
  }

  return {
    createLeafletBounds: function(bounds) {
      if (_isValidBounds(bounds)) {
        return L.latLngBounds([bounds.southWest.lat, bounds.southWest.lng],
                              [bounds.northEast.lat, bounds.northEast.lng]);
      }
    },

    isValidBounds: _isValidBounds,

    createBoundsFromArray: function(boundsArray) {
      if (!(isArray(boundsArray) &amp;&amp; boundsArray.length === 2 &amp;&amp;
            isArray(boundsArray[0]) &amp;&amp; isArray(boundsArray[1]) &amp;&amp;
            boundsArray[0].length === 2 &amp;&amp; boundsArray[1].length === 2 &amp;&amp;
            isNumber(boundsArray[0][0]) &amp;&amp; isNumber(boundsArray[0][1]) &amp;&amp;
            isNumber(boundsArray[1][0]) &amp;&amp; isNumber(boundsArray[1][1]))) {
        $log.error('[AngularJS - Leaflet] The bounds array is not valid.');
        return;
      }

      return {
        northEast: {
          lat: boundsArray[0][0],
          lng: boundsArray[0][1],
        },
        southWest: {
          lat: boundsArray[1][0],
          lng: boundsArray[1][1],
        },
      };
    },

    createBoundsFromLeaflet: function(lfBounds) {
      if (!(isDefined(lfBounds) &amp;&amp; isFunction(lfBounds.getNorthEast) &amp;&amp; isFunction(lfBounds.getSouthWest))) {
        $log.error('[AngularJS - Leaflet] The leaflet bounds is not valid object.');
        return;
      }

      var northEast = lfBounds.getNorthEast();
      var southWest = lfBounds.getSouthWest();

      return {
        northEast: {
          lat: northEast.lat,
          lng: northEast.lng,
        },
        southWest: {
          lat: southWest.lat,
          lng: southWest.lng,
        },
      };
    },
  };
}]);

angular.module('leaflet-directive-two').factory('leafletControlHelpers', ["$rootScope", "$log", "leafletHelpers", "leafletLayerHelpers", "leafletMapDefaults", function($rootScope, $log, leafletHelpers, leafletLayerHelpers, leafletMapDefaults) {
  var isDefined = leafletHelpers.isDefined;
  var isObject = leafletHelpers.isObject;
  var createLayer = leafletLayerHelpers.createLayer;
  var _controls = {};
  var errorHeader = leafletHelpers.errorHeader + ' [Controls] ';

  var _controlLayersMustBeVisible = function(baselayers, overlays, mapId) {
    var defaults = leafletMapDefaults.getDefaults(mapId);
    if (!defaults.controls.layers.visible) {
      return false;
    }

    var atLeastOneControlItemMustBeShown = false;

    if (isObject(baselayers)) {
      Object.keys(baselayers).forEach(function(key) {
        var layer = baselayers[key];
        if (!isDefined(layer.layerOptions) || layer.layerOptions.showOnSelector !== false) {
          atLeastOneControlItemMustBeShown = true;
        }
      });
    }

    if (isObject(overlays)) {
      Object.keys(overlays).forEach(function(key) {
        var layer = overlays[key];
        if (!isDefined(layer.layerParams) || layer.layerParams.showOnSelector !== false) {
          atLeastOneControlItemMustBeShown = true;
        }
      });
    }

    return atLeastOneControlItemMustBeShown;
  };

  var _createLayersControl = function(mapId) {
    var defaults = leafletMapDefaults.getDefaults(mapId);
    var controlOptions = {
      collapsed: defaults.controls.layers.collapsed,
      position: defaults.controls.layers.position,
      autoZIndex: false,
    };

    angular.extend(controlOptions, defaults.controls.layers.options);

    var control;
    if (defaults.controls.layers &amp;&amp; isDefined(defaults.controls.layers.control)) {
      control = defaults.controls.layers.control.apply(this, [[], [], controlOptions]);
    } else {
      control = new L.control.layers([], [], controlOptions);
    }

    return control;
  };

  var controlTypes = {
    draw: {
      isPluginLoaded: function() {
        if (!angular.isDefined(L.Control.Draw)) {
          $log.error(errorHeader + ' Draw plugin is not loaded.');
          return false;
        }

        return true;
      },

      checkValidParams: function(/* params */) {
        return true;
      },

      createControl: function(params) {
        return new L.Control.Draw(params);
      },
    },
    scale: {
      isPluginLoaded: function() {
        return true;
      },

      checkValidParams: function(/* params */) {
        return true;
      },

      createControl: function(params) {
        return new L.control.scale(params);
      },
    },
    fullscreen: {
      isPluginLoaded: function() {
        if (!angular.isDefined(L.Control.Fullscreen)) {
          $log.error(errorHeader + ' Fullscreen plugin is not loaded.');
          return false;
        }

        return true;
      },

      checkValidParams: function(/* params */) {
        return true;
      },

      createControl: function(params) {
        return new L.Control.Fullscreen(params);
      },
    },
    search: {
      isPluginLoaded: function() {
        if (!angular.isDefined(L.Control.Search)) {
          $log.error(errorHeader + ' Search plugin is not loaded.');
          return false;
        }

        return true;
      },

      checkValidParams: function(/* params */) {
        return true;
      },

      createControl: function(params) {
        return new L.Control.Search(params);
      },
    },
    custom: {},
    minimap: {
      isPluginLoaded: function() {
        if (!angular.isDefined(L.Control.MiniMap)) {
          $log.error(errorHeader + ' Minimap plugin is not loaded.');
          return false;
        }

        return true;
      },

      checkValidParams: function(params) {
        if (!isDefined(params.layer)) {
          $log.warn(errorHeader + ' minimap "layer" option should be defined.');
          return false;
        }

        return true;
      },

      createControl: function(params) {
        var layer = createLayer(params.layer);

        if (!isDefined(layer)) {
          $log.warn(errorHeader + ' minimap control "layer" could not be created.');
          return;
        }

        return new L.Control.MiniMap(layer, params);
      },
    },
  };

  return {
    layersControlMustBeVisible: _controlLayersMustBeVisible,

    isValidControlType: function(type) {
      return Object.keys(controlTypes).indexOf(type) !== -1;
    },

    createControl: function(type, params) {
      if (!controlTypes[type].checkValidParams(params)) {
        return;
      }

      return controlTypes[type].createControl(params);
    },

    updateLayersControl: function(map, mapId, loaded, baselayers, overlays, leafletLayers) {
      var i;
      var _layersControl = _controls[mapId];
      var mustBeLoaded = _controlLayersMustBeVisible(baselayers, overlays, mapId);

      if (isDefined(_layersControl) &amp;&amp; loaded) {
        for (i in leafletLayers.baselayers) {
          _layersControl.removeLayer(leafletLayers.baselayers[i]);
        }

        for (i in leafletLayers.overlays) {
          _layersControl.removeLayer(leafletLayers.overlays[i]);
        }

        map.removeControl(_layersControl);
        delete _controls[mapId];
      }

      if (mustBeLoaded) {
        _layersControl = _createLayersControl(mapId);
        _controls[mapId] = _layersControl;
        for (i in baselayers) {
          var hideOnSelector = isDefined(baselayers[i].layerOptions) &amp;&amp;
                               baselayers[i].layerOptions.showOnSelector === false;
          if (!hideOnSelector &amp;&amp; isDefined(leafletLayers.baselayers[i])) {
            _layersControl.addBaseLayer(leafletLayers.baselayers[i], baselayers[i].name);
          }
        }

        for (i in overlays) {
          var hideOverlayOnSelector = isDefined(overlays[i].layerParams) &amp;&amp;
                      overlays[i].layerParams.showOnSelector === false;
          if (!hideOverlayOnSelector &amp;&amp; isDefined(leafletLayers.overlays[i])) {
            _layersControl.addOverlay(leafletLayers.overlays[i], overlays[i].name);
          }
        }

        map.addControl(_layersControl);
      }

      return mustBeLoaded;
    },
  };
}]);

angular.module('leaflet-directive-two').service('leafletData', ["$log", "$q", "leafletHelpers", function($log, $q, leafletHelpers) {
  var getDefer = leafletHelpers.getDefer,
      getUnresolvedDefer = leafletHelpers.getUnresolvedDefer,
      setResolvedDefer = leafletHelpers.setResolvedDefer;

  var _private = {};
  var self = this;

  var upperFirst = function(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
  };

  var _privateItems = [
      'map',
      'tiles',
      'layers',
      'paths',
      'markers',
      'geoJSON',
      'UTFGrid', //odd ball on naming convention keeping to not break
      'decorations',
      'directiveControls',];

  //init
  _privateItems.forEach(function(itemName) {
    _private[itemName] = {};
  });

  this.unresolveMap = function(scopeId) {
    var id = leafletHelpers.obtainEffectiveMapId(_private.map, scopeId);
    _privateItems.forEach(function(itemName) {
      _private[itemName][id] = undefined;
    });
  };

  //int repetitive stuff (get and sets)
  _privateItems.forEach(function(itemName) {
    var name = upperFirst(itemName);
    self['set' + name] = function(lObject, scopeId) {
      var defer = getUnresolvedDefer(_private[itemName], scopeId);
      defer.resolve(lObject);
      setResolvedDefer(_private[itemName], scopeId);
    };

    self['get' + name] = function(scopeId) {
      var defer = getDefer(_private[itemName], scopeId);
      return defer.promise;
    };
  });
}]);

angular.module('leaflet-directive-two')
.service('leafletDirectiveControlsHelpers', ["$log", "leafletData", "leafletHelpers", function($log, leafletData, leafletHelpers) {
  var _isDefined = leafletHelpers.isDefined;
  var _isString = leafletHelpers.isString;
  var _isObject = leafletHelpers.isObject;
  var _mainErrorHeader = leafletHelpers.errorHeader;

  var _errorHeader = _mainErrorHeader + '[leafletDirectiveControlsHelpers';

  var _extend = function(id, thingToAddName, createFn, cleanFn) {
    var _fnHeader = _errorHeader + '.extend] ';
    var extender = {};
    if (!_isDefined(thingToAddName)) {
      $log.error(_fnHeader + 'thingToAddName cannot be undefined');
      return;
    }

    if (_isString(thingToAddName) &amp;&amp; _isDefined(createFn) &amp;&amp; _isDefined(cleanFn)) {
      extender[thingToAddName] = {
        create: createFn,
        clean: cleanFn,
      };
    }    else if (_isObject(thingToAddName) &amp;&amp; !_isDefined(createFn) &amp;&amp; !_isDefined(cleanFn)) {
      extender = thingToAddName;
    }    else {
      $log.error(_fnHeader + 'incorrect arguments');
      return;
    }

    //add external control to create / destroy markers without a watch
    leafletData.getDirectiveControls().then(function(controls) {
      angular.extend(controls, extender);
      leafletData.setDirectiveControls(controls, id);
    });
  };

  return {
    extend: _extend,
  };
}]);

angular.module('leaflet-directive-two')
.service('leafletGeoJsonHelpers', ["leafletHelpers", "leafletIterators", function(leafletHelpers, leafletIterators) {
  var lHlp = leafletHelpers;
  var lIt = leafletIterators;
  var Point = function(lat, lng) {
    this.lat = lat;
    this.lng = lng;
    return this;
  };

  var _getLat = function(value) {
    if (Array.isArray(value) &amp;&amp; value.length === 2) {
      return value[1];
    } else if (lHlp.isDefined(value.type) &amp;&amp; value.type === 'Point') {
      return +value.coordinates[1];
    } else {
      return +value.lat;
    }
  };

  var _getLng = function(value) {
    if (Array.isArray(value) &amp;&amp; value.length === 2) {
      return value[0];
    } else if (lHlp.isDefined(value.type) &amp;&amp; value.type === 'Point') {
      return +value.coordinates[0];
    } else {
      return +value.lng;
    }
  };

  var _validateCoords = function(coords) {
    if (lHlp.isUndefined(coords)) {
      return false;
    }

    if (lHlp.isArray(coords)) {
      if (coords.length === 2 &amp;&amp; lHlp.isNumber(coords[0]) &amp;&amp; lHlp.isNumber(coords[1])) {
        return true;
      }
    } else if (lHlp.isDefined(coords.type)) {
      if (
          coords.type === 'Point' &amp;&amp; lHlp.isArray(coords.coordinates) &amp;&amp;
          coords.coordinates.length === 2  &amp;&amp;
          lHlp.isNumber(coords.coordinates[0]) &amp;&amp;
          lHlp.isNumber(coords.coordinates[1])) {
        return true;
      }
    }

    var ret = lIt.all(['lat', 'lng'], function(pos) {
      return lHlp.isDefined(coords[pos]) &amp;&amp; lHlp.isNumber(coords[pos]);
    });

    return ret;
  };

  var _getCoords = function(value) {
    if (!value || !_validateCoords(value)) {
      return;
    }

    var p =  null;
    if (Array.isArray(value) &amp;&amp; value.length === 2) {
      p = new Point(value[1], value[0]);
    } else if (lHlp.isDefined(value.type) &amp;&amp; value.type === 'Point') {
      p = new Point(value.coordinates[1], value.coordinates[0]);
    } else {
      return value;
    }

    //note angular.merge is avail in angular 1.4.X we might want to fill it here
    return angular.extend(value, p);//tap on lat, lng if it doesnt exist
  };

  return {
    getLat: _getLat,
    getLng: _getLng,
    validateCoords: _validateCoords,
    getCoords: _getCoords,
  };
}]);

angular.module('leaflet-directive-two').service('leafletHelpers', ["$q", "$log", function($q, $log) {
  var _errorHeader = '[AngularJS - Leaflet] ';
  var _copy = angular.copy;
  var _clone = _copy;
  /*
  For parsing paths to a field in an object

  Example:
  var obj = {
      bike:{
       1: 'hi'
       2: 'foo'
      }
  };
  _getObjectValue(obj,"bike.1") returns 'hi'
  this is getPath in ui-gmap
   */
  var _getObjectValue = function(object, pathStr) {
    var obj;
    if (!object || !angular.isObject(object))
        return;

    //if the key is not a sting then we already have the value
    if ((pathStr === null) || !angular.isString(pathStr)) {
      return pathStr;
    }

    obj = object;
    pathStr.split('.').forEach(function(value) {
      if (obj) {
        obj = obj[value];
      }
    });

    return obj;
  };

  /*
   Object Array Notation
   _getObjectArrayPath("bike.one.two")
   returns:
   'bike["one"]["two"]'
   */
  var _getObjectArrayPath = function(pathStr) {
    return pathStr.split('.').reduce(function(previous, current) {
      return previous + '["' + current + '"]';
    });
  };

  /* Object Dot Notation
   _getObjectPath(["bike","one","two"])
   returns:
   "bike.one.two"
   */
  var _getObjectDotPath = function(arrayOfStrings) {
    return arrayOfStrings.reduce(function(previous, current) {
      return previous + '.' + current;
    });
  };

  function _obtainEffectiveMapId(d, mapId) {
    var id;
    var i;
    if (!angular.isDefined(mapId)) {
      if (Object.keys(d).length === 0) {
        id = 'main';
      } else if (Object.keys(d).length &gt;= 1) {
        for (i in d) {
          if (d.hasOwnProperty(i)) {
            id = i;
          }
        }
      } else {
        $log.error(_errorHeader + '- You have more than 1 map on the DOM, you must provide the map ID to the leafletData.getXXX call');
      }
    } else {
      id = mapId;
    }

    return id;
  }

  function _getUnresolvedDefer(d, mapId) {
    var id = _obtainEffectiveMapId(d, mapId);
    var defer;

    if (!angular.isDefined(d[id]) || d[id].resolvedDefer === true) {
      defer = $q.defer();
      d[id] = {
        defer: defer,
        resolvedDefer: false,
      };
    } else {
      defer = d[id].defer;
    }

    return defer;
  }

  var _isDefined = function(value) {
    return angular.isDefined(value) &amp;&amp; value !== null;
  };

  var _isUndefined = function(value) {
    return !_isDefined(value);
  };

  // BEGIN DIRECT PORT FROM AngularJS code base

  var SPECIAL_CHARS_REGEXP = /([\:\-\_]+(.))/g;

  var MOZ_HACK_REGEXP = /^moz([A-Z])/;

  var PREFIX_REGEXP = /^((?:x|data)[\:\-_])/i;

  /**
  Converts snake_case to camelCase.
  Also there is special case for Moz prefix starting with upper case letter.
  @param name Name to normalize
   */

  var camelCase = function(name) {
      return name.replace(SPECIAL_CHARS_REGEXP, function(_, separator, letter, offset) {
        if (offset) {
          return letter.toUpperCase();
        } else {
          return letter;
        }
      }).replace(MOZ_HACK_REGEXP, 'Moz$1');
    };

  /**
  Converts all accepted directives format into proper directive name.
  @param name Name to normalize
   */

  var directiveNormalize = function(name) {
      return camelCase(name.replace(PREFIX_REGEXP, ''));
    };

  // END AngularJS port

  return {
    camelCase: camelCase,
    directiveNormalize: directiveNormalize,
    copy:_copy,
    clone:_clone,
    errorHeader: _errorHeader,
    getObjectValue: _getObjectValue,
    getObjectArrayPath:_getObjectArrayPath,
    getObjectDotPath: _getObjectDotPath,
    defaultTo: function(val, _default) {
      return _isDefined(val) ? val : _default;
    },

    //mainly for checking attributes of directives lets keep this minimal (on what we accept)
    isTruthy: function(val) {
      return val === 'true' || val === true;
    },

    //Determine if a reference is {}
    isEmpty: function(value) {
      return Object.keys(value).length === 0;
    },

    //Determine if a reference is undefined or {}
    isUndefinedOrEmpty: function(value) {
      return (angular.isUndefined(value) || value === null) || Object.keys(value).length === 0;
    },

    // Determine if a reference is defined
    isDefined: _isDefined,
    isUndefined:_isUndefined,
    isNumber: angular.isNumber,
    isString: angular.isString,
    isArray: angular.isArray,
    isObject: angular.isObject,
    isFunction: angular.isFunction,
    equals: angular.equals,

    isValidCenter: function(center) {
      return angular.isDefined(center) &amp;&amp; angular.isNumber(center.lat) &amp;&amp;
             angular.isNumber(center.lng) &amp;&amp; angular.isNumber(center.zoom);
    },

    isValidPoint: function(point) {
      if (!angular.isDefined(point)) {
        return false;
      }

      if (angular.isArray(point)) {
        return point.length === 2 &amp;&amp; angular.isNumber(point[0]) &amp;&amp; angular.isNumber(point[1]);
      }

      return angular.isNumber(point.lat) &amp;&amp; angular.isNumber(point.lng);
    },

    isSameCenterOnMap: function(centerModel, map) {
      var mapCenter = map.getCenter();
      var zoom = map.getZoom();
      if (centerModel.lat &amp;&amp; centerModel.lng &amp;&amp;
          mapCenter.lat.toFixed(4) === centerModel.lat.toFixed(4) &amp;&amp;
          mapCenter.lng.toFixed(4) === centerModel.lng.toFixed(4) &amp;&amp;
          zoom === centerModel.zoom) {
        return true;
      }

      return false;
    },

    safeApply: function($scope, fn) {
      var phase = $scope.$root.$$phase;
      if (phase === '$apply' || phase === '$digest') {
        $scope.$eval(fn);
      } else {
        $scope.$evalAsync(fn);
      }
    },

    obtainEffectiveMapId: _obtainEffectiveMapId,

    getDefer: function(d, mapId) {
      var id = _obtainEffectiveMapId(d, mapId);
      var defer;
      if (!angular.isDefined(d[id]) || d[id].resolvedDefer === false) {
        defer = _getUnresolvedDefer(d, mapId);
      } else {
        defer = d[id].defer;
      }

      return defer;
    },

    getUnresolvedDefer: _getUnresolvedDefer,

    setResolvedDefer: function(d, mapId) {
      var id = _obtainEffectiveMapId(d, mapId);
      d[id].resolvedDefer = true;
    },

    rangeIsSupported: function() {
      var testrange = document.createElement('input');
      testrange.setAttribute('type', 'range');
      return testrange.type === 'range';
    },

    FullScreenControlPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.Control.Fullscreen);
      },
    },

    MiniMapControlPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.Control.MiniMap);
      },
    },

    AwesomeMarkersPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.AwesomeMarkers) &amp;&amp; angular.isDefined(L.AwesomeMarkers.Icon);
      },

      is: function(icon) {
        if (this.isLoaded()) {
          return icon instanceof L.AwesomeMarkers.Icon;
        } else {
          return false;
        }
      },

      equal: function(iconA, iconB) {
        if (!this.isLoaded()) {
          return false;
        }

        if (this.is(iconA)) {
          return angular.equals(iconA, iconB);
        } else {
          return false;
        }
      },
    },

    VectorMarkersPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.VectorMarkers) &amp;&amp; angular.isDefined(L.VectorMarkers.Icon);
      },

      is: function(icon) {
        if (this.isLoaded()) {
          return icon instanceof L.VectorMarkers.Icon;
        } else {
          return false;
        }
      },

      equal: function(iconA, iconB) {
        if (!this.isLoaded()) {
          return false;
        }

        if (this.is(iconA)) {
          return angular.equals(iconA, iconB);
        } else {
          return false;
        }
      },
    },

    DomMarkersPlugin: {
      isLoaded: function() {
        if (angular.isDefined(L.DomMarkers) &amp;&amp; angular.isDefined(L.DomMarkers.Icon)) {
          return true;
        } else {
          return false;
        }
      },

      is: function(icon) {
        if (this.isLoaded()) {
          return icon instanceof L.DomMarkers.Icon;
        } else {
          return false;
        }
      },

      equal: function(iconA, iconB) {
        if (!this.isLoaded()) {
          return false;
        }

        if (this.is(iconA)) {
          return angular.equals(iconA, iconB);
        } else {
          return false;
        }
      },
    },

    PolylineDecoratorPlugin: {
      isLoaded: function() {
        if (angular.isDefined(L.PolylineDecorator)) {
          return true;
        } else {
          return false;
        }
      },

      is: function(decoration) {
        if (this.isLoaded()) {
          return decoration instanceof L.PolylineDecorator;
        } else {
          return false;
        }
      },

      equal: function(decorationA, decorationB) {
        if (!this.isLoaded()) {
          return false;
        }

        if (this.is(decorationA)) {
          return angular.equals(decorationA, decorationB);
        } else {
          return false;
        }
      },
    },

    MakiMarkersPlugin: {
      isLoaded: function() {
        if (angular.isDefined(L.MakiMarkers) &amp;&amp; angular.isDefined(L.MakiMarkers.Icon)) {
          return true;
        } else {
          return false;
        }
      },

      is: function(icon) {
        if (this.isLoaded()) {
          return icon instanceof L.MakiMarkers.Icon;
        } else {
          return false;
        }
      },

      equal: function(iconA, iconB) {
        if (!this.isLoaded()) {
          return false;
        }

        if (this.is(iconA)) {
          return angular.equals(iconA, iconB);
        } else {
          return false;
        }
      },
    },
    ExtraMarkersPlugin: {
      isLoaded: function() {
        if (angular.isDefined(L.ExtraMarkers) &amp;&amp; angular.isDefined(L.ExtraMarkers.Icon)) {
          return true;
        } else {
          return false;
        }
      },

      is: function(icon) {
        if (this.isLoaded()) {
          return icon instanceof L.ExtraMarkers.Icon;
        } else {
          return false;
        }
      },

      equal: function(iconA, iconB) {
        if (!this.isLoaded()) {
          return false;
        }

        if (this.is(iconA)) {
          return angular.equals(iconA, iconB);
        } else {
          return false;
        }
      },
    },
    LabelPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.Label);
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.MarkerClusterGroup;
        } else {
          return false;
        }
      },
    },
    MarkerClusterPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.MarkerClusterGroup);
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.MarkerClusterGroup;
        } else {
          return false;
        }
      },
    },
    GoogleLayerPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.Google);
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.Google;
        } else {
          return false;
        }
      },
    },
    LeafletProviderPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.TileLayer.Provider);
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.TileLayer.Provider;
        } else {
          return false;
        }
      },
    },
    ChinaLayerPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.tileLayer.chinaProvider);
      },
    },
    HeatLayerPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.heatLayer);
      },
    },
    WebGLHeatMapLayerPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.TileLayer.WebGLHeatMap);
      },
    },
    BingLayerPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.BingLayer);
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.BingLayer;
        } else {
          return false;
        }
      },
    },
    WFSLayerPlugin: {
      isLoaded: function() {
        return L.GeoJSON.WFS !== undefined;
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.GeoJSON.WFS;
        } else {
          return false;
        }
      },
    },
    AGSBaseLayerPlugin: {
      isLoaded: function() {
        return L.esri !== undefined &amp;&amp; L.esri.basemapLayer !== undefined;
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.esri.basemapLayer;
        } else {
          return false;
        }
      },
    },
    AGSLayerPlugin: {
      isLoaded: function() {
        return lvector !== undefined &amp;&amp; lvector.AGS !== undefined;
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof lvector.AGS;
        } else {
          return false;
        }
      },
    },
    AGSFeatureLayerPlugin: {
      isLoaded: function() {
        return L.esri !== undefined &amp;&amp; L.esri.featureLayer !== undefined;
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.esri.featureLayer;
        } else {
          return false;
        }
      },
    },
    AGSTiledMapLayerPlugin: {
      isLoaded: function() {
        return L.esri !== undefined &amp;&amp; L.esri.tiledMapLayer !== undefined;
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.esri.tiledMapLayer;
        } else {
          return false;
        }
      },
    },
    AGSDynamicMapLayerPlugin: {
      isLoaded: function() {
        return L.esri !== undefined &amp;&amp; L.esri.dynamicMapLayer !== undefined;
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.esri.dynamicMapLayer;
        } else {
          return false;
        }
      },
    },
    AGSImageMapLayerPlugin: {
      isLoaded: function() {
        return L.esri !== undefined &amp;&amp; L.esri.imageMapLayer !== undefined;
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.esri.imageMapLayer;
        } else {
          return false;
        }
      },
    },
    AGSClusteredLayerPlugin: {
      isLoaded: function() {
        return L.esri !== undefined &amp;&amp; L.esri.clusteredFeatureLayer !== undefined;
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.esri.clusteredFeatureLayer;
        } else {
          return false;
        }
      },
    },
    AGSHeatmapLayerPlugin: {
      isLoaded: function() {
        return L.esri !== undefined &amp;&amp; L.esri.heatmapFeatureLayer !== undefined;
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.esri.heatmapFeatureLayer;
        } else {
          return false;
        }
      },
    },
    YandexLayerPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.Yandex);
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.Yandex;
        } else {
          return false;
        }
      },
    },
    GeoJSONPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.TileLayer.GeoJSON);
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.TileLayer.GeoJSON;
        } else {
          return false;
        }
      },
    },
    UTFGridPlugin: {
      isLoaded: function() {
        return angular.isDefined(L.UtfGrid);
      },

      is: function(layer) {
        if (this.isLoaded()) {
          return layer instanceof L.UtfGrid;
        } else {
          $log.error('[AngularJS - Leaflet] No UtfGrid plugin found.');
          return false;
        }
      },
    },
    CartoDB: {
      isLoaded: function() {
        return cartodb;
      },

      is: function(/*layer*/) {
        return true;
        /*
        if (this.isLoaded()) {
            return layer instanceof L.TileLayer.GeoJSON;
        } else {
            return false;
        }*/
      },
    },
    Leaflet: {
      DivIcon: {
        is: function(icon) {
          return icon instanceof L.DivIcon;
        },

        equal: function(iconA, iconB) {
          if (this.is(iconA)) {
            return angular.equals(iconA, iconB);
          } else {
            return false;
          }
        },
      },
      Icon: {
        is: function(icon) {
          return icon instanceof L.Icon;
        },

        equal: function(iconA, iconB) {
          if (this.is(iconA)) {
            return angular.equals(iconA, iconB);
          } else {
            return false;
          }
        },
      },
    },
    /*
     watchOptions - object to set deep nested watches and turn off watches all together
     (rely on control / functional updates)
     watchOptions - Object
         doWatch:boolean
         isDeep:boolean (sets $watch(function,isDeep))
         individual
             doWatch:boolean
             isDeep:boolean
     */

    //legacy defaults
    watchOptions: {
      doWatch:true,
      isDeep: true,
      individual:{
        doWatch:true,
        isDeep: true,
      },
    },
  };
}]);

angular.module('leaflet-directive-two').service('leafletIterators', ["$log", "leafletHelpers", function($log, leafletHelpers) {

  var lHlp = leafletHelpers;
  var errorHeader = leafletHelpers.errorHeader + 'leafletIterators: ';

  //BEGIN COPY from underscore
  var _keys = Object.keys;
  var _isFunction = lHlp.isFunction;
  var _isObject = lHlp.isObject;

  // Helper for collection methods to determine whether a collection
  // should be iterated as an array or as an object
  // Related: http://people.mozilla.org/~jorendorff/es6-draft.html#sec-tolength
  var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;

  var _isArrayLike = function(collection) {
    var length = collection !== null &amp;&amp; collection.length;
    return lHlp.isNumber(length) &amp;&amp; length &gt;= 0 &amp;&amp; length &lt;= MAX_ARRAY_INDEX;
  };

  // Keep the identity function around for default iteratees.
  var _identity = function(value) {
    return value;
  };

  var _property = function(key) {
    return function(obj) {
      return obj === null ? void 0 : obj[key];
    };
  };

  // Internal function that returns an efficient (for current engines) version
  // of the passed-in callback, to be repeatedly applied in other Underscore
  // functions.
  var optimizeCb = function(func, context, argCount) {
    if (context === void 0) return func;
    switch (argCount === null ? 3 : argCount) {
      case 1: return function(value) {
        return func.call(context, value);
      };

      case 2: return function(value, other) {
        return func.call(context, value, other);
      };

      case 3: return function(value, index, collection) {
        return func.call(context, value, index, collection);
      };

      case 4: return function(accumulator, value, index, collection) {
        return func.call(context, accumulator, value, index, collection);
      };
    }
    return function() {
      return func.apply(context, arguments);
    };
  };

  // An internal function for creating assigner functions.
  var createAssigner = function(keysFunc, undefinedOnly) {
    return function(obj) {
      var length = arguments.length;
      if (length &lt; 2 || obj === null) return obj;
      for (var index = 1; index &lt; length; index++) {
        var source = arguments[index];
        var keys = keysFunc(source);
        var l = keys.length;

        for (var i = 0; i &lt; l; i++) {
          var key = keys[i];
          if (!undefinedOnly || obj[key] === void 0) obj[key] = source[key];
        }
      }

      return obj;
    };
  };

  // Assigns a given object with all the own properties in the passed-in object(s)
  // (https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)
  var _extendOwn;
  var _assign = null;
  _extendOwn = _assign = createAssigner(_keys);

  // Returns whether an object has a given set of `key:value` pairs.
  var _isMatch = function(object, attrs) {
    var keys = _keys(attrs);
    var length = keys.length;
    if (object === null) return !length;
    var obj = Object(object);
    for (var i = 0; i &lt; length; i++) {
      var key = keys[i];
      if (attrs[key] !== obj[key] || !(key in obj)) return false;
    }

    return true;
  };

  // Returns a predicate for checking whether an object has a given set of
  // `key:value` pairs.
  var _matcher;
  var _matches = null;
  _matcher = _matches = function(attrs) {
    attrs = _extendOwn({}, attrs);
    return function(obj) {
      return _isMatch(obj, attrs);
    };
  };

  // A mostly-internal function to generate callbacks that can be applied
  // to each element in a collection, returning the desired result — either
  // identity, an arbitrary callback, a property matcher, or a property accessor.
  var cb = function(value, context, argCount) {
    if (value === null) return _identity;
    if (_isFunction(value)) return optimizeCb(value, context, argCount);
    if (_isObject(value)) return _matcher(value);
    return _property(value);
  };

  var _every;
  var _all = null;
  _every = _all = function(obj, predicate, context) {
    predicate = cb(predicate, context);
    var keys = !_isArrayLike(obj) &amp;&amp; _keys(obj);
    var length = (keys || obj).length;
    for (var index = 0; index &lt; length; index++) {
      var currentKey = keys ? keys[index] : index;
      if (!predicate(obj[currentKey], currentKey, obj)) return false;
    }

    return true;
  };

  //END COPY fron underscore

  var _hasErrors = function(collection, cb, ignoreCollection, cbName) {
    if (!ignoreCollection) {
      if (!lHlp.isDefined(collection) || !lHlp.isDefined(cb)) {
        return true;
      }
    }

    if (!lHlp.isFunction(cb)) {
      cbName = lHlp.defaultTo(cb, 'cb');
      $log.error(errorHeader + cbName + ' is not a function');
      return true;
    }

    return false;
  };

  var _iterate = function(collection, externalCb, internalCb) {
    if (_hasErrors(undefined, internalCb, true, 'internalCb')) {
      return;
    }

    if (!_hasErrors(collection, externalCb)) {
      for (var key in collection) {
        if (collection.hasOwnProperty(key)) {
          internalCb(collection[key], key);
        }
      }
    }
  };

  //see http://jsperf.com/iterators/3
  //utilizing for in is way faster
  var _each = function(collection, cb) {
    _iterate(collection, cb, function(val, key) {
      cb(val, key);
    });
  };

  return {
    each:_each,
    forEach: _each,
    every: _every,
    all: _all,
  };
}]);

angular.module('leaflet-directive-two')
.factory('leafletLayerHelpers', ["$rootScope", "$log", "$q", "leafletHelpers", "leafletIterators", function($rootScope, $log, $q, leafletHelpers, leafletIterators) {
  var Helpers = leafletHelpers;
  var isString = leafletHelpers.isString;
  var isObject = leafletHelpers.isObject;
  var isArray = leafletHelpers.isArray;
  var isDefined = leafletHelpers.isDefined;
  var errorHeader = leafletHelpers.errorHeader;
  var $it = leafletIterators;

  var utfGridCreateLayer = function(params) {
    if (!Helpers.UTFGridPlugin.isLoaded()) {
      $log.error('[AngularJS - Leaflet] The UTFGrid plugin is not loaded.');
      return;
    }

    var utfgrid = new L.UtfGrid(params.url, params.pluginOptions);

    utfgrid.on('mouseover', function(e) {
      $rootScope.$broadcast('leafletDirectiveMap.utfgridMouseover', e);
    });

    utfgrid.on('mouseout', function(e) {
      $rootScope.$broadcast('leafletDirectiveMap.utfgridMouseout', e);
    });

    utfgrid.on('click', function(e) {
      $rootScope.$broadcast('leafletDirectiveMap.utfgridClick', e);
    });

    utfgrid.on('mousemove', function(e) {
      $rootScope.$broadcast('leafletDirectiveMap.utfgridMousemove', e);
    });

    return utfgrid;
  };

  var layerTypes = {
    xyz: {
      mustHaveUrl: true,
      createLayer: function(params) {
        return L.tileLayer(params.url, params.options);
      },
    },
    mapbox: {
      mustHaveKey: true,
      createLayer: function(params) {
        var version = 3;
        if (isDefined(params.options.version) &amp;&amp; params.options.version === 4) {
          version = params.options.version;
        }

        var url = version === 3 ?
            '//{s}.tiles.mapbox.com/v3/' + params.key + '/{z}/{x}/{y}.png' :
            '//api.tiles.mapbox.com/v4/' + params.key + '/{z}/{x}/{y}.png?access_token=' + params.apiKey;
        return L.tileLayer(url, params.options);
      },
    },
    geoJSON: {
      mustHaveUrl: true,
      createLayer: function(params) {
        if (!Helpers.GeoJSONPlugin.isLoaded()) {
          return;
        }

        return new L.TileLayer.GeoJSON(params.url, params.pluginOptions, params.options);
      },
    },
    geoJSONShape: {
      mustHaveUrl: false,
      createLayer: function(params) {
        return new L.GeoJSON(params.data,
            params.options);
      },
    },
    geoJSONAwesomeMarker: {
      mustHaveUrl: false,
      createLayer: function(params) {
        return new L.geoJson(params.data, {
          pointToLayer: function(feature, latlng) {
            return L.marker(latlng, {icon: L.AwesomeMarkers.icon(params.icon)});
          },
        });
      },
    },
    geoJSONVectorMarker: {
      mustHaveUrl: false,
      createLayer: function(params) {
        return new L.geoJson(params.data, {
          pointToLayer: function(feature, latlng) {
            return L.marker(latlng, {icon: L.VectorMarkers.icon(params.icon)});
          },
        });
      },
    },
    utfGrid: {
      mustHaveUrl: true,
      createLayer: utfGridCreateLayer,
    },
    cartodbTiles: {
      mustHaveKey: true,
      createLayer: function(params) {
        var url = '//' + params.user + '.cartodb.com/api/v1/map/' + params.key + '/{z}/{x}/{y}.png';
        return L.tileLayer(url, params.options);
      },
    },
    cartodbUTFGrid: {
      mustHaveKey: true,
      mustHaveLayer: true,
      createLayer: function(params) {
        params.url = '//' + params.user + '.cartodb.com/api/v1/map/' + params.key + '/' + params.layer + '/{z}/{x}/{y}.grid.json';
        return utfGridCreateLayer(params);
      },
    },
    cartodbInteractive: {
      mustHaveKey: true,
      mustHaveLayer: true,
      createLayer: function(params) {
        var tilesURL = '//' + params.user + '.cartodb.com/api/v1/map/' + params.key + '/{z}/{x}/{y}.png';
        var tileLayer = L.tileLayer(tilesURL, params.options);
        params.url = '//' + params.user + '.cartodb.com/api/v1/map/' + params.key + '/' + params.layer + '/{z}/{x}/{y}.grid.json';
        var utfLayer = utfGridCreateLayer(params);
        return L.layerGroup([tileLayer, utfLayer]);
      },
    },
    wms: {
      mustHaveUrl: true,
      createLayer: function(params) {
        return L.tileLayer.wms(params.url, params.options);
      },
    },
    wmts: {
      mustHaveUrl: true,
      createLayer: function(params) {
        return L.tileLayer.wmts(params.url, params.options);
      },
    },
    wfs: {
      mustHaveUrl: true,
      mustHaveLayer: true,
      createLayer: function(params) {
        if (!Helpers.WFSLayerPlugin.isLoaded()) {
          return;
        }

        var options = angular.copy(params.options);
        if (options.crs &amp;&amp; typeof options.crs === 'string') {
          /*jshint -W061 */
          options.crs = eval(options.crs);
        }

        return new L.GeoJSON.WFS(params.url, params.layer, options);
      },
    },
    group: {
      mustHaveUrl: false,
      createLayer: function(params) {
        var lyrs = [];
        $it.each(params.options.layers, function(l) {
                  lyrs.push(createLayer(l));
                });

        params.options.loadedDefer = function() {
          var defers = [];
          if (isDefined(params.options.layers)) {
            for (var i = 0; i &lt; params.options.layers.length; i++) {
              var d = params.options.layers[i].layerOptions.loadedDefer;
              if (isDefined(d)) {
                defers.push(d);
              }
            }
          }

          return defers;
        };

        return L.layerGroup(lyrs);
      },
    },
    featureGroup: {
      mustHaveUrl: false,
      createLayer: function() {
        return L.featureGroup();
      },
    },
    google: {
      mustHaveUrl: false,
      createLayer: function(params) {
        var type = params.type || 'SATELLITE';
        if (!Helpers.GoogleLayerPlugin.isLoaded()) {
          return;
        }

        return new L.Google(type, params.options);
      },
    },
    here: {
      mustHaveUrl: false,
      createLayer: function(params) {
        var provider = params.provider || 'HERE.terrainDay';
        if (!Helpers.LeafletProviderPlugin.isLoaded()) {
          return;
        }

        return new L.TileLayer.Provider(provider, params.options);
      },
    },
    china:{
      mustHaveUrl:false,
      createLayer:function(params) {
        var type = params.type || '';
        if (!Helpers.ChinaLayerPlugin.isLoaded()) {
          return;
        }

        return L.tileLayer.chinaProvider(type, params.options);
      },
    },
    agsBase: {
      mustHaveLayer: true,
      createLayer: function(params) {
        if (!Helpers.AGSBaseLayerPlugin.isLoaded()) {
          return;
        }

        return L.esri.basemapLayer(params.layer, params.options);
      },
    },
    ags: {
      mustHaveUrl: true,
      createLayer: function(params) {
        if (!Helpers.AGSLayerPlugin.isLoaded()) {
          return;
        }

        var options = angular.copy(params.options);
        angular.extend(options, {
          url: params.url,
        });
        var layer = new lvector.AGS(options);
        layer.onAdd = function(map) {
          this.setMap(map);
        };

        layer.onRemove = function() {
          this.setMap(null);
        };

        return layer;
      },
    },
    agsFeature: {
      mustHaveUrl: true,
      createLayer: function(params) {
        if (!Helpers.AGSFeatureLayerPlugin.isLoaded()) {
          $log.warn(errorHeader + ' The esri plugin is not loaded.');
          return;
        }

        params.options.url = params.url;

        var layer = L.esri.featureLayer(params.options);
        var load = function() {
          if (isDefined(params.options.loadedDefer)) {
            params.options.loadedDefer.resolve();
          }
        };

        layer.on('loading', function() {
          params.options.loadedDefer = $q.defer();
          layer.off('load', load);
          layer.on('load', load);
        });

        return layer;
      },
    },
    agsTiled: {
      mustHaveUrl: true,
      createLayer: function(params) {
        if (!Helpers.AGSTiledMapLayerPlugin.isLoaded()) {
          $log.warn(errorHeader + ' The esri plugin is not loaded.');
          return;
        }

        params.options.url = params.url;

        return L.esri.tiledMapLayer(params.options);
      },
    },
    agsDynamic: {
      mustHaveUrl: true,
      createLayer: function(params) {
        if (!Helpers.AGSDynamicMapLayerPlugin.isLoaded()) {
          $log.warn(errorHeader + ' The esri plugin is not loaded.');
          return;
        }

        params.options.url = params.url;

        return L.esri.dynamicMapLayer(params.options);
      },
    },
    agsImage: {
      mustHaveUrl: true,
      createLayer: function(params) {
        if (!Helpers.AGSImageMapLayerPlugin.isLoaded()) {
          $log.warn(errorHeader + ' The esri plugin is not loaded.');
          return;
        }

        params.options.url = params.url;

        return L.esri.imageMapLayer(params.options);
      },
    },
    agsClustered: {
      mustHaveUrl: true,
      createLayer: function(params) {
        if (!Helpers.AGSClusteredLayerPlugin.isLoaded()) {
          $log.warn(errorHeader + ' The esri clustered layer plugin is not loaded.');
          return;
        }

        if (!Helpers.MarkerClusterPlugin.isLoaded()) {
          $log.warn(errorHeader + ' The markercluster plugin is not loaded.');
          return;
        }

        return L.esri.clusteredFeatureLayer(params.url, params.options);
      },
    },
    agsHeatmap: {
      mustHaveUrl: true,
      createLayer: function(params) {
        if (!Helpers.AGSHeatmapLayerPlugin.isLoaded()) {
          $log.warn(errorHeader + ' The esri heatmap layer plugin is not loaded.');
          return;
        }

        if (!Helpers.HeatLayerPlugin.isLoaded()) {
          $log.warn(errorHeader + ' The heatlayer plugin is not loaded.');
          return;
        }

        return L.esri.heatmapFeatureLayer(params.url, params.options);
      },
    },
    markercluster: {
      mustHaveUrl: false,
      createLayer: function(params) {
        if (!Helpers.MarkerClusterPlugin.isLoaded()) {
          $log.warn(errorHeader + ' The markercluster plugin is not loaded.');
          return;
        }

        return new L.MarkerClusterGroup(params.options);
      },
    },
    bing: {
      mustHaveUrl: false,
      createLayer: function(params) {
        if (!Helpers.BingLayerPlugin.isLoaded()) {
          return;
        }

        return new L.BingLayer(params.key, params.options);
      },
    },
    webGLHeatmap: {
      mustHaveUrl: false,
      mustHaveData: true,
      createLayer: function(params) {
        if (!Helpers.WebGLHeatMapLayerPlugin.isLoaded()) {
          return;
        }

        var layer = new L.TileLayer.WebGLHeatMap(params.options);
        if (isDefined(params.data)) {
          layer.setData(params.data);
        }

        return layer;
      },
    },
    heat: {
      mustHaveUrl: false,
      mustHaveData: true,
      createLayer: function(params) {
        if (!Helpers.HeatLayerPlugin.isLoaded()) {
          return;
        }

        var layer = new L.heatLayer();

        if (isArray(params.data)) {
          layer.setLatLngs(params.data);
        }

        if (isObject(params.options)) {
          layer.setOptions(params.options);
        }

        return layer;
      },
    },
    yandex: {
      mustHaveUrl: false,
      createLayer: function(params) {
        var type = params.type || 'map';
        if (!Helpers.YandexLayerPlugin.isLoaded()) {
          return;
        }

        return new L.Yandex(type, params.options);
      },
    },
    imageOverlay: {
      mustHaveUrl: true,
      mustHaveBounds: true,
      createLayer: function(params) {
        return L.imageOverlay(params.url, params.bounds, params.options);
      },
    },
    iip: {
      mustHaveUrl: true,
      createLayer: function(params) {
        return L.tileLayer.iip(params.url, params.options);
      },
    },

    // This "custom" type is used to accept every layer that user want to define himself.
    // We can wrap these custom layers like heatmap or yandex, but it means a lot of work/code to wrap the world,
    // so we let user to define their own layer outside the directive,
    // and pass it on "createLayer" result for next processes
    custom: {
      createLayer: function(params) {
        if (params.layer instanceof L.Class) {
          return angular.copy(params.layer);
        }        else {
          $log.error('[AngularJS - Leaflet] A custom layer must be a leaflet Class');
        }
      },
    },
    cartodb: {
      mustHaveUrl: true,
      createLayer: function(params) {
        return cartodb.createLayer(params.map, params.url);
      },
    },
  };

  function isValidLayerType(layerDefinition) {
    // Check if the baselayer has a valid type
    if (!isString(layerDefinition.type)) {
      $log.error('[AngularJS - Leaflet] A layer must have a valid type defined.');
      return false;
    }

    if (Object.keys(layerTypes).indexOf(layerDefinition.type) === -1) {
      $log.error('[AngularJS - Leaflet] A layer must have a valid type: ' + Object.keys(layerTypes));
      return false;
    }

    // Check if the layer must have an URL
    if (layerTypes[layerDefinition.type].mustHaveUrl &amp;&amp; !isString(layerDefinition.url)) {
      $log.error('[AngularJS - Leaflet] A base layer must have an url');
      return false;
    }

    if (layerTypes[layerDefinition.type].mustHaveData &amp;&amp; !isDefined(layerDefinition.data)) {
      $log.error('[AngularJS - Leaflet] The base layer must have a "data" array attribute');
      return false;
    }

    if (layerTypes[layerDefinition.type].mustHaveLayer &amp;&amp; !isDefined(layerDefinition.layer)) {
      $log.error('[AngularJS - Leaflet] The type of layer ' + layerDefinition.type + ' must have an layer defined');
      return false;
    }

    if (layerTypes[layerDefinition.type].mustHaveBounds &amp;&amp; !isDefined(layerDefinition.bounds)) {
      $log.error('[AngularJS - Leaflet] The type of layer ' + layerDefinition.type + ' must have bounds defined');
      return false;
    }

    if (layerTypes[layerDefinition.type].mustHaveKey &amp;&amp; !isDefined(layerDefinition.key)) {
      $log.error('[AngularJS - Leaflet] The type of layer ' + layerDefinition.type + ' must have key defined');
      return false;
    }

    return true;
  }

  function createLayer(layerDefinition) {
    if (!isValidLayerType(layerDefinition)) {
      return;
    }

    if (!isString(layerDefinition.name)) {
      $log.error('[AngularJS - Leaflet] A base layer must have a name');
      return;
    }

    if (!isObject(layerDefinition.layerParams)) {
      layerDefinition.layerParams = {};
    }

    if (!isObject(layerDefinition.layerOptions)) {
      layerDefinition.layerOptions = {};
    }

    // Mix the layer specific parameters with the general Leaflet options. Although this is an overhead
    // the definition of a base layers is more 'clean' if the two types of parameters are differentiated
    for (var attrname in layerDefinition.layerParams) {
      layerDefinition.layerOptions[attrname] = layerDefinition.layerParams[attrname];
    }

    var params = {
      url: layerDefinition.url,
      data: layerDefinition.data,
      options: layerDefinition.layerOptions,
      layer: layerDefinition.layer,
      icon: layerDefinition.icon,
      type: layerDefinition.layerType,
      bounds: layerDefinition.bounds,
      key: layerDefinition.key,
      apiKey: layerDefinition.apiKey,
      pluginOptions: layerDefinition.pluginOptions,
      user: layerDefinition.user,
    };

    //TODO Add $watch to the layer properties
    return layerTypes[layerDefinition.type].createLayer(params);
  }

  function safeAddLayer(map, layer) {
    if (layer &amp;&amp; typeof layer.addTo === 'function') {
      layer.addTo(map);
    } else {
      map.addLayer(layer);
    }
  }

  function safeRemoveLayer(map, layer, layerOptions) {
    if (isDefined(layerOptions) &amp;&amp; isDefined(layerOptions.loadedDefer)) {
      if (angular.isFunction(layerOptions.loadedDefer)) {
        var defers = layerOptions.loadedDefer();
        $log.debug('Loaded Deferred', defers);
        var count = defers.length;
        if (count &gt; 0) {
          var resolve = function() {
            count--;
            if (count === 0) {
              map.removeLayer(layer);
            }
          };

          for (var i = 0; i &lt; defers.length; i++) {
            defers[i].promise.then(resolve);
          }
        } else {
          map.removeLayer(layer);
        }
      } else {
        layerOptions.loadedDefer.promise.then(function() {
          map.removeLayer(layer);
        });
      }
    } else {
      map.removeLayer(layer);
    }
  }

  return {
    createLayer: createLayer,
    safeAddLayer: safeAddLayer,
    safeRemoveLayer: safeRemoveLayer,
  };
}]);

angular.module('leaflet-directive-two').factory('leafletLegendHelpers', function() {
  var _updateLegend = function(div, legendData, type, url) {
    div.innerHTML = '';
    if (legendData.error) {
      div.innerHTML += '&lt;div class="info-title alert alert-danger"&gt;' + legendData.error.message + '&lt;/div&gt;';
    } else {
      if (type === 'arcgis') {
        for (var i = 0; i &lt; legendData.layers.length; i++) {
          var layer = legendData.layers[i];
          div.innerHTML += '&lt;div class="info-title" data-layerid="' + layer.layerId + '"&gt;' + layer.layerName + '&lt;/div&gt;';
          for (var j = 0; j &lt; layer.legend.length; j++) {
            var leg = layer.legend[j];
            div.innerHTML +=
            '&lt;div class="inline" data-layerid="' + layer.layerId + '"&gt;&lt;img src="data:' + leg.contentType + ';base64,' + leg.imageData + '" /&gt;&lt;/div&gt;' +
            '&lt;div class="info-label" data-layerid="' + layer.layerId + '"&gt;' + leg.label + '&lt;/div&gt;';
          }
        }
      }      else if (type === 'image') {
        div.innerHTML = '&lt;img src="' + url + '"/&gt;';
      }
    }
  };

  var _getOnAddLegend = function(legendData, legendClass, type, url) {
    return function(/*map*/) {
      var div = L.DomUtil.create('div', legendClass);

      if (!L.Browser.touch) {
        L.DomEvent.disableClickPropagation(div);
        L.DomEvent.on(div, 'mousewheel', L.DomEvent.stopPropagation);
      } else {
        L.DomEvent.on(div, 'click', L.DomEvent.stopPropagation);
      }

      _updateLegend(div, legendData, type, url);
      return div;
    };
  };

  var _getOnAddArrayLegend = function(legend, legendClass) {
    return function(/*map*/) {
      var div = L.DomUtil.create('div', legendClass);
      for (var i = 0; i &lt; legend.colors.length; i++) {
        div.innerHTML +=
            '&lt;div class="outline"&gt;&lt;i style="background:' + legend.colors[i] + '"&gt;&lt;/i&gt;&lt;/div&gt;' +
            '&lt;div class="info-label"&gt;' + legend.labels[i] + '&lt;/div&gt;';
      }

      if (!L.Browser.touch) {
        L.DomEvent.disableClickPropagation(div);
        L.DomEvent.on(div, 'mousewheel', L.DomEvent.stopPropagation);
      } else {
        L.DomEvent.on(div, 'click', L.DomEvent.stopPropagation);
      }

      return div;
    };
  };

  return {
    getOnAddLegend: _getOnAddLegend,
    getOnAddArrayLegend: _getOnAddArrayLegend,
    updateLegend: _updateLegend,
  };
});

angular.module('leaflet-directive-two').factory('leafletMapDefaults', ["$q", "leafletHelpers", function($q, leafletHelpers) {
  function _getDefaults() {
    return {
      keyboard: true,
      dragging: true,
      worldCopyJump: false,
      doubleClickZoom: true,
      scrollWheelZoom: true,
      tap: true,
      touchZoom: true,
      zoomControl: true,
      zoomsliderControl: false,
      zoomControlPosition: 'topleft',
      attributionControl: true,
      controls: {
        layers: {
          visible: true,
          position: 'topright',
          collapsed: true,
        },
      },
      nominatim: {
        server: ' http://nominatim.openstreetmap.org/search',
      },
      crs: L.CRS.EPSG3857,
      tileLayer: '//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      tileLayerOptions: {
        attribution: '&amp;copy; &lt;a href="http://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors',
      },
      path: {
        weight: 10,
        opacity: 1,
        color: '#0000ff',
      },
      center: {
        lat: 0,
        lng: 0,
        zoom: 1,
      },
    };
  }

  var isDefined = leafletHelpers.isDefined;
  var isObject = leafletHelpers.isObject;
  var obtainEffectiveMapId = leafletHelpers.obtainEffectiveMapId;
  var defaults = {};

  // Get the _defaults dictionary, and override the properties defined by the user
  return {
    reset: function() {
      defaults = {};
    },

    getDefaults: function(scopeId) {
      var mapId = obtainEffectiveMapId(defaults, scopeId);
      return defaults[mapId];
    },

    getMapCreationDefaults: function(scopeId) {
      var mapId = obtainEffectiveMapId(defaults, scopeId);
      var d = defaults[mapId];

      var mapDefaults = {
        maxZoom: d.maxZoom,
        keyboard: d.keyboard,
        dragging: d.dragging,
        zoomControl: d.zoomControl,
        doubleClickZoom: d.doubleClickZoom,
        scrollWheelZoom: d.scrollWheelZoom,
        tap: d.tap,
        touchZoom: d.touchZoom,
        attributionControl: d.attributionControl,
        worldCopyJump: d.worldCopyJump,
        crs: d.crs,
      };

      if (isDefined(d.minZoom)) {
        mapDefaults.minZoom = d.minZoom;
      }

      if (isDefined(d.zoomAnimation)) {
        mapDefaults.zoomAnimation = d.zoomAnimation;
      }

      if (isDefined(d.fadeAnimation)) {
        mapDefaults.fadeAnimation = d.fadeAnimation;
      }

      if (isDefined(d.markerZoomAnimation)) {
        mapDefaults.markerZoomAnimation = d.markerZoomAnimation;
      }

      if (d.map) {
        for (var option in d.map) {
          mapDefaults[option] = d.map[option];
        }
      }

      return mapDefaults;
    },

    setDefaults: function(userDefaults, scopeId) {
      var newDefaults = _getDefaults();

      if (isDefined(userDefaults)) {
        newDefaults.doubleClickZoom = isDefined(userDefaults.doubleClickZoom) ? userDefaults.doubleClickZoom : newDefaults.doubleClickZoom;
        newDefaults.scrollWheelZoom = isDefined(userDefaults.scrollWheelZoom) ? userDefaults.scrollWheelZoom : newDefaults.doubleClickZoom;
        newDefaults.tap = isDefined(userDefaults.tap) ? userDefaults.tap : newDefaults.tap;
        newDefaults.touchZoom = isDefined(userDefaults.touchZoom) ? userDefaults.touchZoom : newDefaults.doubleClickZoom;
        newDefaults.zoomControl = isDefined(userDefaults.zoomControl) ? userDefaults.zoomControl : newDefaults.zoomControl;
        newDefaults.zoomsliderControl = isDefined(userDefaults.zoomsliderControl) ? userDefaults.zoomsliderControl : newDefaults.zoomsliderControl;
        newDefaults.attributionControl = isDefined(userDefaults.attributionControl) ? userDefaults.attributionControl : newDefaults.attributionControl;
        newDefaults.tileLayer = isDefined(userDefaults.tileLayer) ? userDefaults.tileLayer : newDefaults.tileLayer;
        newDefaults.zoomControlPosition = isDefined(userDefaults.zoomControlPosition) ? userDefaults.zoomControlPosition : newDefaults.zoomControlPosition;
        newDefaults.keyboard = isDefined(userDefaults.keyboard) ? userDefaults.keyboard : newDefaults.keyboard;
        newDefaults.dragging = isDefined(userDefaults.dragging) ? userDefaults.dragging : newDefaults.dragging;

        if (isDefined(userDefaults.controls)) {
          angular.extend(newDefaults.controls, userDefaults.controls);
        }

        if (isObject(userDefaults.crs)) {
          newDefaults.crs = userDefaults.crs;
        } else if (isDefined(L.CRS[userDefaults.crs])) {
          newDefaults.crs = L.CRS[userDefaults.crs];
        }

        if (isDefined(userDefaults.center)) {
          angular.copy(userDefaults.center, newDefaults.center);
        }

        if (isDefined(userDefaults.tileLayerOptions)) {
          angular.copy(userDefaults.tileLayerOptions, newDefaults.tileLayerOptions);
        }

        if (isDefined(userDefaults.maxZoom)) {
          newDefaults.maxZoom = userDefaults.maxZoom;
        }

        if (isDefined(userDefaults.minZoom)) {
          newDefaults.minZoom = userDefaults.minZoom;
        }

        if (isDefined(userDefaults.zoomAnimation)) {
          newDefaults.zoomAnimation = userDefaults.zoomAnimation;
        }

        if (isDefined(userDefaults.fadeAnimation)) {
          newDefaults.fadeAnimation = userDefaults.fadeAnimation;
        }

        if (isDefined(userDefaults.markerZoomAnimation)) {
          newDefaults.markerZoomAnimation = userDefaults.markerZoomAnimation;
        }

        if (isDefined(userDefaults.worldCopyJump)) {
          newDefaults.worldCopyJump = userDefaults.worldCopyJump;
        }

        if (isDefined(userDefaults.map)) {
          newDefaults.map = userDefaults.map;
        }

        if (isDefined(userDefaults.path)) {
          newDefaults.path = userDefaults.path;
        }
      }

      var mapId = obtainEffectiveMapId(defaults, scopeId);
      defaults[mapId] = newDefaults;
      return newDefaults;
    },
  };
}]);

angular.module('leaflet-directive-two').service('leafletMarkersHelpers', ["$rootScope", "$timeout", "leafletHelpers", "$log", "$compile", "leafletGeoJsonHelpers", function($rootScope, $timeout, leafletHelpers, $log, $compile, leafletGeoJsonHelpers) {
  var isDefined = leafletHelpers.isDefined;
  var defaultTo = leafletHelpers.defaultTo;
  var MarkerClusterPlugin = leafletHelpers.MarkerClusterPlugin;
  var AwesomeMarkersPlugin = leafletHelpers.AwesomeMarkersPlugin;
  var VectorMarkersPlugin = leafletHelpers.VectorMarkersPlugin;
  var MakiMarkersPlugin = leafletHelpers.MakiMarkersPlugin;
  var ExtraMarkersPlugin = leafletHelpers.ExtraMarkersPlugin;
  var DomMarkersPlugin = leafletHelpers.DomMarkersPlugin;
  var safeApply = leafletHelpers.safeApply;
  var Helpers = leafletHelpers;
  var isString = leafletHelpers.isString;
  var isNumber = leafletHelpers.isNumber;
  var isObject = leafletHelpers.isObject;
  var groups = {};
  var geoHlp = leafletGeoJsonHelpers;
  var errorHeader = leafletHelpers.errorHeader;

  var _string = function(marker) {
    //this exists since JSON.stringify barfs on cyclic
    var retStr = '';
    ['_icon', '_latlng', '_leaflet_id', '_map', '_shadow'].forEach(function(prop) {
      retStr += prop + ': ' + defaultTo(marker[prop], 'undefined') + ' \n';
    });

    return '[leafletMarker] : \n' + retStr;
  };

  var _log = function(marker, useConsole) {
    var logger = useConsole ? console : $log;
    logger.debug(_string(marker));
  };

  var createLeafletIcon = function(iconData) {
    if (isDefined(iconData) &amp;&amp; isDefined(iconData.type) &amp;&amp; iconData.type === 'awesomeMarker') {
      if (!AwesomeMarkersPlugin.isLoaded()) {
        $log.error(errorHeader + ' The AwesomeMarkers Plugin is not loaded.');
      }

      return new L.AwesomeMarkers.icon(iconData);
    }

    if (isDefined(iconData) &amp;&amp; isDefined(iconData.type) &amp;&amp; iconData.type === 'vectorMarker') {
      if (!VectorMarkersPlugin.isLoaded()) {
        $log.error(errorHeader + ' The VectorMarkers Plugin is not loaded.');
      }

      return new L.VectorMarkers.icon(iconData);
    }

    if (isDefined(iconData) &amp;&amp; isDefined(iconData.type) &amp;&amp; iconData.type === 'makiMarker') {
      if (!MakiMarkersPlugin.isLoaded()) {
        $log.error(errorHeader + 'The MakiMarkers Plugin is not loaded.');
      }

      return new L.MakiMarkers.icon(iconData);
    }

    if (isDefined(iconData) &amp;&amp; isDefined(iconData.type) &amp;&amp; iconData.type === 'extraMarker') {
      if (!ExtraMarkersPlugin.isLoaded()) {
        $log.error(errorHeader + 'The ExtraMarkers Plugin is not loaded.');
      }

      return new L.ExtraMarkers.icon(iconData);
    }

    if (isDefined(iconData) &amp;&amp; isDefined(iconData.type) &amp;&amp; iconData.type === 'div') {
      return new L.divIcon(iconData);
    }

    if (isDefined(iconData) &amp;&amp; isDefined(iconData.type) &amp;&amp; iconData.type === 'dom') {
      if (!DomMarkersPlugin.isLoaded()) {
        $log.error(errorHeader + 'The DomMarkers Plugin is not loaded.');
      }

      var markerScope = angular.isFunction(iconData.getMarkerScope) ? iconData.getMarkerScope() : $rootScope;
      var template = $compile(iconData.template)(markerScope);
      var iconDataCopy = angular.copy(iconData);
      iconDataCopy.element = template[0];
      return new L.DomMarkers.icon(iconDataCopy);
    }

    // allow for any custom icon to be used... assumes the icon has already been initialized
    if (isDefined(iconData) &amp;&amp; isDefined(iconData.type) &amp;&amp; iconData.type === 'icon') {
      return iconData.icon;
    }

    var base64icon = 'marker-icon-2x.png';
    var base64shadow = 'marker-shadow.png';

    if (!isDefined(iconData) || !isDefined(iconData.iconUrl)) {
      return new L.Icon.Default({
        iconUrl: base64icon,
        shadowUrl: 'marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41],
      });
    }

    return new L.Icon(iconData);
  };

  var _resetMarkerGroup = function(groupName) {
    if (isDefined(groups[groupName])) {
      groups.splice(groupName, 1);
    }
  };

  var _resetMarkerGroups = function() {
    groups = {};
  };

  var _deleteMarker = function(marker, map, layers) {
    marker.closePopup();

    // There is no easy way to know if a marker is added to a layer, so we search for it
    // if there are overlays
    if (isDefined(layers) &amp;&amp; isDefined(layers.overlays)) {
      for (var key in layers.overlays) {
        if (layers.overlays[key] instanceof L.LayerGroup || layers.overlays[key] instanceof L.FeatureGroup) {
          if (layers.overlays[key].hasLayer(marker)) {
            layers.overlays[key].removeLayer(marker);
            return;
          }
        }
      }
    }

    if (isDefined(groups)) {
      for (var groupKey in groups) {
        if (groups[groupKey].hasLayer(marker)) {
          groups[groupKey].removeLayer(marker);
        }
      }
    }

    if (map.hasLayer(marker)) {
      map.removeLayer(marker);
    }
  };

  var adjustPopupPan = function(marker, map) {
    var containerHeight = marker._popup._container.offsetHeight;
    var layerPos = new L.Point(marker._popup._containerLeft, -containerHeight - marker._popup._containerBottom);
    var containerPos = map.layerPointToContainerPoint(layerPos);
    if (containerPos !== null) {
      marker._popup._adjustPan();
    }
  };

  var compilePopup = function(marker, markerScope) {
    $compile(marker._popup._contentNode)(markerScope);
  };

  var updatePopup = function(marker, markerScope, map) {
    //The innerText should be more than 1 once angular has compiled.
    //We need to keep trying until angular has compiled before we _updateLayout and _updatePosition
    //This should take care of any scenario , eg ngincludes, whatever.
    //Is there a better way to check for this?
    var innerText = marker._popup._contentNode.innerText || marker._popup._contentNode.textContent;
    if (innerText.length &lt; 1) {
      $timeout(function() {
        updatePopup(marker, markerScope, map);
      });
    }

    //cause a reflow - this is also very important - if we don't do this then the widths are from before $compile
    var reflow = marker._popup._contentNode.offsetWidth;

    marker._popup._updateLayout();
    marker._popup._updatePosition();

    if (marker._popup.options.autoPan) {
      adjustPopupPan(marker, map);
    }

    //using / returning reflow so jshint doesn't moan
    return reflow;
  };

  var _manageOpenPopup = function(marker, markerData, map) {
    // The marker may provide a scope returning function used to compile the message
    // default to $rootScope otherwise
    var markerScope = angular.isFunction(markerData.getMessageScope) ? markerData.getMessageScope() : $rootScope;
    var compileMessage = isDefined(markerData.compileMessage) ? markerData.compileMessage : true;

    if (compileMessage) {
      if (!isDefined(marker._popup) || !isDefined(marker._popup._contentNode)) {
        $log.error(errorHeader + 'Popup is invalid or does not have any content.');
        return false;
      }

      compilePopup(marker, markerScope);
      updatePopup(marker, markerData, map);
    }
  };

  var _manageOpenLabel = function(marker, markerData) {
    var markerScope = angular.isFunction(markerData.getMessageScope) ? markerData.getMessageScope() : $rootScope;
    var labelScope = angular.isFunction(markerData.getLabelScope) ? markerData.getLabelScope() : markerScope;
    var compileMessage = isDefined(markerData.compileMessage) ? markerData.compileMessage : true;

    if (Helpers.LabelPlugin.isLoaded() &amp;&amp; isDefined(markerData.label)) {
      if (isDefined(markerData.label.options) &amp;&amp; markerData.label.options.noHide === true) {
        marker.showLabel();
      }

      if (compileMessage &amp;&amp; isDefined(marker.label)) {
        $compile(marker.label._container)(labelScope);
      }
    }
  };

  var _updateMarker = function(markerData, oldMarkerData, marker, name, leafletScope, layers, map) {
    if (!isDefined(oldMarkerData)) {
      return;
    }

    // Update the lat-lng property (always present in marker properties)
    if (!geoHlp.validateCoords(markerData)) {
      $log.warn('There are problems with lat-lng data, please verify your marker model');
      _deleteMarker(marker, map, layers);
      return;
    }

    // watch is being initialized if old and new object is the same
    var isInitializing = markerData === oldMarkerData;

    // Update marker rotation
    if (isDefined(markerData.iconAngle) &amp;&amp; oldMarkerData.iconAngle !== markerData.iconAngle) {
      marker.setIconAngle(markerData.iconAngle);
    }

    // It is possible that the layer has been removed or the layer marker does not exist
    // Update the layer group if present or move it to the map if not
    if (!isString(markerData.layer)) {
      // There is no layer information, we move the marker to the map if it was in a layer group
      if (isString(oldMarkerData.layer)) {
        // Remove from the layer group that is supposed to be
        if (isDefined(layers.overlays[oldMarkerData.layer]) &amp;&amp; layers.overlays[oldMarkerData.layer].hasLayer(marker)) {
          layers.overlays[oldMarkerData.layer].removeLayer(marker);
          marker.closePopup();
        }

        // Test if it is not on the map and add it
        if (!map.hasLayer(marker)) {
          map.addLayer(marker);
        }
      }
    }

    if ((isNumber(markerData.opacity) || isNumber(parseFloat(markerData.opacity))) &amp;&amp; markerData.opacity !== oldMarkerData.opacity) {
      // There was a different opacity so we update it
      marker.setOpacity(markerData.opacity);
    }

    if (isString(markerData.layer) &amp;&amp; oldMarkerData.layer !== markerData.layer) {
      // If it was on a layer group we have to remove it
      if (isString(oldMarkerData.layer) &amp;&amp; isDefined(layers.overlays[oldMarkerData.layer]) &amp;&amp; layers.overlays[oldMarkerData.layer].hasLayer(marker)) {
        layers.overlays[oldMarkerData.layer].removeLayer(marker);
      }

      marker.closePopup();

      // Remove it from the map in case the new layer is hidden or there is an error in the new layer
      if (map.hasLayer(marker)) {
        map.removeLayer(marker);
      }

      // The markerData.layer is defined so we add the marker to the layer if it is different from the old data
      if (!isDefined(layers.overlays[markerData.layer])) {
        $log.error(errorHeader + 'You must use a name of an existing layer');
        return;
      }

      // Is a group layer?
      var layerGroup = layers.overlays[markerData.layer];
      if (!(layerGroup instanceof L.LayerGroup || layerGroup instanceof L.FeatureGroup)) {
        $log.error(errorHeader + 'A marker can only be added to a layer of type "group" or "featureGroup"');
        return;
      }

      // The marker goes to a correct layer group, so first of all we add it
      layerGroup.addLayer(marker);

      // The marker is automatically added to the map depending on the visibility
      // of the layer, so we only have to open the popup if the marker is in the map
      if (map.hasLayer(marker) &amp;&amp; markerData.focus === true) {
        marker.openPopup();
      }
    }

    // Update the draggable property
    if (markerData.draggable !== true &amp;&amp; oldMarkerData.draggable === true &amp;&amp; (isDefined(marker.dragging))) {
      marker.dragging.disable();
    }

    if (markerData.draggable === true &amp;&amp; oldMarkerData.draggable !== true) {
      // The markerData.draggable property must be true so we update if there wasn't a previous value or it wasn't true
      if (marker.dragging) {
        marker.dragging.enable();
      } else {
        if (L.Handler.MarkerDrag) {
          marker.dragging = new L.Handler.MarkerDrag(marker);
          marker.options.draggable = true;
          marker.dragging.enable();
        }
      }
    }

    // Update the icon property
    if (!isObject(markerData.icon)) {
      // If there is no icon property or it's not an object
      if (isObject(oldMarkerData.icon)) {
        // If there was an icon before restore to the default
        marker.setIcon(createLeafletIcon());
        marker.closePopup();
        marker.unbindPopup();
        if (isString(markerData.message)) {
          marker.bindPopup(markerData.message, markerData.popupOptions);
        }
      }
    }

    if (isObject(markerData.icon) &amp;&amp; isObject(oldMarkerData.icon) &amp;&amp; !angular.equals(markerData.icon, oldMarkerData.icon)) {
      var dragG = false;
      if (marker.dragging) {
        dragG = marker.dragging.enabled();
      }

      marker.setIcon(createLeafletIcon(markerData.icon));
      if (dragG) {
        marker.dragging.enable();
      }

      marker.closePopup();
      marker.unbindPopup();
      if (isString(markerData.message)) {
        marker.bindPopup(markerData.message, markerData.popupOptions);

        // if marker has been already focused, reopen popup
        if (map.hasLayer(marker) &amp;&amp; markerData.focus === true) {
          marker.openPopup();
        }
      }
    }

    // Update the Popup message property
    if (!isString(markerData.message) &amp;&amp; isString(oldMarkerData.message)) {
      marker.closePopup();
      marker.unbindPopup();
    }

    // Update the label content or bind a new label if the old one has been removed.
    if (Helpers.LabelPlugin.isLoaded()) {
      if (isDefined(markerData.label) &amp;&amp; isDefined(markerData.label.message)) {
        if ('label' in oldMarkerData &amp;&amp; 'message' in oldMarkerData.label &amp;&amp; !angular.equals(markerData.label.message, oldMarkerData.label.message)) {
          marker.updateLabelContent(markerData.label.message);
        } else if (!angular.isFunction(marker.getLabel) || angular.isFunction(marker.getLabel) &amp;&amp; !isDefined(marker.getLabel())) {
          marker.bindLabel(markerData.label.message, markerData.label.options);
          _manageOpenLabel(marker, markerData);
        } else {
          _manageOpenLabel(marker, markerData);
        }
      } else if (!('label' in markerData &amp;&amp; !('message' in markerData.label))) {
        if (angular.isFunction(marker.unbindLabel)) {
          marker.unbindLabel();
        }
      }
    }

    // There is some text in the popup, so we must show the text or update existing
    if (isString(markerData.message) &amp;&amp; !isString(oldMarkerData.message)) {
      // There was no message before so we create it
      marker.bindPopup(markerData.message, markerData.popupOptions);
    }

    if (isString(markerData.message) &amp;&amp; isString(oldMarkerData.message) &amp;&amp; markerData.message !== oldMarkerData.message) {
      // There was a different previous message so we update it
      marker.setPopupContent(markerData.message);
    }

    // Update the focus property
    var updatedFocus = false;
    if (markerData.focus !== true &amp;&amp; oldMarkerData.focus === true) {
      // If there was a focus property and was true we turn it off
      marker.closePopup();
      updatedFocus = true;
    }

    // The markerData.focus property must be true so we update if there wasn't a previous value or it wasn't true
    if (markerData.focus === true &amp;&amp; (!isDefined(oldMarkerData.focus) || oldMarkerData.focus === false) || (isInitializing &amp;&amp; markerData.focus === true)) {
      // Reopen the popup when focus is still true
      marker.openPopup();
      updatedFocus = true;
    }

    // zIndexOffset adjustment
    if (oldMarkerData.zIndexOffset !== markerData.zIndexOffset) {
      marker.setZIndexOffset(markerData.zIndexOffset);
    }

    var markerLatLng = marker.getLatLng();
    var isCluster = (isString(markerData.layer) &amp;&amp; Helpers.MarkerClusterPlugin.is(layers.overlays[markerData.layer]));

    // If the marker is in a cluster it has to be removed and added to the layer when the location is changed
    if (isCluster) {
      // The focus has changed even by a user click or programatically
      if (updatedFocus) {
        // We only have to update the location if it was changed programatically, because it was
        // changed by a user drag the marker data has already been updated by the internal event
        // listened by the directive
        if ((markerData.lat !== oldMarkerData.lat) || (markerData.lng !== oldMarkerData.lng)) {
          layers.overlays[markerData.layer].removeLayer(marker);
          marker.setLatLng([markerData.lat, markerData.lng]);
          layers.overlays[markerData.layer].addLayer(marker);
        }
      } else {
        // The marker has possibly moved. It can be moved by a user drag (marker location and data are equal but old
        // data is diferent) or programatically (marker location and data are diferent)
        if ((markerLatLng.lat !== markerData.lat) || (markerLatLng.lng !== markerData.lng)) {
          // The marker was moved by a user drag
          layers.overlays[markerData.layer].removeLayer(marker);
          marker.setLatLng([markerData.lat, markerData.lng]);
          layers.overlays[markerData.layer].addLayer(marker);
        } else if ((markerData.lat !== oldMarkerData.lat) || (markerData.lng !== oldMarkerData.lng)) {
          // The marker was moved programatically
          layers.overlays[markerData.layer].removeLayer(marker);
          marker.setLatLng([markerData.lat, markerData.lng]);
          layers.overlays[markerData.layer].addLayer(marker);
        } else if (isObject(markerData.icon) &amp;&amp; isObject(oldMarkerData.icon) &amp;&amp; !angular.equals(markerData.icon, oldMarkerData.icon)) {
          layers.overlays[markerData.layer].removeLayer(marker);
          layers.overlays[markerData.layer].addLayer(marker);
        }
      }
    } else if (markerLatLng.lat !== markerData.lat || markerLatLng.lng !== markerData.lng) {
      marker.setLatLng([markerData.lat, markerData.lng]);
    }
  };

  return {
    resetMarkerGroup: _resetMarkerGroup,

    resetMarkerGroups: _resetMarkerGroups,

    deleteMarker: _deleteMarker,

    manageOpenPopup: _manageOpenPopup,

    manageOpenLabel: _manageOpenLabel,

    createMarker: function(markerData) {
      if (!isDefined(markerData) || !geoHlp.validateCoords(markerData)) {
        $log.error(errorHeader + 'The marker definition is not valid.');
        return;
      }

      var coords = geoHlp.getCoords(markerData);

      if (!isDefined(coords)) {
        $log.error(errorHeader + 'Unable to get coordinates from markerData.');
        return;
      }

      var markerOptions = {
        icon: createLeafletIcon(markerData.icon),
        title: isDefined(markerData.title) ? markerData.title : '',
        draggable: isDefined(markerData.draggable) ? markerData.draggable : false,
        clickable: isDefined(markerData.clickable) ? markerData.clickable : true,
        riseOnHover: isDefined(markerData.riseOnHover) ? markerData.riseOnHover : false,
        zIndexOffset: isDefined(markerData.zIndexOffset) ? markerData.zIndexOffset : 0,
        iconAngle: isDefined(markerData.iconAngle) ? markerData.iconAngle : 0,
      };

      // Add any other options not added above to markerOptions
      for (var markerDatum in markerData) {
        if (markerData.hasOwnProperty(markerDatum) &amp;&amp; !markerOptions.hasOwnProperty(markerDatum)) {
          markerOptions[markerDatum] = markerData[markerDatum];
        }
      }

      var marker = new L.marker(coords, markerOptions);

      if (!isString(markerData.message)) {
        marker.unbindPopup();
      }

      return marker;
    },

    addMarkerToGroup: function(marker, groupName, groupOptions, map) {
      if (!isString(groupName)) {
        $log.error(errorHeader + 'The marker group you have specified is invalid.');
        return;
      }

      if (!MarkerClusterPlugin.isLoaded()) {
        $log.error(errorHeader + 'The MarkerCluster plugin is not loaded.');
        return;
      }

      if (!isDefined(groups[groupName])) {
        groups[groupName] = new L.MarkerClusterGroup(groupOptions);
        map.addLayer(groups[groupName]);
      }

      groups[groupName].addLayer(marker);
    },

    listenMarkerEvents: function(marker, markerData, leafletScope, doWatch, map) {
      marker.on('popupopen', function(/* event */) {
        safeApply(leafletScope, function() {
          if (isDefined(marker._popup) || isDefined(marker._popup._contentNode)) {
            markerData.focus = true;
            _manageOpenPopup(marker, markerData, map);//needed since markerData is now a copy
          }
        });
      });

      marker.on('popupclose', function(/* event */) {
        safeApply(leafletScope, function() {
          markerData.focus = false;
        });
      });

      marker.on('add', function(/* event */) {
        safeApply(leafletScope, function() {
          if ('label' in markerData)
              _manageOpenLabel(marker, markerData);
        });
      });
    },

    updateMarker: _updateMarker,

    addMarkerWatcher: function(marker, name, leafletScope, layers, map, isDeepWatch) {
      var markerWatchPath = Helpers.getObjectArrayPath('markers.' + name);
      isDeepWatch = defaultTo(isDeepWatch, true);

      var clearWatch = leafletScope.$watch(markerWatchPath, function(markerData, oldMarkerData) {
        if (!isDefined(markerData)) {
          _deleteMarker(marker, map, layers);
          clearWatch();
          return;
        }

        _updateMarker(markerData, oldMarkerData, marker, name, leafletScope, layers, map);
      }, isDeepWatch);
    },

    string: _string,
    log: _log,
  };
}]);

angular.module('leaflet-directive-two').factory('leafletPathsHelpers', ["$rootScope", "$log", "leafletHelpers", function($rootScope, $log, leafletHelpers) {
  var isDefined = leafletHelpers.isDefined;
  var isArray = leafletHelpers.isArray;
  var isNumber = leafletHelpers.isNumber;
  var isValidPoint = leafletHelpers.isValidPoint;

  var availableOptions = [

      // Path options
      'stroke', 'weight', 'color', 'opacity',
      'fill', 'fillColor', 'fillOpacity',
      'dashArray', 'lineCap', 'lineJoin', 'clickable',
      'pointerEvents', 'className',

      // Polyline options
      'smoothFactor', 'noClip',
  ];
  function _convertToLeafletLatLngs(latlngs) {
    return latlngs.filter(function(latlng) {
      return isValidPoint(latlng);
    }).map(function(latlng) {
      return _convertToLeafletLatLng(latlng);
    });
  }

  function _convertToLeafletLatLng(latlng) {
    if (isArray(latlng)) {
      return new L.LatLng(latlng[0], latlng[1]);
    } else {
      return new L.LatLng(latlng.lat, latlng.lng);
    }
  }

  function _convertToLeafletMultiLatLngs(paths) {
    return paths.map(function(latlngs) {
      return _convertToLeafletLatLngs(latlngs);
    });
  }

  function _getOptions(path, defaults) {
    var options = {};
    for (var i = 0; i &lt; availableOptions.length; i++) {
      var optionName = availableOptions[i];

      if (isDefined(path[optionName])) {
        options[optionName] = path[optionName];
      } else if (isDefined(defaults.path[optionName])) {
        options[optionName] = defaults.path[optionName];
      }
    }

    return options;
  }

  var _updatePathOptions = function(path, data) {
    var updatedStyle = {};
    for (var i = 0; i &lt; availableOptions.length; i++) {
      var optionName = availableOptions[i];
      if (isDefined(data[optionName])) {
        updatedStyle[optionName] = data[optionName];
      }
    }

    path.setStyle(data);
  };

  var _isValidPolyline = function(latlngs) {
    if (!isArray(latlngs)) {
      return false;
    }

    for (var i = 0; i &lt; latlngs.length; i++) {
      var point = latlngs[i];
      if (!isValidPoint(point)) {
        return false;
      }
    }

    return true;
  };

  var pathTypes = {
    polyline: {
      isValid: function(pathData) {
        var latlngs = pathData.latlngs;
        return _isValidPolyline(latlngs);
      },

      createPath: function(options) {
        return new L.Polyline([], options);
      },

      setPath: function(path, data) {
        path.setLatLngs(_convertToLeafletLatLngs(data.latlngs));
        _updatePathOptions(path, data);
        return;
      },
    },
    multiPolyline: {
      isValid: function(pathData) {
        var latlngs = pathData.latlngs;
        if (!isArray(latlngs)) {
          return false;
        }

        for (var i in latlngs) {
          var polyline = latlngs[i];
          if (!_isValidPolyline(polyline)) {
            return false;
          }
        }

        return true;
      },

      createPath: function(options) {
        return new L.multiPolyline([[[0, 0], [1, 1]]], options);
      },

      setPath: function(path, data) {
        path.setLatLngs(_convertToLeafletMultiLatLngs(data.latlngs));
        _updatePathOptions(path, data);
        return;
      },
    },
    polygon: {
      isValid: function(pathData) {
        var latlngs = pathData.latlngs;
        return _isValidPolyline(latlngs);
      },

      createPath: function(options) {
        return new L.Polygon([], options);
      },

      setPath: function(path, data) {
        path.setLatLngs(_convertToLeafletLatLngs(data.latlngs));
        _updatePathOptions(path, data);
        return;
      },
    },
    multiPolygon: {
      isValid: function(pathData) {
        var latlngs = pathData.latlngs;

        if (!isArray(latlngs)) {
          return false;
        }

        for (var i in latlngs) {
          var polyline = latlngs[i];
          if (!_isValidPolyline(polyline)) {
            return false;
          }
        }

        return true;
      },

      createPath: function(options) {
        return new L.MultiPolygon([[[0, 0], [1, 1], [0, 1]]], options);
      },

      setPath: function(path, data) {
        path.setLatLngs(_convertToLeafletMultiLatLngs(data.latlngs));
        _updatePathOptions(path, data);
        return;
      },
    },
    rectangle: {
      isValid: function(pathData) {
        var latlngs = pathData.latlngs;

        if (!isArray(latlngs) || latlngs.length !== 2) {
          return false;
        }

        for (var i in latlngs) {
          var point = latlngs[i];
          if (!isValidPoint(point)) {
            return false;
          }
        }

        return true;
      },

      createPath: function(options) {
        return new L.Rectangle([[0, 0], [1, 1]], options);
      },

      setPath: function(path, data) {
        path.setBounds(new L.LatLngBounds(_convertToLeafletLatLngs(data.latlngs)));
        _updatePathOptions(path, data);
      },
    },
    circle: {
      isValid: function(pathData) {
        var point = pathData.latlngs;
        return isValidPoint(point) &amp;&amp; isNumber(pathData.radius);
      },

      createPath: function(options) {
        return new L.Circle([0, 0], 1, options);
      },

      setPath: function(path, data) {
        path.setLatLng(_convertToLeafletLatLng(data.latlngs));
        if (isDefined(data.radius)) {
          path.setRadius(data.radius);
        }

        _updatePathOptions(path, data);
      },
    },
    circleMarker: {
      isValid: function(pathData) {
        var point = pathData.latlngs;
        return isValidPoint(point) &amp;&amp; isNumber(pathData.radius);
      },

      createPath: function(options) {
        return new L.CircleMarker([0, 0], options);
      },

      setPath: function(path, data) {
        path.setLatLng(_convertToLeafletLatLng(data.latlngs));
        if (isDefined(data.radius)) {
          path.setRadius(data.radius);
        }

        _updatePathOptions(path, data);
      },
    },
  };

  var _getPathData = function(path) {
    var pathData = {};
    if (path.latlngs) {
      pathData.latlngs = path.latlngs;
    }

    if (path.radius) {
      pathData.radius = path.radius;
    }

    return pathData;
  };

  return {
    setPathOptions: function(leafletPath, pathType, data) {
      if (!isDefined(pathType)) {
        pathType = 'polyline';
      }

      pathTypes[pathType].setPath(leafletPath, data);
    },

    createPath: function(name, path, defaults) {
      if (!isDefined(path.type)) {
        path.type = 'polyline';
      }

      var options = _getOptions(path, defaults);
      var pathData = _getPathData(path);

      if (!pathTypes[path.type].isValid(pathData)) {
        $log.error('[AngularJS - Leaflet] Invalid data passed to the ' + path.type + ' path');
        return;
      }

      return pathTypes[path.type].createPath(options);
    },
  };
}]);

angular.module('leaflet-directive-two')
.service('leafletWatchHelpers', function() {

  var _maybe = function(scope, watchFunctionName, thingToWatchStr, watchOptions, initCb) {
    //watchOptions.isDeep is/should be ignored in $watchCollection
    var unWatch = scope[watchFunctionName](thingToWatchStr, function(newValue, oldValue) {
      initCb(newValue, oldValue);
      if (!watchOptions.doWatch)
          unWatch();
    }, watchOptions.isDeep);

    return unWatch;
  };

  /*
  @name: maybeWatch
  @description: Utility to watch something once or forever.
  @returns unWatch function
  @param watchOptions - see markersWatchOptions and or derrivatives. This object is used
  to set watching to once and its watch depth.
  */
  var _maybeWatch = function(scope, thingToWatchStr, watchOptions, initCb) {
    return _maybe(scope, '$watch', thingToWatchStr, watchOptions, initCb);
  };

  /*
  @name: _maybeWatchCollection
  @description: Utility to watch something once or forever.
  @returns unWatch function
  @param watchOptions - see markersWatchOptions and or derrivatives. This object is used
  to set watching to once and its watch depth.
  */
  var _maybeWatchCollection = function(scope, thingToWatchStr, watchOptions, initCb) {
    return _maybe(scope, '$watchCollection', thingToWatchStr, watchOptions, initCb);
  };

  return {
    maybeWatch: _maybeWatch,
    maybeWatchCollection: _maybeWatchCollection,
  };
});

angular.module('leaflet-directive-two').factory('nominatimService', ["$q", "$http", "leafletHelpers", "leafletMapDefaults", function($q, $http, leafletHelpers, leafletMapDefaults) {
  var isDefined = leafletHelpers.isDefined;

  return {
    query: function(address, mapId) {
      var defaults = leafletMapDefaults.getDefaults(mapId);
      var url = defaults.nominatim.server;
      var df = $q.defer();

      $http.get(url, { params: { format: 'json', limit: 1, q: address } }).success(function(data) {
        if (data.length &gt; 0 &amp;&amp; isDefined(data[0].boundingbox)) {
          df.resolve(data[0]);
        } else {
          df.reject('[Nominatim] Invalid address');
        }
      });

      return df.promise;
    },
  };
}]);

angular.module('leaflet-directive-two').directive('bounds', ["$log", "$timeout", "$http", "leafletHelpers", "nominatimService", "leafletBoundsHelpers", function($log, $timeout, $http, leafletHelpers, nominatimService, leafletBoundsHelpers) {

  return {
    restrict: 'A',
    scope: false,
    replace: false,
    require: ['leaflet'],

    link: function(scope, element, attrs, controller) {
      var isDefined = leafletHelpers.isDefined;
      var createLeafletBounds = leafletBoundsHelpers.createLeafletBounds;
      var leafletScope = controller[0].getLeafletScope();
      var mapController = controller[0];
      var errorHeader = leafletHelpers.errorHeader + ' [Bounds] ';

      var emptyBounds = function(bounds) {
        return (bounds._southWest.lat === 0 &amp;&amp; bounds._southWest.lng === 0 &amp;&amp;
                bounds._northEast.lat === 0 &amp;&amp; bounds._northEast.lng === 0);
      };

      mapController.getMap().then(function(map) {
        leafletScope.$on('boundsChanged', function(event) {
          var scope = event.currentScope;
          var bounds = map.getBounds();

          if (emptyBounds(bounds) || scope.settingBoundsFromScope) {
            return;
          }

          scope.settingBoundsFromLeaflet = true;
          var newScopeBounds = {
            northEast: {
              lat: bounds._northEast.lat,
              lng: bounds._northEast.lng,
            },
            southWest: {
              lat: bounds._southWest.lat,
              lng: bounds._southWest.lng,
            },
            options: bounds.options,
          };
          if (!angular.equals(scope.bounds, newScopeBounds)) {
            scope.bounds = newScopeBounds;
          }

          $timeout(function() {
            scope.settingBoundsFromLeaflet = false;
          });
        });

        var lastNominatimQuery;
        leafletScope.$watch('bounds', function(bounds) {
          if (scope.settingBoundsFromLeaflet)
              return;
          if (isDefined(bounds.address) &amp;&amp; bounds.address !== lastNominatimQuery) {
            scope.settingBoundsFromScope = true;
            nominatimService.query(bounds.address, attrs.id).then(function(data) {
              var b = data.boundingbox;
              var newBounds = [[b[0], b[2]], [b[1], b[3]]];
              map.fitBounds(newBounds);
            }, function(errMsg) {

              $log.error(errorHeader + ' ' + errMsg + '.');
            });

            lastNominatimQuery = bounds.address;
            $timeout(function() {
              scope.settingBoundsFromScope = false;
            });

            return;
          }

          var leafletBounds = createLeafletBounds(bounds);
          if (leafletBounds &amp;&amp; !map.getBounds().equals(leafletBounds)) {
            scope.settingBoundsFromScope = true;
            map.fitBounds(leafletBounds, bounds.options);
            $timeout(function() {
              scope.settingBoundsFromScope = false;
            });
          }
        }, true);
      });
    },
  };
}]);

var centerDirectiveTypes = ['center', 'lfCenter'];
var centerDirectives = {};

centerDirectiveTypes.forEach(function(directiveName) {
  centerDirectives[directiveName] = ['$log', '$q', '$location', '$timeout', 'leafletMapDefaults', 'leafletHelpers',
      'leafletBoundsHelpers', 'leafletMapEvents',
        function($log, $q, $location, $timeout, leafletMapDefaults, leafletHelpers,
      leafletBoundsHelpers, leafletMapEvents) {

      var isDefined = leafletHelpers.isDefined;
      var isNumber = leafletHelpers.isNumber;
      var isSameCenterOnMap = leafletHelpers.isSameCenterOnMap;
      var safeApply = leafletHelpers.safeApply;
      var isValidCenter = leafletHelpers.isValidCenter;
      var isValidBounds = leafletBoundsHelpers.isValidBounds;
      var isUndefinedOrEmpty = leafletHelpers.isUndefinedOrEmpty;
      var errorHeader = leafletHelpers.errorHeader;

      var shouldInitializeMapWithBounds = function(bounds, center) {
        return isDefined(bounds) &amp;&amp; isValidBounds(bounds) &amp;&amp; isUndefinedOrEmpty(center);
      };

      var _leafletCenter;
      return {
        restrict: 'A',
        scope: false,
        replace: false,
        require: 'leaflet',
        controller: function() {
          _leafletCenter = $q.defer();
          this.getCenter = function() {
            return _leafletCenter.promise;
          };
        },

        link: function(scope, element, attrs, controller) {
          var leafletScope = controller.getLeafletScope();
          var centerModel = leafletScope[directiveName];

          controller.getMap().then(function(map) {
            var defaults = leafletMapDefaults.getDefaults(attrs.id);

            if (attrs[directiveName].search('-') !== -1) {
              $log.error(errorHeader + ' The "center" variable can\'t use a "-" on its key name: "' + attrs[directiveName] + '".');
              map.setView([defaults.center.lat, defaults.center.lng], defaults.center.zoom);
              return;
            } else if (shouldInitializeMapWithBounds(leafletScope.bounds, centerModel)) {
              map.fitBounds(leafletBoundsHelpers.createLeafletBounds(leafletScope.bounds), leafletScope.bounds.options);
              centerModel = map.getCenter();
              safeApply(leafletScope, function(scope) {
                angular.extend(scope[directiveName], {
                  lat: map.getCenter().lat,
                  lng: map.getCenter().lng,
                  zoom: map.getZoom(),
                  autoDiscover: false,
                });
              });

              safeApply(leafletScope, function(scope) {
                var mapBounds = map.getBounds();
                scope.bounds = {
                  northEast: {
                    lat: mapBounds._northEast.lat,
                    lng: mapBounds._northEast.lng,
                  },
                  southWest: {
                    lat: mapBounds._southWest.lat,
                    lng: mapBounds._southWest.lng,
                  },
                };
              });
            } else if (!isDefined(centerModel)) {
              $log.error(errorHeader + ' The "center" property is not defined in the main scope');
              map.setView([defaults.center.lat, defaults.center.lng], defaults.center.zoom);
              return;
            } else if (!(isDefined(centerModel.lat) &amp;&amp; isDefined(centerModel.lng)) &amp;&amp; !isDefined(centerModel.autoDiscover)) {
              angular.copy(defaults.center, centerModel);
            }

            var urlCenterHash;
            var mapReady;
            if (attrs.urlHashCenter === 'yes') {
              var extractCenterFromUrl = function() {
                var search = $location.search();
                var centerParam;
                if (isDefined(search.c)) {
                  var cParam = search.c.split(':');
                  if (cParam.length === 3) {
                    centerParam = {
                      lat: parseFloat(cParam[0]),
                      lng: parseFloat(cParam[1]),
                      zoom: parseInt(cParam[2], 10),
                    };
                  }
                }

                return centerParam;
              };

              urlCenterHash = extractCenterFromUrl();

              leafletScope.$on('$locationChangeSuccess', function(event) {
                var scope = event.currentScope;

                //$log.debug("updated location...");
                var urlCenter = extractCenterFromUrl();
                if (isDefined(urlCenter) &amp;&amp; !isSameCenterOnMap(urlCenter, map)) {
                  //$log.debug("updating center model...", urlCenter);
                  angular.extend(scope[directiveName], {
                    lat: urlCenter.lat,
                    lng: urlCenter.lng,
                    zoom: urlCenter.zoom,
                  });
                }
              });
            }

            leafletScope.$watch(directiveName, function(center) {
              if (leafletScope.settingCenterFromLeaflet)
                  return;

              //$log.debug("updated center model...");
              // The center from the URL has priority
              if (isDefined(urlCenterHash)) {
                angular.copy(urlCenterHash, center);
                urlCenterHash = undefined;
              }

              if (!isValidCenter(center) &amp;&amp; center.autoDiscover !== true) {
                $log.warn(errorHeader + ' invalid \'center\'');

                //map.setView([defaults.center.lat, defaults.center.lng], defaults.center.zoom);
                return;
              }

              if (center.autoDiscover === true) {
                if (!isNumber(center.zoom)) {
                  map.setView([defaults.center.lat, defaults.center.lng], defaults.center.zoom);
                }

                if (isNumber(center.zoom) &amp;&amp; center.zoom &gt; defaults.center.zoom) {
                  map.locate({
                    setView: true,
                    maxZoom: center.zoom,
                  });
                } else if (isDefined(defaults.maxZoom)) {
                  map.locate({
                    setView: true,
                    maxZoom: defaults.maxZoom,
                  });
                } else {
                  map.locate({
                    setView: true,
                  });
                }

                return;
              }

              if (mapReady &amp;&amp; isSameCenterOnMap(center, map)) {
                //$log.debug("no need to update map again.");
                return;
              }

              //$log.debug("updating map center...", center);
              leafletScope.settingCenterFromScope = true;
              map.setView([center.lat, center.lng], center.zoom);
              leafletMapEvents.notifyCenterChangedToBounds(leafletScope, map);
              $timeout(function() {
                leafletScope.settingCenterFromScope = false;

                //$log.debug("allow center scope updates");
              });
            }, true);

            map.whenReady(function() {
              mapReady = true;
            });

            map.on('moveend', function(/* event */) {
              // Resolve the center after the first map position
              _leafletCenter.resolve();
              leafletMapEvents.notifyCenterUrlHashChanged(leafletScope, map, attrs, $location.search());

              //$log.debug("updated center on map...");
              if (isSameCenterOnMap(centerModel, map) || leafletScope.settingCenterFromScope) {
                //$log.debug("same center in model, no need to update again.");
                return;
              }

              leafletScope.settingCenterFromLeaflet = true;
              safeApply(leafletScope, function(scope) {
                if (!leafletScope.settingCenterFromScope) {
                  //$log.debug("updating center model...", map.getCenter(), map.getZoom());
                  angular.extend(scope[directiveName], {
                    lat: map.getCenter().lat,
                    lng: map.getCenter().lng,
                    zoom: map.getZoom(),
                    autoDiscover: false,
                  });
                }

                leafletMapEvents.notifyCenterChangedToBounds(leafletScope, map);
                $timeout(function() {
                  leafletScope.settingCenterFromLeaflet = false;
                });
              });
            });

            if (centerModel.autoDiscover === true) {
              map.on('locationerror', function() {
                $log.warn(errorHeader + ' The Geolocation API is unauthorized on this page.');
                if (isValidCenter(centerModel)) {
                  map.setView([centerModel.lat, centerModel.lng], centerModel.zoom);
                  leafletMapEvents.notifyCenterChangedToBounds(leafletScope, map);
                } else {
                  map.setView([defaults.center.lat, defaults.center.lng], defaults.center.zoom);
                  leafletMapEvents.notifyCenterChangedToBounds(leafletScope, map);
                }
              });
            }
          });
        },
      };
    },
    ];
});

centerDirectiveTypes.forEach(function(dirType) {
  angular.module('leaflet-directive-two').directive(dirType, centerDirectives[dirType]);
});

angular.module('leaflet-directive-two').directive('controls', ["$log", "leafletHelpers", "leafletControlHelpers", function($log, leafletHelpers, leafletControlHelpers) {

  return {
    restrict: 'A',
    scope: false,
    replace: false,
    require: '?^leaflet',

    link: function(scope, element, attrs, controller) {
      if (!controller) {
        return;
      }

      var createControl = leafletControlHelpers.createControl;
      var isValidControlType = leafletControlHelpers.isValidControlType;
      var leafletScope  = controller.getLeafletScope();
      var isDefined = leafletHelpers.isDefined;
      var isArray = leafletHelpers.isArray;
      var leafletControls = {};
      var errorHeader = leafletHelpers.errorHeader + ' [Controls] ';

      controller.getMap().then(function(map) {

        leafletScope.$watchCollection('controls', function(newControls) {

          // Delete controls from the array
          for (var name in leafletControls) {
            if (!isDefined(newControls[name])) {
              if (map.hasControl(leafletControls[name])) {
                map.removeControl(leafletControls[name]);
              }

              delete leafletControls[name];
            }
          }

          for (var newName in newControls) {
            var control;

            var controlType = isDefined(newControls[newName].type) ? newControls[newName].type : newName;

            if (!isValidControlType(controlType)) {
              $log.error(errorHeader + ' Invalid control type: ' + controlType + '.');
              return;
            }

            if (controlType !== 'custom') {
              control = createControl(controlType, newControls[newName]);
              map.addControl(control);
              leafletControls[newName] = control;
            } else {
              var customControlValue = newControls[newName];
              if (isArray(customControlValue)) {
                for (var i in customControlValue) {
                  var customControl = customControlValue[i];
                  map.addControl(customControl);
                  leafletControls[newName] = !isDefined(leafletControls[newName]) ? [customControl] : leafletControls[newName].concat([customControl]);
                }
              } else {
                map.addControl(customControlValue);
                leafletControls[newName] = customControlValue;
              }
            }
          }

        });

      });
    },
  };
}]);

angular.module('leaflet-directive-two').directive('decorations', ["$log", "leafletHelpers", function($log, leafletHelpers) {

  return {
    restrict: 'A',
    scope: false,
    replace: false,
    require: 'leaflet',

    link: function(scope, element, attrs, controller) {
      var leafletScope = controller.getLeafletScope();
      var PolylineDecoratorPlugin = leafletHelpers.PolylineDecoratorPlugin;
      var isDefined = leafletHelpers.isDefined;
      var leafletDecorations = {};

      /* Creates an "empty" decoration with a set of coordinates, but no pattern. */
      function createDecoration(options) {
        if (isDefined(options) &amp;&amp; isDefined(options.coordinates)) {
          if (!PolylineDecoratorPlugin.isLoaded()) {
            $log.error('[AngularJS - Leaflet] The PolylineDecorator Plugin is not loaded.');
          }
        }

        return L.polylineDecorator(options.coordinates);
      }

      /* Updates the path and the patterns for the provided decoration, and returns the decoration. */
      function setDecorationOptions(decoration, options) {
        if (isDefined(decoration) &amp;&amp; isDefined(options)) {
          if (isDefined(options.coordinates) &amp;&amp; isDefined(options.patterns)) {
            decoration.setPaths(options.coordinates);
            decoration.setPatterns(options.patterns);
            return decoration;
          }
        }
      }

      controller.getMap().then(function(map) {
        leafletScope.$watch('decorations', function(newDecorations) {
          for (var name in leafletDecorations) {
            if (!isDefined(newDecorations[name]) || !angular.equals(newDecorations[name], leafletDecorations)) {
              map.removeLayer(leafletDecorations[name]);
              delete leafletDecorations[name];
            }
          }

          for (var newName in newDecorations) {
            var decorationData = newDecorations[newName];
            var newDecoration = createDecoration(decorationData);

            if (isDefined(newDecoration)) {
              leafletDecorations[newName] = newDecoration;
              map.addLayer(newDecoration);
              setDecorationOptions(newDecoration, decorationData);
            }
          }
        }, true);
      });
    },
  };
}]);

angular.module('leaflet-directive-two').directive('eventBroadcast', ["$log", "$rootScope", "leafletHelpers", "leafletMapEvents", "leafletIterators", function($log, $rootScope, leafletHelpers, leafletMapEvents, leafletIterators) {

  return {
    restrict: 'A',
    scope: false,
    replace: false,
    require: 'leaflet',

    link: function(scope, element, attrs, controller) {
      var isObject = leafletHelpers.isObject;
      var isDefined = leafletHelpers.isDefined;
      var leafletScope  = controller.getLeafletScope();
      var eventBroadcast = leafletScope.eventBroadcast;
      var availableMapEvents = leafletMapEvents.getAvailableMapEvents();
      var addEvents = leafletMapEvents.addEvents;

      controller.getMap().then(function(map) {

        var mapEvents = [];
        var logic = 'broadcast';

        // We have a possible valid object
        if (!isDefined(eventBroadcast.map)) {
          // We do not have events enable/disable do we do nothing (all enabled by default)
          mapEvents = availableMapEvents;
        } else if (!isObject(eventBroadcast.map)) {
          // Not a valid object
          $log.warn('[AngularJS - Leaflet] event-broadcast.map must be an object check your model.');
        } else {
          // We have a possible valid map object
          // Event propadation logic
          if (eventBroadcast.map.logic !== 'emit' &amp;&amp; eventBroadcast.map.logic !== 'broadcast') {
            // This is an error
            $log.warn('[AngularJS - Leaflet] Available event propagation logic are: \'emit\' or \'broadcast\'.');
          } else {
            logic = eventBroadcast.map.logic;
          }

          if (!(isObject(eventBroadcast.map.enable) &amp;&amp; eventBroadcast.map.enable.length &gt;= 0)) {
            $log.warn('[AngularJS - Leaflet] event-broadcast.map.enable must be an object check your model.');
          } else {
            // Enable events
            leafletIterators.each(eventBroadcast.map.enable, function(eventName) {
              // Do we have already the event enabled?
              if (mapEvents.indexOf(eventName) === -1 &amp;&amp; availableMapEvents.indexOf(eventName) !== -1) {
                mapEvents.push(eventName);
              }
            });
          }

        }

        // as long as the map is removed in the root leaflet directive we
        // do not need ot clean up the events as leaflet does it itself
        addEvents(map, mapEvents, 'eventName', leafletScope, logic);
      });
    },
  };
}]);

angular.module('leaflet-directive-two')
.directive('geojson', ["$log", "$rootScope", "leafletData", "leafletHelpers", "leafletWatchHelpers", "leafletDirectiveControlsHelpers", "leafletIterators", "leafletGeoJsonEvents", function($log, $rootScope, leafletData, leafletHelpers,
    leafletWatchHelpers, leafletDirectiveControlsHelpers, leafletIterators, leafletGeoJsonEvents) {
  var _maybeWatch = leafletWatchHelpers.maybeWatch;
  var _watchOptions = leafletHelpers.watchOptions;
  var _extendDirectiveControls = leafletDirectiveControlsHelpers.extend;
  var hlp = leafletHelpers;
  var $it = leafletIterators;

  return {
    restrict: 'A',
    scope: false,
    replace: false,
    require: 'leaflet',

    link: function(scope, element, attrs, controller) {
      var isDefined = leafletHelpers.isDefined;
      var leafletScope  = controller.getLeafletScope();
      var leafletGeoJSON = {};
      var _hasSetLeafletData = false;

      controller.getMap().then(function(map) {
        var watchOptions = leafletScope.geojsonWatchOptions || _watchOptions;

        var _hookUpEvents = function(geojson, maybeName) {
          var onEachFeature;

          if (angular.isFunction(geojson.onEachFeature)) {
            onEachFeature = geojson.onEachFeature;
          } else {
            onEachFeature = function(feature, layer) {
              if (leafletHelpers.LabelPlugin.isLoaded() &amp;&amp; isDefined(feature.properties.description)) {
                layer.bindLabel(feature.properties.description);
              }

              leafletGeoJsonEvents.bindEvents(attrs.id, layer, null, feature,
                  leafletScope, maybeName,
                  {resetStyleOnMouseout: geojson.resetStyleOnMouseout,
                  mapId: attrs.id, });
            };
          }

          return onEachFeature;
        };

        var isNested = (hlp.isDefined(attrs.geojsonNested) &amp;&amp;
            hlp.isTruthy(attrs.geojsonNested));

        var _clean = function() {
          if (!leafletGeoJSON)
              return;
          var _remove = function(lObject) {
            if (isDefined(lObject) &amp;&amp; map.hasLayer(lObject)) {
              map.removeLayer(lObject);
            }
          };

          if (isNested) {
            $it.each(leafletGeoJSON, function(lObject) {
              _remove(lObject);
            });

            return;
          }

          _remove(leafletGeoJSON);
        };

        var _addGeojson = function(model, maybeName) {
          var geojson = angular.copy(model);
          if (!(isDefined(geojson) &amp;&amp; isDefined(geojson.data))) {
            return;
          }

          var onEachFeature = _hookUpEvents(geojson, maybeName);

          if (!isDefined(geojson.options)) {
            //right here is why we use a clone / copy (we modify and thus)
            //would kick of a watcher.. we need to be more careful everywhere
            //for stuff like this
            geojson.options = {
              style: geojson.style,
              filter: geojson.filter,
              onEachFeature: onEachFeature,
              pointToLayer: geojson.pointToLayer,
            };
          }

          var lObject = L.geoJson(geojson.data, geojson.options);

          if (maybeName &amp;&amp; hlp.isString(maybeName)) {
            leafletGeoJSON[maybeName] = lObject;
          }          else {
            leafletGeoJSON = lObject;
          }

          lObject.addTo(map);

          if (!_hasSetLeafletData) {//only do this once and play with the same ref forever
            _hasSetLeafletData = true;
            leafletData.setGeoJSON(leafletGeoJSON, attrs.id);
          }
        };

        var _create = function(model) {
          _clean();
          if (isNested) {
            if (!model || !Object.keys(model).length)
                return;
            $it.each(model, function(m, name) {
              //name could be layerName and or groupName
              //for now it is not tied to a layer
              _addGeojson(m, name);
            });

            return;
          }

          _addGeojson(model);
        };

        _extendDirectiveControls(attrs.id, 'geojson', _create, _clean);

        _maybeWatch(leafletScope, 'geojson', watchOptions, function(geojson) {
          _create(geojson);
        });
      });
    },
  };
}]);

angular.module('leaflet-directive-two').directive('layercontrol', ["$filter", "$log", "leafletData", "leafletHelpers", function($filter, $log, leafletData, leafletHelpers) {

  return {
    restrict: 'E',
    scope: {
      icons: '=?',
      autoHideOpacity: '=?', // Hide other opacity controls when one is activated.
      showGroups: '=?', // Hide other opacity controls when one is activated.
      title: '@',
      baseTitle: '@',
      overlaysTitle: '@',
    },
    replace: true,
    transclude: false,
    require: '^leaflet',
    controller: ["$scope", "$element", "$sce", function($scope, $element, $sce) {
      $log.debug('[Angular Directive - Layers] layers', $scope, $element);
      var safeApply = leafletHelpers.safeApply;
      var isDefined = leafletHelpers.isDefined;
      angular.extend($scope, {
        baselayer: '',
        oldGroup: '',
        layerProperties: {},
        groupProperties: {},
        rangeIsSupported: leafletHelpers.rangeIsSupported(),
        changeBaseLayer: function(key, e) {
          leafletHelpers.safeApply($scope, function(scp) {
            scp.baselayer = key;
            leafletData.getMap().then(function(map) {
              leafletData.getLayers().then(function(leafletLayers) {
                if (map.hasLayer(leafletLayers.baselayers[key])) {
                  return;
                }

                for (var i in scp.layers.baselayers) {
                  scp.layers.baselayers[i].icon = scp.icons.unradio;
                  if (map.hasLayer(leafletLayers.baselayers[i])) {
                    map.removeLayer(leafletLayers.baselayers[i]);
                  }
                }

                map.addLayer(leafletLayers.baselayers[key]);
                scp.layers.baselayers[key].icon = $scope.icons.radio;
              });
            });
          });

          e.preventDefault();
        },

        moveLayer: function(ly, newIndex, e) {
          var delta = Object.keys($scope.layers.baselayers).length;
          if (newIndex &gt;= (1 + delta) &amp;&amp; newIndex &lt;= ($scope.overlaysArray.length + delta)) {
            var oldLy;
            for (var key in $scope.layers.overlays) {
              if ($scope.layers.overlays[key].index === newIndex) {
                oldLy = $scope.layers.overlays[key];
                break;
              }
            }

            if (oldLy) {
              safeApply($scope, function() {
                oldLy.index = ly.index;
                ly.index = newIndex;
              });
            }
          }

          e.stopPropagation();
          e.preventDefault();
        },

        initIndex: function(layer, idx) {
          var delta = Object.keys($scope.layers.baselayers).length;
          layer.index = isDefined(layer.index) ? layer.index : idx + delta + 1;
        },

        initGroup: function(groupName) {
          $scope.groupProperties[groupName] = $scope.groupProperties[groupName] ? $scope.groupProperties[groupName] : {};
        },

        toggleOpacity: function(e, layer) {
          if (layer.visible) {
            if ($scope.autoHideOpacity &amp;&amp; !$scope.layerProperties[layer.name].opacityControl) {
              for (var k in $scope.layerProperties) {
                $scope.layerProperties[k].opacityControl = false;
              }
            }

            $scope.layerProperties[layer.name].opacityControl = !$scope.layerProperties[layer.name].opacityControl;
          }

          e.stopPropagation();
          e.preventDefault();
        },

        toggleLegend: function(layer) {
          $scope.layerProperties[layer.name].showLegend = !$scope.layerProperties[layer.name].showLegend;
        },

        showLegend: function(layer) {
          return layer.legend &amp;&amp; $scope.layerProperties[layer.name].showLegend;
        },

        unsafeHTML: function(html) {
          return $sce.trustAsHtml(html);
        },

        getOpacityIcon: function(layer) {
          return layer.visible &amp;&amp; $scope.layerProperties[layer.name].opacityControl ? $scope.icons.close : $scope.icons.open;
        },

        getGroupIcon: function(group) {
          return group.visible ? $scope.icons.check : $scope.icons.uncheck;
        },

        changeOpacity: function(layer) {
          var op = $scope.layerProperties[layer.name].opacity;
          leafletData.getMap().then(function(map) {
            leafletData.getLayers().then(function(leafletLayers) {
              var ly;
              for (var k in $scope.layers.overlays) {
                if ($scope.layers.overlays[k] === layer) {
                  ly = leafletLayers.overlays[k];
                  break;
                }
              }

              if (map.hasLayer(ly)) {
                if (ly.setOpacity) {
                  ly.setOpacity(op / 100);
                }

                if (ly.getLayers &amp;&amp; ly.eachLayer) {
                  ly.eachLayer(function(lay) {
                    if (lay.setOpacity) {
                      lay.setOpacity(op / 100);
                    }
                  });
                }
              }
            });
          });
        },

        changeGroupVisibility: function(groupName) {
          if (!isDefined($scope.groupProperties[groupName])) {
            return;
          }

          var visible = $scope.groupProperties[groupName].visible;
          for (var k in $scope.layers.overlays) {
            var layer = $scope.layers.overlays[k];
            if (layer.group === groupName) {
              layer.visible = visible;
            }
          }
        },
      });

      var div = $element.get(0);
      if (!L.Browser.touch) {
        L.DomEvent.disableClickPropagation(div);
        L.DomEvent.on(div, 'mousewheel', L.DomEvent.stopPropagation);
      } else {
        L.DomEvent.on(div, 'click', L.DomEvent.stopPropagation);
      }
    }],

    template:
    '&lt;div class="angular-leaflet-control-layers" ng-show="overlaysArray.length"&gt;' +
        '&lt;h4 ng-if="title"&gt;{{ title }}&lt;/h4&gt;' +
        '&lt;div class="lf-baselayers"&gt;' +
            '&lt;h5 class="lf-title" ng-if="baseTitle"&gt;{{ baseTitle }}&lt;/h5&gt;' +
            '&lt;div class="lf-row" ng-repeat="(key, layer) in baselayersArray"&gt;' +
                '&lt;label class="lf-icon-bl" ng-click="changeBaseLayer(key, $event)"&gt;' +
                    '&lt;input class="leaflet-control-layers-selector" type="radio" name="lf-radio" ' +
                        'ng-show="false" ng-checked="baselayer === key" ng-value="key" /&gt; ' +
                    '&lt;i class="lf-icon lf-icon-radio" ng-class="layer.icon"&gt;&lt;/i&gt;' +
                    '&lt;div class="lf-text"&gt;{{layer.name}}&lt;/div&gt;' +
                '&lt;/label&gt;' +
            '&lt;/div&gt;' +
        '&lt;/div&gt;' +
        '&lt;div class="lf-overlays"&gt;' +
            '&lt;h5 class="lf-title" ng-if="overlaysTitle"&gt;{{ overlaysTitle }}&lt;/h5&gt;' +
            '&lt;div class="lf-container"&gt;' +
                '&lt;div class="lf-row" ng-repeat="layer in (o = (overlaysArray | orderBy:\'index\':order))" ng-init="initIndex(layer, $index)"&gt;' +
                    '&lt;label class="lf-icon-ol-group" ng-if="showGroups &amp;amp;&amp;amp; layer.group &amp;amp;&amp;amp; layer.group != o[$index-1].group"&gt;' +
                        '&lt;input class="lf-control-layers-selector" type="checkbox" ng-show="false" ' +
                            'ng-change="changeGroupVisibility(layer.group)" ng-model="groupProperties[layer.group].visible"/&gt; ' +
                        '&lt;i class="lf-icon lf-icon-check" ng-class="getGroupIcon(groupProperties[layer.group])"&gt;&lt;/i&gt;' +
                        '&lt;div class="lf-text"&gt;{{ layer.group }}&lt;/div&gt;' +
                    '&lt;/label&gt;' +
                    '&lt;label class="lf-icon-ol"&gt;' +
                        '&lt;input class="lf-control-layers-selector" type="checkbox" ng-show="false" ng-model="layer.visible"/&gt; ' +
                        '&lt;i class="lf-icon lf-icon-check" ng-class="layer.icon"&gt;&lt;/i&gt;' +
                        '&lt;div class="lf-text"&gt;{{layer.name}}&lt;/div&gt;' +
                    '&lt;/label&gt;' +
                    '&lt;div class="lf-icons"&gt;' +
                        '&lt;i class="lf-icon lf-up" ng-class="icons.up" ng-click="moveLayer(layer, layer.index - orderNumber, $event)"&gt;&lt;/i&gt; ' +
                        '&lt;i class="lf-icon lf-down" ng-class="icons.down" ng-click="moveLayer(layer, layer.index + orderNumber, $event)"&gt;&lt;/i&gt; ' +
                        '&lt;i class="lf-icon lf-toggle-legend" ng-class="icons.toggleLegend" ng-if="layer.legend" ng-click="toggleLegend(layer)"&gt;&lt;/i&gt; ' +
                        '&lt;i class="lf-icon lf-open" ng-class="getOpacityIcon(layer)" ng-click="toggleOpacity($event, layer)"&gt;&lt;/i&gt;' +
                    '&lt;/div&gt;' +
                    '&lt;div class="lf-legend" ng-if="showLegend(layer)" ng-bind-html="unsafeHTML(layer.legend)"&gt;&lt;/div&gt;' +
                    '&lt;div class="lf-opacity clearfix" ng-if="layer.visible &amp;amp;&amp;amp; layerProperties[layer.name].opacityControl"&gt;' +
                        '&lt;label ng-if="rangeIsSupported" class="pull-left" style="width: 50%"&gt;0&lt;/label&gt;' +
                        '&lt;label ng-if="rangeIsSupported" class="pull-left text-right" style="width: 50%"&gt;100&lt;/label&gt;' +
                        '&lt;input ng-if="rangeIsSupported" class="clearfix" type="range" min="0" max="100" class="lf-opacity-control" ' +
                            'ng-model="layerProperties[layer.name].opacity" ng-change="changeOpacity(layer)"/&gt;' +
                        '&lt;h6 ng-if="!rangeIsSupported"&gt;Range is not supported in this browser&lt;/h6&gt;' +
                    '&lt;/div&gt;' +
                '&lt;/div&gt;' +
            '&lt;/div&gt;' +
        '&lt;/div&gt;' +
    '&lt;/div&gt;',
    link: function(scope, element, attrs, controller) {
      var isDefined = leafletHelpers.isDefined;
      var leafletScope = controller.getLeafletScope();
      var layers = leafletScope.layers;

      scope.$watch('icons', function() {
        var defaultIcons = {
          uncheck: 'fa fa-square-o',
          check: 'fa fa-check-square-o',
          radio: 'fa fa-dot-circle-o',
          unradio: 'fa fa-circle-o',
          up: 'fa fa-angle-up',
          down: 'fa fa-angle-down',
          open: 'fa fa-angle-double-down',
          close: 'fa fa-angle-double-up',
          toggleLegend: 'fa fa-pencil-square-o',
        };
        if (isDefined(scope.icons)) {
          angular.extend(defaultIcons, scope.icons);
          angular.extend(scope.icons, defaultIcons);
        } else {
          scope.icons = defaultIcons;
        }
      });

      // Setting layer stack order.
      attrs.order = (isDefined(attrs.order) &amp;&amp; (attrs.order === 'normal' || attrs.order === 'reverse')) ? attrs.order : 'normal';
      scope.order = attrs.order === 'normal';
      scope.orderNumber = attrs.order === 'normal' ? -1 : 1;

      scope.layers = layers;
      controller.getMap().then(function(map) {
        leafletScope.$watch('layers.baselayers', function(newBaseLayers) {
          var baselayersArray = {};
          leafletData.getLayers().then(function(leafletLayers) {
            var key;
            for (key in newBaseLayers) {
              var layer = newBaseLayers[key];
              layer.icon = scope.icons[map.hasLayer(leafletLayers.baselayers[key]) ? 'radio' : 'unradio'];
              baselayersArray[key] = layer;
            }

            scope.baselayersArray = baselayersArray;
          });
        });

        leafletScope.$watch('layers.overlays', function(newOverlayLayers) {
          var overlaysArray = [];
          var groupVisibleCount = {};
          leafletData.getLayers().then(function(leafletLayers) {
            var key;
            for (key in newOverlayLayers) {
              var layer = newOverlayLayers[key];
              layer.icon = scope.icons[(layer.visible ? 'check' : 'uncheck')];
              overlaysArray.push(layer);
              if (!isDefined(scope.layerProperties[layer.name])) {
                scope.layerProperties[layer.name] = {
                  opacity: isDefined(layer.layerOptions.opacity) ? layer.layerOptions.opacity * 100 : 100,
                  opacityControl: false,
                  showLegend: true,
                };
              }

              if (isDefined(layer.group)) {
                if (!isDefined(scope.groupProperties[layer.group])) {
                  scope.groupProperties[layer.group] = {
                    visible: false,
                  };
                }

                groupVisibleCount[layer.group] = isDefined(groupVisibleCount[layer.group]) ? groupVisibleCount[layer.group] : {
                  count: 0,
                  visibles: 0,
                };
                groupVisibleCount[layer.group].count++;
                if (layer.visible) {
                  groupVisibleCount[layer.group].visibles++;
                }
              }

              if (isDefined(layer.index) &amp;&amp; leafletLayers.overlays[key].setZIndex) {
                leafletLayers.overlays[key].setZIndex(newOverlayLayers[key].index);
              }
            }

            for (key in groupVisibleCount) {
              scope.groupProperties[key].visible = groupVisibleCount[key].visibles === groupVisibleCount[key].count;
            }

            scope.overlaysArray = overlaysArray;
          });
        }, true);
      });
    },
  };
}]);

angular.module('leaflet-directive-two').directive('layers', ["$log", "$q", "leafletData", "leafletHelpers", "leafletLayerHelpers", "leafletControlHelpers", function($log, $q, leafletData, leafletHelpers, leafletLayerHelpers, leafletControlHelpers) {

  return {
    restrict: 'A',
    scope: false,
    replace: false,
    require: 'leaflet',
    controller: ["$scope", function($scope) {
      $scope._leafletLayers = $q.defer();
      this.getLayers = function() {
        return $scope._leafletLayers.promise;
      };
    }],

    link: function(scope, element, attrs, controller) {
      var isDefined = leafletHelpers.isDefined;
      var leafletLayers = {};
      var leafletScope  = controller.getLeafletScope();
      var layers = leafletScope.layers;
      var createLayer = leafletLayerHelpers.createLayer;
      var safeAddLayer = leafletLayerHelpers.safeAddLayer;
      var safeRemoveLayer = leafletLayerHelpers.safeRemoveLayer;
      var updateLayersControl = leafletControlHelpers.updateLayersControl;
      var isLayersControlVisible = false;

      controller.getMap().then(function(map) {

        // We have baselayers to add to the map
        scope._leafletLayers.resolve(leafletLayers);
        leafletData.setLayers(leafletLayers, attrs.id);

        leafletLayers.baselayers = {};
        leafletLayers.overlays = {};

        var mapId = attrs.id;

        // Setup all baselayers definitions
        var oneVisibleLayer = false;
        for (var layerName in layers.baselayers) {
          var newBaseLayer = createLayer(layers.baselayers[layerName]);
          if (!isDefined(newBaseLayer)) {
            delete layers.baselayers[layerName];
            continue;
          }

          leafletLayers.baselayers[layerName] = newBaseLayer;

          // Only add the visible layer to the map, layer control manages the addition to the map
          // of layers in its control
          if (layers.baselayers[layerName].top === true) {
            safeAddLayer(map, leafletLayers.baselayers[layerName]);
            oneVisibleLayer = true;
          }
        }

        // If there is no visible layer add first to the map
        if (!oneVisibleLayer &amp;&amp; Object.keys(leafletLayers.baselayers).length &gt; 0) {
          safeAddLayer(map, leafletLayers.baselayers[Object.keys(layers.baselayers)[0]]);
        }

        // Setup the Overlays
        for (layerName in layers.overlays) {
          //if (layers.overlays[layerName].type === 'cartodb') {
          //
          //}

          var newOverlayLayer = createLayer(layers.overlays[layerName]);
          if (!isDefined(newOverlayLayer)) {
            delete layers.overlays[layerName];
            continue;
          }

          leafletLayers.overlays[layerName] = newOverlayLayer;

          // Only add the visible overlays to the map
          if (layers.overlays[layerName].visible === true) {
            safeAddLayer(map, leafletLayers.overlays[layerName]);
          }
        }

        // Watch for the base layers
        leafletScope.$watch('layers.baselayers', function(newBaseLayers, oldBaseLayers) {
          if (angular.equals(newBaseLayers, oldBaseLayers)) {
            isLayersControlVisible = updateLayersControl(map, mapId, isLayersControlVisible, newBaseLayers, layers.overlays, leafletLayers);
            return true;
          }

          // Delete layers from the array
          for (var name in leafletLayers.baselayers) {
            if (!isDefined(newBaseLayers[name]) || newBaseLayers[name].doRefresh) {
              // Remove from the map if it's on it
              if (map.hasLayer(leafletLayers.baselayers[name])) {
                map.removeLayer(leafletLayers.baselayers[name]);
              }

              delete leafletLayers.baselayers[name];

              if (newBaseLayers[name] &amp;&amp; newBaseLayers[name].doRefresh) {
                newBaseLayers[name].doRefresh = false;
              }
            }
          }

          // add new layers
          for (var newName in newBaseLayers) {
            if (!isDefined(leafletLayers.baselayers[newName])) {
              var testBaseLayer = createLayer(newBaseLayers[newName]);
              if (isDefined(testBaseLayer)) {
                leafletLayers.baselayers[newName] = testBaseLayer;

                // Only add the visible layer to the map
                if (newBaseLayers[newName].top === true) {
                  safeAddLayer(map, leafletLayers.baselayers[newName]);
                }
              }
            } else {
              if (newBaseLayers[newName].top === true &amp;&amp; !map.hasLayer(leafletLayers.baselayers[newName])) {
                safeAddLayer(map, leafletLayers.baselayers[newName]);
              } else if (newBaseLayers[newName].top === false &amp;&amp; map.hasLayer(leafletLayers.baselayers[newName])) {
                map.removeLayer(leafletLayers.baselayers[newName]);
              }
            }
          }

          //we have layers, so we need to make, at least, one active
          var found = false;

          // search for an active layer
          for (var key in leafletLayers.baselayers) {
            if (map.hasLayer(leafletLayers.baselayers[key])) {
              found = true;
              break;
            }
          }

          // If there is no active layer make one active
          if (!found &amp;&amp; Object.keys(leafletLayers.baselayers).length &gt; 0) {
            safeAddLayer(map, leafletLayers.baselayers[Object.keys(leafletLayers.baselayers)[0]]);
          }

          // Only show the layers switch selector control if we have more than one baselayer + overlay
          isLayersControlVisible = updateLayersControl(map, mapId, isLayersControlVisible, newBaseLayers, layers.overlays, leafletLayers);
        }, true);

        // Watch for the overlay layers
        leafletScope.$watch('layers.overlays', function(newOverlayLayers, oldOverlayLayers) {
          if (angular.equals(newOverlayLayers, oldOverlayLayers)) {
            isLayersControlVisible = updateLayersControl(map, mapId, isLayersControlVisible, layers.baselayers, newOverlayLayers, leafletLayers);
            return true;
          }

          // Delete layers from the array
          for (var name in leafletLayers.overlays) {
            if (!isDefined(newOverlayLayers[name]) || newOverlayLayers[name].doRefresh) {
              // Remove from the map if it's on it
              if (map.hasLayer(leafletLayers.overlays[name])) {
                // Safe remove when ArcGIS layers is loading.
                var options = isDefined(newOverlayLayers[name]) ?
                    newOverlayLayers[name].layerOptions : null;
                safeRemoveLayer(map, leafletLayers.overlays[name], options);
              }

              // TODO: Depending on the layer type we will have to delete what's included on it
              delete leafletLayers.overlays[name];

              if (newOverlayLayers[name] &amp;&amp; newOverlayLayers[name].doRefresh) {
                newOverlayLayers[name].doRefresh = false;
              }
            }
          }

          // add new overlays
          for (var newName in newOverlayLayers) {
            if (!isDefined(leafletLayers.overlays[newName])) {
              var testOverlayLayer = createLayer(newOverlayLayers[newName]);
              if (!isDefined(testOverlayLayer)) {
                // If the layer creation fails, continue to the next overlay
                continue;
              }

              leafletLayers.overlays[newName] = testOverlayLayer;
              if (newOverlayLayers[newName].visible === true) {
                safeAddLayer(map, leafletLayers.overlays[newName]);
              }
            } else {
              // check for the .visible property to hide/show overLayers
              if (newOverlayLayers[newName].visible &amp;&amp; !map.hasLayer(leafletLayers.overlays[newName])) {
                safeAddLayer(map, leafletLayers.overlays[newName]);
              } else if (newOverlayLayers[newName].visible === false &amp;&amp; map.hasLayer(leafletLayers.overlays[newName])) {
                // Safe remove when ArcGIS layers is loading.
                safeRemoveLayer(map, leafletLayers.overlays[newName], newOverlayLayers[newName].layerOptions);
              }
            }

            //refresh heatmap data if present
            if (newOverlayLayers[newName].visible &amp;&amp; map._loaded &amp;&amp; newOverlayLayers[newName].data &amp;&amp; newOverlayLayers[newName].type === 'heatmap') {
              leafletLayers.overlays[newName].setData(newOverlayLayers[newName].data);
              leafletLayers.overlays[newName].update();
            }
          }

          // Only add the layers switch selector control if we have more than one baselayer + overlay
          isLayersControlVisible = updateLayersControl(map, mapId, isLayersControlVisible, layers.baselayers, newOverlayLayers, leafletLayers);
        }, true);
      });
    },
  };
}]);

angular.module('leaflet-directive-two').directive('legend', ["$log", "$http", "leafletHelpers", "leafletLegendHelpers", function($log, $http, leafletHelpers, leafletLegendHelpers) {

  return {
    restrict: 'A',
    scope: false,
    replace: false,
    require: 'leaflet',

    link: function(scope, element, attrs, controller) {

      var isArray = leafletHelpers.isArray;
      var isDefined = leafletHelpers.isDefined;
      var isFunction = leafletHelpers.isFunction;
      var leafletScope = controller.getLeafletScope();
      var legend = leafletScope.legend;

      var legendClass;
      var position;
      var leafletLegend;
      var type;

      leafletScope.$watch('legend', function(newLegend) {

        if (isDefined(newLegend)) {

          legendClass = newLegend.legendClass ? newLegend.legendClass : 'legend';

          position = newLegend.position || 'bottomright';

          // default to arcgis
          type = newLegend.type || 'arcgis';
        }

      }, true);

      controller.getMap().then(function(map) {

        leafletScope.$watch('legend', function(newLegend) {

          if (!isDefined(newLegend)) {

            if (isDefined(leafletLegend)) {
              leafletLegend.removeFrom(map);
              leafletLegend = null;
            }

            return;
          }

          if (!isDefined(newLegend.url) &amp;&amp; (type === 'arcgis') &amp;&amp; (!isArray(newLegend.colors) || !isArray(newLegend.labels) || newLegend.colors.length !== newLegend.labels.length)) {

            $log.warn('[AngularJS - Leaflet] legend.colors and legend.labels must be set.');

            return;
          }

          if (isDefined(newLegend.url)) {

            $log.info('[AngularJS - Leaflet] loading legend service.');

            return;
          }

          if (isDefined(leafletLegend)) {
            leafletLegend.removeFrom(map);
            leafletLegend = null;
          }

          leafletLegend = L.control({
            position: position,
          });
          if (type === 'arcgis') {
            leafletLegend.onAdd = leafletLegendHelpers.getOnAddArrayLegend(newLegend, legendClass);
          }

          leafletLegend.addTo(map);

        });

        leafletScope.$watch('legend.url', function(newURL) {

          if (!isDefined(newURL)) {
            return;
          }

          $http.get(newURL)
                            .success(function(legendData) {

                              if (isDefined(leafletLegend)) {

                                leafletLegendHelpers.updateLegend(leafletLegend.getContainer(), legendData, type, newURL);

                              } else {

                                leafletLegend = L.control({
                                  position: position,
                                });
                                leafletLegend.onAdd = leafletLegendHelpers.getOnAddLegend(legendData, legendClass, type, newURL);
                                leafletLegend.addTo(map);
                              }

                              if (isDefined(legend.loadedData) &amp;&amp; isFunction(legend.loadedData)) {
                                legend.loadedData();
                              }
                            })
                            .error(function() {
                              $log.warn('[AngularJS - Leaflet] legend.url not loaded.');
                            });
        });

      });
    },
  };
}]);

angular.module('leaflet-directive-two').directive('markers',
    ["$log", "$rootScope", "$q", "leafletData", "leafletHelpers", "leafletMapDefaults", "leafletMarkersHelpers", "leafletMarkerEvents", "leafletIterators", "leafletWatchHelpers", "leafletDirectiveControlsHelpers", function($log, $rootScope, $q, leafletData, leafletHelpers, leafletMapDefaults,
              leafletMarkersHelpers, leafletMarkerEvents, leafletIterators, leafletWatchHelpers,
              leafletDirectiveControlsHelpers) {
      //less terse vars to helpers
      var isDefined = leafletHelpers.isDefined;
      var errorHeader = leafletHelpers.errorHeader;
      var Helpers = leafletHelpers;
      var isString = leafletHelpers.isString;
      var addMarkerWatcher = leafletMarkersHelpers.addMarkerWatcher;
      var updateMarker = leafletMarkersHelpers.updateMarker;
      var listenMarkerEvents = leafletMarkersHelpers.listenMarkerEvents;
      var addMarkerToGroup = leafletMarkersHelpers.addMarkerToGroup;
      var createMarker = leafletMarkersHelpers.createMarker;
      var deleteMarker = leafletMarkersHelpers.deleteMarker;
      var $it = leafletIterators;
      var _markersWatchOptions = leafletHelpers.watchOptions;
      var maybeWatch = leafletWatchHelpers.maybeWatch;
      var extendDirectiveControls = leafletDirectiveControlsHelpers.extend;

      var _getLMarker = function(leafletMarkers, name, maybeLayerName) {
        if (!Object.keys(leafletMarkers).length) return;
        if (maybeLayerName &amp;&amp; isString(maybeLayerName)) {
          if (!leafletMarkers[maybeLayerName] || !Object.keys(leafletMarkers[maybeLayerName]).length)
              return;
          return leafletMarkers[maybeLayerName][name];
        }

        return leafletMarkers[name];
      };

      var _setLMarker = function(lObject, leafletMarkers, name, maybeLayerName) {
        if (maybeLayerName &amp;&amp; isString(maybeLayerName)) {
          if (!isDefined(leafletMarkers[maybeLayerName]))
              leafletMarkers[maybeLayerName] = {};
          leafletMarkers[maybeLayerName][name] = lObject;
        } else
            leafletMarkers[name] = lObject;
        return lObject;
      };

      var _maybeAddMarkerToLayer = function(layerName, layers, model, marker, doIndividualWatch, map) {

        if (!isString(layerName)) {
          $log.error(errorHeader + ' A layername must be a string');
          return false;
        }

        if (!isDefined(layers)) {
          $log.error(errorHeader + ' You must add layers to the directive if the markers are going to use this functionality.');
          return false;
        }

        if (!isDefined(layers.overlays) || !isDefined(layers.overlays[layerName])) {
          $log.error(errorHeader + ' A marker can only be added to a layer of type "group"');
          return false;
        }

        var layerGroup = layers.overlays[layerName];
        if (!(layerGroup instanceof L.LayerGroup || layerGroup instanceof L.FeatureGroup)) {
          $log.error(errorHeader + ' Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"');
          return false;
        }

        // The marker goes to a correct layer group, so first of all we add it
        layerGroup.addLayer(marker);

        // The marker is automatically added to the map depending on the visibility
        // of the layer, so we only have to open the popup if the marker is in the map
        if (!doIndividualWatch &amp;&amp; map.hasLayer(marker) &amp;&amp; model.focus === true) {
          marker.openPopup();
        }

        return true;
      };

      //TODO: move to leafletMarkersHelpers??? or make a new class/function file (leafletMarkersHelpers is large already)
      var _addMarkers = function(mapId, markersToRender, oldModels, map, layers, leafletMarkers, leafletScope,
                                 watchOptions, maybeLayerName, skips) {
        for (var newName in markersToRender) {
          if (skips[newName])
              continue;

          if (newName.search('-') !== -1) {
            $log.error('The marker can\'t use a "-" on his key name: "' + newName + '".');
            continue;
          }

          var model = Helpers.copy(markersToRender[newName]);
          var pathToMarker = Helpers.getObjectDotPath(maybeLayerName ? [maybeLayerName, newName] : [newName]);
          var maybeLMarker = _getLMarker(leafletMarkers, newName, maybeLayerName);
          if (!isDefined(maybeLMarker)) {
            //(nmccready) very important to not have model changes when lObject is changed
            //this might be desirable in some cases but it causes two-way binding to lObject which is not ideal
            //if it is left as the reference then all changes from oldModel vs newModel are ignored
            //see _destroy (where modelDiff becomes meaningless if we do not copy here)
            var marker = createMarker(model);
            var layerName = (model ? model.layer : undefined) || maybeLayerName; //original way takes pref
            if (!isDefined(marker)) {
              $log.error(errorHeader + ' Received invalid data on the marker ' + newName + '.');
              continue;
            }

            _setLMarker(marker, leafletMarkers, newName, maybeLayerName);

            // Bind message
            if (isDefined(model.message)) {
              marker.bindPopup(model.message, model.popupOptions);
            }

            // Add the marker to a cluster group if needed
            if (isDefined(model.group)) {
              var groupOptions = isDefined(model.groupOption) ? model.groupOption : null;
              addMarkerToGroup(marker, model.group, groupOptions, map);
            }

            // Show label if defined
            if (Helpers.LabelPlugin.isLoaded() &amp;&amp; isDefined(model.label) &amp;&amp; isDefined(model.label.message)) {
              marker.bindLabel(model.label.message, model.label.options);
            }

            // Check if the marker should be added to a layer
            if (isDefined(model) &amp;&amp; (isDefined(model.layer) || isDefined(maybeLayerName))) {

              var pass = _maybeAddMarkerToLayer(layerName, layers, model, marker,
                  watchOptions.individual.doWatch, map);
              if (!pass)
                  continue; //something went wrong move on in the loop
            } else if (!isDefined(model.group)) {
              // We do not have a layer attr, so the marker goes to the map layer
              map.addLayer(marker);
              if (!watchOptions.individual.doWatch &amp;&amp; model.focus === true) {
                marker.openPopup();
              }
            }

            if (watchOptions.individual.doWatch) {
              addMarkerWatcher(marker, pathToMarker, leafletScope, layers, map,
                  watchOptions.individual.isDeep);
            }

            listenMarkerEvents(marker, model, leafletScope, watchOptions.individual.doWatch, map);
            leafletMarkerEvents.bindEvents(mapId, marker, pathToMarker, model, leafletScope, layerName);
          }          else {
            var oldModel = isDefined(oldModel) ? oldModels[newName] : undefined;
            updateMarker(model, oldModel, maybeLMarker, pathToMarker, leafletScope, layers, map);
          }
        }
      };

      var _seeWhatWeAlreadyHave = function(markerModels, oldMarkerModels, lMarkers, isEqual, cb) {
        var hasLogged = false;
        var equals = false;
        var oldMarker;
        var newMarker;

        var doCheckOldModel =  isDefined(oldMarkerModels);
        for (var name in lMarkers) {
          if (!hasLogged) {
            $log.debug(errorHeader + '[markers] destroy: ');
            hasLogged = true;
          }

          if (doCheckOldModel) {
            //might want to make the option (in watch options) to disable deep checking
            //ie the options to only check !== (reference check) instead of angular.equals (slow)
            newMarker = markerModels[name];
            oldMarker = oldMarkerModels[name];
            equals = angular.equals(newMarker, oldMarker) &amp;&amp; isEqual;
          }

          if (!isDefined(markerModels) ||
              !Object.keys(markerModels).length ||
              !isDefined(markerModels[name]) ||
              !Object.keys(markerModels[name]).length ||
              equals) {
            if (cb &amp;&amp; Helpers.isFunction(cb))
                cb(newMarker, oldMarker, name);
          }
        }
      };

      var _destroy = function(markerModels, oldMarkerModels, lMarkers, map, layers) {
        _seeWhatWeAlreadyHave(markerModels, oldMarkerModels, lMarkers, false,
            function(newMarker, oldMarker, lMarkerName) {
              $log.debug(errorHeader + '[marker] is deleting marker: ' + lMarkerName);
              deleteMarker(lMarkers[lMarkerName], map, layers);
              delete lMarkers[lMarkerName];
            });
      };

      var _getNewModelsToSkipp =  function(newModels, oldModels, lMarkers) {
        var skips = {};
        _seeWhatWeAlreadyHave(newModels, oldModels, lMarkers, true,
            function(newMarker, oldMarker, lMarkerName) {
              $log.debug(errorHeader + '[marker] is already rendered, marker: ' + lMarkerName);
              skips[lMarkerName] = newMarker;
            });

        return skips;
      };

      return {
        restrict: 'A',
        scope: false,
        replace: false,
        require: ['leaflet', '?layers'],

        link: function(scope, element, attrs, controller) {
          var mapController = controller[0];
          var leafletScope  = mapController.getLeafletScope();

          mapController.getMap().then(function(map) {
            var leafletMarkers = {};
            var getLayers;

            // If the layers attribute is used, we must wait until the layers are created
            if (isDefined(controller[1])) {
              getLayers = controller[1].getLayers;
            } else {
              getLayers = function() {
                var deferred = $q.defer();
                deferred.resolve();
                return deferred.promise;
              };
            }

            var watchOptions = leafletScope.markersWatchOptions || _markersWatchOptions;

            // backwards compat
            if (isDefined(attrs.watchMarkers))
                watchOptions.doWatch = watchOptions.individual.doWatch =
                    (!isDefined(attrs.watchMarkers) || Helpers.isTruthy(attrs.watchMarkers));

            var isNested = (isDefined(attrs.markersNested) &amp;&amp; Helpers.isTruthy(attrs.markersNested));

            getLayers().then(function(layers) {
              var _clean = function(models, oldModels) {
                if (isNested) {
                  $it.each(models, function(markerToMaybeDel, layerName) {
                    var oldModel = isDefined(oldModel) ? oldModels[layerName] : undefined;
                    _destroy(markerToMaybeDel, oldModel, leafletMarkers[layerName], map, layers);
                  });

                  return;
                }

                _destroy(models, oldModels, leafletMarkers, map, layers);
              };

              var _create = function(models, oldModels) {
                _clean(models, oldModels);
                var skips = null;
                if (isNested) {
                  $it.each(models, function(markersToAdd, layerName) {
                    var oldModel = isDefined(oldModel) ? oldModels[layerName] : undefined;
                    skips = _getNewModelsToSkipp(models[layerName], oldModel, leafletMarkers[layerName]);
                    _addMarkers(attrs.id, markersToAdd, oldModels, map, layers, leafletMarkers, leafletScope,
                        watchOptions, layerName, skips);
                  });

                  return;
                }

                skips = _getNewModelsToSkipp(models, oldModels, leafletMarkers);
                _addMarkers(attrs.id, models, oldModels, map, layers, leafletMarkers, leafletScope,
                    watchOptions, undefined, skips);
              };

              extendDirectiveControls(attrs.id, 'markers', _create, _clean);
              leafletData.setMarkers(leafletMarkers, attrs.id);

              maybeWatch(leafletScope, 'markers', watchOptions, function(newMarkers, oldMarkers) {
                _create(newMarkers, oldMarkers);
              });
            });
          });
        },
      };
    }]);

angular.module('leaflet-directive-two').directive('maxbounds', ["$log", "leafletMapDefaults", "leafletBoundsHelpers", "leafletHelpers", function($log, leafletMapDefaults, leafletBoundsHelpers, leafletHelpers) {

  return {
    restrict: 'A',
    scope: false,
    replace: false,
    require: 'leaflet',

    link: function(scope, element, attrs, controller) {
      var leafletScope  = controller.getLeafletScope();
      var isValidBounds = leafletBoundsHelpers.isValidBounds;
      var isNumber = leafletHelpers.isNumber;

      controller.getMap().then(function(map) {
        leafletScope.$watch('maxbounds', function(maxbounds) {
          if (!isValidBounds(maxbounds)) {
            // Unset any previous maxbounds
            map.setMaxBounds();
            return;
          }

          var leafletBounds = leafletBoundsHelpers.createLeafletBounds(maxbounds);
          if (isNumber(maxbounds.pad)) {
            leafletBounds = leafletBounds.pad(maxbounds.pad);
          }

          map.setMaxBounds(leafletBounds);
          if (!attrs.center &amp;&amp; !attrs.lfCenter) {
            map.fitBounds(leafletBounds);
          }
        });
      });
    },
  };
}]);

angular.module('leaflet-directive-two').directive('paths', ["$log", "$q", "leafletData", "leafletMapDefaults", "leafletHelpers", "leafletPathsHelpers", "leafletPathEvents", function($log, $q, leafletData, leafletMapDefaults, leafletHelpers, leafletPathsHelpers, leafletPathEvents) {

  return {
    restrict: 'A',
    scope: false,
    replace: false,
    require: ['leaflet', '?layers'],

    link: function(scope, element, attrs, controller) {
      var mapController = controller[0];
      var isDefined = leafletHelpers.isDefined;
      var isString = leafletHelpers.isString;
      var leafletScope  = mapController.getLeafletScope();
      var paths     = leafletScope.paths;
      var createPath = leafletPathsHelpers.createPath;
      var bindPathEvents = leafletPathEvents.bindPathEvents;
      var setPathOptions = leafletPathsHelpers.setPathOptions;

      mapController.getMap().then(function(map) {
        var defaults = leafletMapDefaults.getDefaults(attrs.id);
        var getLayers;

        // If the layers attribute is used, we must wait until the layers are created
        if (isDefined(controller[1])) {
          getLayers = controller[1].getLayers;
        } else {
          getLayers = function() {
            var deferred = $q.defer();
            deferred.resolve();
            return deferred.promise;
          };
        }

        if (!isDefined(paths)) {
          return;
        }

        getLayers().then(function(layers) {

          var leafletPaths = {};
          leafletData.setPaths(leafletPaths, attrs.id);

          // Should we watch for every specific marker on the map?
          var shouldWatch = (!isDefined(attrs.watchPaths) || attrs.watchPaths === 'true');

          // Function for listening every single path once created
          var watchPathFn = function(leafletPath, name) {
            var clearWatch = leafletScope.$watch('paths["' + name + '"]', function(pathData, old) {
              if (!isDefined(pathData)) {
                if (isDefined(old.layer)) {
                  for (var i in layers.overlays) {
                    var overlay = layers.overlays[i];
                    overlay.removeLayer(leafletPath);
                  }
                }

                map.removeLayer(leafletPath);
                clearWatch();
                return;
              }

              setPathOptions(leafletPath, pathData.type, pathData);
            }, true);
          };

          leafletScope.$watchCollection('paths', function(newPaths) {

            // Delete paths (by name) from the array
            for (var name in leafletPaths) {
              if (!isDefined(newPaths[name])) {
                map.removeLayer(leafletPaths[name]);
                delete leafletPaths[name];
              }
            }

            // Create the new paths
            for (var newName in newPaths) {
              if (newName.search('\\$') === 0) {
                continue;
              }

              if (newName.search('-') !== -1) {
                $log.error('[AngularJS - Leaflet] The path name "' + newName + '" is not valid. It must not include "-" and a number.');
                continue;
              }

              if (!isDefined(leafletPaths[newName])) {
                var pathData = newPaths[newName];
                var newPath = createPath(newName, newPaths[newName], defaults);

                // bind popup if defined
                if (isDefined(newPath) &amp;&amp; isDefined(pathData.message)) {
                  newPath.bindPopup(pathData.message, pathData.popupOptions);
                }

                // Show label if defined
                if (leafletHelpers.LabelPlugin.isLoaded() &amp;&amp; isDefined(pathData.label) &amp;&amp; isDefined(pathData.label.message)) {
                  newPath.bindLabel(pathData.label.message, pathData.label.options);
                }

                // Check if the marker should be added to a layer
                if (isDefined(pathData) &amp;&amp; isDefined(pathData.layer)) {

                  if (!isString(pathData.layer)) {
                    $log.error('[AngularJS - Leaflet] A layername must be a string');
                    continue;
                  }

                  if (!isDefined(layers)) {
                    $log.error('[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.');
                    continue;
                  }

                  if (!isDefined(layers.overlays) || !isDefined(layers.overlays[pathData.layer])) {
                    $log.error('[AngularJS - Leaflet] A path can only be added to a layer of type "group"');
                    continue;
                  }

                  var layerGroup = layers.overlays[pathData.layer];
                  if (!(layerGroup instanceof L.LayerGroup || layerGroup instanceof L.FeatureGroup)) {
                    $log.error('[AngularJS - Leaflet] Adding a path to an overlay needs a overlay of the type "group" or "featureGroup"');
                    continue;
                  }

                  // Listen for changes on the new path
                  leafletPaths[newName] = newPath;

                  // The path goes to a correct layer group, so first of all we add it
                  layerGroup.addLayer(newPath);

                  if (shouldWatch) {
                    watchPathFn(newPath, newName);
                  } else {
                    setPathOptions(newPath, pathData.type, pathData);
                  }
                } else if (isDefined(newPath)) {
                  // Listen for changes on the new path
                  leafletPaths[newName] = newPath;
                  map.addLayer(newPath);

                  if (shouldWatch) {
                    watchPathFn(newPath, newName);
                  } else {
                    setPathOptions(newPath, pathData.type, pathData);
                  }
                }

                bindPathEvents(attrs.id, newPath, newName, pathData, leafletScope);
              }
            }
          });
        });
      });
    },
  };
}]);

angular.module('leaflet-directive-two').directive('tiles', ["$log", "leafletData", "leafletMapDefaults", "leafletHelpers", function($log, leafletData, leafletMapDefaults, leafletHelpers) {

  return {
    restrict: 'A',
    scope: false,
    replace: false,
    require: 'leaflet',

    link: function(scope, element, attrs, controller) {
      var isDefined = leafletHelpers.isDefined;
      var leafletScope  = controller.getLeafletScope();
      var tiles = leafletScope.tiles;

      if (!isDefined(tiles) ||  !isDefined(tiles.url)) {
        $log.warn('[AngularJS - Leaflet] The \'tiles\' definition doesn\'t have the \'url\' property.');
        return;
      }

      controller.getMap().then(function(map) {
        var defaults = leafletMapDefaults.getDefaults(attrs.id);
        var tileLayerObj;
        leafletScope.$watch('tiles', function(tiles, oldtiles) {
          var tileLayerOptions = defaults.tileLayerOptions;
          var tileLayerUrl = defaults.tileLayer;

          // If no valid tiles are in the scope, remove the last layer
          if (!isDefined(tiles.url) &amp;&amp; isDefined(tileLayerObj)) {
            map.removeLayer(tileLayerObj);
            return;
          }

          // No leafletTiles object defined yet
          if (!isDefined(tileLayerObj)) {
            if (isDefined(tiles.options)) {
              angular.copy(tiles.options, tileLayerOptions);
            }

            if (isDefined(tiles.url)) {
              tileLayerUrl = tiles.url;
            }

            if (tiles.type === 'wms') {
              tileLayerObj = L.tileLayer.wms(tileLayerUrl, tileLayerOptions);
            } else {
              tileLayerObj = L.tileLayer(tileLayerUrl, tileLayerOptions);
            }

            tileLayerObj.addTo(map);
            leafletData.setTiles(tileLayerObj, attrs.id);
            return;
          }

          // If the options of the tilelayer is changed, we need to redraw the layer
          if (isDefined(tiles.url) &amp;&amp; isDefined(tiles.options) &amp;&amp;
              (tiles.type !== oldtiles.type || !angular.equals(tiles.options, tileLayerOptions))) {
            map.removeLayer(tileLayerObj);
            tileLayerOptions = defaults.tileLayerOptions;
            angular.copy(tiles.options, tileLayerOptions);
            tileLayerUrl = tiles.url;

            if (tiles.type === 'wms') {
              tileLayerObj = L.tileLayer.wms(tileLayerUrl, tileLayerOptions);
            } else {
              tileLayerObj = L.tileLayer(tileLayerUrl, tileLayerOptions);
            }

            tileLayerObj.addTo(map);
            leafletData.setTiles(tileLayerObj, attrs.id);
            return;
          }

          // Only the URL of the layer is changed, update the tiles object
          if (isDefined(tiles.url)) {
            tileLayerObj.setUrl(tiles.url);
          }
        }, true);
      });
    },
  };
}]);

/*
    Create multiple similar directives for watchOptions to support directiveControl
    instead. (when watches are disabled)
    NgAnnotate does not work here due to the functional creation
*/
['markers', 'geojson'].forEach(function(name) {
  angular.module('leaflet-directive-two').directive(name + 'WatchOptions', [
      '$log', '$rootScope', '$q', 'leafletData', 'leafletHelpers',
        function($log, $rootScope, $q, leafletData, leafletHelpers) {

          var isDefined = leafletHelpers.isDefined,
              errorHeader = leafletHelpers.errorHeader,
              isObject = leafletHelpers.isObject,
              _watchOptions = leafletHelpers.watchOptions;

          return {
            restrict: 'A',
            scope: false,
            replace: false,
            require: ['leaflet'],

            link: function(scope, element, attrs, controller) {
              var mapController = controller[0],
                  leafletScope = mapController.getLeafletScope();

              mapController.getMap().then(function() {
                if (isDefined(scope[name + 'WatchOptions'])) {
                  if (isObject(scope[name + 'WatchOptions']))
                      angular.extend(_watchOptions, scope[name + 'WatchOptions']);
                  else
                      $log.error(errorHeader + '[' + name + 'WatchOptions] is not an object');
                  leafletScope[name + 'WatchOptions'] = _watchOptions;
                }
              });
            },
          };
        },]);
});

angular.module('leaflet-directive-two')
.factory('LeafletEventsHelpersFactory', ["$rootScope", "$q", "$log", "leafletHelpers", function($rootScope, $q, $log, leafletHelpers) {
  var safeApply = leafletHelpers.safeApply;
  var isDefined = leafletHelpers.isDefined;
  var isObject = leafletHelpers.isObject;
  var isArray = leafletHelpers.isArray;
  var errorHeader = leafletHelpers.errorHeader;

  var EventsHelper = function(rootBroadcastName, lObjectType) {
    this.rootBroadcastName = rootBroadcastName;
    $log.debug('LeafletEventsHelpersFactory: lObjectType: ' + lObjectType + 'rootBroadcastName: ' + rootBroadcastName);

    //used to path/key out certain properties based on the type , "markers", "geojson"
    this.lObjectType = lObjectType;
  };

  EventsHelper.prototype.getAvailableEvents = function() {return [];};

  /*
   argument: name: Note this can be a single string or dot notation
   Example:
   markerModel : {
   m1: { lat:_, lon: _}
   }
   //would yield name of
   name = "m1"

   If nested:
   markerModel : {
   cars: {
   m1: { lat:_, lon: _}
   }
   }
   //would yield name of
   name = "cars.m1"
   */
  EventsHelper.prototype.genDispatchEvent = function(maybeMapId, eventName, logic, leafletScope, lObject, name, model, layerName, extra) {
    var _this = this;

    maybeMapId = maybeMapId || '';
    if (maybeMapId)
      maybeMapId = '.' + maybeMapId;

    return function(e) {
      var broadcastName = _this.rootBroadcastName + maybeMapId + '.' + eventName;
      $log.debug(broadcastName);
      _this.fire(leafletScope, broadcastName, logic, e, e.target || lObject, model, name, layerName, extra);
    };
  };

  EventsHelper.prototype.fire = function(scope, broadcastName, logic, event, lObject, model, modelName, layerName) {
    // Safely broadcast the event
    safeApply(scope, function() {
      var toSend = {
        leafletEvent: event,
        leafletObject: lObject,
        modelName: modelName,
        model: model,
      };
      if (isDefined(layerName))
          angular.extend(toSend, {layerName: layerName});

      if (logic === 'emit') {
        scope.$emit(broadcastName, toSend);
      } else {
        $rootScope.$broadcast(broadcastName, toSend);
      }
    });
  };

  EventsHelper.prototype.bindEvents = function(maybeMapId, lObject, name, model, leafletScope, layerName, extra) {
    var events = [];
    var logic = 'emit';
    var _this = this;

    if (!isDefined(leafletScope.eventBroadcast)) {
      // Backward compatibility, if no event-broadcast attribute, all events are broadcasted
      events = this.getAvailableEvents();
    } else if (!isObject(leafletScope.eventBroadcast)) {
      // Not a valid object
      $log.error(errorHeader + 'event-broadcast must be an object check your model.');
    } else {
      // We have a possible valid object
      if (!isDefined(leafletScope.eventBroadcast[_this.lObjectType])) {
        // We do not have events enable/disable do we do nothing (all enabled by default)
        events = this.getAvailableEvents();
      } else if (!isObject(leafletScope.eventBroadcast[_this.lObjectType])) {
        // Not a valid object
        $log.warn(errorHeader + 'event-broadcast.' + [_this.lObjectType]  + ' must be an object check your model.');
      } else {
        // We have a possible valid map object
        // Event propadation logic
        if (isDefined(leafletScope.eventBroadcast[this.lObjectType].logic)) {
          // We take care of possible propagation logic
          if (leafletScope.eventBroadcast[_this.lObjectType].logic !== 'emit' &amp;&amp;
              leafletScope.eventBroadcast[_this.lObjectType].logic !== 'broadcast')
                  $log.warn(errorHeader + 'Available event propagation logic are: \'emit\' or \'broadcast\'.');
        }

        // Enable / Disable
        var eventsEnable = false;
        var eventsDisable = false;
        if (isDefined(leafletScope.eventBroadcast[_this.lObjectType].enable) &amp;&amp;
            isArray(leafletScope.eventBroadcast[_this.lObjectType].enable))
                eventsEnable = true;
        if (isDefined(leafletScope.eventBroadcast[_this.lObjectType].disable) &amp;&amp;
            isArray(leafletScope.eventBroadcast[_this.lObjectType].disable))
                eventsDisable = true;

        if (eventsEnable &amp;&amp; eventsDisable) {
          // Both are active, this is an error
          $log.warn(errorHeader + 'can not enable and disable events at the same time');
        } else if (!eventsEnable &amp;&amp; !eventsDisable) {
          // Both are inactive, this is an error
          $log.warn(errorHeader + 'must enable or disable events');
        } else {
          // At this point the object is OK, lets enable or disable events
          if (eventsEnable) {
            // Enable events
            leafletScope.eventBroadcast[this.lObjectType].enable.forEach(function(eventName) {
              // Do we have already the event enabled?
              if (events.indexOf(eventName) !== -1) {
                // Repeated event, this is an error
                $log.warn(errorHeader + 'This event ' + eventName + ' is already enabled');
              } else {
                // Does the event exists?
                if (_this.getAvailableEvents().indexOf(eventName) === -1) {
                  // The event does not exists, this is an error
                  $log.warn(errorHeader + 'This event ' + eventName + ' does not exist');
                } else {
                  // All ok enable the event
                  events.push(eventName);
                }
              }
            });
          } else {
            // Disable events
            events = this.getAvailableEvents();
            leafletScope.eventBroadcast[_this.lObjectType].disable.forEach(function(eventName) {
              var index = events.indexOf(eventName);
              if (index === -1) {
                // The event does not exist
                $log.warn(errorHeader + 'This event ' + eventName + ' does not exist or has been already disabled');

              } else {
                events.splice(index, 1);
              }
            });
          }
        }
      }
    }

    events.forEach(function(eventName) {
      lObject.on(eventName, _this.genDispatchEvent(maybeMapId, eventName, logic, leafletScope, lObject, name, model, layerName, extra));
    });

    return logic;
  };

  return EventsHelper;
}])
.service('leafletEventsHelpers', ["LeafletEventsHelpersFactory", function(LeafletEventsHelpersFactory) {
  return new LeafletEventsHelpersFactory();
}]);

angular.module('leaflet-directive-two')
.factory('leafletGeoJsonEvents', ["$rootScope", "$q", "$log", "leafletHelpers", "LeafletEventsHelpersFactory", "leafletData", function($rootScope, $q, $log, leafletHelpers,
  LeafletEventsHelpersFactory, leafletData) {
  var safeApply = leafletHelpers.safeApply;
  var EventsHelper = LeafletEventsHelpersFactory;

  var GeoJsonEvents = function() {
      EventsHelper.call(this, 'leafletDirectiveGeoJson', 'geojson');
    };

  GeoJsonEvents.prototype =  new EventsHelper();

  GeoJsonEvents.prototype.genDispatchEvent = function(maybeMapId, eventName, logic, leafletScope, lObject, name, model, layerName, extra) {
    var base = EventsHelper.prototype.genDispatchEvent.call(this, maybeMapId, eventName, logic, leafletScope, lObject, name, model, layerName);
    var _this = this;

    return function(e) {
      if (eventName === 'mouseout') {
        if (extra.resetStyleOnMouseout) {
          leafletData.getGeoJSON(extra.mapId)
                    .then(function(leafletGeoJSON) {
                      //this is broken on nested needs to traverse or user layerName (nested)
                      var lobj = layerName ? leafletGeoJSON[layerName] : leafletGeoJSON;
                      lobj.resetStyle(e.target);
                    });

        }

        safeApply(leafletScope, function() {
          $rootScope.$broadcast(_this.rootBroadcastName + '.mouseout', e);
        });
      }

      base(e); //common
    };
  };

  GeoJsonEvents.prototype.getAvailableEvents = function() { return [
      'click',
      'dblclick',
      'mouseover',
      'mouseout',
      ];
  };

  return new GeoJsonEvents();
}]);

angular.module('leaflet-directive-two')
.factory('leafletLabelEvents', ["$rootScope", "$q", "$log", "leafletHelpers", "LeafletEventsHelpersFactory", function($rootScope, $q, $log, leafletHelpers, LeafletEventsHelpersFactory) {
  var Helpers = leafletHelpers;
  var EventsHelper = LeafletEventsHelpersFactory;

  var LabelEvents = function() {
          EventsHelper.call(this, 'leafletDirectiveLabel', 'markers');
        };

  LabelEvents.prototype =  new EventsHelper();

  LabelEvents.prototype.genDispatchEvent = function(maybeMapId, eventName, logic, leafletScope, lObject, name, model, layerName) {
    var markerName = name.replace('markers.', '');
    return EventsHelper.prototype
        .genDispatchEvent.call(this, maybeMapId, eventName, logic, leafletScope, lObject, markerName, model, layerName);
  };

  LabelEvents.prototype.getAvailableEvents = function() {
    return [
        'click',
        'dblclick',
        'mousedown',
        'mouseover',
        'mouseout',
        'contextmenu',
    ];
  };

  LabelEvents.prototype.genEvents = function(maybeMapId, eventName, logic, leafletScope, lObject, name, model, layerName) {
    var _this = this;
    var labelEvents = this.getAvailableEvents();
    var scopeWatchName = Helpers.getObjectArrayPath('markers.' + name);
    labelEvents.forEach(function(eventName) {
      lObject.label.on(eventName, _this.genDispatchEvent(
          maybeMapId, eventName, logic, leafletScope, lObject.label, scopeWatchName, model, layerName));
    });
  };

  LabelEvents.prototype.bindEvents = function() {};

  return new LabelEvents();
}]);

angular.module('leaflet-directive-two')
.factory('leafletMapEvents', ["$rootScope", "$q", "$log", "leafletHelpers", "leafletEventsHelpers", "leafletIterators", function($rootScope, $q, $log, leafletHelpers, leafletEventsHelpers, leafletIterators) {
  var isDefined = leafletHelpers.isDefined;
  var fire = leafletEventsHelpers.fire;

  var _getAvailableMapEvents = function() {
    return [
        'click',
        'dblclick',
        'mousedown',
        'mouseup',
        'mouseover',
        'mouseout',
        'mousemove',
        'contextmenu',
        'focus',
        'blur',
        'preclick',
        'load',
        'unload',
        'viewreset',
        'movestart',
        'move',
        'moveend',
        'dragstart',
        'drag',
        'dragend',
        'zoomstart',
        'zoomanim',
        'zoomend',
        'zoomlevelschange',
        'resize',
        'autopanstart',
        'layeradd',
        'layerremove',
        'baselayerchange',
        'overlayadd',
        'overlayremove',
        'locationfound',
        'locationerror',
        'popupopen',
        'popupclose',
        'draw:created',
        'draw:edited',
        'draw:deleted',
        'draw:drawstart',
        'draw:drawstop',
        'draw:editstart',
        'draw:editstop',
        'draw:deletestart',
        'draw:deletestop',
    ];
  };

  var _genDispatchMapEvent = function(scope, eventName, logic, maybeMapId) {
    if (maybeMapId)
      maybeMapId = maybeMapId + '.';
    return function(e) {
      // Put together broadcast name
      var broadcastName = 'leafletDirectiveMap.' + maybeMapId + eventName;
      $log.debug(broadcastName);

      // Safely broadcast the event
      fire(scope, broadcastName, logic, e, e.target, scope);
    };
  };

  var _notifyCenterChangedToBounds = function(scope) {
    scope.$broadcast('boundsChanged');
  };

  var _notifyCenterUrlHashChanged = function(scope, map, attrs, search) {
    if (!isDefined(attrs.urlHashCenter)) {
      return;
    }

    var center = map.getCenter();
    var centerUrlHash = (center.lat).toFixed(4) + ':' + (center.lng).toFixed(4) + ':' + map.getZoom();
    if (!isDefined(search.c) || search.c !== centerUrlHash) {
      //$log.debug("notified new center...");
      scope.$emit('centerUrlHash', centerUrlHash);
    }
  };

  var _addEvents =  function(map, mapEvents, contextName, scope, logic) {
    leafletIterators.each(mapEvents, function(eventName) {
      var context = {};
      context[contextName] = eventName;
      map.on(eventName, _genDispatchMapEvent(scope, eventName, logic, map._container.id || ''), context);
    });
  };

  return {
    getAvailableMapEvents: _getAvailableMapEvents,
    genDispatchMapEvent: _genDispatchMapEvent,
    notifyCenterChangedToBounds: _notifyCenterChangedToBounds,
    notifyCenterUrlHashChanged: _notifyCenterUrlHashChanged,
    addEvents: _addEvents,
  };
}]);

angular.module('leaflet-directive-two')
.factory('leafletMarkerEvents', ["$rootScope", "$q", "$log", "leafletHelpers", "LeafletEventsHelpersFactory", "leafletLabelEvents", function($rootScope, $q, $log, leafletHelpers, LeafletEventsHelpersFactory, leafletLabelEvents) {
  var safeApply = leafletHelpers.safeApply;
  var isDefined = leafletHelpers.isDefined;
  var Helpers = leafletHelpers;
  var lblHelp = leafletLabelEvents;
  var EventsHelper = LeafletEventsHelpersFactory;

  var MarkerEvents = function() {
      EventsHelper.call(this, 'leafletDirectiveMarker', 'markers');
    };

  MarkerEvents.prototype = new EventsHelper();

  MarkerEvents.prototype.genDispatchEvent = function(maybeMapId, eventName, logic, leafletScope, lObject, name, model, layerName) {
    var handle = EventsHelper.prototype
        .genDispatchEvent.call(this, maybeMapId, eventName, logic, leafletScope, lObject, name, model, layerName);
    return function(e) {
      // Broadcast old marker click name for backwards compatibility
      if (eventName === 'click') {
        safeApply(leafletScope, function() {
          $rootScope.$broadcast('leafletDirectiveMarkersClick', name);
        });
      } else if (eventName === 'dragend') {
        safeApply(leafletScope, function() {
          model.lat = lObject.getLatLng().lat;
          model.lng = lObject.getLatLng().lng;
        });

        if (model.message &amp;&amp; model.focus === true) {
          lObject.openPopup();
        }
      }

      handle(e); //common
    };
  };

  MarkerEvents.prototype.getAvailableEvents = function() { return [
      'click',
      'dblclick',
      'mousedown',
      'mouseover',
      'mouseout',
      'contextmenu',
      'dragstart',
      'drag',
      'dragend',
      'move',
      'remove',
      'popupopen',
      'popupclose',
      'touchend',
      'touchstart',
      'touchmove',
      'touchcancel',
      'touchleave',
      ];
  };

  MarkerEvents.prototype.bindEvents = function(maybeMapId, lObject, name, model, leafletScope, layerName) {
      var logic = EventsHelper.prototype.bindEvents.call(this, maybeMapId, lObject, name, model, leafletScope, layerName);

      if (Helpers.LabelPlugin.isLoaded() &amp;&amp; isDefined(lObject.label)) {
        lblHelp.genEvents(maybeMapId, name, logic, leafletScope, lObject, model, layerName);
      }
    };

  return new MarkerEvents();
}]);

angular.module('leaflet-directive-two')
.factory('leafletPathEvents', ["$rootScope", "$q", "$log", "leafletHelpers", "leafletLabelEvents", "leafletEventsHelpers", function($rootScope, $q, $log, leafletHelpers, leafletLabelEvents, leafletEventsHelpers) {
  var isDefined = leafletHelpers.isDefined;
  var isObject = leafletHelpers.isObject;
  var Helpers = leafletHelpers;
  var errorHeader = leafletHelpers.errorHeader;
  var lblHelp = leafletLabelEvents;
  var fire = leafletEventsHelpers.fire;

  /*
  TODO (nmccready) This EventsHelper needs to be derrived from leafletEventsHelpers to elminate copy and paste code.
  */

  var _genDispatchPathEvent = function(maybeMapId, eventName, logic, leafletScope, lObject, name, model, layerName) {
    maybeMapId = maybeMapId || '';

    if (maybeMapId)
      maybeMapId = '.' + maybeMapId;

    return function(e) {
      var broadcastName = 'leafletDirectivePath' + maybeMapId + '.' + eventName;
      $log.debug(broadcastName);
      fire(leafletScope, broadcastName, logic, e, e.target || lObject, model, name, layerName);
    };
  };

  var _bindPathEvents = function(maybeMapId, lObject, name, model, leafletScope) {
    var pathEvents = [];
    var i;
    var eventName;
    var logic = 'broadcast';

    if (!isDefined(leafletScope.eventBroadcast)) {
      // Backward compatibility, if no event-broadcast attribute, all events are broadcasted
      pathEvents = _getAvailablePathEvents();
    } else if (!isObject(leafletScope.eventBroadcast)) {
      // Not a valid object
      $log.error(errorHeader + 'event-broadcast must be an object check your model.');
    } else {
      // We have a possible valid object
      if (!isDefined(leafletScope.eventBroadcast.path)) {
        // We do not have events enable/disable do we do nothing (all enabled by default)
        pathEvents = _getAvailablePathEvents();
      } else if (isObject(leafletScope.eventBroadcast.paths)) {
        // Not a valid object
        $log.warn(errorHeader + 'event-broadcast.path must be an object check your model.');
      } else {
        // We have a possible valid map object
        // Event propadation logic
        if (leafletScope.eventBroadcast.path.logic !== undefined &amp;&amp; leafletScope.eventBroadcast.path.logic !== null) {
          // We take care of possible propagation logic
          if (leafletScope.eventBroadcast.path.logic !== 'emit' &amp;&amp; leafletScope.eventBroadcast.path.logic !== 'broadcast') {
            // This is an error
            $log.warn(errorHeader + 'Available event propagation logic are: \'emit\' or \'broadcast\'.');
          } else if (leafletScope.eventBroadcast.path.logic === 'emit') {
            logic = 'emit';
          }
        }

        // Enable / Disable
        var pathEventsEnable = false;
        var pathEventsDisable = false;
        if (leafletScope.eventBroadcast.path.enable !== undefined &amp;&amp; leafletScope.eventBroadcast.path.enable !== null) {
          if (typeof leafletScope.eventBroadcast.path.enable === 'object') {
            pathEventsEnable = true;
          }
        }

        if (leafletScope.eventBroadcast.path.disable !== undefined &amp;&amp; leafletScope.eventBroadcast.path.disable !== null) {
          if (typeof leafletScope.eventBroadcast.path.disable === 'object') {
            pathEventsDisable = true;
          }
        }

        if (pathEventsEnable &amp;&amp; pathEventsDisable) {
          // Both are active, this is an error
          $log.warn(errorHeader + 'can not enable and disable events at the same time');
        } else if (!pathEventsEnable &amp;&amp; !pathEventsDisable) {
          // Both are inactive, this is an error
          $log.warn(errorHeader + 'must enable or disable events');
        } else {
          // At this point the path object is OK, lets enable or disable events
          if (pathEventsEnable) {
            // Enable events
            for (i = 0; i &lt; leafletScope.eventBroadcast.path.enable.length; i++) {
              eventName = leafletScope.eventBroadcast.path.enable[i];

              // Do we have already the event enabled?
              if (pathEvents.indexOf(eventName) !== -1) {
                // Repeated event, this is an error
                $log.warn(errorHeader + 'This event ' + eventName + ' is already enabled');
              } else {
                // Does the event exists?
                if (_getAvailablePathEvents().indexOf(eventName) === -1) {
                  // The event does not exists, this is an error
                  $log.warn(errorHeader + 'This event ' + eventName + ' does not exist');
                } else {
                  // All ok enable the event
                  pathEvents.push(eventName);
                }
              }
            }
          } else {
            // Disable events
            pathEvents = _getAvailablePathEvents();
            for (i = 0; i &lt; leafletScope.eventBroadcast.path.disable.length; i++) {
              eventName = leafletScope.eventBroadcast.path.disable[i];
              var index = pathEvents.indexOf(eventName);
              if (index === -1) {
                // The event does not exist
                $log.warn(errorHeader + 'This event ' + eventName + ' does not exist or has been already disabled');

              } else {
                pathEvents.splice(index, 1);
              }
            }
          }
        }
      }
    }

    for (i = 0; i &lt; pathEvents.length; i++) {
      eventName = pathEvents[i];
      lObject.on(eventName, _genDispatchPathEvent(maybeMapId, eventName, logic, leafletScope, pathEvents, name));
    }

    if (Helpers.LabelPlugin.isLoaded() &amp;&amp; isDefined(lObject.label)) {
      lblHelp.genEvents(maybeMapId, name, logic, leafletScope, lObject, model);
    }
  };

  var _getAvailablePathEvents = function() {
    return [
        'click',
        'dblclick',
        'mousedown',
        'mouseover',
        'mouseout',
        'contextmenu',
        'add',
        'remove',
        'popupopen',
        'popupclose',
    ];
  };

  return {
    getAvailablePathEvents: _getAvailablePathEvents,
    bindPathEvents: _bindPathEvents,
  };
}]);

}(angular));

]]&gt;&lt;/script&gt;&lt;script_name&gt;Leaflet Directive Asset App&lt;/script_name&gt;&lt;sys_class_name&gt;sys_ui_script&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-05-15 15:56:18&lt;/sys_created_on&gt;&lt;sys_id&gt;ab4559bbdb15f7409eb1d311ce9619d9&lt;/sys_id&gt;&lt;sys_mod_count&gt;18&lt;/sys_mod_count&gt;&lt;sys_name&gt;x_snc_sp_asset_map.Leaflet Directive Ass&lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_ui_script_ab4559bbdb15f7409eb1d311ce9619d9&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;brian.nguyen&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-08-26 16:06:01&lt;/sys_updated_on&gt;&lt;ui_type&gt;0&lt;/ui_type&gt;&lt;use_scoped_format&gt;false&lt;/use_scoped_format&gt;&lt;/sys_ui_script&gt;&lt;/record_update&gt;</payload>
<payload_hash>-1249886600</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>e395faeedb48c410993fdc965e961919</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d92670000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>x_snc_sp_asset_map.Leaflet Directive Ass</target_name>
<type>UI Script</type>
<update_domain>global</update_domain>
<update_guid>8363bb7869677300fef116a62ec5b488</update_guid>
<update_guid_history>8363bb7869677300fef116a62ec5b488:-1249886600,5443bb78ef6773005faeca19634db92c:950543197,30df23b48c677300de600fad874adf08:53548523,477eab746c677300e056b942907a72c9:1564636101,d597976fe617f7003e628126780536e8:1182972229,bc275b2f1317f70000c570d47c9f6295:990257897,36c6d32f0217f700696590d7af74eb21:1182972229,1d84df6b2b17f70098d714f0e7d97160:947316387,51641f6b8217f700c6daf95ded3bebed:1138718735,5e4b83efecd3f70092c9cc59f2f4e26e:-1827626525,4a2b8baf7dd3f700ef089819432e8b11:-1990494137,75cac7af7bd3f7002e46797d6b8291a3:-82975006,9a8f579feed3b700cf54ef0403f39aaa:661263161,df31171b5793b700f4a50f4d90373c1a:280984287,a7d097d7b293b7006cc9d49255bd9c5e:-1037553056,c751e6ff5459f7404d890b44615d8a7d:2052947239,015166ff5559f74022d6206e75270a1d:-779972301,ab21aebf4b59f740aa1e9e61a35886c5:-1434164287,d47559bb4615f7407317031115d6e0df:-779972301</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_css_include_65d77f8cdb617b409eb1d311ce96194c</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_css_include"><m2m_sp_dependency_css_include action="INSERT_OR_UPDATE"><order>200</order><sp_css_include display_value="awesome marker asset css">c175257fdb55f7409eb1d311ce9619c5</sp_css_include><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sys_class_name>m2m_sp_dependency_css_include</sys_class_name><sys_created_by>lil.dicky</sys_created_by><sys_created_on>2019-05-16 22:24:18</sys_created_on><sys_id>65d77f8cdb617b409eb1d311ce96194c</sys_id><sys_mod_count>1</sys_mod_count><sys_name>awesome marker asset css.Leaflet NG</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_css_include_65d77f8cdb617b409eb1d311ce96194c</sys_update_name><sys_updated_by>lil.dicky</sys_updated_by><sys_updated_on>2019-05-16 22:24:25</sys_updated_on></m2m_sp_dependency_css_include></record_update>]]></payload>
<payload_hash>-485134511</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>e7957aeedb48c410993fdc965e9619fd</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d916a0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>awesome marker asset css.Leaflet NG</target_name>
<type>Dependency CSS Includes</type>
<update_domain>global</update_domain>
<update_guid>9fd77f8c70617b40f36b44d01782f569</update_guid>
<update_guid_history>9fd77f8c70617b40f36b44d01782f569:-485134511,9fd77f8c70617b40f36b44d01782f569:-485134511,edd77f8cc9617b40ff52443fef6c294d:1208941746</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_css_19ff8b971b93b70074f3db9cdc4bcbfd</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_css"><sp_css action="INSERT_OR_UPDATE"><css>.leaflet-container .leaflet-control-search {&#13;
	position:relative;&#13;
	float:left;&#13;
	background:#fff;&#13;
	color:#1978cf;&#13;
	border: 2px solid rgba(0,0,0,0.2);&#13;
	background-clip: padding-box;&#13;
	-moz-border-radius: 4px;&#13;
	-webkit-border-radius: 4px;&#13;
	border-radius: 4px;&#13;
	background-color: rgba(255, 255, 255, 0.8);&#13;
	z-index:1000;	&#13;
	margin-left: 10px;&#13;
	margin-top: 10px;&#13;
}&#13;
.leaflet-control-search.search-exp {/*expanded*/&#13;
	background: #fff;&#13;
	border: 2px solid rgba(0,0,0,0.2);&#13;
	background-clip: padding-box;	&#13;
}&#13;
.leaflet-control-search .search-input {&#13;
	display:block;&#13;
	float:left;&#13;
	background: #fff;&#13;
	border:1px solid #666;&#13;
	border-radius:2px;&#13;
	height:22px;&#13;
	padding:0 20px 0 2px;&#13;
	margin:4px 0 4px 4px;&#13;
}&#13;
.leaflet-control-search.search-load .search-input {&#13;
	background: url('loader.gif') no-repeat center right #fff;&#13;
}&#13;
.leaflet-control-search.search-load .search-cancel {&#13;
	visibility:hidden;&#13;
}&#13;
.leaflet-control-search .search-cancel {&#13;
	display:block;&#13;
	width:22px;&#13;
	height:22px;&#13;
	position:absolute;&#13;
	right:28px;&#13;
	margin:6px 0;&#13;
	background: url('search-icon.png') no-repeat 0 -46px;&#13;
	text-decoration:none;&#13;
	filter: alpha(opacity=80);&#13;
	opacity: 0.8;		&#13;
}&#13;
.leaflet-control-search .search-cancel:hover {&#13;
	filter: alpha(opacity=100);&#13;
	opacity: 1;&#13;
}&#13;
.leaflet-control-search .search-cancel span {&#13;
	display:none;/* comment for cancel button imageless */&#13;
	font-size:18px;&#13;
	line-height:20px;&#13;
	color:#ccc;&#13;
	font-weight:bold;&#13;
}&#13;
.leaflet-control-search .search-cancel:hover span {&#13;
	color:#aaa;&#13;
}&#13;
.leaflet-control-search .search-button {&#13;
	display:block;&#13;
	float:left;&#13;
	width:30px;&#13;
	height:30px;	&#13;
	background: url('search-icon.png') no-repeat 4px 4px #fff;&#13;
	border-radius:4px;&#13;
}&#13;
.leaflet-control-search .search-button:hover {&#13;
	background: url('search-icon.png') no-repeat 4px -20px #fafafa;&#13;
}&#13;
.leaflet-control-search .search-tooltip {&#13;
	position:absolute;&#13;
	top:100%;&#13;
	left:0;&#13;
	float:left;&#13;
	list-style: none;&#13;
	padding-left: 0;&#13;
	min-width:120px;&#13;
	max-height:122px;&#13;
	box-shadow: 1px 1px 6px rgba(0,0,0,0.4);&#13;
	background-color: rgba(0, 0, 0, 0.25);&#13;
	z-index:1010;&#13;
	overflow-y:auto;&#13;
	overflow-x:hidden;&#13;
	cursor: pointer;&#13;
}&#13;
.leaflet-control-search .search-tip {&#13;
	margin:2px;&#13;
	padding:2px 4px;&#13;
	display:block;&#13;
	color:black;&#13;
	background: #eee;&#13;
	border-radius:.25em;&#13;
	text-decoration:none;	&#13;
	white-space:nowrap;&#13;
	vertical-align:center;&#13;
}&#13;
.leaflet-control-search .search-button:hover {&#13;
	background-color: #f4f4f4;&#13;
}&#13;
.leaflet-control-search .search-tip-select,&#13;
.leaflet-control-search .search-tip:hover {&#13;
	background-color: #fff;&#13;
}&#13;
.leaflet-control-search .search-alert {&#13;
	cursor:pointer;&#13;
	clear:both;&#13;
	font-size:.75em;&#13;
	margin-bottom:5px;&#13;
	padding:0 .25em;&#13;
	color:#e00;&#13;
	font-weight:bold;&#13;
	border-radius:.25em;&#13;
}&#13;
&#13;
&#13;
</css><name>leaflet search css</name><sys_class_name>sp_css</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-21 21:40:26</sys_created_on><sys_id>19ff8b971b93b70074f3db9cdc4bcbfd</sys_id><sys_mod_count>8</sys_mod_count><sys_name>leaflet search css</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_css_19ff8b971b93b70074f3db9cdc4bcbfd</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-22 15:51:45</sys_updated_on></sp_css></record_update>]]></payload>
<payload_hash>-315818423</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>e795faeedb48c410993fdc965e961912</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d92130000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>leaflet search css</target_name>
<type>Style Sheet</type>
<update_domain>global</update_domain>
<update_guid>fec9c76f55d3f700f21c0009ea1b9c9d</update_guid>
<update_guid_history>fec9c76f55d3f700f21c0009ea1b9c9d:-315818423,c2b9036f8cd3f70098a051c433aa35c1:-1964046007,2799c36fa3d3f7007af5aa60a8458e75:-472682819,6789c36ffbd3f7000c17ad3900939e19:-315818423,0ea7cbab88d3f7004a9ca7d5626bf8d5:-1224361141,9767cbab27d3f7000752b30879b55d7e:-477580029,b6ce135fa5d3b7003c7177a8a8578247:-315818423,7f9e131f9ad3b70018c9a8815c471b48:-475585783,34005b979993b70016571f871e6026bb:1417987785</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_page_9916d9fbdb15f7409eb1d311ce961971</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_page"><sp_page action="INSERT_OR_UPDATE"><category>custom</category><css>.container {
  margin-left:30px;
}</css><draft>false</draft><dynamic_title_structure/><id>asset_map</id><internal>false</internal><public>true</public><roles/><short_description/><sys_class_name>sp_page</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:59:06</sys_created_on><sys_id>9916d9fbdb15f7409eb1d311ce961971</sys_id><sys_mod_count>3</sys_mod_count><sys_name>asset_map</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_page_9916d9fbdb15f7409eb1d311ce961971</sys_update_name><sys_updated_by>brian</sys_updated_by><sys_updated_on>2019-08-21 21:37:06</sys_updated_on><title>Asset Map</title></sp_page><sys_translated_text action="delete_multiple" query="documentkey=9916d9fbdb15f7409eb1d311ce961971"/></record_update>]]></payload>
<payload_hash>-1550283999</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>e795faeedb48c410993fdc965e961915</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16cb61ca5ad0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>asset_map</target_name>
<type>Page</type>
<update_domain>global</update_domain>
<update_guid>7f3f4757bb5f7b8048f9917e3462630f</update_guid>
<update_guid_history>7f3f4757bb5f7b8048f9917e3462630f:-1550283999,e5d03273d3d9f740f55d92b59ad16967:-998567392,3eb0be3382d9f740df0b9fb76834a761:36468194,5916d9fba615f7409e3a96d873d31773:2000126698</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_ui_script_4667176f1b17f70074f3db9cdc4bcb3f</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_ui_script"&gt;&lt;sys_ui_script action="INSERT_OR_UPDATE"&gt;&lt;active&gt;true&lt;/active&gt;&lt;description/&gt;&lt;global&gt;false&lt;/global&gt;&lt;name&gt;x_snc_sp_asset_map.leaflet search layer&lt;/name&gt;&lt;script&gt;&lt;![CDATA[var searchLayer = L.layerGroup().addTo(map);
		//... adding data in searchLayer ...
		map.addControl( new L.Control.Search({layer: searchLayer}) );
		//searchLayer is a L.LayerGroup contains searched markers]]&gt;&lt;/script&gt;&lt;script_name&gt;leaflet search layer&lt;/script_name&gt;&lt;sys_class_name&gt;sys_ui_script&lt;/sys_class_name&gt;&lt;sys_created_by&gt;brian.nguyen&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2019-08-22 16:51:25&lt;/sys_created_on&gt;&lt;sys_id&gt;4667176f1b17f70074f3db9cdc4bcb3f&lt;/sys_id&gt;&lt;sys_mod_count&gt;0&lt;/sys_mod_count&gt;&lt;sys_name&gt;x_snc_sp_asset_map.leaflet search layer&lt;/sys_name&gt;&lt;sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="SP Asset Map"&gt;fd6a882bdb5d77409eb1d311ce961975&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_ui_script_4667176f1b17f70074f3db9cdc4bcb3f&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;brian.nguyen&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2019-08-22 16:51:25&lt;/sys_updated_on&gt;&lt;ui_type&gt;10&lt;/ui_type&gt;&lt;use_scoped_format&gt;false&lt;/use_scoped_format&gt;&lt;/sys_ui_script&gt;&lt;/record_update&gt;</payload>
<payload_hash>486270082</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>e795faeedb48c410993fdc965e961918</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d923f0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>x_snc_sp_asset_map.leaflet search layer</target_name>
<type>UI Script</type>
<update_domain>global</update_domain>
<update_guid>0177576f9a17f700dd156fc01e596f0a</update_guid>
<update_guid_history>0177576f9a17f700dd156fc01e596f0a:486270082</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>db_image_cb9ce4ecdbe5bb409eb1d311ce961932</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="db_image"><db_image action="INSERT_OR_UPDATE"><active>true</active><category/><format>png</format><height>41</height><image>c6ac68ecdbe5bb409eb1d311ce9619b1</image><name>marker-shadow.png</name><size_bytes>618</size_bytes><sys_class_name>db_image</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:28</sys_created_on><sys_id>cb9ce4ecdbe5bb409eb1d311ce961932</sys_id><sys_mod_count>2</sys_mod_count><sys_name>marker-shadow.png</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>db_image_cb9ce4ecdbe5bb409eb1d311ce961932</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-17 20:53:34</sys_updated_on><thumbnail/><width>41</width></db_image><sys_attachment action="INSERT_OR_UPDATE"><average_image_color>#0</average_image_color><chunk_size_bytes>734003</chunk_size_bytes><compressed>true</compressed><content_type>image/png</content_type><encryption_context/><file_name>image</file_name><image_height>41</image_height><image_width>41</image_width><size_bytes>618</size_bytes><size_compressed>641</size_compressed><state>pending</state><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:34</sys_created_on><sys_id>c6ac68ecdbe5bb409eb1d311ce9619b1</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-17 20:53:34</sys_updated_on><table_name>ZZ_YYdb_image</table_name><table_sys_id>cb9ce4ecdbe5bb409eb1d311ce961932</table_sys_id></sys_attachment><sys_attachment_doc action="INSERT_OR_UPDATE"><data>H4sIAAAAAAAAAA==</data><length>16</length><position>0</position><sys_attachment display_value="image" sys_id="c6ac68ecdbe5bb409eb1d311ce9619b1">c6ac68ecdbe5bb409eb1d311ce9619b1</sys_attachment><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:34</sys_created_on><sys_id>0aac68ecdbe5bb409eb1d311ce9619b1</sys_id></sys_attachment_doc><sys_attachment_doc action="INSERT_OR_UPDATE"><data>AWoClf2JUE5HDQoaCgAAAA1JSERSAAAAKQAAACkIBAAAAAJpyH0AAAIxSURBVHgB7dKFjuNAEATQCjP9/38dMzOGDXOt0pSslt3H4p3acPxU251+wv9OH//93JA3ZMfp/fL8EakLfv2tX5L6qp60E7EiY1BcvwkICvZXiIxBccY0nF4J9leFJEFxAx++Q5ZR21/OUuAAQ2ZkNyajZNWa3w5IzZ5fEGncOMdIwW62pLtJuZ6bMGJH7GkoI1QhGR2SRjGECTIagG/JAUQkR5/BKaa8F8m4npoqopacCS8Zk5pldNSAWphQtY1IdRyRm5HUcgiKZQTG61HHDM4tE4gbi8qYIpC3friYiWFLLMB/Wb2UdkclmuUA4wzO1FGIqKan+ul0kNz0DCvLnFNkK17sUe25LzAmB5gat7HbzE1N3TzoOKTu9QyxxA5rzLgOga0IJKQAqU3CmA22mGOsLowgdSRHphbHGzpJznGqfbbaaYJEXMi3yUR0rH6KQK2D3WpLZanBV8F6UkKJAnC/OLF8j1zFlBaCJIl6UqfAESUpi0M5vYwVuGZSKBtF5AFXQKDj6oxdLFdLIZSfhRsXyX7up1IadMLRcsKZqEiBQcuEs6GlUK3DgLNhe8tBZBsk2bGgKw4oDFKAEmejvlq+iWRHDyIgAVyx1zTZ72LIJ3y0fCZ5JKgpOjAiC+xxIZlQ4Ds+4I3lvYFf2ZAztLTBiEw1TvjOCw8GPcdTvCC4B+fHGMVAYETqnA34aMwT3MdjvManzBXExKFhf01e8RYPcdvAl/iCI7gIUhDFdJwfX9Mz7TiSQGIAAAAASUVORK5CYILhjG1VagIAAA==</data><length>844</length><position>1</position><sys_attachment display_value="image" sys_id="c6ac68ecdbe5bb409eb1d311ce9619b1">c6ac68ecdbe5bb409eb1d311ce9619b1</sys_attachment><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:34</sys_created_on><sys_id>caac68ecdbe5bb409eb1d311ce9619b1</sys_id></sys_attachment_doc></record_update>]]></payload>
<payload_hash>981720579</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>eb957aeedb48c410993fdc965e9619fc</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d919b0000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>marker-shadow.png</target_name>
<type>Images</type>
<update_domain>global</update_domain>
<update_guid>46ac68eca3e5bb405887cd5907ae56bb</update_guid>
<update_guid_history>46ac68eca3e5bb405887cd5907ae56bb:981720579,46ac68eca3e5bb405887cd5907ae56bb:981720579,caac68ec0fe5bb40de26bfe42ac9e6b6:-929862140,caac68ec7ce5bb40ccd05e9a6de793b4:-929862140,bcac28ec89e5bb402ffddbe7a2fe0910:-690500356</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_widget_dependency_93941d7bdb15f7409eb1d311ce96196f</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_widget_dependency"><m2m_sp_widget_dependency action="INSERT_OR_UPDATE"><sp_dependency display_value="Leaflet NG">1884d97bdb15f7409eb1d311ce96194b</sp_dependency><sp_widget display_value="Service Portal Asset Map">4a7a40abdb5d77409eb1d311ce9619e6</sp_widget><sys_class_name>m2m_sp_widget_dependency</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:52:41</sys_created_on><sys_id>93941d7bdb15f7409eb1d311ce96196f</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Leaflet NG.Service Portal Asset Map</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_widget_dependency_93941d7bdb15f7409eb1d311ce96196f</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:52:41</sys_updated_on></m2m_sp_widget_dependency></record_update>]]></payload>
<payload_hash>-798900651</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>eb95faeedb48c410993fdc965e961911</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90920000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Leaflet NG.Service Portal Asset Map</target_name>
<type>Widget Dependency</type>
<update_domain>global</update_domain>
<update_guid>db945d7be615f740cece9755c0204a50</update_guid>
<update_guid_history>db945d7be615f740cece9755c0204a50:-798900651,db945d7be615f740cece9755c0204a50:-798900651</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_js_include_3757d36f1b17f70074f3db9cdc4bcb71</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_js_include"><sp_js_include action="INSERT_OR_UPDATE"><display_name>Leaflet Search</display_name><source>local</source><sys_class_name>sp_js_include</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-22 16:51:28</sys_created_on><sys_id>3757d36f1b17f70074f3db9cdc4bcb71</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Leaflet Search</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_ui_script display_value="x_snc_sp_asset_map.leaflet search layer">4667176f1b17f70074f3db9cdc4bcb3f</sys_ui_script><sys_update_name>sp_js_include_3757d36f1b17f70074f3db9cdc4bcb71</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-22 16:51:28</sys_updated_on><url/></sp_js_include></record_update>]]></payload>
<payload_hash>-91591449</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>eb95faeedb48c410993fdc965e961914</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d92460000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>Leaflet Search</target_name>
<type>JS Include</type>
<update_domain>global</update_domain>
<update_guid>f977576fd817f700fd531e23530f2f3b</update_guid>
<update_guid_history>f977576fd817f700fd531e23530f2f3b:-91591449</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_scope_privilege_efd1f427db8b3b409eb1d311ce9619b3</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_scope_privilege"><sys_scope_privilege action="INSERT_OR_UPDATE"><operation>read</operation><source_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</source_scope><status>allowed</status><sys_class_name>sys_scope_privilege</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-08-09 18:32:17</sys_created_on><sys_id>efd1f427db8b3b409eb1d311ce9619b3</sys_id><sys_mod_count>0</sys_mod_count><sys_name>customer_contact</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sys_scope_privilege_efd1f427db8b3b409eb1d311ce9619b3</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-08-09 18:32:17</sys_updated_on><target_name>customer_contact</target_name><target_scope display_value="Global">global</target_scope><target_type>sys_db_object</target_type></sys_scope_privilege></record_update>]]></payload>
<payload_hash>-2107169711</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>eb95faeedb48c410993fdc965e961917</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91a50000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>customer_contact</target_name>
<type>Cross scope privilege</type>
<update_domain>global</update_domain>
<update_guid>27d1f427ce8b3b40181b872b8a1cbeb5</update_guid>
<update_guid_history>27d1f427ce8b3b40181b872b8a1cbeb5:-2107169711,27d1f427ce8b3b40181b872b8a1cbeb5:-2107169711</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>db_image_2f8c64ecdbe5bb409eb1d311ce9619d2</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="db_image"><db_image action="INSERT_OR_UPDATE"><active>true</active><category/><format>png</format><height>82</height><image>029ce4ecdbe5bb409eb1d311ce961908</image><name>marker-icon-2x.png</name><size_bytes>2586</size_bytes><sys_class_name>db_image</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:12</sys_created_on><sys_id>2f8c64ecdbe5bb409eb1d311ce9619d2</sys_id><sys_mod_count>2</sys_mod_count><sys_name>marker-icon-2x.png</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>db_image_2f8c64ecdbe5bb409eb1d311ce9619d2</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-17 20:53:18</sys_updated_on><thumbnail/><width>50</width></db_image><sys_attachment action="INSERT_OR_UPDATE"><average_image_color>#2e84cb</average_image_color><chunk_size_bytes>734003</chunk_size_bytes><compressed>true</compressed><content_type>image/png</content_type><encryption_context/><file_name>image</file_name><image_height>82</image_height><image_width>50</image_width><size_bytes>2586</size_bytes><size_compressed>2518</size_compressed><state>pending</state><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:17</sys_created_on><sys_id>029ce4ecdbe5bb409eb1d311ce961908</sys_id><sys_mod_count>2</sys_mod_count><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-17 20:53:18</sys_updated_on><table_name>ZZ_YYdb_image</table_name><table_sys_id>2f8c64ecdbe5bb409eb1d311ce9619d2</table_sys_id></sys_attachment><sys_attachment_doc action="INSERT_OR_UPDATE"><data>H4sIAAAAAAAAAA==</data><length>16</length><position>0</position><sys_attachment display_value="image" sys_id="029ce4ecdbe5bb409eb1d311ce961908">029ce4ecdbe5bb409eb1d311ce961908</sys_attachment><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:17</sys_created_on><sys_id>429ce4ecdbe5bb409eb1d311ce961908</sys_id></sys_attachment_doc><sys_attachment_doc action="INSERT_OR_UPDATE"><data>ZVV5OJRrGx85hWoYRRHTiVEKs5mxZMjSWBOOxPGRqOiTYYzshTHWYaSsY98HJft2cJAly8yYsSehcmx15CBE8n6jvnP+Off13L/797uf3/2813O913u9VAszQ/DhU4dBIBDY2AhvyavKvLQU5OehjLjfBAh0YMvC1Erf1JWECShVDalWD2tUC2tQo9SrURo1w9N5RD2sQX2/U4clV6tT6rUim3Rj2wwfd6oGV2F9crHBFaqhtWYpfXYFo47F4/aFYxZpLP1HHSi/Qox/qVpo7U3GuEPRmH3RmCq5Bu6XoUausc0ftcweNs8cupI+aJTGtc0bVQmpVA2pVAnmYbVqSJUhnWuVybHOGTWgc5V9Cn7NHTLLGNYKb8A+KFMLKtcIqTRJG9RP4V7PGlR5+ByfwlENLueRy8kcrbBavWSOTe6oVdYINrBML4ljnDr4SzpHJfApNvCpYcqgbiJHP7bVImNYO5Fj8uQl78qWcfVZvw/3vF5Y39r5srPLmflQ1DVxm/67JrnGMnME41+i7FvEQ+2EgbhaDgAAe3vApSecmaVVHfJzvegWZe98jF+x5uOBxAZuHXvaLG1YN6rpGq32fk4b2jufN4uLHyh4McaaWtyXPoW86yh7FxgkDWo8GjCLrkTfzzNJ6L2cOHgxjq31gOGQ0IC+n68ex1YLKFG+n2eUPKRGY6NIuaapQ8GMTpOUIRQpRzWW/cfyOoJAv5LMUYlhXwl7eie5/mrqkHY8F0lIw8d133hcs7y+hSJlI9zTUJ5ZWCqrljmJ8sxEEjMxVJbhk/5rUc8R7nS9x1zlaBbSIx0dxdKhthvG9xokDhomsC/FcRGEVN7CPxlERbI0Yjm8Z8HdUpGRLPQ9+v5WBBPOQ/dURDiTJ5GEFF1aL/wHd0/joWLYvgHOMxDoihQmwm1/SiOGoxDK1IzlakW/hIcxL4T2nyf34yI6FfdtqfLkfvmQ/rPB/TyuTmmTC+rjTV2M5sAe9qlHc2Qe9KkEN/E6uBjumcA+nkc1knM6oBfzsOF8MBPq34uNGOA1pf16VSOYaP9aKd9eSZ9etH/1uSAmJpyN9ClHh/ZhwgfQYQOokJdoygDC+xkyqAvhVTJ5t1+K9yX86W1pdg0krXaNSIvnfw8sZ+J5bxo4d4SyCXyPY077+EHghwLq2genvhMlXlb8v/loF/g7eoB/Rfyrf6jf34T+/SzWwn5Z+/fIpR/FkJcblfvOfXXvn+23+/DKDzjxBVjNB5JUAeCbHBtotB8B2i3/9qC6eMAAgOzvigYAlB/9pf6SLTIIdHDeGK9r5c9XNhSWr6ArAXpLuC/KwMXEEsx8VwCUX/3tZ8SLY8Qm0ZruezU4gnXshOuOcOzUXPAfqzut95zrm3czcZCjERS+hpx1/05GvH4+2kFewlxuRSi/C3PLd7vgxAUbDWi0vHKkEmjiowiEf8l7YPPT570Amc89NdId4fMXTUgyzO5vkBMwol3vWcEivGpGOxaQRq/pQVLYFXbhijHHBHTaP0jJ8ZEFkzPnRs3mkmoPkbMrWmHxfNxdk7LNW8/6Y9oQgoU7oZFnRjJM5rZf1r2GXtWZmo5qMlrs9F1ynckP09UMHXknb5UEEQgbnB3qCYPoea9lmpTuyBbEWvwXJaxt6obSj2adBgu5RCuyjFcupMqOSIutzHpWRZ+cZxoqWr+trVt1mZqD2UNOHsnpq5xQlZxcXoFL0VyjXB40Q01FZG/3zF02jq9qr38IvdN8o2Z2adpr4FVA5Vw50vhu4Epe2Yuxyefdr8qZVuOp8ROBbQG/7S4Elm9PxoSCyG4freYbxMd3OxrFEJnnaUhrBYx9O4tV32F6s05OEphdhSPgFWXlz4lKSgQz7w8bpKysmZP1gjKHGD7BU9YMwGCio+L6Xg4piAymeQuPVt/E5aD5ZaZoV3WijF/vHeC8GlGuwNjRxR0NinCOlCqPWzUiB+jSQ+qmphNZLVSmRwi4ZOgcWbc5jjCRA/I5L4jbnLo+TeC0CjVdXvqWMSP/7ZOtTnx+Z+4k0+7Lm6PthWuCNR7aQo0qEjaixxd9t04Rq977tkWh47HC6TgdSl6AlvQTl8/jMlsKRHGw1nAxzPLXHJGDxkpixdTCpNz1PDFiojB7aDVQV1MMFkkz6LTtw8srS2KITizn994G4kevwW+f2WtJPhFjmTBkP91tR1/fFvpw3uTgPfbXvuBSEaZ+ES2j6DDxHXwO4ratsJm8Sb16dBcMNXIawU/3ZEgzuoStRcS6+JxghnrSBbP4mDPCMcOjDPMB/CdppNXrsAU9+wRDNCmCevxsaI8MyX2+n50NISlhq23eb8Jk/LYyFiIE5go9y6lfd4fAgNuciIxPHAQN0tHFQqENL97JLZGKX0Bv/exHbW7O8phqClr+DHNY3d0U+Pqq4suZgFIt4na0MzI5+0rK9ZU7tsGTc1iHlPhWW9+gQmhf4IOk6l1w5584PtS3M35//XHkL9fNG2/tUnBuKWW2Foypu6dAVlGZdiQ+/4pOkJItgJ9Mdd5Wr4w6cFjLylEkqKOhDJnvLktjlKpLOjN0pUMYesr9Bb3nYU1r0Xkl47eOpq99MZJv6lfweqT9EU2b7XNx9gaLGUpEknaLmrJTHrXGbGFWWxmMoitXj5unN0o11WjebcT9ifhE8Fx4A1/LYh5uaNtLA+QXywtpp0e8MotsbGA9Wjo/O2/w82f6WJzk/N7NRc3R3h66+wk66vSu8atEQQspBW23ca4lAORvHMAQeoPKeCCvYsuaP2X6S97SHQOIivF82ntBDMUODK65f0oJDPaRKLhFJKcdcnIIq3Pi+7Xw2JUS1/9K3LAezaA9LLREXksTv97Xy3W2lLi8/HE88ZmCy8228p5TFzb4j1QcrKNubATuzIpfyn+00A2OsM2u6DlX+ptmuI+DtdlPwdCszsJ74A2l9eYuOY623s+lUi6Srm7N4UrLuTUULOH9Ezlq95Ffqi91IlxLF7t2pseC89wDiAJT0MJSkfhwrSpP2U9CM546rzU0qmDSp+eWiUI9i+Wy0OYvckz54ovy1WVSTk+bSC0+vkk3pKEe0NmWBG/o28mxMSps9g5z4ifc0jNNcxez4djhTniqcr6jYeL6X11ZXl69sm3RiIFGYc6b0y+DfBf17VRuLNooz66j/iMa8UHVn7PrcWI15yDXRVZB8bjmbckZW4hEsRedIBjecdpcXYzMxjtLClCccpAs2WGr08M/HXA6RxZVGMdCqAawQNEI0a78QboD/h0YEs9P7CWflTtGl4U5UAKMI2l8t++YanPNDwXtGhnAEQmRwEdH3ZWjcy9xvD8dyFjfDF+u50j5Hz+1UjIaCgAA</data><length>3344</length><position>1</position><sys_attachment display_value="image" sys_id="029ce4ecdbe5bb409eb1d311ce961908">029ce4ecdbe5bb409eb1d311ce961908</sys_attachment><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-17 20:53:17</sys_created_on><sys_id>069ce4ecdbe5bb409eb1d311ce961908</sys_id></sys_attachment_doc></record_update>]]></payload>
<payload_hash>-1103680709</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>ef957aeedb48c410993fdc965e9619fb</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91900000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>marker-icon-2x.png</target_name>
<type>Images</type>
<update_domain>global</update_domain>
<update_guid>9a9c28ec85e5bb408f25cd92ace99c0a</update_guid>
<update_guid_history>9a9c28ec85e5bb408f25cd92ace99c0a:-1103680709,9a9c28ec85e5bb408f25cd92ace99c0a:-1103680709,169ce4ec21e5bb4062e8a7b3159bea0d:788350688,069ce4ec20e5bb40bc51f94dd0d99d0b:788350688,fc9ca4ecbfe5bb4037811a035097f883:216468384</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>m2m_sp_dependency_js_include_e2c515fbdb15f7409eb1d311ce9619b9</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="m2m_sp_dependency_js_include"><m2m_sp_dependency_js_include action="INSERT_OR_UPDATE"><order>100</order><sp_dependency display_value="awesome marker asset">ed9591fbdb15f7409eb1d311ce961924</sp_dependency><sp_js_include display_value="awesome marker asset">62a515fbdb15f7409eb1d311ce96190c</sp_js_include><sys_class_name>m2m_sp_dependency_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:57:49</sys_created_on><sys_id>e2c515fbdb15f7409eb1d311ce9619b9</sys_id><sys_mod_count>0</sys_mod_count><sys_name>awesome marker asset.awesome marker asset</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>m2m_sp_dependency_js_include_e2c515fbdb15f7409eb1d311ce9619b9</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 15:57:49</sys_updated_on></m2m_sp_dependency_js_include></record_update>]]></payload>
<payload_hash>940538017</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>ef95faeedb48c410993fdc965e961910</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d90c10000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>awesome marker asset.awesome marker asset</target_name>
<type>Dependency JS Includes</type>
<update_domain>global</update_domain>
<update_guid>eac5d5fb7015f7409d0cde630d8c5d1b</update_guid>
<update_guid_history>eac5d5fb7015f7409d0cde630d8c5d1b:940538017,eac5d5fb7015f7409d0cde630d8c5d1b:940538017</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sp_dependency_ed9591fbdb15f7409eb1d311ce961924</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_dependency"><sp_dependency action="INSERT_OR_UPDATE"><module/><name>awesome marker asset</name><page_load>false</page_load><sp_portals/><sys_class_name>sp_dependency</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2019-05-15 15:57:11</sys_created_on><sys_id>ed9591fbdb15f7409eb1d311ce961924</sys_id><sys_mod_count>4</sys_mod_count><sys_name>awesome marker asset</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sp_dependency_ed9591fbdb15f7409eb1d311ce961924</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2019-05-15 21:16:21</sys_updated_on></sp_dependency></record_update>]]></payload>
<payload_hash>-584825695</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>ef95faeedb48c410993fdc965e961913</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d91230000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>awesome marker asset</target_name>
<type>Widget Dependency</type>
<update_domain>global</update_domain>
<update_guid>58be1e3f8559f7409e9fe35a3bc4b57c</update_guid>
<update_guid_history>58be1e3f8559f7409e9fe35a3bc4b57c:-584825695,58be1e3f8559f7409e9fe35a3bc4b57c:-584825695,539ed63f0159f7407b01068cf0675ccc:-1276628483,0c689a776459f74071107521a8ab5f5e:-584825695,03285677d459f740118dd56fcef9512e:1408412166,4da591fb8f15f740e6f8321b2aaf1429:-584825695</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</application>
<category>customer</category>
<comments/>
<name>sys_scope_privilege_b5db9a59dbebb300e246e64305961960</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_scope_privilege"><sys_scope_privilege action="INSERT_OR_UPDATE"><operation>read</operation><source_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</source_scope><status>allowed</status><sys_class_name>sys_scope_privilege</sys_class_name><sys_created_by>brian.nguyen</sys_created_by><sys_created_on>2019-08-27 23:00:20</sys_created_on><sys_id>b5db9a59dbebb300e246e64305961960</sys_id><sys_mod_count>0</sys_mod_count><sys_name>sys_attachment</sys_name><sys_package display_value="SP Asset Map" source="x_snc_sp_asset_map">fd6a882bdb5d77409eb1d311ce961975</sys_package><sys_policy/><sys_scope display_value="SP Asset Map">fd6a882bdb5d77409eb1d311ce961975</sys_scope><sys_update_name>sys_scope_privilege_b5db9a59dbebb300e246e64305961960</sys_update_name><sys_updated_by>brian.nguyen</sys_updated_by><sys_updated_on>2019-08-27 23:00:20</sys_updated_on><target_name>sys_attachment</target_name><target_scope display_value="Global">global</target_scope><target_type>sys_db_object</target_type></sys_scope_privilege></record_update>]]></payload>
<payload_hash>1670242129</payload_hash>
<remote_update_set display_value="Location Map">a7957aeedb48c410993fdc965e9619fb</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2019-09-25 18:36:46</sys_created_on>
<sys_id>ef95faeedb48c410993fdc965e961916</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_recorded_at>16d693d92840000001</sys_recorded_at>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2019-09-25 18:36:46</sys_updated_on>
<table/>
<target_name>sys_attachment</target_name>
<type>Cross scope privilege</type>
<update_domain>global</update_domain>
<update_guid>3ddb9a5935ebb300cf6a574c3b813861</update_guid>
<update_guid_history>3ddb9a5935ebb300cf6a574c3b813861:1670242129</update_guid_history>
<update_set display_value=""/>
<view/>
</sys_update_xml>
</unload>
